function gC(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in t)){const u=Object.getOwnPropertyDescriptor(i,o);u&&Object.defineProperty(t,o,u.get?u:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();var _C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bm(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var m2={exports:{}},Nm={},g2={exports:{}},Zt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nd=Symbol.for("react.element"),yC=Symbol.for("react.portal"),vC=Symbol.for("react.fragment"),xC=Symbol.for("react.strict_mode"),bC=Symbol.for("react.profiler"),wC=Symbol.for("react.provider"),TC=Symbol.for("react.context"),EC=Symbol.for("react.forward_ref"),SC=Symbol.for("react.suspense"),AC=Symbol.for("react.memo"),PC=Symbol.for("react.lazy"),qb=Symbol.iterator;function IC(t){return t===null||typeof t!="object"?null:(t=qb&&t[qb]||t["@@iterator"],typeof t=="function"?t:null)}var _2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y2=Object.assign,v2={};function Mu(t,e,n){this.props=t,this.context=e,this.refs=v2,this.updater=n||_2}Mu.prototype.isReactComponent={};Mu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Mu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function x2(){}x2.prototype=Mu.prototype;function Bv(t,e,n){this.props=t,this.context=e,this.refs=v2,this.updater=n||_2}var Nv=Bv.prototype=new x2;Nv.constructor=Bv;y2(Nv,Mu.prototype);Nv.isPureReactComponent=!0;var Zb=Array.isArray,b2=Object.prototype.hasOwnProperty,Uv={current:null},w2={key:!0,ref:!0,__self:!0,__source:!0};function T2(t,e,n){var i,o={},u=null,f=null;if(e!=null)for(i in e.ref!==void 0&&(f=e.ref),e.key!==void 0&&(u=""+e.key),e)b2.call(e,i)&&!w2.hasOwnProperty(i)&&(o[i]=e[i]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var b=Array(l),w=0;w<l;w++)b[w]=arguments[w+2];o.children=b}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)o[i]===void 0&&(o[i]=l[i]);return{$$typeof:Nd,type:t,key:u,ref:f,props:o,_owner:Uv.current}}function CC(t,e){return{$$typeof:Nd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Vv(t){return typeof t=="object"&&t!==null&&t.$$typeof===Nd}function MC(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Xb=/\/+/g;function f_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?MC(""+t.key):e.toString(36)}function Dp(t,e,n,i,o){var u=typeof t;(u==="undefined"||u==="boolean")&&(t=null);var f=!1;if(t===null)f=!0;else switch(u){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case Nd:case yC:f=!0}}if(f)return f=t,o=o(f),t=i===""?"."+f_(f,0):i,Zb(o)?(n="",t!=null&&(n=t.replace(Xb,"$&/")+"/"),Dp(o,e,n,"",function(w){return w})):o!=null&&(Vv(o)&&(o=CC(o,n+(!o.key||f&&f.key===o.key?"":(""+o.key).replace(Xb,"$&/")+"/")+t)),e.push(o)),1;if(f=0,i=i===""?".":i+":",Zb(t))for(var l=0;l<t.length;l++){u=t[l];var b=i+f_(u,l);f+=Dp(u,e,n,b,o)}else if(b=IC(t),typeof b=="function")for(t=b.call(t),l=0;!(u=t.next()).done;)u=u.value,b=i+f_(u,l++),f+=Dp(u,e,n,b,o);else if(u==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return f}function rp(t,e,n){if(t==null)return t;var i=[],o=0;return Dp(t,i,"","",function(u){return e.call(n,u,o++)}),i}function LC(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Rr={current:null},zp={transition:null},kC={ReactCurrentDispatcher:Rr,ReactCurrentBatchConfig:zp,ReactCurrentOwner:Uv};function E2(){throw Error("act(...) is not supported in production builds of React.")}Zt.Children={map:rp,forEach:function(t,e,n){rp(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return rp(t,function(){e++}),e},toArray:function(t){return rp(t,function(e){return e})||[]},only:function(t){if(!Vv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Zt.Component=Mu;Zt.Fragment=vC;Zt.Profiler=bC;Zt.PureComponent=Bv;Zt.StrictMode=xC;Zt.Suspense=SC;Zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kC;Zt.act=E2;Zt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=y2({},t.props),o=t.key,u=t.ref,f=t._owner;if(e!=null){if(e.ref!==void 0&&(u=e.ref,f=Uv.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(b in e)b2.call(e,b)&&!w2.hasOwnProperty(b)&&(i[b]=e[b]===void 0&&l!==void 0?l[b]:e[b])}var b=arguments.length-2;if(b===1)i.children=n;else if(1<b){l=Array(b);for(var w=0;w<b;w++)l[w]=arguments[w+2];i.children=l}return{$$typeof:Nd,type:t.type,key:o,ref:u,props:i,_owner:f}};Zt.createContext=function(t){return t={$$typeof:TC,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:wC,_context:t},t.Consumer=t};Zt.createElement=T2;Zt.createFactory=function(t){var e=T2.bind(null,t);return e.type=t,e};Zt.createRef=function(){return{current:null}};Zt.forwardRef=function(t){return{$$typeof:EC,render:t}};Zt.isValidElement=Vv;Zt.lazy=function(t){return{$$typeof:PC,_payload:{_status:-1,_result:t},_init:LC}};Zt.memo=function(t,e){return{$$typeof:AC,type:t,compare:e===void 0?null:e}};Zt.startTransition=function(t){var e=zp.transition;zp.transition={};try{t()}finally{zp.transition=e}};Zt.unstable_act=E2;Zt.useCallback=function(t,e){return Rr.current.useCallback(t,e)};Zt.useContext=function(t){return Rr.current.useContext(t)};Zt.useDebugValue=function(){};Zt.useDeferredValue=function(t){return Rr.current.useDeferredValue(t)};Zt.useEffect=function(t,e){return Rr.current.useEffect(t,e)};Zt.useId=function(){return Rr.current.useId()};Zt.useImperativeHandle=function(t,e,n){return Rr.current.useImperativeHandle(t,e,n)};Zt.useInsertionEffect=function(t,e){return Rr.current.useInsertionEffect(t,e)};Zt.useLayoutEffect=function(t,e){return Rr.current.useLayoutEffect(t,e)};Zt.useMemo=function(t,e){return Rr.current.useMemo(t,e)};Zt.useReducer=function(t,e,n){return Rr.current.useReducer(t,e,n)};Zt.useRef=function(t){return Rr.current.useRef(t)};Zt.useState=function(t){return Rr.current.useState(t)};Zt.useSyncExternalStore=function(t,e,n){return Rr.current.useSyncExternalStore(t,e,n)};Zt.useTransition=function(){return Rr.current.useTransition()};Zt.version="18.3.1";g2.exports=Zt;var gn=g2.exports;const RC=Bm(gn);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DC=gn,zC=Symbol.for("react.element"),OC=Symbol.for("react.fragment"),FC=Object.prototype.hasOwnProperty,BC=DC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,NC={key:!0,ref:!0,__self:!0,__source:!0};function S2(t,e,n){var i,o={},u=null,f=null;n!==void 0&&(u=""+n),e.key!==void 0&&(u=""+e.key),e.ref!==void 0&&(f=e.ref);for(i in e)FC.call(e,i)&&!NC.hasOwnProperty(i)&&(o[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)o[i]===void 0&&(o[i]=e[i]);return{$$typeof:zC,type:t,key:u,ref:f,props:o,_owner:BC.current}}Nm.Fragment=OC;Nm.jsx=S2;Nm.jsxs=S2;m2.exports=Nm;var at=m2.exports,vy={},A2={exports:{}},_s={},P2={exports:{}},I2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Ye,Tt){var pt=Ye.length;Ye.push(Tt);e:for(;0<pt;){var Ot=pt-1>>>1,Mt=Ye[Ot];if(0<o(Mt,Tt))Ye[Ot]=Tt,Ye[pt]=Mt,pt=Ot;else break e}}function n(Ye){return Ye.length===0?null:Ye[0]}function i(Ye){if(Ye.length===0)return null;var Tt=Ye[0],pt=Ye.pop();if(pt!==Tt){Ye[0]=pt;e:for(var Ot=0,Mt=Ye.length,Kt=Mt>>>1;Ot<Kt;){var vn=2*(Ot+1)-1,mr=Ye[vn],Ii=vn+1,dn=Ye[Ii];if(0>o(mr,pt))Ii<Mt&&0>o(dn,mr)?(Ye[Ot]=dn,Ye[Ii]=pt,Ot=Ii):(Ye[Ot]=mr,Ye[vn]=pt,Ot=vn);else if(Ii<Mt&&0>o(dn,pt))Ye[Ot]=dn,Ye[Ii]=pt,Ot=Ii;else break e}}return Tt}function o(Ye,Tt){var pt=Ye.sortIndex-Tt.sortIndex;return pt!==0?pt:Ye.id-Tt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var f=Date,l=f.now();t.unstable_now=function(){return f.now()-l}}var b=[],w=[],C=1,L=null,k=3,H=!1,K=!1,re=!1,ce=typeof setTimeout=="function"?setTimeout:null,W=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(Ye){for(var Tt=n(w);Tt!==null;){if(Tt.callback===null)i(w);else if(Tt.startTime<=Ye)i(w),Tt.sortIndex=Tt.expirationTime,e(b,Tt);else break;Tt=n(w)}}function fe(Ye){if(re=!1,Z(Ye),!K)if(n(b)!==null)K=!0,Sn(Te);else{var Tt=n(w);Tt!==null&&Xt(fe,Tt.startTime-Ye)}}function Te(Ye,Tt){K=!1,re&&(re=!1,W(Oe),Oe=-1),H=!0;var pt=k;try{for(Z(Tt),L=n(b);L!==null&&(!(L.expirationTime>Tt)||Ye&&!Re());){var Ot=L.callback;if(typeof Ot=="function"){L.callback=null,k=L.priorityLevel;var Mt=Ot(L.expirationTime<=Tt);Tt=t.unstable_now(),typeof Mt=="function"?L.callback=Mt:L===n(b)&&i(b),Z(Tt)}else i(b);L=n(b)}if(L!==null)var Kt=!0;else{var vn=n(w);vn!==null&&Xt(fe,vn.startTime-Tt),Kt=!1}return Kt}finally{L=null,k=pt,H=!1}}var Pe=!1,ze=null,Oe=-1,Me=5,Ee=-1;function Re(){return!(t.unstable_now()-Ee<Me)}function nt(){if(ze!==null){var Ye=t.unstable_now();Ee=Ye;var Tt=!0;try{Tt=ze(!0,Ye)}finally{Tt?rt():(Pe=!1,ze=null)}}else Pe=!1}var rt;if(typeof G=="function")rt=function(){G(nt)};else if(typeof MessageChannel<"u"){var yt=new MessageChannel,Dt=yt.port2;yt.port1.onmessage=nt,rt=function(){Dt.postMessage(null)}}else rt=function(){ce(nt,0)};function Sn(Ye){ze=Ye,Pe||(Pe=!0,rt())}function Xt(Ye,Tt){Oe=ce(function(){Ye(t.unstable_now())},Tt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ye){Ye.callback=null},t.unstable_continueExecution=function(){K||H||(K=!0,Sn(Te))},t.unstable_forceFrameRate=function(Ye){0>Ye||125<Ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Me=0<Ye?Math.floor(1e3/Ye):5},t.unstable_getCurrentPriorityLevel=function(){return k},t.unstable_getFirstCallbackNode=function(){return n(b)},t.unstable_next=function(Ye){switch(k){case 1:case 2:case 3:var Tt=3;break;default:Tt=k}var pt=k;k=Tt;try{return Ye()}finally{k=pt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ye,Tt){switch(Ye){case 1:case 2:case 3:case 4:case 5:break;default:Ye=3}var pt=k;k=Ye;try{return Tt()}finally{k=pt}},t.unstable_scheduleCallback=function(Ye,Tt,pt){var Ot=t.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?Ot+pt:Ot):pt=Ot,Ye){case 1:var Mt=-1;break;case 2:Mt=250;break;case 5:Mt=1073741823;break;case 4:Mt=1e4;break;default:Mt=5e3}return Mt=pt+Mt,Ye={id:C++,callback:Tt,priorityLevel:Ye,startTime:pt,expirationTime:Mt,sortIndex:-1},pt>Ot?(Ye.sortIndex=pt,e(w,Ye),n(b)===null&&Ye===n(w)&&(re?(W(Oe),Oe=-1):re=!0,Xt(fe,pt-Ot))):(Ye.sortIndex=Mt,e(b,Ye),K||H||(K=!0,Sn(Te))),Ye},t.unstable_shouldYield=Re,t.unstable_wrapCallback=function(Ye){var Tt=k;return function(){var pt=k;k=Tt;try{return Ye.apply(this,arguments)}finally{k=pt}}}})(I2);P2.exports=I2;var UC=P2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VC=gn,ms=UC;function Ze(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var C2=new Set,fd={};function Yl(t,e){pu(t,e),pu(t+"Capture",e)}function pu(t,e){for(fd[t]=e,t=0;t<e.length;t++)C2.add(e[t])}var ta=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xy=Object.prototype.hasOwnProperty,jC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Yb={},Kb={};function GC(t){return xy.call(Kb,t)?!0:xy.call(Yb,t)?!1:jC.test(t)?Kb[t]=!0:(Yb[t]=!0,!1)}function $C(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function HC(t,e,n,i){if(e===null||typeof e>"u"||$C(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Dr(t,e,n,i,o,u,f){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=u,this.removeEmptyString=f}var Xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Xi[t]=new Dr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Xi[e]=new Dr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Xi[t]=new Dr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Xi[t]=new Dr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Xi[t]=new Dr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Xi[t]=new Dr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Xi[t]=new Dr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Xi[t]=new Dr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Xi[t]=new Dr(t,5,!1,t.toLowerCase(),null,!1,!1)});var jv=/[\-:]([a-z])/g;function Gv(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(jv,Gv);Xi[e]=new Dr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(jv,Gv);Xi[e]=new Dr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(jv,Gv);Xi[e]=new Dr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Xi[t]=new Dr(t,1,!1,t.toLowerCase(),null,!1,!1)});Xi.xlinkHref=new Dr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Xi[t]=new Dr(t,1,!1,t.toLowerCase(),null,!0,!0)});function $v(t,e,n,i){var o=Xi.hasOwnProperty(e)?Xi[e]:null;(o!==null?o.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(HC(e,n,o,i)&&(n=null),i||o===null?GC(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,i=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var la=VC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,sp=Symbol.for("react.element"),Hc=Symbol.for("react.portal"),Wc=Symbol.for("react.fragment"),Hv=Symbol.for("react.strict_mode"),by=Symbol.for("react.profiler"),M2=Symbol.for("react.provider"),L2=Symbol.for("react.context"),Wv=Symbol.for("react.forward_ref"),wy=Symbol.for("react.suspense"),Ty=Symbol.for("react.suspense_list"),qv=Symbol.for("react.memo"),Oa=Symbol.for("react.lazy"),k2=Symbol.for("react.offscreen"),Jb=Symbol.iterator;function Dh(t){return t===null||typeof t!="object"?null:(t=Jb&&t[Jb]||t["@@iterator"],typeof t=="function"?t:null)}var Jn=Object.assign,p_;function Zh(t){if(p_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);p_=e&&e[1]||""}return`
`+p_+t}var m_=!1;function g_(t,e){if(!t||m_)return"";m_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var i=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){i=w}t.call(e.prototype)}else{try{throw Error()}catch(w){i=w}t()}}catch(w){if(w&&i&&typeof w.stack=="string"){for(var o=w.stack.split(`
`),u=i.stack.split(`
`),f=o.length-1,l=u.length-1;1<=f&&0<=l&&o[f]!==u[l];)l--;for(;1<=f&&0<=l;f--,l--)if(o[f]!==u[l]){if(f!==1||l!==1)do if(f--,l--,0>l||o[f]!==u[l]){var b=`
`+o[f].replace(" at new "," at ");return t.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",t.displayName)),b}while(1<=f&&0<=l);break}}}finally{m_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Zh(t):""}function WC(t){switch(t.tag){case 5:return Zh(t.type);case 16:return Zh("Lazy");case 13:return Zh("Suspense");case 19:return Zh("SuspenseList");case 0:case 2:case 15:return t=g_(t.type,!1),t;case 11:return t=g_(t.type.render,!1),t;case 1:return t=g_(t.type,!0),t;default:return""}}function Ey(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Wc:return"Fragment";case Hc:return"Portal";case by:return"Profiler";case Hv:return"StrictMode";case wy:return"Suspense";case Ty:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case L2:return(t.displayName||"Context")+".Consumer";case M2:return(t._context.displayName||"Context")+".Provider";case Wv:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case qv:return e=t.displayName||null,e!==null?e:Ey(t.type)||"Memo";case Oa:e=t._payload,t=t._init;try{return Ey(t(e))}catch{}}return null}function qC(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ey(e);case 8:return e===Hv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function el(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function R2(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ZC(t){var e=R2(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,u=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(f){i=""+f,u.call(this,f)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(f){i=""+f},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function op(t){t._valueTracker||(t._valueTracker=ZC(t))}function D2(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=R2(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function em(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Sy(t,e){var n=e.checked;return Jn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Qb(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=el(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function z2(t,e){e=e.checked,e!=null&&$v(t,"checked",e,!1)}function Ay(t,e){z2(t,e);var n=el(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Py(t,e.type,n):e.hasOwnProperty("defaultValue")&&Py(t,e.type,el(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function e1(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Py(t,e,n){(e!=="number"||em(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Xh=Array.isArray;function su(t,e,n,i){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&i&&(t[n].defaultSelected=!0)}else{for(n=""+el(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,i&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function Iy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ze(91));return Jn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function t1(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ze(92));if(Xh(n)){if(1<n.length)throw Error(Ze(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:el(n)}}function O2(t,e){var n=el(e.value),i=el(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function n1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function F2(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Cy(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?F2(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ap,B2=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ap=ap||document.createElement("div"),ap.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ap.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function pd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ed={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},XC=["Webkit","ms","Moz","O"];Object.keys(ed).forEach(function(t){XC.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ed[e]=ed[t]})});function N2(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ed.hasOwnProperty(t)&&ed[t]?(""+e).trim():e+"px"}function U2(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,o=N2(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,o):t[n]=o}}var YC=Jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function My(t,e){if(e){if(YC[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ze(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ze(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ze(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ze(62))}}function Ly(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ky=null;function Zv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ry=null,ou=null,au=null;function i1(t){if(t=jd(t)){if(typeof Ry!="function")throw Error(Ze(280));var e=t.stateNode;e&&(e=$m(e),Ry(t.stateNode,t.type,e))}}function V2(t){ou?au?au.push(t):au=[t]:ou=t}function j2(){if(ou){var t=ou,e=au;if(au=ou=null,i1(t),e)for(t=0;t<e.length;t++)i1(e[t])}}function G2(t,e){return t(e)}function $2(){}var __=!1;function H2(t,e,n){if(__)return t(e,n);__=!0;try{return G2(t,e,n)}finally{__=!1,(ou!==null||au!==null)&&($2(),j2())}}function md(t,e){var n=t.stateNode;if(n===null)return null;var i=$m(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ze(231,e,typeof n));return n}var Dy=!1;if(ta)try{var zh={};Object.defineProperty(zh,"passive",{get:function(){Dy=!0}}),window.addEventListener("test",zh,zh),window.removeEventListener("test",zh,zh)}catch{Dy=!1}function KC(t,e,n,i,o,u,f,l,b){var w=Array.prototype.slice.call(arguments,3);try{e.apply(n,w)}catch(C){this.onError(C)}}var td=!1,tm=null,nm=!1,zy=null,JC={onError:function(t){td=!0,tm=t}};function QC(t,e,n,i,o,u,f,l,b){td=!1,tm=null,KC.apply(JC,arguments)}function eM(t,e,n,i,o,u,f,l,b){if(QC.apply(this,arguments),td){if(td){var w=tm;td=!1,tm=null}else throw Error(Ze(198));nm||(nm=!0,zy=w)}}function Kl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function W2(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function r1(t){if(Kl(t)!==t)throw Error(Ze(188))}function tM(t){var e=t.alternate;if(!e){if(e=Kl(t),e===null)throw Error(Ze(188));return e!==t?null:t}for(var n=t,i=e;;){var o=n.return;if(o===null)break;var u=o.alternate;if(u===null){if(i=o.return,i!==null){n=i;continue}break}if(o.child===u.child){for(u=o.child;u;){if(u===n)return r1(o),t;if(u===i)return r1(o),e;u=u.sibling}throw Error(Ze(188))}if(n.return!==i.return)n=o,i=u;else{for(var f=!1,l=o.child;l;){if(l===n){f=!0,n=o,i=u;break}if(l===i){f=!0,i=o,n=u;break}l=l.sibling}if(!f){for(l=u.child;l;){if(l===n){f=!0,n=u,i=o;break}if(l===i){f=!0,i=u,n=o;break}l=l.sibling}if(!f)throw Error(Ze(189))}}if(n.alternate!==i)throw Error(Ze(190))}if(n.tag!==3)throw Error(Ze(188));return n.stateNode.current===n?t:e}function q2(t){return t=tM(t),t!==null?Z2(t):null}function Z2(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Z2(t);if(e!==null)return e;t=t.sibling}return null}var X2=ms.unstable_scheduleCallback,s1=ms.unstable_cancelCallback,nM=ms.unstable_shouldYield,iM=ms.unstable_requestPaint,pi=ms.unstable_now,rM=ms.unstable_getCurrentPriorityLevel,Xv=ms.unstable_ImmediatePriority,Y2=ms.unstable_UserBlockingPriority,im=ms.unstable_NormalPriority,sM=ms.unstable_LowPriority,K2=ms.unstable_IdlePriority,Um=null,Po=null;function oM(t){if(Po&&typeof Po.onCommitFiberRoot=="function")try{Po.onCommitFiberRoot(Um,t,void 0,(t.current.flags&128)===128)}catch{}}var ro=Math.clz32?Math.clz32:cM,aM=Math.log,lM=Math.LN2;function cM(t){return t>>>=0,t===0?32:31-(aM(t)/lM|0)|0}var lp=64,cp=4194304;function Yh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function rm(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,o=t.suspendedLanes,u=t.pingedLanes,f=n&268435455;if(f!==0){var l=f&~o;l!==0?i=Yh(l):(u&=f,u!==0&&(i=Yh(u)))}else f=n&~o,f!==0?i=Yh(f):u!==0&&(i=Yh(u));if(i===0)return 0;if(e!==0&&e!==i&&!(e&o)&&(o=i&-i,u=e&-e,o>=u||o===16&&(u&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-ro(e),o=1<<n,i|=t[n],e&=~o;return i}function uM(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hM(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,o=t.expirationTimes,u=t.pendingLanes;0<u;){var f=31-ro(u),l=1<<f,b=o[f];b===-1?(!(l&n)||l&i)&&(o[f]=uM(l,e)):b<=e&&(t.expiredLanes|=l),u&=~l}}function Oy(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function J2(){var t=lp;return lp<<=1,!(lp&4194240)&&(lp=64),t}function y_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ud(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ro(e),t[e]=n}function dM(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-ro(n),u=1<<o;e[o]=0,i[o]=-1,t[o]=-1,n&=~u}}function Yv(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-ro(n),o=1<<i;o&e|t[i]&e&&(t[i]|=e),n&=~o}}var yn=0;function Q2(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var eE,Kv,tE,nE,iE,Fy=!1,up=[],$a=null,Ha=null,Wa=null,gd=new Map,_d=new Map,Ba=[],fM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function o1(t,e){switch(t){case"focusin":case"focusout":$a=null;break;case"dragenter":case"dragleave":Ha=null;break;case"mouseover":case"mouseout":Wa=null;break;case"pointerover":case"pointerout":gd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_d.delete(e.pointerId)}}function Oh(t,e,n,i,o,u){return t===null||t.nativeEvent!==u?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:u,targetContainers:[o]},e!==null&&(e=jd(e),e!==null&&Kv(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function pM(t,e,n,i,o){switch(e){case"focusin":return $a=Oh($a,t,e,n,i,o),!0;case"dragenter":return Ha=Oh(Ha,t,e,n,i,o),!0;case"mouseover":return Wa=Oh(Wa,t,e,n,i,o),!0;case"pointerover":var u=o.pointerId;return gd.set(u,Oh(gd.get(u)||null,t,e,n,i,o)),!0;case"gotpointercapture":return u=o.pointerId,_d.set(u,Oh(_d.get(u)||null,t,e,n,i,o)),!0}return!1}function rE(t){var e=Dl(t.target);if(e!==null){var n=Kl(e);if(n!==null){if(e=n.tag,e===13){if(e=W2(n),e!==null){t.blockedOn=e,iE(t.priority,function(){tE(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Op(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=By(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);ky=i,n.target.dispatchEvent(i),ky=null}else return e=jd(n),e!==null&&Kv(e),t.blockedOn=n,!1;e.shift()}return!0}function a1(t,e,n){Op(t)&&n.delete(e)}function mM(){Fy=!1,$a!==null&&Op($a)&&($a=null),Ha!==null&&Op(Ha)&&(Ha=null),Wa!==null&&Op(Wa)&&(Wa=null),gd.forEach(a1),_d.forEach(a1)}function Fh(t,e){t.blockedOn===e&&(t.blockedOn=null,Fy||(Fy=!0,ms.unstable_scheduleCallback(ms.unstable_NormalPriority,mM)))}function yd(t){function e(o){return Fh(o,t)}if(0<up.length){Fh(up[0],t);for(var n=1;n<up.length;n++){var i=up[n];i.blockedOn===t&&(i.blockedOn=null)}}for($a!==null&&Fh($a,t),Ha!==null&&Fh(Ha,t),Wa!==null&&Fh(Wa,t),gd.forEach(e),_d.forEach(e),n=0;n<Ba.length;n++)i=Ba[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Ba.length&&(n=Ba[0],n.blockedOn===null);)rE(n),n.blockedOn===null&&Ba.shift()}var lu=la.ReactCurrentBatchConfig,sm=!0;function gM(t,e,n,i){var o=yn,u=lu.transition;lu.transition=null;try{yn=1,Jv(t,e,n,i)}finally{yn=o,lu.transition=u}}function _M(t,e,n,i){var o=yn,u=lu.transition;lu.transition=null;try{yn=4,Jv(t,e,n,i)}finally{yn=o,lu.transition=u}}function Jv(t,e,n,i){if(sm){var o=By(t,e,n,i);if(o===null)I_(t,e,i,om,n),o1(t,i);else if(pM(o,t,e,n,i))i.stopPropagation();else if(o1(t,i),e&4&&-1<fM.indexOf(t)){for(;o!==null;){var u=jd(o);if(u!==null&&eE(u),u=By(t,e,n,i),u===null&&I_(t,e,i,om,n),u===o)break;o=u}o!==null&&i.stopPropagation()}else I_(t,e,i,null,n)}}var om=null;function By(t,e,n,i){if(om=null,t=Zv(i),t=Dl(t),t!==null)if(e=Kl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=W2(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return om=t,null}function sE(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rM()){case Xv:return 1;case Y2:return 4;case im:case sM:return 16;case K2:return 536870912;default:return 16}default:return 16}}var Ua=null,Qv=null,Fp=null;function oE(){if(Fp)return Fp;var t,e=Qv,n=e.length,i,o="value"in Ua?Ua.value:Ua.textContent,u=o.length;for(t=0;t<n&&e[t]===o[t];t++);var f=n-t;for(i=1;i<=f&&e[n-i]===o[u-i];i++);return Fp=o.slice(t,1<i?1-i:void 0)}function Bp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function hp(){return!0}function l1(){return!1}function ys(t){function e(n,i,o,u,f){this._reactName=n,this._targetInst=o,this.type=i,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(u):u[l]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?hp:l1,this.isPropagationStopped=l1,this}return Jn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=hp)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=hp)},persist:function(){},isPersistent:hp}),e}var Lu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},e0=ys(Lu),Vd=Jn({},Lu,{view:0,detail:0}),yM=ys(Vd),v_,x_,Bh,Vm=Jn({},Vd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:t0,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Bh&&(Bh&&t.type==="mousemove"?(v_=t.screenX-Bh.screenX,x_=t.screenY-Bh.screenY):x_=v_=0,Bh=t),v_)},movementY:function(t){return"movementY"in t?t.movementY:x_}}),c1=ys(Vm),vM=Jn({},Vm,{dataTransfer:0}),xM=ys(vM),bM=Jn({},Vd,{relatedTarget:0}),b_=ys(bM),wM=Jn({},Lu,{animationName:0,elapsedTime:0,pseudoElement:0}),TM=ys(wM),EM=Jn({},Lu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),SM=ys(EM),AM=Jn({},Lu,{data:0}),u1=ys(AM),PM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MM(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=CM[t])?!!e[t]:!1}function t0(){return MM}var LM=Jn({},Vd,{key:function(t){if(t.key){var e=PM[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Bp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?IM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:t0,charCode:function(t){return t.type==="keypress"?Bp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Bp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),kM=ys(LM),RM=Jn({},Vm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),h1=ys(RM),DM=Jn({},Vd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:t0}),zM=ys(DM),OM=Jn({},Lu,{propertyName:0,elapsedTime:0,pseudoElement:0}),FM=ys(OM),BM=Jn({},Vm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),NM=ys(BM),UM=[9,13,27,32],n0=ta&&"CompositionEvent"in window,nd=null;ta&&"documentMode"in document&&(nd=document.documentMode);var VM=ta&&"TextEvent"in window&&!nd,aE=ta&&(!n0||nd&&8<nd&&11>=nd),d1=" ",f1=!1;function lE(t,e){switch(t){case"keyup":return UM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var qc=!1;function jM(t,e){switch(t){case"compositionend":return cE(e);case"keypress":return e.which!==32?null:(f1=!0,d1);case"textInput":return t=e.data,t===d1&&f1?null:t;default:return null}}function GM(t,e){if(qc)return t==="compositionend"||!n0&&lE(t,e)?(t=oE(),Fp=Qv=Ua=null,qc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return aE&&e.locale!=="ko"?null:e.data;default:return null}}var $M={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function p1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!$M[t.type]:e==="textarea"}function uE(t,e,n,i){V2(i),e=am(e,"onChange"),0<e.length&&(n=new e0("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var id=null,vd=null;function HM(t){bE(t,0)}function jm(t){var e=Yc(t);if(D2(e))return t}function WM(t,e){if(t==="change")return e}var hE=!1;if(ta){var w_;if(ta){var T_="oninput"in document;if(!T_){var m1=document.createElement("div");m1.setAttribute("oninput","return;"),T_=typeof m1.oninput=="function"}w_=T_}else w_=!1;hE=w_&&(!document.documentMode||9<document.documentMode)}function g1(){id&&(id.detachEvent("onpropertychange",dE),vd=id=null)}function dE(t){if(t.propertyName==="value"&&jm(vd)){var e=[];uE(e,vd,t,Zv(t)),H2(HM,e)}}function qM(t,e,n){t==="focusin"?(g1(),id=e,vd=n,id.attachEvent("onpropertychange",dE)):t==="focusout"&&g1()}function ZM(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return jm(vd)}function XM(t,e){if(t==="click")return jm(e)}function YM(t,e){if(t==="input"||t==="change")return jm(e)}function KM(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ao=typeof Object.is=="function"?Object.is:KM;function xd(t,e){if(ao(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var o=n[i];if(!xy.call(e,o)||!ao(t[o],e[o]))return!1}return!0}function _1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function y1(t,e){var n=_1(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_1(n)}}function fE(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?fE(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function pE(){for(var t=window,e=em();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=em(t.document)}return e}function i0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function JM(t){var e=pE(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&fE(n.ownerDocument.documentElement,n)){if(i!==null&&i0(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,u=Math.min(i.start,o);i=i.end===void 0?u:Math.min(i.end,o),!t.extend&&u>i&&(o=i,i=u,u=o),o=y1(n,u);var f=y1(n,i);o&&f&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==f.node||t.focusOffset!==f.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),u>i?(t.addRange(e),t.extend(f.node,f.offset)):(e.setEnd(f.node,f.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var QM=ta&&"documentMode"in document&&11>=document.documentMode,Zc=null,Ny=null,rd=null,Uy=!1;function v1(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Uy||Zc==null||Zc!==em(i)||(i=Zc,"selectionStart"in i&&i0(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),rd&&xd(rd,i)||(rd=i,i=am(Ny,"onSelect"),0<i.length&&(e=new e0("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Zc)))}function dp(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Xc={animationend:dp("Animation","AnimationEnd"),animationiteration:dp("Animation","AnimationIteration"),animationstart:dp("Animation","AnimationStart"),transitionend:dp("Transition","TransitionEnd")},E_={},mE={};ta&&(mE=document.createElement("div").style,"AnimationEvent"in window||(delete Xc.animationend.animation,delete Xc.animationiteration.animation,delete Xc.animationstart.animation),"TransitionEvent"in window||delete Xc.transitionend.transition);function Gm(t){if(E_[t])return E_[t];if(!Xc[t])return t;var e=Xc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in mE)return E_[t]=e[n];return t}var gE=Gm("animationend"),_E=Gm("animationiteration"),yE=Gm("animationstart"),vE=Gm("transitionend"),xE=new Map,x1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function il(t,e){xE.set(t,e),Yl(e,[t])}for(var S_=0;S_<x1.length;S_++){var A_=x1[S_],eL=A_.toLowerCase(),tL=A_[0].toUpperCase()+A_.slice(1);il(eL,"on"+tL)}il(gE,"onAnimationEnd");il(_E,"onAnimationIteration");il(yE,"onAnimationStart");il("dblclick","onDoubleClick");il("focusin","onFocus");il("focusout","onBlur");il(vE,"onTransitionEnd");pu("onMouseEnter",["mouseout","mouseover"]);pu("onMouseLeave",["mouseout","mouseover"]);pu("onPointerEnter",["pointerout","pointerover"]);pu("onPointerLeave",["pointerout","pointerover"]);Yl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Yl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Yl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Yl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Yl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Yl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kh));function b1(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,eM(i,e,void 0,t),t.currentTarget=null}function bE(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],o=i.event;i=i.listeners;e:{var u=void 0;if(e)for(var f=i.length-1;0<=f;f--){var l=i[f],b=l.instance,w=l.currentTarget;if(l=l.listener,b!==u&&o.isPropagationStopped())break e;b1(o,l,w),u=b}else for(f=0;f<i.length;f++){if(l=i[f],b=l.instance,w=l.currentTarget,l=l.listener,b!==u&&o.isPropagationStopped())break e;b1(o,l,w),u=b}}}if(nm)throw t=zy,nm=!1,zy=null,t}function Bn(t,e){var n=e[Hy];n===void 0&&(n=e[Hy]=new Set);var i=t+"__bubble";n.has(i)||(wE(e,t,2,!1),n.add(i))}function P_(t,e,n){var i=0;e&&(i|=4),wE(n,t,i,e)}var fp="_reactListening"+Math.random().toString(36).slice(2);function bd(t){if(!t[fp]){t[fp]=!0,C2.forEach(function(n){n!=="selectionchange"&&(nL.has(n)||P_(n,!1,t),P_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[fp]||(e[fp]=!0,P_("selectionchange",!1,e))}}function wE(t,e,n,i){switch(sE(e)){case 1:var o=gM;break;case 4:o=_M;break;default:o=Jv}n=o.bind(null,e,n,t),o=void 0,!Dy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),i?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function I_(t,e,n,i,o){var u=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var f=i.tag;if(f===3||f===4){var l=i.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(f===4)for(f=i.return;f!==null;){var b=f.tag;if((b===3||b===4)&&(b=f.stateNode.containerInfo,b===o||b.nodeType===8&&b.parentNode===o))return;f=f.return}for(;l!==null;){if(f=Dl(l),f===null)return;if(b=f.tag,b===5||b===6){i=u=f;continue e}l=l.parentNode}}i=i.return}H2(function(){var w=u,C=Zv(n),L=[];e:{var k=xE.get(t);if(k!==void 0){var H=e0,K=t;switch(t){case"keypress":if(Bp(n)===0)break e;case"keydown":case"keyup":H=kM;break;case"focusin":K="focus",H=b_;break;case"focusout":K="blur",H=b_;break;case"beforeblur":case"afterblur":H=b_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=c1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=xM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=zM;break;case gE:case _E:case yE:H=TM;break;case vE:H=FM;break;case"scroll":H=yM;break;case"wheel":H=NM;break;case"copy":case"cut":case"paste":H=SM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=h1}var re=(e&4)!==0,ce=!re&&t==="scroll",W=re?k!==null?k+"Capture":null:k;re=[];for(var G=w,Z;G!==null;){Z=G;var fe=Z.stateNode;if(Z.tag===5&&fe!==null&&(Z=fe,W!==null&&(fe=md(G,W),fe!=null&&re.push(wd(G,fe,Z)))),ce)break;G=G.return}0<re.length&&(k=new H(k,K,null,n,C),L.push({event:k,listeners:re}))}}if(!(e&7)){e:{if(k=t==="mouseover"||t==="pointerover",H=t==="mouseout"||t==="pointerout",k&&n!==ky&&(K=n.relatedTarget||n.fromElement)&&(Dl(K)||K[na]))break e;if((H||k)&&(k=C.window===C?C:(k=C.ownerDocument)?k.defaultView||k.parentWindow:window,H?(K=n.relatedTarget||n.toElement,H=w,K=K?Dl(K):null,K!==null&&(ce=Kl(K),K!==ce||K.tag!==5&&K.tag!==6)&&(K=null)):(H=null,K=w),H!==K)){if(re=c1,fe="onMouseLeave",W="onMouseEnter",G="mouse",(t==="pointerout"||t==="pointerover")&&(re=h1,fe="onPointerLeave",W="onPointerEnter",G="pointer"),ce=H==null?k:Yc(H),Z=K==null?k:Yc(K),k=new re(fe,G+"leave",H,n,C),k.target=ce,k.relatedTarget=Z,fe=null,Dl(C)===w&&(re=new re(W,G+"enter",K,n,C),re.target=Z,re.relatedTarget=ce,fe=re),ce=fe,H&&K)t:{for(re=H,W=K,G=0,Z=re;Z;Z=Fc(Z))G++;for(Z=0,fe=W;fe;fe=Fc(fe))Z++;for(;0<G-Z;)re=Fc(re),G--;for(;0<Z-G;)W=Fc(W),Z--;for(;G--;){if(re===W||W!==null&&re===W.alternate)break t;re=Fc(re),W=Fc(W)}re=null}else re=null;H!==null&&w1(L,k,H,re,!1),K!==null&&ce!==null&&w1(L,ce,K,re,!0)}}e:{if(k=w?Yc(w):window,H=k.nodeName&&k.nodeName.toLowerCase(),H==="select"||H==="input"&&k.type==="file")var Te=WM;else if(p1(k))if(hE)Te=YM;else{Te=ZM;var Pe=qM}else(H=k.nodeName)&&H.toLowerCase()==="input"&&(k.type==="checkbox"||k.type==="radio")&&(Te=XM);if(Te&&(Te=Te(t,w))){uE(L,Te,n,C);break e}Pe&&Pe(t,k,w),t==="focusout"&&(Pe=k._wrapperState)&&Pe.controlled&&k.type==="number"&&Py(k,"number",k.value)}switch(Pe=w?Yc(w):window,t){case"focusin":(p1(Pe)||Pe.contentEditable==="true")&&(Zc=Pe,Ny=w,rd=null);break;case"focusout":rd=Ny=Zc=null;break;case"mousedown":Uy=!0;break;case"contextmenu":case"mouseup":case"dragend":Uy=!1,v1(L,n,C);break;case"selectionchange":if(QM)break;case"keydown":case"keyup":v1(L,n,C)}var ze;if(n0)e:{switch(t){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else qc?lE(t,n)&&(Oe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Oe="onCompositionStart");Oe&&(aE&&n.locale!=="ko"&&(qc||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&qc&&(ze=oE()):(Ua=C,Qv="value"in Ua?Ua.value:Ua.textContent,qc=!0)),Pe=am(w,Oe),0<Pe.length&&(Oe=new u1(Oe,t,null,n,C),L.push({event:Oe,listeners:Pe}),ze?Oe.data=ze:(ze=cE(n),ze!==null&&(Oe.data=ze)))),(ze=VM?jM(t,n):GM(t,n))&&(w=am(w,"onBeforeInput"),0<w.length&&(C=new u1("onBeforeInput","beforeinput",null,n,C),L.push({event:C,listeners:w}),C.data=ze))}bE(L,e)})}function wd(t,e,n){return{instance:t,listener:e,currentTarget:n}}function am(t,e){for(var n=e+"Capture",i=[];t!==null;){var o=t,u=o.stateNode;o.tag===5&&u!==null&&(o=u,u=md(t,n),u!=null&&i.unshift(wd(t,u,o)),u=md(t,e),u!=null&&i.push(wd(t,u,o))),t=t.return}return i}function Fc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function w1(t,e,n,i,o){for(var u=e._reactName,f=[];n!==null&&n!==i;){var l=n,b=l.alternate,w=l.stateNode;if(b!==null&&b===i)break;l.tag===5&&w!==null&&(l=w,o?(b=md(n,u),b!=null&&f.unshift(wd(n,b,l))):o||(b=md(n,u),b!=null&&f.push(wd(n,b,l)))),n=n.return}f.length!==0&&t.push({event:e,listeners:f})}var iL=/\r\n?/g,rL=/\u0000|\uFFFD/g;function T1(t){return(typeof t=="string"?t:""+t).replace(iL,`
`).replace(rL,"")}function pp(t,e,n){if(e=T1(e),T1(t)!==e&&n)throw Error(Ze(425))}function lm(){}var Vy=null,jy=null;function Gy(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var $y=typeof setTimeout=="function"?setTimeout:void 0,sL=typeof clearTimeout=="function"?clearTimeout:void 0,E1=typeof Promise=="function"?Promise:void 0,oL=typeof queueMicrotask=="function"?queueMicrotask:typeof E1<"u"?function(t){return E1.resolve(null).then(t).catch(aL)}:$y;function aL(t){setTimeout(function(){throw t})}function C_(t,e){var n=e,i=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(i===0){t.removeChild(o),yd(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=o}while(n);yd(e)}function qa(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function S1(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ku=Math.random().toString(36).slice(2),To="__reactFiber$"+ku,Td="__reactProps$"+ku,na="__reactContainer$"+ku,Hy="__reactEvents$"+ku,lL="__reactListeners$"+ku,cL="__reactHandles$"+ku;function Dl(t){var e=t[To];if(e)return e;for(var n=t.parentNode;n;){if(e=n[na]||n[To]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=S1(t);t!==null;){if(n=t[To])return n;t=S1(t)}return e}t=n,n=t.parentNode}return null}function jd(t){return t=t[To]||t[na],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Yc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ze(33))}function $m(t){return t[Td]||null}var Wy=[],Kc=-1;function rl(t){return{current:t}}function Nn(t){0>Kc||(t.current=Wy[Kc],Wy[Kc]=null,Kc--)}function Dn(t,e){Kc++,Wy[Kc]=t.current,t.current=e}var tl={},pr=rl(tl),Zr=rl(!1),Vl=tl;function mu(t,e){var n=t.type.contextTypes;if(!n)return tl;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var o={},u;for(u in n)o[u]=e[u];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Xr(t){return t=t.childContextTypes,t!=null}function cm(){Nn(Zr),Nn(pr)}function A1(t,e,n){if(pr.current!==tl)throw Error(Ze(168));Dn(pr,e),Dn(Zr,n)}function TE(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var o in i)if(!(o in e))throw Error(Ze(108,qC(t)||"Unknown",o));return Jn({},n,i)}function um(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||tl,Vl=pr.current,Dn(pr,t),Dn(Zr,Zr.current),!0}function P1(t,e,n){var i=t.stateNode;if(!i)throw Error(Ze(169));n?(t=TE(t,e,Vl),i.__reactInternalMemoizedMergedChildContext=t,Nn(Zr),Nn(pr),Dn(pr,t)):Nn(Zr),Dn(Zr,n)}var Yo=null,Hm=!1,M_=!1;function EE(t){Yo===null?Yo=[t]:Yo.push(t)}function uL(t){Hm=!0,EE(t)}function sl(){if(!M_&&Yo!==null){M_=!0;var t=0,e=yn;try{var n=Yo;for(yn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Yo=null,Hm=!1}catch(o){throw Yo!==null&&(Yo=Yo.slice(t+1)),X2(Xv,sl),o}finally{yn=e,M_=!1}}return null}var Jc=[],Qc=0,hm=null,dm=0,ks=[],Rs=0,jl=null,Jo=1,Qo="";function Ll(t,e){Jc[Qc++]=dm,Jc[Qc++]=hm,hm=t,dm=e}function SE(t,e,n){ks[Rs++]=Jo,ks[Rs++]=Qo,ks[Rs++]=jl,jl=t;var i=Jo;t=Qo;var o=32-ro(i)-1;i&=~(1<<o),n+=1;var u=32-ro(e)+o;if(30<u){var f=o-o%5;u=(i&(1<<f)-1).toString(32),i>>=f,o-=f,Jo=1<<32-ro(e)+o|n<<o|i,Qo=u+t}else Jo=1<<u|n<<o|i,Qo=t}function r0(t){t.return!==null&&(Ll(t,1),SE(t,1,0))}function s0(t){for(;t===hm;)hm=Jc[--Qc],Jc[Qc]=null,dm=Jc[--Qc],Jc[Qc]=null;for(;t===jl;)jl=ks[--Rs],ks[Rs]=null,Qo=ks[--Rs],ks[Rs]=null,Jo=ks[--Rs],ks[Rs]=null}var fs=null,ds=null,Wn=!1,no=null;function AE(t,e){var n=Ds(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function I1(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,fs=t,ds=qa(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,fs=t,ds=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=jl!==null?{id:Jo,overflow:Qo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Ds(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,fs=t,ds=null,!0):!1;default:return!1}}function qy(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Zy(t){if(Wn){var e=ds;if(e){var n=e;if(!I1(t,e)){if(qy(t))throw Error(Ze(418));e=qa(n.nextSibling);var i=fs;e&&I1(t,e)?AE(i,n):(t.flags=t.flags&-4097|2,Wn=!1,fs=t)}}else{if(qy(t))throw Error(Ze(418));t.flags=t.flags&-4097|2,Wn=!1,fs=t}}}function C1(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;fs=t}function mp(t){if(t!==fs)return!1;if(!Wn)return C1(t),Wn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Gy(t.type,t.memoizedProps)),e&&(e=ds)){if(qy(t))throw PE(),Error(Ze(418));for(;e;)AE(t,e),e=qa(e.nextSibling)}if(C1(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ze(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ds=qa(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ds=null}}else ds=fs?qa(t.stateNode.nextSibling):null;return!0}function PE(){for(var t=ds;t;)t=qa(t.nextSibling)}function gu(){ds=fs=null,Wn=!1}function o0(t){no===null?no=[t]:no.push(t)}var hL=la.ReactCurrentBatchConfig;function Nh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ze(309));var i=n.stateNode}if(!i)throw Error(Ze(147,t));var o=i,u=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===u?e.ref:(e=function(f){var l=o.refs;f===null?delete l[u]:l[u]=f},e._stringRef=u,e)}if(typeof t!="string")throw Error(Ze(284));if(!n._owner)throw Error(Ze(290,t))}return t}function gp(t,e){throw t=Object.prototype.toString.call(e),Error(Ze(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function M1(t){var e=t._init;return e(t._payload)}function IE(t){function e(W,G){if(t){var Z=W.deletions;Z===null?(W.deletions=[G],W.flags|=16):Z.push(G)}}function n(W,G){if(!t)return null;for(;G!==null;)e(W,G),G=G.sibling;return null}function i(W,G){for(W=new Map;G!==null;)G.key!==null?W.set(G.key,G):W.set(G.index,G),G=G.sibling;return W}function o(W,G){return W=Ka(W,G),W.index=0,W.sibling=null,W}function u(W,G,Z){return W.index=Z,t?(Z=W.alternate,Z!==null?(Z=Z.index,Z<G?(W.flags|=2,G):Z):(W.flags|=2,G)):(W.flags|=1048576,G)}function f(W){return t&&W.alternate===null&&(W.flags|=2),W}function l(W,G,Z,fe){return G===null||G.tag!==6?(G=F_(Z,W.mode,fe),G.return=W,G):(G=o(G,Z),G.return=W,G)}function b(W,G,Z,fe){var Te=Z.type;return Te===Wc?C(W,G,Z.props.children,fe,Z.key):G!==null&&(G.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===Oa&&M1(Te)===G.type)?(fe=o(G,Z.props),fe.ref=Nh(W,G,Z),fe.return=W,fe):(fe=Hp(Z.type,Z.key,Z.props,null,W.mode,fe),fe.ref=Nh(W,G,Z),fe.return=W,fe)}function w(W,G,Z,fe){return G===null||G.tag!==4||G.stateNode.containerInfo!==Z.containerInfo||G.stateNode.implementation!==Z.implementation?(G=B_(Z,W.mode,fe),G.return=W,G):(G=o(G,Z.children||[]),G.return=W,G)}function C(W,G,Z,fe,Te){return G===null||G.tag!==7?(G=Nl(Z,W.mode,fe,Te),G.return=W,G):(G=o(G,Z),G.return=W,G)}function L(W,G,Z){if(typeof G=="string"&&G!==""||typeof G=="number")return G=F_(""+G,W.mode,Z),G.return=W,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case sp:return Z=Hp(G.type,G.key,G.props,null,W.mode,Z),Z.ref=Nh(W,null,G),Z.return=W,Z;case Hc:return G=B_(G,W.mode,Z),G.return=W,G;case Oa:var fe=G._init;return L(W,fe(G._payload),Z)}if(Xh(G)||Dh(G))return G=Nl(G,W.mode,Z,null),G.return=W,G;gp(W,G)}return null}function k(W,G,Z,fe){var Te=G!==null?G.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return Te!==null?null:l(W,G,""+Z,fe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case sp:return Z.key===Te?b(W,G,Z,fe):null;case Hc:return Z.key===Te?w(W,G,Z,fe):null;case Oa:return Te=Z._init,k(W,G,Te(Z._payload),fe)}if(Xh(Z)||Dh(Z))return Te!==null?null:C(W,G,Z,fe,null);gp(W,Z)}return null}function H(W,G,Z,fe,Te){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return W=W.get(Z)||null,l(G,W,""+fe,Te);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case sp:return W=W.get(fe.key===null?Z:fe.key)||null,b(G,W,fe,Te);case Hc:return W=W.get(fe.key===null?Z:fe.key)||null,w(G,W,fe,Te);case Oa:var Pe=fe._init;return H(W,G,Z,Pe(fe._payload),Te)}if(Xh(fe)||Dh(fe))return W=W.get(Z)||null,C(G,W,fe,Te,null);gp(G,fe)}return null}function K(W,G,Z,fe){for(var Te=null,Pe=null,ze=G,Oe=G=0,Me=null;ze!==null&&Oe<Z.length;Oe++){ze.index>Oe?(Me=ze,ze=null):Me=ze.sibling;var Ee=k(W,ze,Z[Oe],fe);if(Ee===null){ze===null&&(ze=Me);break}t&&ze&&Ee.alternate===null&&e(W,ze),G=u(Ee,G,Oe),Pe===null?Te=Ee:Pe.sibling=Ee,Pe=Ee,ze=Me}if(Oe===Z.length)return n(W,ze),Wn&&Ll(W,Oe),Te;if(ze===null){for(;Oe<Z.length;Oe++)ze=L(W,Z[Oe],fe),ze!==null&&(G=u(ze,G,Oe),Pe===null?Te=ze:Pe.sibling=ze,Pe=ze);return Wn&&Ll(W,Oe),Te}for(ze=i(W,ze);Oe<Z.length;Oe++)Me=H(ze,W,Oe,Z[Oe],fe),Me!==null&&(t&&Me.alternate!==null&&ze.delete(Me.key===null?Oe:Me.key),G=u(Me,G,Oe),Pe===null?Te=Me:Pe.sibling=Me,Pe=Me);return t&&ze.forEach(function(Re){return e(W,Re)}),Wn&&Ll(W,Oe),Te}function re(W,G,Z,fe){var Te=Dh(Z);if(typeof Te!="function")throw Error(Ze(150));if(Z=Te.call(Z),Z==null)throw Error(Ze(151));for(var Pe=Te=null,ze=G,Oe=G=0,Me=null,Ee=Z.next();ze!==null&&!Ee.done;Oe++,Ee=Z.next()){ze.index>Oe?(Me=ze,ze=null):Me=ze.sibling;var Re=k(W,ze,Ee.value,fe);if(Re===null){ze===null&&(ze=Me);break}t&&ze&&Re.alternate===null&&e(W,ze),G=u(Re,G,Oe),Pe===null?Te=Re:Pe.sibling=Re,Pe=Re,ze=Me}if(Ee.done)return n(W,ze),Wn&&Ll(W,Oe),Te;if(ze===null){for(;!Ee.done;Oe++,Ee=Z.next())Ee=L(W,Ee.value,fe),Ee!==null&&(G=u(Ee,G,Oe),Pe===null?Te=Ee:Pe.sibling=Ee,Pe=Ee);return Wn&&Ll(W,Oe),Te}for(ze=i(W,ze);!Ee.done;Oe++,Ee=Z.next())Ee=H(ze,W,Oe,Ee.value,fe),Ee!==null&&(t&&Ee.alternate!==null&&ze.delete(Ee.key===null?Oe:Ee.key),G=u(Ee,G,Oe),Pe===null?Te=Ee:Pe.sibling=Ee,Pe=Ee);return t&&ze.forEach(function(nt){return e(W,nt)}),Wn&&Ll(W,Oe),Te}function ce(W,G,Z,fe){if(typeof Z=="object"&&Z!==null&&Z.type===Wc&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case sp:e:{for(var Te=Z.key,Pe=G;Pe!==null;){if(Pe.key===Te){if(Te=Z.type,Te===Wc){if(Pe.tag===7){n(W,Pe.sibling),G=o(Pe,Z.props.children),G.return=W,W=G;break e}}else if(Pe.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===Oa&&M1(Te)===Pe.type){n(W,Pe.sibling),G=o(Pe,Z.props),G.ref=Nh(W,Pe,Z),G.return=W,W=G;break e}n(W,Pe);break}else e(W,Pe);Pe=Pe.sibling}Z.type===Wc?(G=Nl(Z.props.children,W.mode,fe,Z.key),G.return=W,W=G):(fe=Hp(Z.type,Z.key,Z.props,null,W.mode,fe),fe.ref=Nh(W,G,Z),fe.return=W,W=fe)}return f(W);case Hc:e:{for(Pe=Z.key;G!==null;){if(G.key===Pe)if(G.tag===4&&G.stateNode.containerInfo===Z.containerInfo&&G.stateNode.implementation===Z.implementation){n(W,G.sibling),G=o(G,Z.children||[]),G.return=W,W=G;break e}else{n(W,G);break}else e(W,G);G=G.sibling}G=B_(Z,W.mode,fe),G.return=W,W=G}return f(W);case Oa:return Pe=Z._init,ce(W,G,Pe(Z._payload),fe)}if(Xh(Z))return K(W,G,Z,fe);if(Dh(Z))return re(W,G,Z,fe);gp(W,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,G!==null&&G.tag===6?(n(W,G.sibling),G=o(G,Z),G.return=W,W=G):(n(W,G),G=F_(Z,W.mode,fe),G.return=W,W=G),f(W)):n(W,G)}return ce}var _u=IE(!0),CE=IE(!1),fm=rl(null),pm=null,eu=null,a0=null;function l0(){a0=eu=pm=null}function c0(t){var e=fm.current;Nn(fm),t._currentValue=e}function Xy(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function cu(t,e){pm=t,a0=eu=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(qr=!0),t.firstContext=null)}function Bs(t){var e=t._currentValue;if(a0!==t)if(t={context:t,memoizedValue:e,next:null},eu===null){if(pm===null)throw Error(Ze(308));eu=t,pm.dependencies={lanes:0,firstContext:t}}else eu=eu.next=t;return e}var zl=null;function u0(t){zl===null?zl=[t]:zl.push(t)}function ME(t,e,n,i){var o=e.interleaved;return o===null?(n.next=n,u0(e)):(n.next=o.next,o.next=n),e.interleaved=n,ia(t,i)}function ia(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Fa=!1;function h0(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function LE(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ea(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Za(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,rn&2){var o=i.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),i.pending=e,ia(t,n)}return o=i.interleaved,o===null?(e.next=e,u0(i)):(e.next=o.next,o.next=e),i.interleaved=e,ia(t,n)}function Np(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Yv(t,n)}}function L1(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var o=null,u=null;if(n=n.firstBaseUpdate,n!==null){do{var f={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};u===null?o=u=f:u=u.next=f,n=n.next}while(n!==null);u===null?o=u=e:u=u.next=e}else o=u=e;n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:u,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function mm(t,e,n,i){var o=t.updateQueue;Fa=!1;var u=o.firstBaseUpdate,f=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var b=l,w=b.next;b.next=null,f===null?u=w:f.next=w,f=b;var C=t.alternate;C!==null&&(C=C.updateQueue,l=C.lastBaseUpdate,l!==f&&(l===null?C.firstBaseUpdate=w:l.next=w,C.lastBaseUpdate=b))}if(u!==null){var L=o.baseState;f=0,C=w=b=null,l=u;do{var k=l.lane,H=l.eventTime;if((i&k)===k){C!==null&&(C=C.next={eventTime:H,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var K=t,re=l;switch(k=e,H=n,re.tag){case 1:if(K=re.payload,typeof K=="function"){L=K.call(H,L,k);break e}L=K;break e;case 3:K.flags=K.flags&-65537|128;case 0:if(K=re.payload,k=typeof K=="function"?K.call(H,L,k):K,k==null)break e;L=Jn({},L,k);break e;case 2:Fa=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,k=o.effects,k===null?o.effects=[l]:k.push(l))}else H={eventTime:H,lane:k,tag:l.tag,payload:l.payload,callback:l.callback,next:null},C===null?(w=C=H,b=L):C=C.next=H,f|=k;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;k=l,l=k.next,k.next=null,o.lastBaseUpdate=k,o.shared.pending=null}}while(!0);if(C===null&&(b=L),o.baseState=b,o.firstBaseUpdate=w,o.lastBaseUpdate=C,e=o.shared.interleaved,e!==null){o=e;do f|=o.lane,o=o.next;while(o!==e)}else u===null&&(o.shared.lanes=0);$l|=f,t.lanes=f,t.memoizedState=L}}function k1(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],o=i.callback;if(o!==null){if(i.callback=null,i=n,typeof o!="function")throw Error(Ze(191,o));o.call(i)}}}var Gd={},Io=rl(Gd),Ed=rl(Gd),Sd=rl(Gd);function Ol(t){if(t===Gd)throw Error(Ze(174));return t}function d0(t,e){switch(Dn(Sd,e),Dn(Ed,t),Dn(Io,Gd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Cy(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Cy(e,t)}Nn(Io),Dn(Io,e)}function yu(){Nn(Io),Nn(Ed),Nn(Sd)}function kE(t){Ol(Sd.current);var e=Ol(Io.current),n=Cy(e,t.type);e!==n&&(Dn(Ed,t),Dn(Io,n))}function f0(t){Ed.current===t&&(Nn(Io),Nn(Ed))}var Yn=rl(0);function gm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var L_=[];function p0(){for(var t=0;t<L_.length;t++)L_[t]._workInProgressVersionPrimary=null;L_.length=0}var Up=la.ReactCurrentDispatcher,k_=la.ReactCurrentBatchConfig,Gl=0,Kn=null,Si=null,Oi=null,_m=!1,sd=!1,Ad=0,dL=0;function lr(){throw Error(Ze(321))}function m0(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ao(t[n],e[n]))return!1;return!0}function g0(t,e,n,i,o,u){if(Gl=u,Kn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Up.current=t===null||t.memoizedState===null?gL:_L,t=n(i,o),sd){u=0;do{if(sd=!1,Ad=0,25<=u)throw Error(Ze(301));u+=1,Oi=Si=null,e.updateQueue=null,Up.current=yL,t=n(i,o)}while(sd)}if(Up.current=ym,e=Si!==null&&Si.next!==null,Gl=0,Oi=Si=Kn=null,_m=!1,e)throw Error(Ze(300));return t}function _0(){var t=Ad!==0;return Ad=0,t}function wo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?Kn.memoizedState=Oi=t:Oi=Oi.next=t,Oi}function Ns(){if(Si===null){var t=Kn.alternate;t=t!==null?t.memoizedState:null}else t=Si.next;var e=Oi===null?Kn.memoizedState:Oi.next;if(e!==null)Oi=e,Si=t;else{if(t===null)throw Error(Ze(310));Si=t,t={memoizedState:Si.memoizedState,baseState:Si.baseState,baseQueue:Si.baseQueue,queue:Si.queue,next:null},Oi===null?Kn.memoizedState=Oi=t:Oi=Oi.next=t}return Oi}function Pd(t,e){return typeof e=="function"?e(t):e}function R_(t){var e=Ns(),n=e.queue;if(n===null)throw Error(Ze(311));n.lastRenderedReducer=t;var i=Si,o=i.baseQueue,u=n.pending;if(u!==null){if(o!==null){var f=o.next;o.next=u.next,u.next=f}i.baseQueue=o=u,n.pending=null}if(o!==null){u=o.next,i=i.baseState;var l=f=null,b=null,w=u;do{var C=w.lane;if((Gl&C)===C)b!==null&&(b=b.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),i=w.hasEagerState?w.eagerState:t(i,w.action);else{var L={lane:C,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};b===null?(l=b=L,f=i):b=b.next=L,Kn.lanes|=C,$l|=C}w=w.next}while(w!==null&&w!==u);b===null?f=i:b.next=l,ao(i,e.memoizedState)||(qr=!0),e.memoizedState=i,e.baseState=f,e.baseQueue=b,n.lastRenderedState=i}if(t=n.interleaved,t!==null){o=t;do u=o.lane,Kn.lanes|=u,$l|=u,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function D_(t){var e=Ns(),n=e.queue;if(n===null)throw Error(Ze(311));n.lastRenderedReducer=t;var i=n.dispatch,o=n.pending,u=e.memoizedState;if(o!==null){n.pending=null;var f=o=o.next;do u=t(u,f.action),f=f.next;while(f!==o);ao(u,e.memoizedState)||(qr=!0),e.memoizedState=u,e.baseQueue===null&&(e.baseState=u),n.lastRenderedState=u}return[u,i]}function RE(){}function DE(t,e){var n=Kn,i=Ns(),o=e(),u=!ao(i.memoizedState,o);if(u&&(i.memoizedState=o,qr=!0),i=i.queue,y0(FE.bind(null,n,i,t),[t]),i.getSnapshot!==e||u||Oi!==null&&Oi.memoizedState.tag&1){if(n.flags|=2048,Id(9,OE.bind(null,n,i,o,e),void 0,null),Fi===null)throw Error(Ze(349));Gl&30||zE(n,e,o)}return o}function zE(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Kn.updateQueue,e===null?(e={lastEffect:null,stores:null},Kn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function OE(t,e,n,i){e.value=n,e.getSnapshot=i,BE(e)&&NE(t)}function FE(t,e,n){return n(function(){BE(e)&&NE(t)})}function BE(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ao(t,n)}catch{return!0}}function NE(t){var e=ia(t,1);e!==null&&so(e,t,1,-1)}function R1(t){var e=wo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Pd,lastRenderedState:t},e.queue=t,t=t.dispatch=mL.bind(null,Kn,t),[e.memoizedState,t]}function Id(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Kn.updateQueue,e===null?(e={lastEffect:null,stores:null},Kn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function UE(){return Ns().memoizedState}function Vp(t,e,n,i){var o=wo();Kn.flags|=t,o.memoizedState=Id(1|e,n,void 0,i===void 0?null:i)}function Wm(t,e,n,i){var o=Ns();i=i===void 0?null:i;var u=void 0;if(Si!==null){var f=Si.memoizedState;if(u=f.destroy,i!==null&&m0(i,f.deps)){o.memoizedState=Id(e,n,u,i);return}}Kn.flags|=t,o.memoizedState=Id(1|e,n,u,i)}function D1(t,e){return Vp(8390656,8,t,e)}function y0(t,e){return Wm(2048,8,t,e)}function VE(t,e){return Wm(4,2,t,e)}function jE(t,e){return Wm(4,4,t,e)}function GE(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function $E(t,e,n){return n=n!=null?n.concat([t]):null,Wm(4,4,GE.bind(null,e,t),n)}function v0(){}function HE(t,e){var n=Ns();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&m0(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function WE(t,e){var n=Ns();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&m0(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function qE(t,e,n){return Gl&21?(ao(n,e)||(n=J2(),Kn.lanes|=n,$l|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,qr=!0),t.memoizedState=n)}function fL(t,e){var n=yn;yn=n!==0&&4>n?n:4,t(!0);var i=k_.transition;k_.transition={};try{t(!1),e()}finally{yn=n,k_.transition=i}}function ZE(){return Ns().memoizedState}function pL(t,e,n){var i=Ya(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},XE(t))YE(e,n);else if(n=ME(t,e,n,i),n!==null){var o=kr();so(n,t,i,o),KE(n,e,i)}}function mL(t,e,n){var i=Ya(t),o={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(XE(t))YE(e,o);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=e.lastRenderedReducer,u!==null))try{var f=e.lastRenderedState,l=u(f,n);if(o.hasEagerState=!0,o.eagerState=l,ao(l,f)){var b=e.interleaved;b===null?(o.next=o,u0(e)):(o.next=b.next,b.next=o),e.interleaved=o;return}}catch{}finally{}n=ME(t,e,o,i),n!==null&&(o=kr(),so(n,t,i,o),KE(n,e,i))}}function XE(t){var e=t.alternate;return t===Kn||e!==null&&e===Kn}function YE(t,e){sd=_m=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function KE(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Yv(t,n)}}var ym={readContext:Bs,useCallback:lr,useContext:lr,useEffect:lr,useImperativeHandle:lr,useInsertionEffect:lr,useLayoutEffect:lr,useMemo:lr,useReducer:lr,useRef:lr,useState:lr,useDebugValue:lr,useDeferredValue:lr,useTransition:lr,useMutableSource:lr,useSyncExternalStore:lr,useId:lr,unstable_isNewReconciler:!1},gL={readContext:Bs,useCallback:function(t,e){return wo().memoizedState=[t,e===void 0?null:e],t},useContext:Bs,useEffect:D1,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Vp(4194308,4,GE.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Vp(4194308,4,t,e)},useInsertionEffect:function(t,e){return Vp(4,2,t,e)},useMemo:function(t,e){var n=wo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=wo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=pL.bind(null,Kn,t),[i.memoizedState,t]},useRef:function(t){var e=wo();return t={current:t},e.memoizedState=t},useState:R1,useDebugValue:v0,useDeferredValue:function(t){return wo().memoizedState=t},useTransition:function(){var t=R1(!1),e=t[0];return t=fL.bind(null,t[1]),wo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Kn,o=wo();if(Wn){if(n===void 0)throw Error(Ze(407));n=n()}else{if(n=e(),Fi===null)throw Error(Ze(349));Gl&30||zE(i,e,n)}o.memoizedState=n;var u={value:n,getSnapshot:e};return o.queue=u,D1(FE.bind(null,i,u,t),[t]),i.flags|=2048,Id(9,OE.bind(null,i,u,n,e),void 0,null),n},useId:function(){var t=wo(),e=Fi.identifierPrefix;if(Wn){var n=Qo,i=Jo;n=(i&~(1<<32-ro(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ad++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=dL++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},_L={readContext:Bs,useCallback:HE,useContext:Bs,useEffect:y0,useImperativeHandle:$E,useInsertionEffect:VE,useLayoutEffect:jE,useMemo:WE,useReducer:R_,useRef:UE,useState:function(){return R_(Pd)},useDebugValue:v0,useDeferredValue:function(t){var e=Ns();return qE(e,Si.memoizedState,t)},useTransition:function(){var t=R_(Pd)[0],e=Ns().memoizedState;return[t,e]},useMutableSource:RE,useSyncExternalStore:DE,useId:ZE,unstable_isNewReconciler:!1},yL={readContext:Bs,useCallback:HE,useContext:Bs,useEffect:y0,useImperativeHandle:$E,useInsertionEffect:VE,useLayoutEffect:jE,useMemo:WE,useReducer:D_,useRef:UE,useState:function(){return D_(Pd)},useDebugValue:v0,useDeferredValue:function(t){var e=Ns();return Si===null?e.memoizedState=t:qE(e,Si.memoizedState,t)},useTransition:function(){var t=D_(Pd)[0],e=Ns().memoizedState;return[t,e]},useMutableSource:RE,useSyncExternalStore:DE,useId:ZE,unstable_isNewReconciler:!1};function eo(t,e){if(t&&t.defaultProps){e=Jn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Yy(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Jn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var qm={isMounted:function(t){return(t=t._reactInternals)?Kl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=kr(),o=Ya(t),u=ea(i,o);u.payload=e,n!=null&&(u.callback=n),e=Za(t,u,o),e!==null&&(so(e,t,o,i),Np(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=kr(),o=Ya(t),u=ea(i,o);u.tag=1,u.payload=e,n!=null&&(u.callback=n),e=Za(t,u,o),e!==null&&(so(e,t,o,i),Np(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=kr(),i=Ya(t),o=ea(n,i);o.tag=2,e!=null&&(o.callback=e),e=Za(t,o,i),e!==null&&(so(e,t,i,n),Np(e,t,i))}};function z1(t,e,n,i,o,u,f){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,u,f):e.prototype&&e.prototype.isPureReactComponent?!xd(n,i)||!xd(o,u):!0}function JE(t,e,n){var i=!1,o=tl,u=e.contextType;return typeof u=="object"&&u!==null?u=Bs(u):(o=Xr(e)?Vl:pr.current,i=e.contextTypes,u=(i=i!=null)?mu(t,o):tl),e=new e(n,u),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qm,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=u),e}function O1(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&qm.enqueueReplaceState(e,e.state,null)}function Ky(t,e,n,i){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs={},h0(t);var u=e.contextType;typeof u=="object"&&u!==null?o.context=Bs(u):(u=Xr(e)?Vl:pr.current,o.context=mu(t,u)),o.state=t.memoizedState,u=e.getDerivedStateFromProps,typeof u=="function"&&(Yy(t,e,u,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&qm.enqueueReplaceState(o,o.state,null),mm(t,n,o,i),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function vu(t,e){try{var n="",i=e;do n+=WC(i),i=i.return;while(i);var o=n}catch(u){o=`
Error generating stack: `+u.message+`
`+u.stack}return{value:t,source:e,stack:o,digest:null}}function z_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Jy(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var vL=typeof WeakMap=="function"?WeakMap:Map;function QE(t,e,n){n=ea(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){xm||(xm=!0,lv=i),Jy(t,e)},n}function eS(t,e,n){n=ea(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var o=e.value;n.payload=function(){return i(o)},n.callback=function(){Jy(t,e)}}var u=t.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(n.callback=function(){Jy(t,e),typeof i!="function"&&(Xa===null?Xa=new Set([this]):Xa.add(this));var f=e.stack;this.componentDidCatch(e.value,{componentStack:f!==null?f:""})}),n}function F1(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new vL;var o=new Set;i.set(e,o)}else o=i.get(e),o===void 0&&(o=new Set,i.set(e,o));o.has(n)||(o.add(n),t=RL.bind(null,t,e,n),e.then(t,t))}function B1(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function N1(t,e,n,i,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ea(-1,1),e.tag=2,Za(n,e,1))),n.lanes|=1),t)}var xL=la.ReactCurrentOwner,qr=!1;function Mr(t,e,n,i){e.child=t===null?CE(e,null,n,i):_u(e,t.child,n,i)}function U1(t,e,n,i,o){n=n.render;var u=e.ref;return cu(e,o),i=g0(t,e,n,i,u,o),n=_0(),t!==null&&!qr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,ra(t,e,o)):(Wn&&n&&r0(e),e.flags|=1,Mr(t,e,i,o),e.child)}function V1(t,e,n,i,o){if(t===null){var u=n.type;return typeof u=="function"&&!P0(u)&&u.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=u,tS(t,e,u,i,o)):(t=Hp(n.type,null,i,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(u=t.child,!(t.lanes&o)){var f=u.memoizedProps;if(n=n.compare,n=n!==null?n:xd,n(f,i)&&t.ref===e.ref)return ra(t,e,o)}return e.flags|=1,t=Ka(u,i),t.ref=e.ref,t.return=e,e.child=t}function tS(t,e,n,i,o){if(t!==null){var u=t.memoizedProps;if(xd(u,i)&&t.ref===e.ref)if(qr=!1,e.pendingProps=i=u,(t.lanes&o)!==0)t.flags&131072&&(qr=!0);else return e.lanes=t.lanes,ra(t,e,o)}return Qy(t,e,n,i,o)}function nS(t,e,n){var i=e.pendingProps,o=i.children,u=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dn(nu,cs),cs|=n;else{if(!(n&1073741824))return t=u!==null?u.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Dn(nu,cs),cs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=u!==null?u.baseLanes:n,Dn(nu,cs),cs|=i}else u!==null?(i=u.baseLanes|n,e.memoizedState=null):i=n,Dn(nu,cs),cs|=i;return Mr(t,e,o,n),e.child}function iS(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Qy(t,e,n,i,o){var u=Xr(n)?Vl:pr.current;return u=mu(e,u),cu(e,o),n=g0(t,e,n,i,u,o),i=_0(),t!==null&&!qr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,ra(t,e,o)):(Wn&&i&&r0(e),e.flags|=1,Mr(t,e,n,o),e.child)}function j1(t,e,n,i,o){if(Xr(n)){var u=!0;um(e)}else u=!1;if(cu(e,o),e.stateNode===null)jp(t,e),JE(e,n,i),Ky(e,n,i,o),i=!0;else if(t===null){var f=e.stateNode,l=e.memoizedProps;f.props=l;var b=f.context,w=n.contextType;typeof w=="object"&&w!==null?w=Bs(w):(w=Xr(n)?Vl:pr.current,w=mu(e,w));var C=n.getDerivedStateFromProps,L=typeof C=="function"||typeof f.getSnapshotBeforeUpdate=="function";L||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==i||b!==w)&&O1(e,f,i,w),Fa=!1;var k=e.memoizedState;f.state=k,mm(e,i,f,o),b=e.memoizedState,l!==i||k!==b||Zr.current||Fa?(typeof C=="function"&&(Yy(e,n,C,i),b=e.memoizedState),(l=Fa||z1(e,n,l,i,k,b,w))?(L||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(e.flags|=4194308)):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=b),f.props=i,f.state=b,f.context=w,i=l):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{f=e.stateNode,LE(t,e),l=e.memoizedProps,w=e.type===e.elementType?l:eo(e.type,l),f.props=w,L=e.pendingProps,k=f.context,b=n.contextType,typeof b=="object"&&b!==null?b=Bs(b):(b=Xr(n)?Vl:pr.current,b=mu(e,b));var H=n.getDerivedStateFromProps;(C=typeof H=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==L||k!==b)&&O1(e,f,i,b),Fa=!1,k=e.memoizedState,f.state=k,mm(e,i,f,o);var K=e.memoizedState;l!==L||k!==K||Zr.current||Fa?(typeof H=="function"&&(Yy(e,n,H,i),K=e.memoizedState),(w=Fa||z1(e,n,w,i,k,K,b)||!1)?(C||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(i,K,b),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(i,K,b)),typeof f.componentDidUpdate=="function"&&(e.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=K),f.props=i,f.state=K,f.context=b,i=w):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=1024),i=!1)}return ev(t,e,n,i,u,o)}function ev(t,e,n,i,o,u){iS(t,e);var f=(e.flags&128)!==0;if(!i&&!f)return o&&P1(e,n,!1),ra(t,e,u);i=e.stateNode,xL.current=e;var l=f&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&f?(e.child=_u(e,t.child,null,u),e.child=_u(e,null,l,u)):Mr(t,e,l,u),e.memoizedState=i.state,o&&P1(e,n,!0),e.child}function rS(t){var e=t.stateNode;e.pendingContext?A1(t,e.pendingContext,e.pendingContext!==e.context):e.context&&A1(t,e.context,!1),d0(t,e.containerInfo)}function G1(t,e,n,i,o){return gu(),o0(o),e.flags|=256,Mr(t,e,n,i),e.child}var tv={dehydrated:null,treeContext:null,retryLane:0};function nv(t){return{baseLanes:t,cachePool:null,transitions:null}}function sS(t,e,n){var i=e.pendingProps,o=Yn.current,u=!1,f=(e.flags&128)!==0,l;if((l=f)||(l=t!==null&&t.memoizedState===null?!1:(o&2)!==0),l?(u=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),Dn(Yn,o&1),t===null)return Zy(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(f=i.children,t=i.fallback,u?(i=e.mode,u=e.child,f={mode:"hidden",children:f},!(i&1)&&u!==null?(u.childLanes=0,u.pendingProps=f):u=Ym(f,i,0,null),t=Nl(t,i,n,null),u.return=e,t.return=e,u.sibling=t,e.child=u,e.child.memoizedState=nv(n),e.memoizedState=tv,t):x0(e,f));if(o=t.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return bL(t,e,f,i,l,o,n);if(u){u=i.fallback,f=e.mode,o=t.child,l=o.sibling;var b={mode:"hidden",children:i.children};return!(f&1)&&e.child!==o?(i=e.child,i.childLanes=0,i.pendingProps=b,e.deletions=null):(i=Ka(o,b),i.subtreeFlags=o.subtreeFlags&14680064),l!==null?u=Ka(l,u):(u=Nl(u,f,n,null),u.flags|=2),u.return=e,i.return=e,i.sibling=u,e.child=i,i=u,u=e.child,f=t.child.memoizedState,f=f===null?nv(n):{baseLanes:f.baseLanes|n,cachePool:null,transitions:f.transitions},u.memoizedState=f,u.childLanes=t.childLanes&~n,e.memoizedState=tv,i}return u=t.child,t=u.sibling,i=Ka(u,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function x0(t,e){return e=Ym({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function _p(t,e,n,i){return i!==null&&o0(i),_u(e,t.child,null,n),t=x0(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function bL(t,e,n,i,o,u,f){if(n)return e.flags&256?(e.flags&=-257,i=z_(Error(Ze(422))),_p(t,e,f,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(u=i.fallback,o=e.mode,i=Ym({mode:"visible",children:i.children},o,0,null),u=Nl(u,o,f,null),u.flags|=2,i.return=e,u.return=e,i.sibling=u,e.child=i,e.mode&1&&_u(e,t.child,null,f),e.child.memoizedState=nv(f),e.memoizedState=tv,u);if(!(e.mode&1))return _p(t,e,f,null);if(o.data==="$!"){if(i=o.nextSibling&&o.nextSibling.dataset,i)var l=i.dgst;return i=l,u=Error(Ze(419)),i=z_(u,i,void 0),_p(t,e,f,i)}if(l=(f&t.childLanes)!==0,qr||l){if(i=Fi,i!==null){switch(f&-f){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(i.suspendedLanes|f)?0:o,o!==0&&o!==u.retryLane&&(u.retryLane=o,ia(t,o),so(i,t,o,-1))}return A0(),i=z_(Error(Ze(421))),_p(t,e,f,i)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=DL.bind(null,t),o._reactRetry=e,null):(t=u.treeContext,ds=qa(o.nextSibling),fs=e,Wn=!0,no=null,t!==null&&(ks[Rs++]=Jo,ks[Rs++]=Qo,ks[Rs++]=jl,Jo=t.id,Qo=t.overflow,jl=e),e=x0(e,i.children),e.flags|=4096,e)}function $1(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Xy(t.return,e,n)}function O_(t,e,n,i,o){var u=t.memoizedState;u===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o}:(u.isBackwards=e,u.rendering=null,u.renderingStartTime=0,u.last=i,u.tail=n,u.tailMode=o)}function oS(t,e,n){var i=e.pendingProps,o=i.revealOrder,u=i.tail;if(Mr(t,e,i.children,n),i=Yn.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$1(t,n,e);else if(t.tag===19)$1(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Dn(Yn,i),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&gm(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),O_(e,!1,o,n,u);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&gm(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}O_(e,!0,n,null,u);break;case"together":O_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function jp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ra(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),$l|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ze(153));if(e.child!==null){for(t=e.child,n=Ka(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ka(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function wL(t,e,n){switch(e.tag){case 3:rS(e),gu();break;case 5:kE(e);break;case 1:Xr(e.type)&&um(e);break;case 4:d0(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,o=e.memoizedProps.value;Dn(fm,i._currentValue),i._currentValue=o;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Dn(Yn,Yn.current&1),e.flags|=128,null):n&e.child.childLanes?sS(t,e,n):(Dn(Yn,Yn.current&1),t=ra(t,e,n),t!==null?t.sibling:null);Dn(Yn,Yn.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return oS(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Dn(Yn,Yn.current),i)break;return null;case 22:case 23:return e.lanes=0,nS(t,e,n)}return ra(t,e,n)}var aS,iv,lS,cS;aS=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};iv=function(){};lS=function(t,e,n,i){var o=t.memoizedProps;if(o!==i){t=e.stateNode,Ol(Io.current);var u=null;switch(n){case"input":o=Sy(t,o),i=Sy(t,i),u=[];break;case"select":o=Jn({},o,{value:void 0}),i=Jn({},i,{value:void 0}),u=[];break;case"textarea":o=Iy(t,o),i=Iy(t,i),u=[];break;default:typeof o.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=lm)}My(n,i);var f;n=null;for(w in o)if(!i.hasOwnProperty(w)&&o.hasOwnProperty(w)&&o[w]!=null)if(w==="style"){var l=o[w];for(f in l)l.hasOwnProperty(f)&&(n||(n={}),n[f]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(fd.hasOwnProperty(w)?u||(u=[]):(u=u||[]).push(w,null));for(w in i){var b=i[w];if(l=o!=null?o[w]:void 0,i.hasOwnProperty(w)&&b!==l&&(b!=null||l!=null))if(w==="style")if(l){for(f in l)!l.hasOwnProperty(f)||b&&b.hasOwnProperty(f)||(n||(n={}),n[f]="");for(f in b)b.hasOwnProperty(f)&&l[f]!==b[f]&&(n||(n={}),n[f]=b[f])}else n||(u||(u=[]),u.push(w,n)),n=b;else w==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,l=l?l.__html:void 0,b!=null&&l!==b&&(u=u||[]).push(w,b)):w==="children"?typeof b!="string"&&typeof b!="number"||(u=u||[]).push(w,""+b):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(fd.hasOwnProperty(w)?(b!=null&&w==="onScroll"&&Bn("scroll",t),u||l===b||(u=[])):(u=u||[]).push(w,b))}n&&(u=u||[]).push("style",n);var w=u;(e.updateQueue=w)&&(e.flags|=4)}};cS=function(t,e,n,i){n!==i&&(e.flags|=4)};function Uh(t,e){if(!Wn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function cr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags&14680064,i|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags,i|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function TL(t,e,n){var i=e.pendingProps;switch(s0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cr(e),null;case 1:return Xr(e.type)&&cm(),cr(e),null;case 3:return i=e.stateNode,yu(),Nn(Zr),Nn(pr),p0(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(mp(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,no!==null&&(hv(no),no=null))),iv(t,e),cr(e),null;case 5:f0(e);var o=Ol(Sd.current);if(n=e.type,t!==null&&e.stateNode!=null)lS(t,e,n,i,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ze(166));return cr(e),null}if(t=Ol(Io.current),mp(e)){i=e.stateNode,n=e.type;var u=e.memoizedProps;switch(i[To]=e,i[Td]=u,t=(e.mode&1)!==0,n){case"dialog":Bn("cancel",i),Bn("close",i);break;case"iframe":case"object":case"embed":Bn("load",i);break;case"video":case"audio":for(o=0;o<Kh.length;o++)Bn(Kh[o],i);break;case"source":Bn("error",i);break;case"img":case"image":case"link":Bn("error",i),Bn("load",i);break;case"details":Bn("toggle",i);break;case"input":Qb(i,u),Bn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!u.multiple},Bn("invalid",i);break;case"textarea":t1(i,u),Bn("invalid",i)}My(n,u),o=null;for(var f in u)if(u.hasOwnProperty(f)){var l=u[f];f==="children"?typeof l=="string"?i.textContent!==l&&(u.suppressHydrationWarning!==!0&&pp(i.textContent,l,t),o=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(u.suppressHydrationWarning!==!0&&pp(i.textContent,l,t),o=["children",""+l]):fd.hasOwnProperty(f)&&l!=null&&f==="onScroll"&&Bn("scroll",i)}switch(n){case"input":op(i),e1(i,u,!0);break;case"textarea":op(i),n1(i);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(i.onclick=lm)}i=o,e.updateQueue=i,i!==null&&(e.flags|=4)}else{f=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=F2(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=f.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=f.createElement(n,{is:i.is}):(t=f.createElement(n),n==="select"&&(f=t,i.multiple?f.multiple=!0:i.size&&(f.size=i.size))):t=f.createElementNS(t,n),t[To]=e,t[Td]=i,aS(t,e,!1,!1),e.stateNode=t;e:{switch(f=Ly(n,i),n){case"dialog":Bn("cancel",t),Bn("close",t),o=i;break;case"iframe":case"object":case"embed":Bn("load",t),o=i;break;case"video":case"audio":for(o=0;o<Kh.length;o++)Bn(Kh[o],t);o=i;break;case"source":Bn("error",t),o=i;break;case"img":case"image":case"link":Bn("error",t),Bn("load",t),o=i;break;case"details":Bn("toggle",t),o=i;break;case"input":Qb(t,i),o=Sy(t,i),Bn("invalid",t);break;case"option":o=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},o=Jn({},i,{value:void 0}),Bn("invalid",t);break;case"textarea":t1(t,i),o=Iy(t,i),Bn("invalid",t);break;default:o=i}My(n,o),l=o;for(u in l)if(l.hasOwnProperty(u)){var b=l[u];u==="style"?U2(t,b):u==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&B2(t,b)):u==="children"?typeof b=="string"?(n!=="textarea"||b!=="")&&pd(t,b):typeof b=="number"&&pd(t,""+b):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(fd.hasOwnProperty(u)?b!=null&&u==="onScroll"&&Bn("scroll",t):b!=null&&$v(t,u,b,f))}switch(n){case"input":op(t),e1(t,i,!1);break;case"textarea":op(t),n1(t);break;case"option":i.value!=null&&t.setAttribute("value",""+el(i.value));break;case"select":t.multiple=!!i.multiple,u=i.value,u!=null?su(t,!!i.multiple,u,!1):i.defaultValue!=null&&su(t,!!i.multiple,i.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=lm)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return cr(e),null;case 6:if(t&&e.stateNode!=null)cS(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ze(166));if(n=Ol(Sd.current),Ol(Io.current),mp(e)){if(i=e.stateNode,n=e.memoizedProps,i[To]=e,(u=i.nodeValue!==n)&&(t=fs,t!==null))switch(t.tag){case 3:pp(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&pp(i.nodeValue,n,(t.mode&1)!==0)}u&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[To]=e,e.stateNode=i}return cr(e),null;case 13:if(Nn(Yn),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Wn&&ds!==null&&e.mode&1&&!(e.flags&128))PE(),gu(),e.flags|=98560,u=!1;else if(u=mp(e),i!==null&&i.dehydrated!==null){if(t===null){if(!u)throw Error(Ze(318));if(u=e.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(Ze(317));u[To]=e}else gu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;cr(e),u=!1}else no!==null&&(hv(no),no=null),u=!0;if(!u)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Yn.current&1?Ai===0&&(Ai=3):A0())),e.updateQueue!==null&&(e.flags|=4),cr(e),null);case 4:return yu(),iv(t,e),t===null&&bd(e.stateNode.containerInfo),cr(e),null;case 10:return c0(e.type._context),cr(e),null;case 17:return Xr(e.type)&&cm(),cr(e),null;case 19:if(Nn(Yn),u=e.memoizedState,u===null)return cr(e),null;if(i=(e.flags&128)!==0,f=u.rendering,f===null)if(i)Uh(u,!1);else{if(Ai!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(f=gm(t),f!==null){for(e.flags|=128,Uh(u,!1),i=f.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)u=n,t=i,u.flags&=14680066,f=u.alternate,f===null?(u.childLanes=0,u.lanes=t,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=f.childLanes,u.lanes=f.lanes,u.child=f.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=f.memoizedProps,u.memoizedState=f.memoizedState,u.updateQueue=f.updateQueue,u.type=f.type,t=f.dependencies,u.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Dn(Yn,Yn.current&1|2),e.child}t=t.sibling}u.tail!==null&&pi()>xu&&(e.flags|=128,i=!0,Uh(u,!1),e.lanes=4194304)}else{if(!i)if(t=gm(f),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Uh(u,!0),u.tail===null&&u.tailMode==="hidden"&&!f.alternate&&!Wn)return cr(e),null}else 2*pi()-u.renderingStartTime>xu&&n!==1073741824&&(e.flags|=128,i=!0,Uh(u,!1),e.lanes=4194304);u.isBackwards?(f.sibling=e.child,e.child=f):(n=u.last,n!==null?n.sibling=f:e.child=f,u.last=f)}return u.tail!==null?(e=u.tail,u.rendering=e,u.tail=e.sibling,u.renderingStartTime=pi(),e.sibling=null,n=Yn.current,Dn(Yn,i?n&1|2:n&1),e):(cr(e),null);case 22:case 23:return S0(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?cs&1073741824&&(cr(e),e.subtreeFlags&6&&(e.flags|=8192)):cr(e),null;case 24:return null;case 25:return null}throw Error(Ze(156,e.tag))}function EL(t,e){switch(s0(e),e.tag){case 1:return Xr(e.type)&&cm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return yu(),Nn(Zr),Nn(pr),p0(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return f0(e),null;case 13:if(Nn(Yn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ze(340));gu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Nn(Yn),null;case 4:return yu(),null;case 10:return c0(e.type._context),null;case 22:case 23:return S0(),null;case 24:return null;default:return null}}var yp=!1,dr=!1,SL=typeof WeakSet=="function"?WeakSet:Set,_t=null;function tu(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ii(t,e,i)}else n.current=null}function rv(t,e,n){try{n()}catch(i){ii(t,e,i)}}var H1=!1;function AL(t,e){if(Vy=sm,t=pE(),i0(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var o=i.anchorOffset,u=i.focusNode;i=i.focusOffset;try{n.nodeType,u.nodeType}catch{n=null;break e}var f=0,l=-1,b=-1,w=0,C=0,L=t,k=null;t:for(;;){for(var H;L!==n||o!==0&&L.nodeType!==3||(l=f+o),L!==u||i!==0&&L.nodeType!==3||(b=f+i),L.nodeType===3&&(f+=L.nodeValue.length),(H=L.firstChild)!==null;)k=L,L=H;for(;;){if(L===t)break t;if(k===n&&++w===o&&(l=f),k===u&&++C===i&&(b=f),(H=L.nextSibling)!==null)break;L=k,k=L.parentNode}L=H}n=l===-1||b===-1?null:{start:l,end:b}}else n=null}n=n||{start:0,end:0}}else n=null;for(jy={focusedElem:t,selectionRange:n},sm=!1,_t=e;_t!==null;)if(e=_t,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,_t=t;else for(;_t!==null;){e=_t;try{var K=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(K!==null){var re=K.memoizedProps,ce=K.memoizedState,W=e.stateNode,G=W.getSnapshotBeforeUpdate(e.elementType===e.type?re:eo(e.type,re),ce);W.__reactInternalSnapshotBeforeUpdate=G}break;case 3:var Z=e.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ze(163))}}catch(fe){ii(e,e.return,fe)}if(t=e.sibling,t!==null){t.return=e.return,_t=t;break}_t=e.return}return K=H1,H1=!1,K}function od(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var o=i=i.next;do{if((o.tag&t)===t){var u=o.destroy;o.destroy=void 0,u!==void 0&&rv(e,n,u)}o=o.next}while(o!==i)}}function Zm(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function sv(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function uS(t){var e=t.alternate;e!==null&&(t.alternate=null,uS(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[To],delete e[Td],delete e[Hy],delete e[lL],delete e[cL])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hS(t){return t.tag===5||t.tag===3||t.tag===4}function W1(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||hS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ov(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=lm));else if(i!==4&&(t=t.child,t!==null))for(ov(t,e,n),t=t.sibling;t!==null;)ov(t,e,n),t=t.sibling}function av(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(av(t,e,n),t=t.sibling;t!==null;)av(t,e,n),t=t.sibling}var qi=null,to=!1;function Ma(t,e,n){for(n=n.child;n!==null;)dS(t,e,n),n=n.sibling}function dS(t,e,n){if(Po&&typeof Po.onCommitFiberUnmount=="function")try{Po.onCommitFiberUnmount(Um,n)}catch{}switch(n.tag){case 5:dr||tu(n,e);case 6:var i=qi,o=to;qi=null,Ma(t,e,n),qi=i,to=o,qi!==null&&(to?(t=qi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):qi.removeChild(n.stateNode));break;case 18:qi!==null&&(to?(t=qi,n=n.stateNode,t.nodeType===8?C_(t.parentNode,n):t.nodeType===1&&C_(t,n),yd(t)):C_(qi,n.stateNode));break;case 4:i=qi,o=to,qi=n.stateNode.containerInfo,to=!0,Ma(t,e,n),qi=i,to=o;break;case 0:case 11:case 14:case 15:if(!dr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){o=i=i.next;do{var u=o,f=u.destroy;u=u.tag,f!==void 0&&(u&2||u&4)&&rv(n,e,f),o=o.next}while(o!==i)}Ma(t,e,n);break;case 1:if(!dr&&(tu(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){ii(n,e,l)}Ma(t,e,n);break;case 21:Ma(t,e,n);break;case 22:n.mode&1?(dr=(i=dr)||n.memoizedState!==null,Ma(t,e,n),dr=i):Ma(t,e,n);break;default:Ma(t,e,n)}}function q1(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new SL),e.forEach(function(i){var o=zL.bind(null,t,i);n.has(i)||(n.add(i),i.then(o,o))})}}function Qs(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];try{var u=t,f=e,l=f;e:for(;l!==null;){switch(l.tag){case 5:qi=l.stateNode,to=!1;break e;case 3:qi=l.stateNode.containerInfo,to=!0;break e;case 4:qi=l.stateNode.containerInfo,to=!0;break e}l=l.return}if(qi===null)throw Error(Ze(160));dS(u,f,o),qi=null,to=!1;var b=o.alternate;b!==null&&(b.return=null),o.return=null}catch(w){ii(o,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)fS(e,t),e=e.sibling}function fS(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Qs(e,t),yo(t),i&4){try{od(3,t,t.return),Zm(3,t)}catch(re){ii(t,t.return,re)}try{od(5,t,t.return)}catch(re){ii(t,t.return,re)}}break;case 1:Qs(e,t),yo(t),i&512&&n!==null&&tu(n,n.return);break;case 5:if(Qs(e,t),yo(t),i&512&&n!==null&&tu(n,n.return),t.flags&32){var o=t.stateNode;try{pd(o,"")}catch(re){ii(t,t.return,re)}}if(i&4&&(o=t.stateNode,o!=null)){var u=t.memoizedProps,f=n!==null?n.memoizedProps:u,l=t.type,b=t.updateQueue;if(t.updateQueue=null,b!==null)try{l==="input"&&u.type==="radio"&&u.name!=null&&z2(o,u),Ly(l,f);var w=Ly(l,u);for(f=0;f<b.length;f+=2){var C=b[f],L=b[f+1];C==="style"?U2(o,L):C==="dangerouslySetInnerHTML"?B2(o,L):C==="children"?pd(o,L):$v(o,C,L,w)}switch(l){case"input":Ay(o,u);break;case"textarea":O2(o,u);break;case"select":var k=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!u.multiple;var H=u.value;H!=null?su(o,!!u.multiple,H,!1):k!==!!u.multiple&&(u.defaultValue!=null?su(o,!!u.multiple,u.defaultValue,!0):su(o,!!u.multiple,u.multiple?[]:"",!1))}o[Td]=u}catch(re){ii(t,t.return,re)}}break;case 6:if(Qs(e,t),yo(t),i&4){if(t.stateNode===null)throw Error(Ze(162));o=t.stateNode,u=t.memoizedProps;try{o.nodeValue=u}catch(re){ii(t,t.return,re)}}break;case 3:if(Qs(e,t),yo(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{yd(e.containerInfo)}catch(re){ii(t,t.return,re)}break;case 4:Qs(e,t),yo(t);break;case 13:Qs(e,t),yo(t),o=t.child,o.flags&8192&&(u=o.memoizedState!==null,o.stateNode.isHidden=u,!u||o.alternate!==null&&o.alternate.memoizedState!==null||(T0=pi())),i&4&&q1(t);break;case 22:if(C=n!==null&&n.memoizedState!==null,t.mode&1?(dr=(w=dr)||C,Qs(e,t),dr=w):Qs(e,t),yo(t),i&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!C&&t.mode&1)for(_t=t,C=t.child;C!==null;){for(L=_t=C;_t!==null;){switch(k=_t,H=k.child,k.tag){case 0:case 11:case 14:case 15:od(4,k,k.return);break;case 1:tu(k,k.return);var K=k.stateNode;if(typeof K.componentWillUnmount=="function"){i=k,n=k.return;try{e=i,K.props=e.memoizedProps,K.state=e.memoizedState,K.componentWillUnmount()}catch(re){ii(i,n,re)}}break;case 5:tu(k,k.return);break;case 22:if(k.memoizedState!==null){X1(L);continue}}H!==null?(H.return=k,_t=H):X1(L)}C=C.sibling}e:for(C=null,L=t;;){if(L.tag===5){if(C===null){C=L;try{o=L.stateNode,w?(u=o.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(l=L.stateNode,b=L.memoizedProps.style,f=b!=null&&b.hasOwnProperty("display")?b.display:null,l.style.display=N2("display",f))}catch(re){ii(t,t.return,re)}}}else if(L.tag===6){if(C===null)try{L.stateNode.nodeValue=w?"":L.memoizedProps}catch(re){ii(t,t.return,re)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===t)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===t)break e;for(;L.sibling===null;){if(L.return===null||L.return===t)break e;C===L&&(C=null),L=L.return}C===L&&(C=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:Qs(e,t),yo(t),i&4&&q1(t);break;case 21:break;default:Qs(e,t),yo(t)}}function yo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(hS(n)){var i=n;break e}n=n.return}throw Error(Ze(160))}switch(i.tag){case 5:var o=i.stateNode;i.flags&32&&(pd(o,""),i.flags&=-33);var u=W1(t);av(t,u,o);break;case 3:case 4:var f=i.stateNode.containerInfo,l=W1(t);ov(t,l,f);break;default:throw Error(Ze(161))}}catch(b){ii(t,t.return,b)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function PL(t,e,n){_t=t,pS(t)}function pS(t,e,n){for(var i=(t.mode&1)!==0;_t!==null;){var o=_t,u=o.child;if(o.tag===22&&i){var f=o.memoizedState!==null||yp;if(!f){var l=o.alternate,b=l!==null&&l.memoizedState!==null||dr;l=yp;var w=dr;if(yp=f,(dr=b)&&!w)for(_t=o;_t!==null;)f=_t,b=f.child,f.tag===22&&f.memoizedState!==null?Y1(o):b!==null?(b.return=f,_t=b):Y1(o);for(;u!==null;)_t=u,pS(u),u=u.sibling;_t=o,yp=l,dr=w}Z1(t)}else o.subtreeFlags&8772&&u!==null?(u.return=o,_t=u):Z1(t)}}function Z1(t){for(;_t!==null;){var e=_t;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:dr||Zm(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!dr)if(n===null)i.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:eo(e.type,n.memoizedProps);i.componentDidUpdate(o,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var u=e.updateQueue;u!==null&&k1(e,u,i);break;case 3:var f=e.updateQueue;if(f!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}k1(e,f,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var b=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&n.focus();break;case"img":b.src&&(n.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var C=w.memoizedState;if(C!==null){var L=C.dehydrated;L!==null&&yd(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ze(163))}dr||e.flags&512&&sv(e)}catch(k){ii(e,e.return,k)}}if(e===t){_t=null;break}if(n=e.sibling,n!==null){n.return=e.return,_t=n;break}_t=e.return}}function X1(t){for(;_t!==null;){var e=_t;if(e===t){_t=null;break}var n=e.sibling;if(n!==null){n.return=e.return,_t=n;break}_t=e.return}}function Y1(t){for(;_t!==null;){var e=_t;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Zm(4,e)}catch(b){ii(e,n,b)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var o=e.return;try{i.componentDidMount()}catch(b){ii(e,o,b)}}var u=e.return;try{sv(e)}catch(b){ii(e,u,b)}break;case 5:var f=e.return;try{sv(e)}catch(b){ii(e,f,b)}}}catch(b){ii(e,e.return,b)}if(e===t){_t=null;break}var l=e.sibling;if(l!==null){l.return=e.return,_t=l;break}_t=e.return}}var IL=Math.ceil,vm=la.ReactCurrentDispatcher,b0=la.ReactCurrentOwner,zs=la.ReactCurrentBatchConfig,rn=0,Fi=null,_i=null,Zi=0,cs=0,nu=rl(0),Ai=0,Cd=null,$l=0,Xm=0,w0=0,ad=null,Wr=null,T0=0,xu=1/0,Xo=null,xm=!1,lv=null,Xa=null,vp=!1,Va=null,bm=0,ld=0,cv=null,Gp=-1,$p=0;function kr(){return rn&6?pi():Gp!==-1?Gp:Gp=pi()}function Ya(t){return t.mode&1?rn&2&&Zi!==0?Zi&-Zi:hL.transition!==null?($p===0&&($p=J2()),$p):(t=yn,t!==0||(t=window.event,t=t===void 0?16:sE(t.type)),t):1}function so(t,e,n,i){if(50<ld)throw ld=0,cv=null,Error(Ze(185));Ud(t,n,i),(!(rn&2)||t!==Fi)&&(t===Fi&&(!(rn&2)&&(Xm|=n),Ai===4&&Na(t,Zi)),Yr(t,i),n===1&&rn===0&&!(e.mode&1)&&(xu=pi()+500,Hm&&sl()))}function Yr(t,e){var n=t.callbackNode;hM(t,e);var i=rm(t,t===Fi?Zi:0);if(i===0)n!==null&&s1(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&s1(n),e===1)t.tag===0?uL(K1.bind(null,t)):EE(K1.bind(null,t)),oL(function(){!(rn&6)&&sl()}),n=null;else{switch(Q2(i)){case 1:n=Xv;break;case 4:n=Y2;break;case 16:n=im;break;case 536870912:n=K2;break;default:n=im}n=wS(n,mS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function mS(t,e){if(Gp=-1,$p=0,rn&6)throw Error(Ze(327));var n=t.callbackNode;if(uu()&&t.callbackNode!==n)return null;var i=rm(t,t===Fi?Zi:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=wm(t,i);else{e=i;var o=rn;rn|=2;var u=_S();(Fi!==t||Zi!==e)&&(Xo=null,xu=pi()+500,Bl(t,e));do try{LL();break}catch(l){gS(t,l)}while(!0);l0(),vm.current=u,rn=o,_i!==null?e=0:(Fi=null,Zi=0,e=Ai)}if(e!==0){if(e===2&&(o=Oy(t),o!==0&&(i=o,e=uv(t,o))),e===1)throw n=Cd,Bl(t,0),Na(t,i),Yr(t,pi()),n;if(e===6)Na(t,i);else{if(o=t.current.alternate,!(i&30)&&!CL(o)&&(e=wm(t,i),e===2&&(u=Oy(t),u!==0&&(i=u,e=uv(t,u))),e===1))throw n=Cd,Bl(t,0),Na(t,i),Yr(t,pi()),n;switch(t.finishedWork=o,t.finishedLanes=i,e){case 0:case 1:throw Error(Ze(345));case 2:kl(t,Wr,Xo);break;case 3:if(Na(t,i),(i&130023424)===i&&(e=T0+500-pi(),10<e)){if(rm(t,0)!==0)break;if(o=t.suspendedLanes,(o&i)!==i){kr(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=$y(kl.bind(null,t,Wr,Xo),e);break}kl(t,Wr,Xo);break;case 4:if(Na(t,i),(i&4194240)===i)break;for(e=t.eventTimes,o=-1;0<i;){var f=31-ro(i);u=1<<f,f=e[f],f>o&&(o=f),i&=~u}if(i=o,i=pi()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*IL(i/1960))-i,10<i){t.timeoutHandle=$y(kl.bind(null,t,Wr,Xo),i);break}kl(t,Wr,Xo);break;case 5:kl(t,Wr,Xo);break;default:throw Error(Ze(329))}}}return Yr(t,pi()),t.callbackNode===n?mS.bind(null,t):null}function uv(t,e){var n=ad;return t.current.memoizedState.isDehydrated&&(Bl(t,e).flags|=256),t=wm(t,e),t!==2&&(e=Wr,Wr=n,e!==null&&hv(e)),t}function hv(t){Wr===null?Wr=t:Wr.push.apply(Wr,t)}function CL(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var o=n[i],u=o.getSnapshot;o=o.value;try{if(!ao(u(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Na(t,e){for(e&=~w0,e&=~Xm,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ro(e),i=1<<n;t[n]=-1,e&=~i}}function K1(t){if(rn&6)throw Error(Ze(327));uu();var e=rm(t,0);if(!(e&1))return Yr(t,pi()),null;var n=wm(t,e);if(t.tag!==0&&n===2){var i=Oy(t);i!==0&&(e=i,n=uv(t,i))}if(n===1)throw n=Cd,Bl(t,0),Na(t,e),Yr(t,pi()),n;if(n===6)throw Error(Ze(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,kl(t,Wr,Xo),Yr(t,pi()),null}function E0(t,e){var n=rn;rn|=1;try{return t(e)}finally{rn=n,rn===0&&(xu=pi()+500,Hm&&sl())}}function Hl(t){Va!==null&&Va.tag===0&&!(rn&6)&&uu();var e=rn;rn|=1;var n=zs.transition,i=yn;try{if(zs.transition=null,yn=1,t)return t()}finally{yn=i,zs.transition=n,rn=e,!(rn&6)&&sl()}}function S0(){cs=nu.current,Nn(nu)}function Bl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,sL(n)),_i!==null)for(n=_i.return;n!==null;){var i=n;switch(s0(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&cm();break;case 3:yu(),Nn(Zr),Nn(pr),p0();break;case 5:f0(i);break;case 4:yu();break;case 13:Nn(Yn);break;case 19:Nn(Yn);break;case 10:c0(i.type._context);break;case 22:case 23:S0()}n=n.return}if(Fi=t,_i=t=Ka(t.current,null),Zi=cs=e,Ai=0,Cd=null,w0=Xm=$l=0,Wr=ad=null,zl!==null){for(e=0;e<zl.length;e++)if(n=zl[e],i=n.interleaved,i!==null){n.interleaved=null;var o=i.next,u=n.pending;if(u!==null){var f=u.next;u.next=o,i.next=f}n.pending=i}zl=null}return t}function gS(t,e){do{var n=_i;try{if(l0(),Up.current=ym,_m){for(var i=Kn.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}_m=!1}if(Gl=0,Oi=Si=Kn=null,sd=!1,Ad=0,b0.current=null,n===null||n.return===null){Ai=1,Cd=e,_i=null;break}e:{var u=t,f=n.return,l=n,b=e;if(e=Zi,l.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var w=b,C=l,L=C.tag;if(!(C.mode&1)&&(L===0||L===11||L===15)){var k=C.alternate;k?(C.updateQueue=k.updateQueue,C.memoizedState=k.memoizedState,C.lanes=k.lanes):(C.updateQueue=null,C.memoizedState=null)}var H=B1(f);if(H!==null){H.flags&=-257,N1(H,f,l,u,e),H.mode&1&&F1(u,w,e),e=H,b=w;var K=e.updateQueue;if(K===null){var re=new Set;re.add(b),e.updateQueue=re}else K.add(b);break e}else{if(!(e&1)){F1(u,w,e),A0();break e}b=Error(Ze(426))}}else if(Wn&&l.mode&1){var ce=B1(f);if(ce!==null){!(ce.flags&65536)&&(ce.flags|=256),N1(ce,f,l,u,e),o0(vu(b,l));break e}}u=b=vu(b,l),Ai!==4&&(Ai=2),ad===null?ad=[u]:ad.push(u),u=f;do{switch(u.tag){case 3:u.flags|=65536,e&=-e,u.lanes|=e;var W=QE(u,b,e);L1(u,W);break e;case 1:l=b;var G=u.type,Z=u.stateNode;if(!(u.flags&128)&&(typeof G.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(Xa===null||!Xa.has(Z)))){u.flags|=65536,e&=-e,u.lanes|=e;var fe=eS(u,l,e);L1(u,fe);break e}}u=u.return}while(u!==null)}vS(n)}catch(Te){e=Te,_i===n&&n!==null&&(_i=n=n.return);continue}break}while(!0)}function _S(){var t=vm.current;return vm.current=ym,t===null?ym:t}function A0(){(Ai===0||Ai===3||Ai===2)&&(Ai=4),Fi===null||!($l&268435455)&&!(Xm&268435455)||Na(Fi,Zi)}function wm(t,e){var n=rn;rn|=2;var i=_S();(Fi!==t||Zi!==e)&&(Xo=null,Bl(t,e));do try{ML();break}catch(o){gS(t,o)}while(!0);if(l0(),rn=n,vm.current=i,_i!==null)throw Error(Ze(261));return Fi=null,Zi=0,Ai}function ML(){for(;_i!==null;)yS(_i)}function LL(){for(;_i!==null&&!nM();)yS(_i)}function yS(t){var e=bS(t.alternate,t,cs);t.memoizedProps=t.pendingProps,e===null?vS(t):_i=e,b0.current=null}function vS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=EL(n,e),n!==null){n.flags&=32767,_i=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ai=6,_i=null;return}}else if(n=TL(n,e,cs),n!==null){_i=n;return}if(e=e.sibling,e!==null){_i=e;return}_i=e=t}while(e!==null);Ai===0&&(Ai=5)}function kl(t,e,n){var i=yn,o=zs.transition;try{zs.transition=null,yn=1,kL(t,e,n,i)}finally{zs.transition=o,yn=i}return null}function kL(t,e,n,i){do uu();while(Va!==null);if(rn&6)throw Error(Ze(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ze(177));t.callbackNode=null,t.callbackPriority=0;var u=n.lanes|n.childLanes;if(dM(t,u),t===Fi&&(_i=Fi=null,Zi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vp||(vp=!0,wS(im,function(){return uu(),null})),u=(n.flags&15990)!==0,n.subtreeFlags&15990||u){u=zs.transition,zs.transition=null;var f=yn;yn=1;var l=rn;rn|=4,b0.current=null,AL(t,n),fS(n,t),JM(jy),sm=!!Vy,jy=Vy=null,t.current=n,PL(n),iM(),rn=l,yn=f,zs.transition=u}else t.current=n;if(vp&&(vp=!1,Va=t,bm=o),u=t.pendingLanes,u===0&&(Xa=null),oM(n.stateNode),Yr(t,pi()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],i(o.value,{componentStack:o.stack,digest:o.digest});if(xm)throw xm=!1,t=lv,lv=null,t;return bm&1&&t.tag!==0&&uu(),u=t.pendingLanes,u&1?t===cv?ld++:(ld=0,cv=t):ld=0,sl(),null}function uu(){if(Va!==null){var t=Q2(bm),e=zs.transition,n=yn;try{if(zs.transition=null,yn=16>t?16:t,Va===null)var i=!1;else{if(t=Va,Va=null,bm=0,rn&6)throw Error(Ze(331));var o=rn;for(rn|=4,_t=t.current;_t!==null;){var u=_t,f=u.child;if(_t.flags&16){var l=u.deletions;if(l!==null){for(var b=0;b<l.length;b++){var w=l[b];for(_t=w;_t!==null;){var C=_t;switch(C.tag){case 0:case 11:case 15:od(8,C,u)}var L=C.child;if(L!==null)L.return=C,_t=L;else for(;_t!==null;){C=_t;var k=C.sibling,H=C.return;if(uS(C),C===w){_t=null;break}if(k!==null){k.return=H,_t=k;break}_t=H}}}var K=u.alternate;if(K!==null){var re=K.child;if(re!==null){K.child=null;do{var ce=re.sibling;re.sibling=null,re=ce}while(re!==null)}}_t=u}}if(u.subtreeFlags&2064&&f!==null)f.return=u,_t=f;else e:for(;_t!==null;){if(u=_t,u.flags&2048)switch(u.tag){case 0:case 11:case 15:od(9,u,u.return)}var W=u.sibling;if(W!==null){W.return=u.return,_t=W;break e}_t=u.return}}var G=t.current;for(_t=G;_t!==null;){f=_t;var Z=f.child;if(f.subtreeFlags&2064&&Z!==null)Z.return=f,_t=Z;else e:for(f=G;_t!==null;){if(l=_t,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Zm(9,l)}}catch(Te){ii(l,l.return,Te)}if(l===f){_t=null;break e}var fe=l.sibling;if(fe!==null){fe.return=l.return,_t=fe;break e}_t=l.return}}if(rn=o,sl(),Po&&typeof Po.onPostCommitFiberRoot=="function")try{Po.onPostCommitFiberRoot(Um,t)}catch{}i=!0}return i}finally{yn=n,zs.transition=e}}return!1}function J1(t,e,n){e=vu(n,e),e=QE(t,e,1),t=Za(t,e,1),e=kr(),t!==null&&(Ud(t,1,e),Yr(t,e))}function ii(t,e,n){if(t.tag===3)J1(t,t,n);else for(;e!==null;){if(e.tag===3){J1(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Xa===null||!Xa.has(i))){t=vu(n,t),t=eS(e,t,1),e=Za(e,t,1),t=kr(),e!==null&&(Ud(e,1,t),Yr(e,t));break}}e=e.return}}function RL(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=kr(),t.pingedLanes|=t.suspendedLanes&n,Fi===t&&(Zi&n)===n&&(Ai===4||Ai===3&&(Zi&130023424)===Zi&&500>pi()-T0?Bl(t,0):w0|=n),Yr(t,e)}function xS(t,e){e===0&&(t.mode&1?(e=cp,cp<<=1,!(cp&130023424)&&(cp=4194304)):e=1);var n=kr();t=ia(t,e),t!==null&&(Ud(t,e,n),Yr(t,n))}function DL(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),xS(t,n)}function zL(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ze(314))}i!==null&&i.delete(e),xS(t,n)}var bS;bS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Zr.current)qr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return qr=!1,wL(t,e,n);qr=!!(t.flags&131072)}else qr=!1,Wn&&e.flags&1048576&&SE(e,dm,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;jp(t,e),t=e.pendingProps;var o=mu(e,pr.current);cu(e,n),o=g0(null,e,i,t,o,n);var u=_0();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Xr(i)?(u=!0,um(e)):u=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,h0(e),o.updater=qm,e.stateNode=o,o._reactInternals=e,Ky(e,i,t,n),e=ev(null,e,i,!0,u,n)):(e.tag=0,Wn&&u&&r0(e),Mr(null,e,o,n),e=e.child),e;case 16:i=e.elementType;e:{switch(jp(t,e),t=e.pendingProps,o=i._init,i=o(i._payload),e.type=i,o=e.tag=FL(i),t=eo(i,t),o){case 0:e=Qy(null,e,i,t,n);break e;case 1:e=j1(null,e,i,t,n);break e;case 11:e=U1(null,e,i,t,n);break e;case 14:e=V1(null,e,i,eo(i.type,t),n);break e}throw Error(Ze(306,i,""))}return e;case 0:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:eo(i,o),Qy(t,e,i,o,n);case 1:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:eo(i,o),j1(t,e,i,o,n);case 3:e:{if(rS(e),t===null)throw Error(Ze(387));i=e.pendingProps,u=e.memoizedState,o=u.element,LE(t,e),mm(e,i,null,n);var f=e.memoizedState;if(i=f.element,u.isDehydrated)if(u={element:i,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},e.updateQueue.baseState=u,e.memoizedState=u,e.flags&256){o=vu(Error(Ze(423)),e),e=G1(t,e,i,n,o);break e}else if(i!==o){o=vu(Error(Ze(424)),e),e=G1(t,e,i,n,o);break e}else for(ds=qa(e.stateNode.containerInfo.firstChild),fs=e,Wn=!0,no=null,n=CE(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(gu(),i===o){e=ra(t,e,n);break e}Mr(t,e,i,n)}e=e.child}return e;case 5:return kE(e),t===null&&Zy(e),i=e.type,o=e.pendingProps,u=t!==null?t.memoizedProps:null,f=o.children,Gy(i,o)?f=null:u!==null&&Gy(i,u)&&(e.flags|=32),iS(t,e),Mr(t,e,f,n),e.child;case 6:return t===null&&Zy(e),null;case 13:return sS(t,e,n);case 4:return d0(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=_u(e,null,i,n):Mr(t,e,i,n),e.child;case 11:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:eo(i,o),U1(t,e,i,o,n);case 7:return Mr(t,e,e.pendingProps,n),e.child;case 8:return Mr(t,e,e.pendingProps.children,n),e.child;case 12:return Mr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,o=e.pendingProps,u=e.memoizedProps,f=o.value,Dn(fm,i._currentValue),i._currentValue=f,u!==null)if(ao(u.value,f)){if(u.children===o.children&&!Zr.current){e=ra(t,e,n);break e}}else for(u=e.child,u!==null&&(u.return=e);u!==null;){var l=u.dependencies;if(l!==null){f=u.child;for(var b=l.firstContext;b!==null;){if(b.context===i){if(u.tag===1){b=ea(-1,n&-n),b.tag=2;var w=u.updateQueue;if(w!==null){w=w.shared;var C=w.pending;C===null?b.next=b:(b.next=C.next,C.next=b),w.pending=b}}u.lanes|=n,b=u.alternate,b!==null&&(b.lanes|=n),Xy(u.return,n,e),l.lanes|=n;break}b=b.next}}else if(u.tag===10)f=u.type===e.type?null:u.child;else if(u.tag===18){if(f=u.return,f===null)throw Error(Ze(341));f.lanes|=n,l=f.alternate,l!==null&&(l.lanes|=n),Xy(f,n,e),f=u.sibling}else f=u.child;if(f!==null)f.return=u;else for(f=u;f!==null;){if(f===e){f=null;break}if(u=f.sibling,u!==null){u.return=f.return,f=u;break}f=f.return}u=f}Mr(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,i=e.pendingProps.children,cu(e,n),o=Bs(o),i=i(o),e.flags|=1,Mr(t,e,i,n),e.child;case 14:return i=e.type,o=eo(i,e.pendingProps),o=eo(i.type,o),V1(t,e,i,o,n);case 15:return tS(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:eo(i,o),jp(t,e),e.tag=1,Xr(i)?(t=!0,um(e)):t=!1,cu(e,n),JE(e,i,o),Ky(e,i,o,n),ev(null,e,i,!0,t,n);case 19:return oS(t,e,n);case 22:return nS(t,e,n)}throw Error(Ze(156,e.tag))};function wS(t,e){return X2(t,e)}function OL(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ds(t,e,n,i){return new OL(t,e,n,i)}function P0(t){return t=t.prototype,!(!t||!t.isReactComponent)}function FL(t){if(typeof t=="function")return P0(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Wv)return 11;if(t===qv)return 14}return 2}function Ka(t,e){var n=t.alternate;return n===null?(n=Ds(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Hp(t,e,n,i,o,u){var f=2;if(i=t,typeof t=="function")P0(t)&&(f=1);else if(typeof t=="string")f=5;else e:switch(t){case Wc:return Nl(n.children,o,u,e);case Hv:f=8,o|=8;break;case by:return t=Ds(12,n,e,o|2),t.elementType=by,t.lanes=u,t;case wy:return t=Ds(13,n,e,o),t.elementType=wy,t.lanes=u,t;case Ty:return t=Ds(19,n,e,o),t.elementType=Ty,t.lanes=u,t;case k2:return Ym(n,o,u,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case M2:f=10;break e;case L2:f=9;break e;case Wv:f=11;break e;case qv:f=14;break e;case Oa:f=16,i=null;break e}throw Error(Ze(130,t==null?t:typeof t,""))}return e=Ds(f,n,e,o),e.elementType=t,e.type=i,e.lanes=u,e}function Nl(t,e,n,i){return t=Ds(7,t,i,e),t.lanes=n,t}function Ym(t,e,n,i){return t=Ds(22,t,i,e),t.elementType=k2,t.lanes=n,t.stateNode={isHidden:!1},t}function F_(t,e,n){return t=Ds(6,t,null,e),t.lanes=n,t}function B_(t,e,n){return e=Ds(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function BL(t,e,n,i,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=y_(0),this.expirationTimes=y_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=y_(0),this.identifierPrefix=i,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function I0(t,e,n,i,o,u,f,l,b){return t=new BL(t,e,n,l,b),e===1?(e=1,u===!0&&(e|=8)):e=0,u=Ds(3,null,null,e),t.current=u,u.stateNode=t,u.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},h0(u),t}function NL(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hc,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function TS(t){if(!t)return tl;t=t._reactInternals;e:{if(Kl(t)!==t||t.tag!==1)throw Error(Ze(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Xr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ze(171))}if(t.tag===1){var n=t.type;if(Xr(n))return TE(t,n,e)}return e}function ES(t,e,n,i,o,u,f,l,b){return t=I0(n,i,!0,t,o,u,f,l,b),t.context=TS(null),n=t.current,i=kr(),o=Ya(n),u=ea(i,o),u.callback=e??null,Za(n,u,o),t.current.lanes=o,Ud(t,o,i),Yr(t,i),t}function Km(t,e,n,i){var o=e.current,u=kr(),f=Ya(o);return n=TS(n),e.context===null?e.context=n:e.pendingContext=n,e=ea(u,f),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Za(o,e,f),t!==null&&(so(t,o,f,u),Np(t,o,f)),f}function Tm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Q1(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function C0(t,e){Q1(t,e),(t=t.alternate)&&Q1(t,e)}function UL(){return null}var SS=typeof reportError=="function"?reportError:function(t){console.error(t)};function M0(t){this._internalRoot=t}Jm.prototype.render=M0.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ze(409));Km(t,e,null,null)};Jm.prototype.unmount=M0.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Hl(function(){Km(null,t,null,null)}),e[na]=null}};function Jm(t){this._internalRoot=t}Jm.prototype.unstable_scheduleHydration=function(t){if(t){var e=nE();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ba.length&&e!==0&&e<Ba[n].priority;n++);Ba.splice(n,0,t),n===0&&rE(t)}};function L0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Qm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ew(){}function VL(t,e,n,i,o){if(o){if(typeof i=="function"){var u=i;i=function(){var w=Tm(f);u.call(w)}}var f=ES(e,i,t,0,null,!1,!1,"",ew);return t._reactRootContainer=f,t[na]=f.current,bd(t.nodeType===8?t.parentNode:t),Hl(),f}for(;o=t.lastChild;)t.removeChild(o);if(typeof i=="function"){var l=i;i=function(){var w=Tm(b);l.call(w)}}var b=I0(t,0,!1,null,null,!1,!1,"",ew);return t._reactRootContainer=b,t[na]=b.current,bd(t.nodeType===8?t.parentNode:t),Hl(function(){Km(e,b,n,i)}),b}function eg(t,e,n,i,o){var u=n._reactRootContainer;if(u){var f=u;if(typeof o=="function"){var l=o;o=function(){var b=Tm(f);l.call(b)}}Km(e,f,t,o)}else f=VL(n,e,t,o,i);return Tm(f)}eE=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Yh(e.pendingLanes);n!==0&&(Yv(e,n|1),Yr(e,pi()),!(rn&6)&&(xu=pi()+500,sl()))}break;case 13:Hl(function(){var i=ia(t,1);if(i!==null){var o=kr();so(i,t,1,o)}}),C0(t,1)}};Kv=function(t){if(t.tag===13){var e=ia(t,134217728);if(e!==null){var n=kr();so(e,t,134217728,n)}C0(t,134217728)}};tE=function(t){if(t.tag===13){var e=Ya(t),n=ia(t,e);if(n!==null){var i=kr();so(n,t,e,i)}C0(t,e)}};nE=function(){return yn};iE=function(t,e){var n=yn;try{return yn=t,e()}finally{yn=n}};Ry=function(t,e,n){switch(e){case"input":if(Ay(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var o=$m(i);if(!o)throw Error(Ze(90));D2(i),Ay(i,o)}}}break;case"textarea":O2(t,n);break;case"select":e=n.value,e!=null&&su(t,!!n.multiple,e,!1)}};G2=E0;$2=Hl;var jL={usingClientEntryPoint:!1,Events:[jd,Yc,$m,V2,j2,E0]},Vh={findFiberByHostInstance:Dl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},GL={bundleType:Vh.bundleType,version:Vh.version,rendererPackageName:Vh.rendererPackageName,rendererConfig:Vh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:la.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=q2(t),t===null?null:t.stateNode},findFiberByHostInstance:Vh.findFiberByHostInstance||UL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xp.isDisabled&&xp.supportsFiber)try{Um=xp.inject(GL),Po=xp}catch{}}_s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jL;_s.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!L0(e))throw Error(Ze(200));return NL(t,e,null,n)};_s.createRoot=function(t,e){if(!L0(t))throw Error(Ze(299));var n=!1,i="",o=SS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=I0(t,1,!1,null,null,n,!1,i,o),t[na]=e.current,bd(t.nodeType===8?t.parentNode:t),new M0(e)};_s.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ze(188)):(t=Object.keys(t).join(","),Error(Ze(268,t)));return t=q2(e),t=t===null?null:t.stateNode,t};_s.flushSync=function(t){return Hl(t)};_s.hydrate=function(t,e,n){if(!Qm(e))throw Error(Ze(200));return eg(null,t,e,!0,n)};_s.hydrateRoot=function(t,e,n){if(!L0(t))throw Error(Ze(405));var i=n!=null&&n.hydratedSources||null,o=!1,u="",f=SS;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),e=ES(e,null,t,1,n??null,o,!1,u,f),t[na]=e.current,bd(t),i)for(t=0;t<i.length;t++)n=i[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new Jm(e)};_s.render=function(t,e,n){if(!Qm(e))throw Error(Ze(200));return eg(null,t,e,!1,n)};_s.unmountComponentAtNode=function(t){if(!Qm(t))throw Error(Ze(40));return t._reactRootContainer?(Hl(function(){eg(null,null,t,!1,function(){t._reactRootContainer=null,t[na]=null})}),!0):!1};_s.unstable_batchedUpdates=E0;_s.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Qm(n))throw Error(Ze(200));if(t==null||t._reactInternals===void 0)throw Error(Ze(38));return eg(t,e,n,!1,i)};_s.version="18.3.1-next-f1338f8080-20240426";function AS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(AS)}catch(t){console.error(t)}}AS(),A2.exports=_s;var $L=A2.exports,tw=$L;vy.createRoot=tw.createRoot,vy.hydrateRoot=tw.hydrateRoot;const HL=[{name:"Aircotec",long:"ACT",short:"I"},{name:"Cambridge Aero Instruments",long:"CAM",short:"C"},{name:"ClearNav Instruments",long:"CNI",short:null},{name:"Data Swan/DSX",long:"DSX",short:"D"},{name:"EW Avionics",long:"EWA",short:"E"},{name:"Filser",long:"FIL",short:"F"},{name:"Flarm",long:"FLA",short:"G"},{name:"Flytech",long:"FLY",short:null},{name:"Garrecht",long:"GCS",short:"A"},{name:"IMI Gliding Equipment",long:"IMI",short:"M"},{name:"Logstream",long:"LGS",short:null},{name:"LX Navigation",long:"LXN",short:"L"},{name:"LXNAV",long:"LXV",short:"V"},{name:"Naviter",long:"NAV",short:null},{name:"New Technologies",long:"NTE",short:"N"},{name:"Nielsen Kellerman",long:"NKL",short:"K"},{name:"Peschges",long:"PES",short:"P"},{name:"PressFinish Electronics",long:"PFE",short:null},{name:"Print Technik",long:"PRT",short:"R"},{name:"Scheffel",long:"SCH",short:"H"},{name:"Streamline Data Instruments",long:"SDI",short:"S"},{name:"Triadis Engineering GmbH",long:"TRI",short:"T"},{name:"Zander",long:"ZAN",short:"Z"},{name:"XCSoar",long:"XCS",short:null},{name:"LK8000",long:"XLK",short:null},{name:"GpsDump",long:"XGD",short:null},{name:"SeeYou Recorder",long:"XCM",short:null},{name:"Flyskyhy",long:"XFH",short:null},{name:"XCTrack",long:"XCT",short:null},{name:"Flymaster Live",long:"XFM",short:null},{name:"XCTracer",long:"XTR",short:null},{name:"SkyBean",long:"XSB",short:null},{name:"leGPSBip",long:"XSD",short:null},{name:"Logfly",long:"XLF",short:null},{name:"Loctome",long:"XLM",short:null}],WL=HL;var qL=function(e){let n=e.length===1;e=e.toUpperCase();let i=WL.filter(o=>o[n?"short":"long"]===e);return i.length!==0?i[0].name:e},nw=qL,ZL=60*60*1e3,XL=24*60*60*1e3,YL=/^A(\w{3})(\w{3,}?)(?:FLIGHT:(\d+)|\:(.+))?$/,KL=/^HFDTE(?:DATE:)?(\d{2})(\d{2})(\d{2})(?:,?(\d{2}))?/,JL=/^H(\w)PLT(?:.{0,}?:(.*)|(.*))$/,QL=/^H(\w)CM2(?:.{0,}?:(.*)|(.*))$/,ek=/^H(\w)GTY(?:.{0,}?:(.*)|(.*))$/,tk=/^H(\w)GID(?:.{0,}?:(.*)|(.*))$/,nk=/^H(\w)CID(?:.{0,}?:(.*)|(.*))$/,ik=/^H(\w)CCL(?:.{0,}?:(.*)|(.*))$/,rk=/^H(\w)SIT(?:.{0,}?:(.*)|(.*))$/,sk=/^H(\w)FTY(?:.{0,}?:(.*)|(.*))$/,ok=/^H(\w)RFW(?:.{0,}?:(.*)|(.*))$/,ak=/^H(\w)RHW(?:.{0,}?:(.*)|(.*))$/,lk=/^H(\w)TZN(?:.{0,}?:([-+]?[\d.]+))$/,ck=/^H(\w)DTM(?:.{0,}?:(.*)|(.*))$/,uk=/^H(\w)ALG(?:.{0,}?:(.*)|(.*))$/,hk=/^H(\w)ALP(?:.{0,}?:(.*)|(.*))$/,dk=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{3})([NS])(\d{3})(\d{2})(\d{3})([EW])([AV])(-\d{4}|\d{5})(-\d{4}|\d{5})/,fk=/^K(\d{2})(\d{2})(\d{2})/,pk=/^[IJ](\d{2})(?:\d{2}\d{2}[A-Z]{3})+/,mk=/^[L]([A-Z]{3})(.+)/,gk=/^C(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{4})([-\d]{2})(.*)/,_k=/^C(\d{2})(\d{2})(\d{3})([NS])(\d{3})(\d{2})(\d{3})([EW])(.*)/,iw=/^\d*$/,yk=["F","O","P"],vk=function(){function t(e){e===void 0&&(e={}),this._result={numFlight:null,pilot:null,copilot:null,gliderType:null,registration:null,callsign:null,competitionClass:null,loggerType:null,firmwareVersion:null,hardwareVersion:null,geoDatum:null,geoDatumAlgorithm:null,geoPressureAlgorithm:null,task:null,fixes:[],dataRecords:[],commentRecords:[],security:null,errors:[]},this.fixExtensions=[],this.dataExtensions=[],this.lineNumber=0,this.prevTimestamp=null,this.options=e}return t.parse=function(e,n){n===void 0&&(n={});for(var i=new t(n),o=[],u=0,f=e.split(`
`);u<f.length;u++){var l=f[u];try{i.processLine(l.trim())}catch(w){if(n.lenient)o.push(w);else throw w}}var b=i.result;return b.errors=o,b},Object.defineProperty(t.prototype,"result",{get:function(){if(!this._result.loggerManufacturer)throw new Error("Missing A record");if(!this._result.date)throw new Error("Missing HFDTE record");return this._result},enumerable:!1,configurable:!0}),t.prototype.processLine=function(e){this.lineNumber+=1;var n=e[0];if(n==="B"){var i=this.parseBRecord(e);this.prevTimestamp=i.timestamp,this._result.fixes.push(i)}else if(n==="K"){var o=this.parseKRecord(e);this.prevTimestamp=o.timestamp,this._result.dataRecords.push(o)}else if(n==="H")this.processHeader(e);else if(n==="C")this.processTaskLine(e);else if(n==="A"){var u=this.parseARecord(e);this._result.loggerId=u.loggerId,this._result.loggerManufacturer=u.manufacturer,u.numFlight!==null&&(this._result.numFlight=u.numFlight)}else n==="I"?this.fixExtensions=this.parseIJRecord(e):n==="J"?this.dataExtensions=this.parseIJRecord(e):n==="L"&&this.options.parseComments?this._result.commentRecords.push(this.parseLRecord(e)):n==="G"&&(this._result.security=(this._result.security||"")+e.slice(1))},t.prototype.processHeader=function(e){var n=e.slice(2,5);if(n==="DTE"){var i=this.parseDateHeader(e);this._result.date=i.date,i.numFlight!==null&&(this._result.numFlight=i.numFlight)}else n==="PLT"?this._result.pilot=this.parsePilot(e):n==="CM2"?this._result.copilot=this.parseCopilot(e):n==="GTY"?this._result.gliderType=this.parseGliderType(e):n==="GID"?this._result.registration=this.parseRegistration(e):n==="CID"?this._result.callsign=this.parseCallsign(e):n==="CCL"?this._result.competitionClass=this.parseCompetitionClass(e):n==="SIT"?this._result.site=this.parseSite(e):n==="TZN"?this._result.timezone=this.parseTimezone(e):n==="FTY"?this._result.loggerType=this.parseLoggerType(e):n==="RFW"?this._result.firmwareVersion=this.parseFirmwareVersion(e):n==="RHW"?this._result.hardwareVersion=this.parseHardwareVersion(e):n==="DTM"?this._result.geoDatum=this.parseGeoDatum(e):n==="ALG"?this._result.geoDatumAlgorithm=this.parseGeoDatumAlgorithm(e):n==="ALP"&&(this._result.geoPressureAlgorithm=this.parseGeoPressureAlgorithm(e))},t.prototype.parseARecord=function(e){var n=e.match(YL);if(n){var i=nw(n[1]),o=n[2],u=n[3]?parseInt(n[3],10):null,f=n[4]||null;return{manufacturer:i,loggerId:o,numFlight:u,additionalData:f}}if(n=e.match(/^A(\w{3})(.+)?$/),n){var i=nw(n[1]),f=n[2]?n[2].trim():null;return{manufacturer:i,loggerId:null,numFlight:null,additionalData:f}}throw new Error("Invalid A record at line ".concat(this.lineNumber,": ").concat(e))},t.prototype.parseDateHeader=function(e){var n=e.match(KL);if(!n)throw new Error("Invalid DTE header at line ".concat(this.lineNumber,": ").concat(e));var i=n[3][0]==="8"||n[3][0]==="9",o="".concat(i?"19":"20").concat(n[3],"-").concat(n[2],"-").concat(n[1]),u=n[4]?parseInt(n[4],10):null;return{date:o,numFlight:u}},t.prototype.parseTextHeader=function(e,n,i,o){o===void 0&&(o=" ");var u=i.match(n);if(!u)throw new Error("Invalid ".concat(e," header at line ").concat(this.lineNumber,": ").concat(i));var f=u[1];if(yk.indexOf(f)===-1&&!this.options.lenient)throw new Error("Invalid data source at line ".concat(this.lineNumber,": ").concat(f));return(u[2]||u[3]||"").replace(/_/g,o).trim()},t.prototype.parsePilot=function(e){return this.parseTextHeader("PLT",JL,e)},t.prototype.parseCopilot=function(e){return this.parseTextHeader("CM2",QL,e)},t.prototype.parseGliderType=function(e){return this.parseTextHeader("GTY",ek,e)},t.prototype.parseRegistration=function(e){return this.parseTextHeader("GID",tk,e,"-")},t.prototype.parseCallsign=function(e){return this.parseTextHeader("GTY",nk,e)},t.prototype.parseCompetitionClass=function(e){return this.parseTextHeader("GID",ik,e)},t.prototype.parseSite=function(e){return this.parseTextHeader("SIT",rk,e)},t.prototype.parseTimezone=function(e){var n=this.parseTextHeader("TZN",lk,e),i=parseFloat(n);if(isNaN(i))throw new Error("Invalid TZN header at line ".concat(this.lineNumber,": ").concat(e));return i},t.prototype.parseLoggerType=function(e){return this.parseTextHeader("FTY",sk,e)},t.prototype.parseFirmwareVersion=function(e){return this.parseTextHeader("RFW",ok,e)},t.prototype.parseHardwareVersion=function(e){return this.parseTextHeader("RHW",ak,e)},t.prototype.parseGeoDatum=function(e){return this.parseTextHeader("FDT",ck,e)},t.prototype.parseGeoDatumAlgorithm=function(e){return this.parseTextHeader("ALG",uk,e)},t.prototype.parseGeoPressureAlgorithm=function(e){return this.parseTextHeader("ALP",hk,e)},t.prototype.processTaskLine=function(e){this._result.task?this._result.task.points.push(this.parseTaskPoint(e)):this._result.task=this.parseTask(e)},t.prototype.parseTask=function(e){var n=e.match(gk);if(!n)throw new Error("Invalid task declaration at line ".concat(this.lineNumber,": ").concat(e));var i=n[3][0]==="8"||n[3][0]==="9",o="".concat(i?"19":"20").concat(n[3],"-").concat(n[2],"-").concat(n[1]),u="".concat(n[4],":").concat(n[5],":").concat(n[6]),f=Date.parse("".concat(o,"T").concat(u,"Z")),l=null;(n[7]!=="00"||n[8]!=="00"||n[9]!=="00")&&(i=n[9][0]==="8"||n[9][0]==="9",l="".concat(i?"19":"20").concat(n[9],"-").concat(n[8],"-").concat(n[7]));var b=n[10]!=="0000"?parseInt(n[10],10):null,w=parseInt(n[11],10),C=n[12]||null;return{declarationDate:o,declarationTime:u,declarationTimestamp:f,flightDate:l,taskNumber:b,numTurnpoints:w,comment:C,points:[]}},t.prototype.parseTaskPoint=function(e){var n=e.match(_k);if(!n)throw new Error("Invalid task point declaration at line ".concat(this.lineNumber,": ").concat(e));var i=t.parseLatitude(n[1],n[2],n[3],n[4]),o=t.parseLongitude(n[5],n[6],n[7],n[8]),u=n[9]||null;return{latitude:i,longitude:o,name:u}},t.prototype.parseBRecord=function(e){if(!this._result.date)throw new Error("Missing HFDTE record before first B record");var n=e.match(dk);if(!n)throw new Error("Invalid B record at line ".concat(this.lineNumber,": ").concat(e));var i={};if(this.fixExtensions)for(var o=0,u=this.fixExtensions;o<u.length;o++){var f=u[o],l=f.code,b=f.start,w=f.length;i[l]=e.slice(b,b+w)}var C="".concat(n[1],":").concat(n[2],":").concat(n[3]),L=this.calcTimestamp(C),k=iw.test(i.LAD)?i.LAD:"",H=t.parseLatitude(n[4],n[5],n[6]+k,n[7]);k=iw.test(i.LOD)?i.LOD:"";var K=t.parseLongitude(n[8],n[9],n[10]+k,n[11]),re=n[12]==="A",ce=n[13]==="00000"?null:parseInt(n[13],10),W=n[14]==="00000"?null:parseInt(n[14],10),G=null;if(i.ENL){var Z=this.fixExtensions.filter(function(Pe){return Pe.code==="ENL"})[0].length,fe=Math.pow(10,Z);G=parseInt(i.ENL,10)/fe}var Te=i.FXA?parseInt(i.FXA,10):null;return{timestamp:L,time:C,latitude:H,longitude:K,valid:re,pressureAltitude:ce,gpsAltitude:W,extensions:i,enl:G,fixAccuracy:Te}},t.prototype.parseKRecord=function(e){if(!this._result.date)throw new Error("Missing HFDTE record before first K record");if(!this.dataExtensions)throw new Error("Missing J record before first K record");var n=e.match(fk);if(!n)throw new Error("Invalid K record at line ".concat(this.lineNumber,": ").concat(e));var i="".concat(n[1],":").concat(n[2],":").concat(n[3]),o=this.calcTimestamp(i),u={};if(this.dataExtensions)for(var f=0,l=this.dataExtensions;f<l.length;f++){var b=l[f],w=b.code,C=b.start,L=b.length;u[w]=e.slice(C,C+L)}return{timestamp:o,time:i,extensions:u}},t.prototype.parseIJRecord=function(e){var n=e.match(pk);if(!n)throw new Error("Invalid ".concat(e[0]," record at line ").concat(this.lineNumber,": ").concat(e));var i=parseInt(n[1],10);if(e.length<3+i*7)throw new Error("Invalid ".concat(e[0]," record at line ").concat(this.lineNumber,": ").concat(e));for(var o=new Array(i),u=0;u<i;u++){var f=3+u*7,l=parseInt(e.slice(f,f+2),10)-1,b=parseInt(e.slice(f+2,f+4),10)-1,w=b-l+1,C=e.slice(f+4,f+7);o[u]={start:l,length:w,code:C}}return o},t.prototype.parseLRecord=function(e){var n=e.match(mk);if(!n)throw new Error("Invalid L record at line ".concat(this.lineNumber,": ").concat(e));return{code:n[1],message:n[2].trim()}},t.parseLatitude=function(e,n,i,o){var u=parseInt(e,10)+parseFloat("".concat(n,".").concat(i))/60;return o==="S"?-u:u},t.parseLongitude=function(e,n,i,o){var u=parseInt(e,10)+parseFloat("".concat(n,".").concat(i))/60;return o==="W"?-u:u},t.prototype.calcTimestamp=function(e){for(var n=Date.parse("".concat(this._result.date,"T").concat(e,"Z"));this.prevTimestamp&&n<this.prevTimestamp-ZL;)n+=XL;return n},t}(),xk=vk;const bk=Bm(xk);function rw(t){return new Promise((e,n)=>{const i=new FileReader;i.onload=o=>{var u,f,l;try{const b=o.target.result,w=bk.parse(b,{lenient:!0});if(console.log("IGC Parser result:",w),console.log("Fixes count:",(u=w==null?void 0:w.fixes)==null?void 0:u.length),console.log("Sample fix:",(f=w==null?void 0:w.fixes)==null?void 0:f[0]),!w||!w.fixes||w.fixes.length===0){n(new Error("No valid track points found in IGC file"));return}let C="Unknown Pilot";w.pilot&&(C=w.pilot);const L=w.fixes.filter(ce=>ce.valid&&ce.latitude&&ce.longitude).map(ce=>({timestamp:new Date(ce.timestamp),latitude:ce.latitude,longitude:ce.longitude,altitude:ce.gpsAltitude||ce.pressureAltitude||0,time:ce.time}));if(L.length===0){n(new Error("No valid GPS coordinates found in IGC file"));return}const k=L[0].timestamp,H=L[L.length-1].timestamp,K=H.getTime()-k.getTime(),re={id:wk(),name:t.name,pilotName:C,coordinates:L,startTime:k,endTime:H,duration:K,color:Tk(),file:t,parsedData:w};console.log("Final track object:",re),console.log("Sample coordinate:",L[0]),console.log("Coordinate has timestamp:",!!((l=L[0])!=null&&l.timestamp)),e(re)}catch(b){n(new Error(`Failed to parse IGC file: ${b.message}`))}},i.onerror=()=>n(new Error("Failed to read file")),i.readAsText(t)})}function wk(){return"track_"+Math.random().toString(36).substr(2,9)}function Tk(){const t=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#F97316","#06B6D4","#EC4899"];return t[Math.floor(Math.random()*t.length)]}const Ek=({onFilesUploaded:t,onCreateReplay:e,tracks:n})=>{const[i,o]=gn.useState(!1),[u,f]=gn.useState(!1),[l,b]=gn.useState(""),w=gn.useCallback(ce=>{ce.preventDefault(),o(!0)},[]),C=gn.useCallback(ce=>{ce.preventDefault(),o(!1)},[]),L=gn.useCallback(async ce=>{ce.preventDefault(),o(!1),f(!0),b("");const W=Array.from(ce.dataTransfer.files).filter(G=>G.name.toLowerCase().endsWith(".igc"));if(W.length===0){b("Please drop IGC files only"),f(!1);return}try{const G=[];for(const Z of W)try{const fe=await rw(Z);G.push(fe)}catch(fe){console.error(`Failed to parse ${Z.name}:`,fe),b(`Failed to parse ${Z.name}: ${fe.message}`)}G.length>0&&t(G)}catch(G){b(`Error processing files: ${G.message}`)}finally{f(!1)}},[t]),k=gn.useCallback(async ce=>{const W=Array.from(ce.target.files).filter(G=>G.name.toLowerCase().endsWith(".igc"));if(W.length!==0){f(!0),b("");try{const G=[];for(const Z of W)try{const fe=await rw(Z);G.push(fe)}catch(fe){console.error(`Failed to parse ${Z.name}:`,fe),b(`Failed to parse ${Z.name}: ${fe.message}`)}G.length>0&&t(G)}catch(G){b(`Error processing files: ${G.message}`)}finally{f(!1)}}},[t]),H=(ce,W)=>{const G=n.map(Z=>Z.id===ce?{...Z,pilotName:W}:Z);t(G)},K=ce=>{const W=n.filter(G=>G.id!==ce);t(W)},re=ce=>{const W=Math.floor(ce/6e4),G=Math.floor(ce%6e4/1e3);return`${W}:${G.toString().padStart(2,"0")}`};return at.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:at.jsxs("div",{className:"max-w-4xl mx-auto",children:[at.jsxs("div",{className:"text-center mb-8",children:[at.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"GlideTrax"}),at.jsx("p",{className:"text-lg text-gray-600",children:"3D GPS Track Replay"})]}),at.jsx("div",{className:`relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 ${i?"border-blue-500 bg-blue-50":"border-gray-300 bg-white hover:border-gray-400"}`,onDragOver:w,onDragLeave:C,onDrop:L,children:at.jsxs("div",{className:"space-y-4",children:[at.jsx("div",{className:"text-6xl text-gray-400 mb-4",children:"📁"}),at.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"Drop your IGC files here"}),at.jsx("p",{className:"text-gray-500",children:"Or click to browse files"}),at.jsx("input",{type:"file",multiple:!0,accept:".igc",onChange:k,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})}),l&&at.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:at.jsx("p",{className:"text-red-700",children:l})}),u&&at.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:at.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[at.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),at.jsx("span",{className:"text-blue-700",children:"Processing files..."})]})}),n.length>0&&at.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow-lg p-6",children:[at.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Uploaded Tracks (",n.length,")"]}),at.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:n.map(ce=>at.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[at.jsx("div",{className:"flex-1",children:at.jsxs("div",{className:"flex items-center space-x-3",children:[at.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:ce.color}}),at.jsxs("div",{children:[at.jsx("p",{className:"font-medium text-gray-900",children:ce.name}),at.jsxs("div",{className:"flex items-center space-x-2",children:[at.jsx("input",{type:"text",value:ce.pilotName,onChange:W=>H(ce.id,W.target.value),className:"text-sm px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Pilot name"}),at.jsxs("span",{className:"text-sm text-gray-500",children:[ce.coordinates.length," points"]}),at.jsx("span",{className:"text-sm text-gray-500",children:re(ce.duration)})]})]})]})}),at.jsx("button",{onClick:()=>K(ce.id),className:"text-red-600 hover:text-red-800 p-2",title:"Remove track",children:at.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:at.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},ce.id))}),at.jsx("div",{className:"mt-6 text-center",children:at.jsx("button",{onClick:e,disabled:n.length===0,className:"px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Create 3D Replay"})})]}),at.jsxs("div",{className:"mt-8 text-center text-gray-600",children:[at.jsx("p",{className:"mb-2",children:"Supported format: IGC (.igc)"}),at.jsx("p",{className:"text-sm",children:"Drop one or more IGC files to get started"})]})]})})};var PS={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(_C,function(){var n,i,o;function u(l,b){if(!n)n=b;else if(!i)i=b;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",C={};n(C),o=b(C),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}u(["exports"],function(l){function b(a,r,c,d){return new(c||(c=Promise))(function(m,v){function x(I){try{A(d.next(I))}catch(R){v(R)}}function T(I){try{A(d.throw(I))}catch(R){v(R)}}function A(I){var R;I.done?m(I.value):(R=I.value,R instanceof c?R:new c(function(O){O(R)})).then(x,T)}A((d=d.apply(a,r||[])).next())})}function w(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}typeof SuppressedError=="function"&&SuppressedError;var C=L;function L(a,r){this.x=a,this.y=r}L.prototype={clone:function(){return new L(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,c=a.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),c=Math.sin(a),d=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=d,this},_rotateAround:function(a,r){var c=Math.cos(a),d=Math.sin(a),m=r.y+d*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-d*(this.y-r.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},L.convert=function(a){return a instanceof L?a:Array.isArray(a)?new L(a[0],a[1]):a};var k=w(C),H=K;function K(a,r,c,d){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=c,this.p2y=d}K.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,d=0;d<8;d++){var m=this.sampleCurveX(c)-a;if(Math.abs(m)<r)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=m/v}var x=0,T=1;for(c=a,d=0;d<20&&(m=this.sampleCurveX(c),!(Math.abs(m-a)<r));d++)a>m?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};var re=w(H);let ce,W;function G(){return ce==null&&(ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ce}function Z(){if(W==null&&(W=!1,G())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let d=0;d<5*5;d++){const m=4*d;r.fillStyle=`rgb(${m},${m+1},${m+2})`,r.fillRect(d%5,Math.floor(d/5),1,1)}const c=r.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&c[d]!==d){W=!0;break}}}return W||!1}function fe(a,r,c,d){const m=new re(a,r,c,d);return function(v){return m.solve(v)}}const Te=fe(.25,.1,.25,1);function Pe(a,r,c){return Math.min(c,Math.max(r,a))}function ze(a,r,c){const d=c-r,m=((a-r)%d+d)%d+r;return m===r?c:m}function Oe(a,...r){for(const c of r)for(const d in c)a[d]=c[d];return a}let Me=1;function Ee(a,r,c){const d={};for(const m in a)d[m]=r.call(c||this,a[m],m,a);return d}function Re(a,r,c){const d={};for(const m in a)r.call(c||this,a[m],m,a)&&(d[m]=a[m]);return d}function nt(a){return Array.isArray(a)?a.map(nt):typeof a=="object"&&a?Ee(a,nt):a}const rt={};function yt(a){rt[a]||(typeof console<"u"&&console.warn(a),rt[a]=!0)}function Dt(a,r,c){return(c.y-a.y)*(r.x-a.x)>(r.y-a.y)*(c.x-a.x)}function Sn(a){let r=0;for(let c,d,m=0,v=a.length,x=v-1;m<v;x=m++)c=a[m],d=a[x],r+=(d.x-c.x)*(c.y+d.y);return r}function Xt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ye=null;function Tt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ot(a,r,c,d,m){return b(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(a,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const T=x.startsWith("BGR"),A=new Uint8ClampedArray(d*m*4);if(yield v.copyTo(A,function(I,R,O,B,j){const $=4*Math.max(-R,0),Q=(Math.max(0,O)-O)*B*4+$,oe=4*B,he=Math.max(0,R),ve=Math.max(0,O);return{rect:{x:he,y:ve,width:Math.min(I.width,R+B)-he,height:Math.min(I.height,O+j)-ve},layout:[{offset:Q,stride:oe}]}}(a,r,c,d,m)),T)for(let I=0;I<A.length;I+=4){const R=A[I];A[I]=A[I+2],A[I+2]=R}return A}finally{v.close()}})}let Mt,Kt,vn,mr;const Ii={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){return this.getImageCanvasContext(a).getImageData(-r,-r,a.width+2*r,a.height+2*r)},getImageCanvasContext(a){const r=window.document.createElement("canvas"),c=r.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return r.width=a.width,r.height=a.height,c.drawImage(a,0,0,a.width,a.height),c},resolveURL:a=>(vn||(vn=document.createElement("a")),vn.href=a,vn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(mr==null&&(mr=matchMedia("(prefers-reduced-motion: reduce)")),mr.matches)}},dn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Ci extends Error{constructor(r,c,d,m){super(`AJAXError: ${c} (${r}): ${d}`),this.status=r,this.statusText=c,this.url=d,this.body=m}}const tn=Xt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,fn=a=>dn.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))];function vs(a,r){const c=new AbortController,d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:tn(),signal:c.signal});let m=!1,v=!1;return a.type==="json"&&d.headers.set("Accept","application/json"),v||fetch(d).then(x=>x.ok?(T=>{(a.type==="arrayBuffer"||a.type==="image"?T.arrayBuffer():a.type==="json"?T.json():T.text()).then(A=>{v||(m=!0,r(null,A,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(A=>{v||r(new Error(A.message))})})(x):x.blob().then(T=>r(new Ci(x.status,x.statusText,a.url,T)))).catch(x=>{x.code!==20&&r(new Error(x.message))}),{cancel:()=>{v=!0,m||c.abort()}}}const Yi=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Xt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r);if(!Xt())return(fn(a.url)||vs)(a,r)}if(!(/^file:/.test(c=a.url)||/^file:/.test(tn())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return vs(a,r);if(Xt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var c;return function(d,m){const v=new XMLHttpRequest;v.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(v.responseType="arraybuffer");for(const x in d.headers)v.setRequestHeader(x,d.headers[x]);return d.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=d.credentials==="include",v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let x=v.response;if(d.type==="json")try{x=JSON.parse(v.response)}catch(T){return m(T)}m(null,x,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const x=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});m(new Ci(v.status,v.statusText,d.url,x))}},v.send(d.body),{cancel:()=>v.abort()}}(a,r)},Kr=function(a,r){return Yi(Oe(a,{type:"arrayBuffer"}),r)};function Bi(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const r=new URL(a),c=window.location;return r.protocol===c.protocol&&r.host===c.host}function zr(a,r,c){c[a]&&c[a].indexOf(r)!==-1||(c[a]=c[a]||[],c[a].push(r))}function gi(a,r,c){if(c&&c[a]){const d=c[a].indexOf(r);d!==-1&&c[a].splice(d,1)}}class Mi{constructor(r,c={}){Oe(this,c),this.type=r}}class Jr extends Mi{constructor(r,c={}){super("error",Oe({error:r},c))}}class xs{on(r,c){return this._listeners=this._listeners||{},zr(r,c,this._listeners),this}off(r,c){return gi(r,c,this._listeners),gi(r,c,this._oneTimeListeners),this}once(r,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},zr(r,c,this._oneTimeListeners),this):new Promise(d=>this.once(r,d))}fire(r,c){typeof r=="string"&&(r=new Mi(r,c||{}));const d=r.type;if(this.listens(d)){r.target=this;const m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of m)T.call(this,r);const v=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of v)gi(d,T,this._oneTimeListeners),T.call(this,r);const x=this._eventedParent;x&&(Oe(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof Jr&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,c){return this._eventedParent=r,this._eventedParentData=c,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const pn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ki(a,r){const c={};for(const d in a)d!=="ref"&&(c[d]=a[d]);return pn.forEach(d=>{d in r&&(c[d]=r[d])}),c}function sn(a,r){if(Array.isArray(a)){if(!Array.isArray(r)||a.length!==r.length)return!1;for(let c=0;c<a.length;c++)if(!sn(a[c],r[c]))return!1;return!0}if(typeof a=="object"&&a!==null&&r!==null){if(typeof r!="object"||Object.keys(a).length!==Object.keys(r).length)return!1;for(const c in a)if(!sn(a[c],r[c]))return!1;return!0}return a===r}const Wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Or(a,r,c){c.push({command:Wt.addSource,args:[a,r[a]]})}function lo(a,r,c){r.push({command:Wt.removeSource,args:[a]}),c[a]=!0}function Fr(a,r,c,d){lo(a,c,d),Or(a,r,c)}function Lo(a,r,c){let d;for(d in a[c])if(Object.prototype.hasOwnProperty.call(a[c],d)&&d!=="data"&&!sn(a[c][d],r[c][d]))return!1;for(d in r[c])if(Object.prototype.hasOwnProperty.call(r[c],d)&&d!=="data"&&!sn(a[c][d],r[c][d]))return!1;return!0}function Us(a,r,c,d,m,v){let x;for(x in r=r||{},a=a||{})Object.prototype.hasOwnProperty.call(a,x)&&(sn(a[x],r[x])||c.push({command:v,args:[d,x,r[x],m]}));for(x in r)Object.prototype.hasOwnProperty.call(r,x)&&!Object.prototype.hasOwnProperty.call(a,x)&&(sn(a[x],r[x])||c.push({command:v,args:[d,x,r[x],m]}))}function Qr(a){return a.id}function Br(a,r){return a[r.id]=r,a}class He{constructor(r,c,d,m){this.message=(r?`${r}: `:"")+d,m&&(this.identifier=m),c!=null&&c.__line__&&(this.line=c.__line__)}}function Nr(a,...r){for(const c of r)for(const d in c)a[d]=c[d];return a}class An extends Error{constructor(r,c){super(c),this.message=c,this.key=r}}class Vs{constructor(r,c=[]){this.parent=r,this.bindings={};for(const[d,m]of c)this.bindings[d]=m}concat(r){return new Vs(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const es={kind:"null"},qe={kind:"number"},It={kind:"string"},Pt={kind:"boolean"},yi={kind:"color"},gr={kind:"object"},Ct={kind:"value"},_r={kind:"collator"},ne={kind:"formatted"},F={kind:"padding"},U={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function se(a,r){return{kind:"array",itemType:a,N:r}}function ae(a){if(a.kind==="array"){const r=ae(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const xe=[es,qe,It,Pt,yi,ne,gr,se(Ct),F,U,X];function me(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!me(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const c of xe)if(!me(c,r))return null}}return`Expected ${ae(a)} but found ${ae(r)} instead.`}function ue(a,r){return r.some(c=>c.kind===a.kind)}function _e(a,r){return r.some(c=>c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a)}function ke(a,r){return a.kind==="array"&&r.kind==="array"?a.itemType.kind===r.itemType.kind&&typeof a.N=="number":a.kind===r.kind}const De=.96422,Ne=.82521,gt=4/29,St=6/29,ot=3*St*St,vt=St*St*St,At=Math.PI/180,qt=180/Math.PI;function Jt(a){return(a%=360)<0&&(a+=360),a}function kt([a,r,c,d]){let m,v;const x=Un((.2225045*(a=Rt(a))+.7168786*(r=Rt(r))+.0606169*(c=Rt(c)))/1);a===r&&r===c?m=v=x:(m=Un((.4360747*a+.3850649*r+.1430804*c)/De),v=Un((.0139322*a+.0971045*r+.7141733*c)/Ne));const T=116*x-16;return[T<0?0:T,500*(m-x),200*(x-v),d]}function Rt(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Un(a){return a>vt?Math.pow(a,1/3):a/ot+gt}function nn([a,r,c,d]){let m=(a+16)/116,v=isNaN(r)?m:m+r/500,x=isNaN(c)?m:m-c/200;return m=1*ri(m),v=De*ri(v),x=Ne*ri(x),[Cn(3.1338561*v-1.6168667*m-.4906146*x),Cn(-.9787684*v+1.9161415*m+.033454*x),Cn(.0719453*v-.2289914*m+1.4052427*x),d]}function Cn(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function ri(a){return a>St?a*a*a:ot*(a-gt)}function Ji(a){return parseInt(a.padEnd(2,a),16)/255}function ko(a,r){return si(r?a/100:a,0,1)}function si(a,r,c){return Math.min(Math.max(r,a),c)}function yr(a){return!a.some(Number.isNaN)}const bs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Nt{constructor(r,c,d,m=1,v=!0){this.r=r,this.g=c,this.b=d,this.a=m,v||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[r,c,d,m]))}static parse(r){if(r instanceof Nt)return r;if(typeof r!="string")return;const c=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=bs[d];if(m){const[x,T,A]=m;return[x/255,T/255,A/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const x=d.length<6?1:2;let T=1;return[Ji(d.slice(T,T+=x)),Ji(d.slice(T,T+=x)),Ji(d.slice(T,T+=x)),Ji(d.slice(T,T+x)||"ff")]}if(d.startsWith("rgb")){const x=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,A,I,R,O,B,j,$,Q,oe,he,ve]=x,pe=[R||" ",j||" ",oe].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const be=[I,B,Q].join(""),Se=be==="%%%"?100:be===""?255:0;if(Se){const Be=[si(+A/Se,0,1),si(+O/Se,0,1),si(+$/Se,0,1),he?ko(+he,ve):1];if(yr(Be))return Be}}return}}const v=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,T,A,I,R,O,B,j,$]=v,Q=[A||" ",R||" ",B].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const oe=[+T,si(+I,0,100),si(+O,0,100),j?ko(+j,$):1];if(yr(oe))return function([he,ve,pe,be]){function Se(Be){const tt=(Be+he/30)%12,ht=ve*Math.min(pe,1-pe);return pe-ht*Math.max(-1,Math.min(tt-3,9-tt,1))}return he=Jt(he),ve/=100,pe/=100,[Se(0),Se(8),Se(4),be]}(oe)}}}(r);return c?new Nt(...c,!1):void 0}get rgb(){const{r,g:c,b:d,a:m}=this,v=m||1/0;return this.overwriteGetter("rgb",[r/v,c/v,d/v,m])}get hcl(){return this.overwriteGetter("hcl",function(r){const[c,d,m,v]=kt(r),x=Math.sqrt(d*d+m*m);return[Math.round(1e4*x)?Jt(Math.atan2(m,d)*qt):NaN,x,c,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",kt(this.rgb))}overwriteGetter(r,c){return Object.defineProperty(this,r,{value:c}),c}toString(){const[r,c,d,m]=this.rgb;return`rgba(${[r,c,d].map(v=>Math.round(255*v)).join(",")},${m})`}}Nt.black=new Nt(0,0,0,1),Nt.white=new Nt(1,1,1,1),Nt.transparent=new Nt(0,0,0,0),Nt.red=new Nt(1,0,0,1);class js{constructor(r,c,d){this.sensitivity=r?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,c){return this.collator.compare(r,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ni{constructor(r,c,d,m,v){this.text=r,this.image=c,this.scale=d,this.fontStack=m,this.textColor=v}}class xn{constructor(r){this.sections=r}static fromString(r){return new xn([new Ni(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof xn?r:xn.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Li{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Li)return r;if(typeof r=="number")return new Li([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const c of r)if(typeof c!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new Li(r)}}toString(){return JSON.stringify(this.values)}}const nc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class vi{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof vi)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let c=0;c<r.length;c+=2){const d=r[c],m=r[c+1];if(typeof d!="string"||!nc.has(d)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new vi(r)}}toString(){return JSON.stringify(this.values)}}class ln{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ln({name:r,available:!1}):null}}function Gs(a,r,c,d){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[a,r,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[a,r,c,d]:[a,r,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ws(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Nt||a instanceof js||a instanceof xn||a instanceof Li||a instanceof vi||a instanceof ln)return!0;if(Array.isArray(a)){for(const r of a)if(!ws(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!ws(a[r]))return!1;return!0}return!1}function un(a){if(a===null)return es;if(typeof a=="string")return It;if(typeof a=="boolean")return Pt;if(typeof a=="number")return qe;if(a instanceof Nt)return yi;if(a instanceof js)return _r;if(a instanceof xn)return ne;if(a instanceof Li)return F;if(a instanceof vi)return X;if(a instanceof ln)return U;if(Array.isArray(a)){const r=a.length;let c;for(const d of a){const m=un(d);if(c){if(c===m)continue;c=Ct;break}c=m}return se(c||Ct,r)}return gr}function Ht(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof Nt||a instanceof xn||a instanceof Li||a instanceof vi||a instanceof ln?a.toString():JSON.stringify(a)}class ts{constructor(r,c){this.type=r,this.value=c}static parse(r,c){if(r.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ws(r[1]))return c.error("invalid value");const d=r[1];let m=un(d);const v=c.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new ts(m,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hn{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const vr={string:It,number:qe,boolean:Pt,object:gr};class Qi{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");let d,m=1;const v=r[0];if(v==="array"){let T,A;if(r.length>2){const I=r[1];if(typeof I!="string"||!(I in vr)||I==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=vr[I],m++}else T=Ct;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return c.error('The length argument to "array" must be a positive integer literal',2);A=r[2],m++}d=se(T,A)}else{if(!vr[v])throw new Error(`Types doesn't contain name = ${v}`);d=vr[v]}const x=[];for(;m<r.length;m++){const T=c.parse(r[m],m,Ct);if(!T)return null;x.push(T)}return new Qi(d,x)}evaluate(r){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(r);if(!me(this.type,un(d)))return d;if(c===this.args.length-1)throw new hn(`Expected value to be of type ${ae(this.type)}, but found ${ae(un(d))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const ha={"to-boolean":Pt,"to-color":yi,"to-number":qe,"to-string":It};class Ur{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[0];if(!ha[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&r.length!==2)return c.error("Expected one argument.");const m=ha[d],v=[];for(let x=1;x<r.length;x++){const T=c.parse(r[x],x,Ct);if(!T)return null;v.push(T)}return new Ur(m,v)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let c,d;for(const m of this.args){if(c=m.evaluate(r),d=null,c instanceof Nt)return c;if(typeof c=="string"){const v=r.parseColor(c);if(v)return v}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Gs(c[0],c[1],c[2],c[3]),!d))return new Nt(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new hn(d||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const d of this.args){c=d.evaluate(r);const m=Li.parse(c);if(m)return m}throw new hn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const d of this.args){c=d.evaluate(r);const m=vi.parse(c);if(m)return m}throw new hn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const d of this.args){if(c=d.evaluate(r),c===null)return 0;const m=Number(c);if(!isNaN(m))return m}throw new hn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return xn.fromString(Ht(this.args[0].evaluate(r)));case"resolvedImage":return ln.fromString(Ht(this.args[0].evaluate(r)));default:return Ht(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const ol=["Unknown","Point","LineString","Polygon"];class al{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ol[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let c=this._parseColorCache[r];return c||(c=this._parseColorCache[r]=Nt.parse(r)),c}}class da{constructor(r,c,d=[],m,v=new Vs,x=[]){this.registry=r,this.path=d,this.key=d.map(T=>`[${T}]`).join(""),this.scope=v,this.errors=x,this.expectedType=m,this._isConstant=c}parse(r,c,d,m,v={}){return c?this.concat(c,d,m)._parse(r,v):this._parse(r,v)}_parse(r,c){function d(m,v,x){return x==="assert"?new Qi(v,[m]):x==="coerce"?new Ur(v,[m]):m}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let x=v.parse(r,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,A=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||A.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string")if(T.kind!=="padding"||A.kind!=="value"&&A.kind!=="number"&&A.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||A.kind!=="value"&&A.kind!=="array"){if(this.checkSubtype(T,A))return null}else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"assert")}if(!(x instanceof ts)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const T=new al;try{x=new ts(x.type,x.evaluate(T))}catch(A){return this.error(A.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,c,d){const m=typeof r=="number"?this.path.concat(r):this.path,v=d?this.scope.concat(d):this.scope;return new da(this.registry,this._isConstant,m,c||null,v,this.errors)}error(r,...c){const d=`${this.key}${c.map(m=>`[${m}]`).join("")}`;this.errors.push(new An(d,r))}checkSubtype(r,c){const d=me(r,c);return d&&this.error(d),d}}class q{constructor(r,c,d){this.type=_r,this.locale=d,this.caseSensitive=r,this.diacriticSensitive=c}static parse(r,c){if(r.length!==2)return c.error("Expected one argument.");const d=r[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const m=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,Pt);if(!m)return null;const v=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,Pt);if(!v)return null;let x=null;return d.locale&&(x=c.parse(d.locale,1,It),!x)?null:new q(m,v,x)}evaluate(r){return new js(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const Y=8192;function de(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Ce(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function Ge(a,r){const c=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(c*m*Y),Math.round(d*m*Y)]}function ct(a,r,c){const d=a[0]-r[0],m=a[1]-r[1],v=a[0]-c[0],x=a[1]-c[1];return d*x-v*m==0&&d*v<=0&&m*x<=0}function Ft(a,r){let c=!1;for(let x=0,T=r.length;x<T;x++){const A=r[x];for(let I=0,R=A.length;I<R-1;I++){if(ct(a,A[I],A[I+1]))return!1;(m=A[I])[1]>(d=a)[1]!=(v=A[I+1])[1]>d[1]&&d[0]<(v[0]-m[0])*(d[1]-m[1])/(v[1]-m[1])+m[0]&&(c=!c)}}var d,m,v;return c}function Vn(a,r){for(let c=0;c<r.length;c++)if(Ft(a,r[c]))return!0;return!1}function Qn(a,r,c,d){const m=d[0]-c[0],v=d[1]-c[1],x=(a[0]-c[0])*v-m*(a[1]-c[1]),T=(r[0]-c[0])*v-m*(r[1]-c[1]);return x>0&&T<0||x<0&&T>0}function xi(a,r,c){for(const I of c)for(let R=0;R<I.length-1;++R)if((T=[(x=I[R+1])[0]-(v=I[R])[0],x[1]-v[1]])[0]*(A=[(m=r)[0]-(d=a)[0],m[1]-d[1]])[1]-T[1]*A[0]!=0&&Qn(d,m,v,x)&&Qn(v,x,d,m))return!0;var d,m,v,x,T,A;return!1}function xr(a,r){for(let c=0;c<a.length;++c)if(!Ft(a[c],r))return!1;for(let c=0;c<a.length-1;++c)if(xi(a[c],a[c+1],r))return!1;return!0}function tf(a,r){for(let c=0;c<r.length;c++)if(xr(a,r[c]))return!0;return!1}function ic(a,r,c){const d=[];for(let m=0;m<a.length;m++){const v=[];for(let x=0;x<a[m].length;x++){const T=Ge(a[m][x],c);de(r,T),v.push(T)}d.push(v)}return d}function nf(a,r,c){const d=[];for(let m=0;m<a.length;m++){const v=ic(a[m],r,c);d.push(v)}return d}function rf(a,r,c,d){if(a[0]<c[0]||a[0]>c[2]){const m=.5*d;let v=a[0]-c[0]>m?-d:c[0]-a[0]>m?d:0;v===0&&(v=a[0]-c[2]>m?-d:c[2]-a[0]>m?d:0),a[0]+=v}de(r,a)}function Du(a,r,c,d){const m=Math.pow(2,d.z)*Y,v=[d.x*Y,d.y*Y],x=[];for(const T of a)for(const A of T){const I=[A.x+v[0],A.y+v[1]];rf(I,r,c,m),x.push(I)}return x}function zu(a,r,c,d){const m=Math.pow(2,d.z)*Y,v=[d.x*Y,d.y*Y],x=[];for(const A of a){const I=[];for(const R of A){const O=[R.x+v[0],R.y+v[1]];de(r,O),I.push(O)}x.push(I)}if(r[2]-r[0]<=m/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const A of x)for(const I of A)rf(I,r,c,m)}var T;return x}class Ro{constructor(r,c){this.type=Pt,this.geojson=r,this.geometries=c}static parse(r,c){if(r.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ws(r[1])){const d=r[1];if(d.type==="FeatureCollection")for(let m=0;m<d.features.length;++m){const v=d.features[m].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ro(d,d.features[m].geometry)}else if(d.type==="Feature"){const m=d.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ro(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Ro(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(c,d){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const T=ic(d.coordinates,v,x),A=Du(c.geometry(),m,v,x);if(!Ce(m,v))return!1;for(const I of A)if(!Ft(I,T))return!1}if(d.type==="MultiPolygon"){const T=nf(d.coordinates,v,x),A=Du(c.geometry(),m,v,x);if(!Ce(m,v))return!1;for(const I of A)if(!Vn(I,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(c,d){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const T=ic(d.coordinates,v,x),A=zu(c.geometry(),m,v,x);if(!Ce(m,v))return!1;for(const I of A)if(!xr(I,T))return!1}if(d.type==="MultiPolygon"){const T=nf(d.coordinates,v,x),A=zu(c.geometry(),m,v,x);if(!Ce(m,v))return!1;for(const I of A)if(!tf(I,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class rc{constructor(r,c){this.type=c.type,this.name=r,this.boundExpression=c}static parse(r,c){if(r.length!==2||typeof r[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=r[1];return c.scope.has(d)?new rc(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Vr{constructor(r,c,d,m){this.name=r,this.type=c,this._evaluate=d,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,c){const d=r[0],m=Vr.definitions[d];if(!m)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,T=x.filter(([I])=>!Array.isArray(I)||I.length===r.length-1);let A=null;for(const[I,R]of T){A=new da(c.registry,sc,c.path,null,c.scope);const O=[];let B=!1;for(let j=1;j<r.length;j++){const $=r[j],Q=Array.isArray(I)?I[j-1]:I.type,oe=A.parse($,1+O.length,Q);if(!oe){B=!0;break}O.push(oe)}if(!B)if(Array.isArray(I)&&I.length!==O.length)A.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let j=0;j<O.length;j++){const $=Array.isArray(I)?I[j]:I.type,Q=O[j];A.concat(j+1).checkSubtype($,Q.type)}if(A.errors.length===0)return new Vr(d,v,R,O)}}if(T.length===1)c.errors.push(...A.errors);else{const I=(T.length?T:x).map(([O])=>{return B=O,Array.isArray(B)?`(${B.map(ae).join(", ")})`:`(${ae(B.type)}...)`;var B}).join(" | "),R=[];for(let O=1;O<r.length;O++){const B=c.parse(r[O],1+R.length);if(!B)return null;R.push(ae(B.type))}c.error(`Expected arguments of type ${I}, but found (${R.join(", ")}) instead.`)}return null}static register(r,c){Vr.definitions=c;for(const d in c)r[d]=Vr}}function sc(a){if(a instanceof rc)return sc(a.boundExpression);if(a instanceof Vr&&a.name==="error"||a instanceof q||a instanceof Ro)return!1;const r=a instanceof Ur||a instanceof Qi;let c=!0;return a.eachChild(d=>{c=r?c&&sc(d):c&&d instanceof ts}),!!c&&oc(a)&&ac(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function oc(a){if(a instanceof Vr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ro)return!1;let r=!0;return a.eachChild(c=>{r&&!oc(c)&&(r=!1)}),r}function ll(a){if(a instanceof Vr&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(c=>{r&&!ll(c)&&(r=!1)}),r}function ac(a,r){if(a instanceof Vr&&r.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(d=>{c&&!ac(d,r)&&(c=!1)}),c}function fa(a,r){const c=a.length-1;let d,m,v=0,x=c,T=0;for(;v<=x;)if(T=Math.floor((v+x)/2),d=a[T],m=a[T+1],d<=r){if(T===c||r<m)return T;v=T+1}else{if(!(d>r))throw new hn("Input is not a number.");x=T-1}return 0}class co{constructor(r,c,d){this.type=r,this.input=c,this.labels=[],this.outputs=[];for(const[m,v]of d)this.labels.push(m),this.outputs.push(v)}static parse(r,c){if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(r[1],1,qe);if(!d)return null;const m=[];let v=null;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(let x=1;x<r.length;x+=2){const T=x===1?-1/0:r[x],A=r[x+1],I=x,R=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=c.parse(A,R,v);if(!O)return null;v=v||O.type,m.push([T,O])}return new co(v,d,m)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const m=this.input.evaluate(r);if(m<=c[0])return d[0].evaluate(r);const v=c.length;return m>=c[v-1]?d[v-1].evaluate(r):d[fa(c,m)].evaluate(r)}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Gt(a,r,c){return a+c*(r-a)}function lc(a,r,c){return a.map((d,m)=>Gt(d,r[m],c))}const br={number:Gt,color:function(a,r,c,d="rgb"){switch(d){case"rgb":{const[m,v,x,T]=lc(a.rgb,r.rgb,c);return new Nt(m,v,x,T,!1)}case"hcl":{const[m,v,x,T]=a.hcl,[A,I,R,O]=r.hcl;let B,j;if(isNaN(m)||isNaN(A))isNaN(m)?isNaN(A)?B=NaN:(B=A,x!==1&&x!==0||(j=I)):(B=m,R!==1&&R!==0||(j=v));else{let ve=A-m;A>m&&ve>180?ve-=360:A<m&&m-A>180&&(ve+=360),B=m+c*ve}const[$,Q,oe,he]=function([ve,pe,be,Se]){return ve=isNaN(ve)?0:ve*At,nn([be,Math.cos(ve)*pe,Math.sin(ve)*pe,Se])}([B,j??Gt(v,I,c),Gt(x,R,c),Gt(T,O,c)]);return new Nt($,Q,oe,he,!1)}case"lab":{const[m,v,x,T]=nn(lc(a.lab,r.lab,c));return new Nt(m,v,x,T,!1)}}},array:lc,padding:function(a,r,c){return new Li(lc(a.values,r.values,c))},variableAnchorOffsetCollection:function(a,r,c){const d=a.values,m=r.values;if(d.length!==m.length)throw new hn(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${r.toString()}`);const v=[];for(let x=0;x<d.length;x+=2){if(d[x]!==m[x])throw new hn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${d[x]}, to[${x}]: ${m[x]}`);v.push(d[x]);const[T,A]=d[x+1],[I,R]=m[x+1];v.push([Gt(T,I,c),Gt(A,R,c)])}return new vi(v)}};class wr{constructor(r,c,d,m,v){this.type=r,this.operator=c,this.interpolation=d,this.input=m,this.labels=[],this.outputs=[];for(const[x,T]of v)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(r,c,d,m){let v=0;if(r.name==="exponential")v=Ou(c,r.base,d,m);else if(r.name==="linear")v=Ou(c,1,d,m);else if(r.name==="cubic-bezier"){const x=r.controlPoints;v=new re(x[0],x[1],x[2],x[3]).solve(Ou(c,1,d,m))}return v}static parse(r,c){let[d,m,v,...x]=r;if(!Array.isArray(m)||m.length===0)return c.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const I=m[1];if(typeof I!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:I}}else{if(m[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const I=m.slice(1);if(I.length!==4||I.some(R=>typeof R!="number"||R<0||R>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:I}}}if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(v=c.parse(v,2,qe),!v)return null;const T=[];let A=null;d==="interpolate-hcl"||d==="interpolate-lab"?A=yi:c.expectedType&&c.expectedType.kind!=="value"&&(A=c.expectedType);for(let I=0;I<x.length;I+=2){const R=x[I],O=x[I+1],B=I+3,j=I+4;if(typeof R!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(T.length&&T[T.length-1][0]>=R)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const $=c.parse(O,j,A);if(!$)return null;A=A||$.type,T.push([R,$])}return ke(A,qe)||ke(A,yi)||ke(A,F)||ke(A,X)||ke(A,se(qe))?new wr(A,d,m,v,T):c.error(`Type ${ae(A)} is not interpolatable.`)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const m=this.input.evaluate(r);if(m<=c[0])return d[0].evaluate(r);const v=c.length;if(m>=c[v-1])return d[v-1].evaluate(r);const x=fa(c,m),T=wr.interpolationFactor(this.interpolation,m,c[x],c[x+1]),A=d[x].evaluate(r),I=d[x+1].evaluate(r);switch(this.operator){case"interpolate":return br[this.type.kind](A,I,T);case"interpolate-hcl":return br.color(A,I,T,"hcl");case"interpolate-lab":return br.color(A,I,T,"lab")}}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Ou(a,r,c,d){const m=d-c,v=a-c;return m===0?0:r===1?v/m:(Math.pow(r,v)-1)/(Math.pow(r,m)-1)}class cc{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expectected at least one argument.");let d=null;const m=c.expectedType;m&&m.kind!=="value"&&(d=m);const v=[];for(const T of r.slice(1)){const A=c.parse(T,1+v.length,d,void 0,{typeAnnotation:"omit"});if(!A)return null;d=d||A.type,v.push(A)}if(!d)throw new Error("No output type");const x=m&&v.some(T=>me(m,T.type));return new cc(x?Ct:d,v)}evaluate(r){let c,d=null,m=0;for(const v of this.args)if(m++,d=v.evaluate(r),d&&d instanceof ln&&!d.available&&(c||(c=d.name),d=null,m===this.args.length&&(d=c)),d!==null)break;return d}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class uc{constructor(r,c){this.type=c.type,this.bindings=[].concat(r),this.result=c}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const c of this.bindings)r(c[1]);r(this.result)}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const d=[];for(let v=1;v<r.length-1;v+=2){const x=r[v];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=c.parse(r[v+1],v+1);if(!T)return null;d.push([x,T])}const m=c.parse(r[r.length-1],r.length-1,c.expectedType,d);return m?new uc(d,m):null}outputDefined(){return this.result.outputDefined()}}class Fu{constructor(r,c,d){this.type=r,this.index=c,this.input=d}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,qe),m=c.parse(r[2],2,se(c.expectedType||Ct));return d&&m?new Fu(m.type.itemType,d,m):null}evaluate(r){const c=this.index.evaluate(r),d=this.input.evaluate(r);if(c<0)throw new hn(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new hn(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new hn(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Bu{constructor(r,c){this.type=Pt,this.needle=r,this.haystack=c}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Ct),m=c.parse(r[2],2,Ct);return d&&m?ue(d.type,[Pt,It,qe,es,Ct])?new Bu(d,m):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ae(d.type)} instead`):null}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!d)return!1;if(!_e(c,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${ae(un(c))} instead.`);if(!_e(d,["string","array"]))throw new hn(`Expected second argument to be of type array or string, but found ${ae(un(d))} instead.`);return d.indexOf(c)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class hc{constructor(r,c,d){this.type=qe,this.needle=r,this.haystack=c,this.fromIndex=d}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Ct),m=c.parse(r[2],2,Ct);if(!d||!m)return null;if(!ue(d.type,[Pt,It,qe,es,Ct]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ae(d.type)} instead`);if(r.length===4){const v=c.parse(r[3],3,qe);return v?new hc(d,m,v):null}return new hc(d,m)}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!_e(c,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${ae(un(c))} instead.`);if(!_e(d,["string","array"]))throw new hn(`Expected second argument to be of type array or string, but found ${ae(un(d))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return d.indexOf(c,m)}return d.indexOf(c)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Nu{constructor(r,c,d,m,v,x){this.inputType=r,this.type=c,this.input=d,this.cases=m,this.outputs=v,this.otherwise=x}static parse(r,c){if(r.length<5)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return c.error("Expected an even number of arguments.");let d,m;c.expectedType&&c.expectedType.kind!=="value"&&(m=c.expectedType);const v={},x=[];for(let I=2;I<r.length-1;I+=2){let R=r[I];const O=r[I+1];Array.isArray(R)||(R=[R]);const B=c.concat(I);if(R.length===0)return B.error("Expected at least one branch label.");for(const $ of R){if(typeof $!="number"&&typeof $!="string")return B.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return B.error("Numeric branch labels must be integer values.");if(d){if(B.checkSubtype(d,un($)))return null}else d=un($);if(v[String($)]!==void 0)return B.error("Branch labels must be unique.");v[String($)]=x.length}const j=c.parse(O,I,m);if(!j)return null;m=m||j.type,x.push(j)}const T=c.parse(r[1],1,Ct);if(!T)return null;const A=c.parse(r[r.length-1],r.length-1,m);return A?T.type.kind!=="value"&&c.concat(1).checkSubtype(d,T.type)?null:new Nu(d,m,T,v,x,A):null}evaluate(r){const c=this.input.evaluate(r);return(un(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Uu{constructor(r,c,d){this.type=r,this.branches=c,this.otherwise=d}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const m=[];for(let x=1;x<r.length-1;x+=2){const T=c.parse(r[x],x,Pt);if(!T)return null;const A=c.parse(r[x+1],x+1,d);if(!A)return null;m.push([T,A]),d=d||A.type}const v=c.parse(r[r.length-1],r.length-1,d);if(!v)return null;if(!d)throw new Error("Can't infer output type");return new Uu(d,m,v)}evaluate(r){for(const[c,d]of this.branches)if(c.evaluate(r))return d.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[c,d]of this.branches)r(c),r(d);r(this.otherwise)}outputDefined(){return this.branches.every(([r,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class dc{constructor(r,c,d,m){this.type=r,this.input=c,this.beginIndex=d,this.endIndex=m}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Ct),m=c.parse(r[2],2,qe);if(!d||!m)return null;if(!ue(d.type,[se(Ct),It,Ct]))return c.error(`Expected first argument to be of type array or string, but found ${ae(d.type)} instead`);if(r.length===4){const v=c.parse(r[3],3,qe);return v?new dc(d.type,d,m,v):null}return new dc(d.type,d,m)}evaluate(r){const c=this.input.evaluate(r),d=this.beginIndex.evaluate(r);if(!_e(c,["string","array"]))throw new hn(`Expected first argument to be of type array or string, but found ${ae(un(c))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return c.slice(d,m)}return c.slice(d)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function sf(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function of(a,r,c,d){return d.compare(r,c)===0}function pa(a,r,c){const d=a!=="=="&&a!=="!=";return class IS{constructor(v,x,T){this.type=Pt,this.lhs=v,this.rhs=x,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const T=v[0];let A=x.parse(v[1],1,Ct);if(!A)return null;if(!sf(T,A.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${ae(A.type)}'.`);let I=x.parse(v[2],2,Ct);if(!I)return null;if(!sf(T,I.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${ae(I.type)}'.`);if(A.type.kind!==I.type.kind&&A.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${ae(A.type)}' and '${ae(I.type)}'.`);d&&(A.type.kind==="value"&&I.type.kind!=="value"?A=new Qi(I.type,[A]):A.type.kind!=="value"&&I.type.kind==="value"&&(I=new Qi(A.type,[I])));let R=null;if(v.length===4){if(A.type.kind!=="string"&&I.type.kind!=="string"&&A.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(R=x.parse(v[3],3,_r),!R)return null}return new IS(A,I,R)}evaluate(v){const x=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(d&&this.hasUntypedArgument){const A=un(x),I=un(T);if(A.kind!==I.kind||A.kind!=="string"&&A.kind!=="number")throw new hn(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${A.kind}, ${I.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const A=un(x),I=un(T);if(A.kind!=="string"||I.kind!=="string")return r(v,x,T)}return this.collator?c(v,x,T,this.collator.evaluate(v)):r(v,x,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const ug=pa("==",function(a,r,c){return r===c},of),hg=pa("!=",function(a,r,c){return r!==c},function(a,r,c,d){return!of(0,r,c,d)}),dg=pa("<",function(a,r,c){return r<c},function(a,r,c,d){return d.compare(r,c)<0}),fg=pa(">",function(a,r,c){return r>c},function(a,r,c,d){return d.compare(r,c)>0}),pg=pa("<=",function(a,r,c){return r<=c},function(a,r,c,d){return d.compare(r,c)<=0}),mg=pa(">=",function(a,r,c){return r>=c},function(a,r,c,d){return d.compare(r,c)>=0});class Vu{constructor(r,c,d,m,v){this.type=It,this.number=r,this.locale=c,this.currency=d,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(r,c){if(r.length!==3)return c.error("Expected two arguments.");const d=c.parse(r[1],1,qe);if(!d)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return c.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=c.parse(m.locale,1,It),!v))return null;let x=null;if(m.currency&&(x=c.parse(m.currency,1,It),!x))return null;let T=null;if(m["min-fraction-digits"]&&(T=c.parse(m["min-fraction-digits"],1,qe),!T))return null;let A=null;return m["max-fraction-digits"]&&(A=c.parse(m["max-fraction-digits"],1,qe),!A)?null:new Vu(d,v,x,T,A)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class fc{constructor(r){this.type=ne,this.sections=r}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const m=[];let v=!1;for(let x=1;x<=r.length-1;++x){const T=r[x];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let A=null;if(T["font-scale"]&&(A=c.parse(T["font-scale"],1,qe),!A))return null;let I=null;if(T["text-font"]&&(I=c.parse(T["text-font"],1,se(It)),!I))return null;let R=null;if(T["text-color"]&&(R=c.parse(T["text-color"],1,yi),!R))return null;const O=m[m.length-1];O.scale=A,O.font=I,O.textColor=R}else{const A=c.parse(r[x],1,Ct);if(!A)return null;const I=A.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:A,scale:null,font:null,textColor:null})}}return new fc(m)}evaluate(r){return new xn(this.sections.map(c=>{const d=c.content.evaluate(r);return un(d)===U?new Ni("",d,null,null,null):new Ni(Ht(d),null,c.scale?c.scale.evaluate(r):null,c.font?c.font.evaluate(r).join(","):null,c.textColor?c.textColor.evaluate(r):null)}))}eachChild(r){for(const c of this.sections)r(c.content),c.scale&&r(c.scale),c.font&&r(c.font),c.textColor&&r(c.textColor)}outputDefined(){return!1}}class ju{constructor(r){this.type=U,this.input=r}static parse(r,c){if(r.length!==2)return c.error("Expected two arguments.");const d=c.parse(r[1],1,It);return d?new ju(d):c.error("No image name provided.")}evaluate(r){const c=this.input.evaluate(r),d=ln.fromString(c);return d&&r.availableImages&&(d.available=r.availableImages.indexOf(c)>-1),d}eachChild(r){r(this.input)}outputDefined(){return!1}}class Gu{constructor(r){this.type=qe,this.input=r}static parse(r,c){if(r.length!==2)return c.error(`Expected 1 argument, but found ${r.length-1} instead.`);const d=c.parse(r[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${ae(d.type)} instead.`):new Gu(d):null}evaluate(r){const c=this.input.evaluate(r);if(typeof c=="string"||Array.isArray(c))return c.length;throw new hn(`Expected value to be of type string or array, but found ${ae(un(c))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const ma={"==":ug,"!=":hg,">":fg,"<":dg,">=":mg,"<=":pg,array:Qi,at:Fu,boolean:Qi,case:Uu,coalesce:cc,collator:q,format:fc,image:ju,in:Bu,"index-of":hc,interpolate:wr,"interpolate-hcl":wr,"interpolate-lab":wr,length:Gu,let:uc,literal:ts,match:Nu,number:Qi,"number-format":Vu,object:Qi,slice:dc,step:co,string:Qi,"to-boolean":Ur,"to-color":Ur,"to-number":Ur,"to-string":Ur,var:rc,within:Ro};function af(a,[r,c,d,m]){r=r.evaluate(a),c=c.evaluate(a),d=d.evaluate(a);const v=m?m.evaluate(a):1,x=Gs(r,c,d,v);if(x)throw new hn(x);return new Nt(r/255,c/255,d/255,v,!1)}function lf(a,r){return a in r}function $u(a,r){const c=r[a];return c===void 0?null:c}function Do(a){return{type:a}}function cf(a){return{result:"success",value:a}}function uo(a){return{result:"error",value:a}}function ga(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function uf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Hu(a){return!!a.expression&&a.expression.interpolated}function Qt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Mn(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function gg(a){return a}function $t(a,r){const c=r.type==="color",d=a.stops&&typeof a.stops[0][0]=="object",m=d||!(d||a.property!==void 0),v=a.type||(Hu(r)?"exponential":"interval");if(c||r.type==="padding"){const R=c?Nt.parse:Li.parse;(a=Nr({},a)).stops&&(a.stops=a.stops.map(O=>[O[0],R(O[1])])),a.default=R(a.default?a.default:r.default)}if(a.colorSpace&&(x=a.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var x;let T,A,I;if(v==="exponential")T=cl;else if(v==="interval")T=Pn;else if(v==="categorical"){T=Ln,A=Object.create(null);for(const R of a.stops)A[R[0]]=R[1];I=typeof a.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);T=hf}if(d){const R={},O=[];for(let $=0;$<a.stops.length;$++){const Q=a.stops[$],oe=Q[0].zoom;R[oe]===void 0&&(R[oe]={zoom:oe,type:a.type,property:a.property,default:a.default,stops:[]},O.push(oe)),R[oe].stops.push([Q[0].value,Q[1]])}const B=[];for(const $ of O)B.push([R[$].zoom,$t(R[$],r)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:wr.interpolationFactor.bind(void 0,j),zoomStops:B.map($=>$[0]),evaluate:({zoom:$},Q)=>cl({stops:B,base:a.base},r,$).evaluate($,Q)}}if(m){const R=v==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:wr.interpolationFactor.bind(void 0,R),zoomStops:a.stops.map(O=>O[0]),evaluate:({zoom:O})=>T(a,r,O,A,I)}}return{kind:"source",evaluate(R,O){const B=O&&O.properties?O.properties[a.property]:void 0;return B===void 0?zo(a.default,r.default):T(a,r,B,A,I)}}}function zo(a,r,c){return a!==void 0?a:r!==void 0?r:c!==void 0?c:void 0}function Ln(a,r,c,d,m){return zo(typeof c===m?d[c]:void 0,a.default,r.default)}function Pn(a,r,c){if(Qt(c)!=="number")return zo(a.default,r.default);const d=a.stops.length;if(d===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[d-1][0])return a.stops[d-1][1];const m=fa(a.stops.map(v=>v[0]),c);return a.stops[m][1]}function cl(a,r,c){const d=a.base!==void 0?a.base:1;if(Qt(c)!=="number")return zo(a.default,r.default);const m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];const v=fa(a.stops.map(R=>R[0]),c),x=function(R,O,B,j){const $=j-B,Q=R-B;return $===0?0:O===1?Q/$:(Math.pow(O,Q)-1)/(Math.pow(O,$)-1)}(c,d,a.stops[v][0],a.stops[v+1][0]),T=a.stops[v][1],A=a.stops[v+1][1],I=br[r.type]||gg;return typeof T.evaluate=="function"?{evaluate(...R){const O=T.evaluate.apply(void 0,R),B=A.evaluate.apply(void 0,R);if(O!==void 0&&B!==void 0)return I(O,B,x,a.colorSpace)}}:I(T,A,x,a.colorSpace)}function hf(a,r,c){switch(r.type){case"color":c=Nt.parse(c);break;case"formatted":c=xn.fromString(c.toString());break;case"resolvedImage":c=ln.fromString(c.toString());break;case"padding":c=Li.parse(c);break;default:Qt(c)===r.type||r.type==="enum"&&r.values[c]||(c=void 0)}return zo(c,a.default,r.default)}Vr.register(ma,{error:[{kind:"error"},[It],(a,[r])=>{throw new hn(r.evaluate(a))}],typeof:[It,[Ct],(a,[r])=>ae(un(r.evaluate(a)))],"to-rgba":[se(qe,4),[yi],(a,[r])=>{const[c,d,m,v]=r.evaluate(a).rgb;return[255*c,255*d,255*m,v]}],rgb:[yi,[qe,qe,qe],af],rgba:[yi,[qe,qe,qe,qe],af],has:{type:Pt,overloads:[[[It],(a,[r])=>lf(r.evaluate(a),a.properties())],[[It,gr],(a,[r,c])=>lf(r.evaluate(a),c.evaluate(a))]]},get:{type:Ct,overloads:[[[It],(a,[r])=>$u(r.evaluate(a),a.properties())],[[It,gr],(a,[r,c])=>$u(r.evaluate(a),c.evaluate(a))]]},"feature-state":[Ct,[It],(a,[r])=>$u(r.evaluate(a),a.featureState||{})],properties:[gr,[],a=>a.properties()],"geometry-type":[It,[],a=>a.geometryType()],id:[Ct,[],a=>a.id()],zoom:[qe,[],a=>a.globals.zoom],"heatmap-density":[qe,[],a=>a.globals.heatmapDensity||0],"line-progress":[qe,[],a=>a.globals.lineProgress||0],accumulated:[Ct,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[qe,Do(qe),(a,r)=>{let c=0;for(const d of r)c+=d.evaluate(a);return c}],"*":[qe,Do(qe),(a,r)=>{let c=1;for(const d of r)c*=d.evaluate(a);return c}],"-":{type:qe,overloads:[[[qe,qe],(a,[r,c])=>r.evaluate(a)-c.evaluate(a)],[[qe],(a,[r])=>-r.evaluate(a)]]},"/":[qe,[qe,qe],(a,[r,c])=>r.evaluate(a)/c.evaluate(a)],"%":[qe,[qe,qe],(a,[r,c])=>r.evaluate(a)%c.evaluate(a)],ln2:[qe,[],()=>Math.LN2],pi:[qe,[],()=>Math.PI],e:[qe,[],()=>Math.E],"^":[qe,[qe,qe],(a,[r,c])=>Math.pow(r.evaluate(a),c.evaluate(a))],sqrt:[qe,[qe],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[qe,[qe],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[qe,[qe],(a,[r])=>Math.log(r.evaluate(a))],log2:[qe,[qe],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[qe,[qe],(a,[r])=>Math.sin(r.evaluate(a))],cos:[qe,[qe],(a,[r])=>Math.cos(r.evaluate(a))],tan:[qe,[qe],(a,[r])=>Math.tan(r.evaluate(a))],asin:[qe,[qe],(a,[r])=>Math.asin(r.evaluate(a))],acos:[qe,[qe],(a,[r])=>Math.acos(r.evaluate(a))],atan:[qe,[qe],(a,[r])=>Math.atan(r.evaluate(a))],min:[qe,Do(qe),(a,r)=>Math.min(...r.map(c=>c.evaluate(a)))],max:[qe,Do(qe),(a,r)=>Math.max(...r.map(c=>c.evaluate(a)))],abs:[qe,[qe],(a,[r])=>Math.abs(r.evaluate(a))],round:[qe,[qe],(a,[r])=>{const c=r.evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[qe,[qe],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[qe,[qe],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[Pt,[It,Ct],(a,[r,c])=>a.properties()[r.value]===c.value],"filter-id-==":[Pt,[Ct],(a,[r])=>a.id()===r.value],"filter-type-==":[Pt,[It],(a,[r])=>a.geometryType()===r.value],"filter-<":[Pt,[It,Ct],(a,[r,c])=>{const d=a.properties()[r.value],m=c.value;return typeof d==typeof m&&d<m}],"filter-id-<":[Pt,[Ct],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c<d}],"filter->":[Pt,[It,Ct],(a,[r,c])=>{const d=a.properties()[r.value],m=c.value;return typeof d==typeof m&&d>m}],"filter-id->":[Pt,[Ct],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c>d}],"filter-<=":[Pt,[It,Ct],(a,[r,c])=>{const d=a.properties()[r.value],m=c.value;return typeof d==typeof m&&d<=m}],"filter-id-<=":[Pt,[Ct],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c<=d}],"filter->=":[Pt,[It,Ct],(a,[r,c])=>{const d=a.properties()[r.value],m=c.value;return typeof d==typeof m&&d>=m}],"filter-id->=":[Pt,[Ct],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c>=d}],"filter-has":[Pt,[Ct],(a,[r])=>r.value in a.properties()],"filter-has-id":[Pt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Pt,[se(It)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[Pt,[se(Ct)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[Pt,[It,se(Ct)],(a,[r,c])=>c.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[Pt,[It,se(Ct)],(a,[r,c])=>function(d,m,v,x){for(;v<=x;){const T=v+x>>1;if(m[T]===d)return!0;m[T]>d?x=T-1:v=T+1}return!1}(a.properties()[r.value],c.value,0,c.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(a,[r,c])=>r.evaluate(a)&&c.evaluate(a)],[Do(Pt),(a,r)=>{for(const c of r)if(!c.evaluate(a))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(a,[r,c])=>r.evaluate(a)||c.evaluate(a)],[Do(Pt),(a,r)=>{for(const c of r)if(c.evaluate(a))return!0;return!1}]]},"!":[Pt,[Pt],(a,[r])=>!r.evaluate(a)],"is-supported-script":[Pt,[It],(a,[r])=>{const c=a.globals&&a.globals.isSupportedScript;return!c||c(r.evaluate(a))}],upcase:[It,[It],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[It,[It],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[It,Do(Ct),(a,r)=>r.map(c=>Ht(c.evaluate(a))).join("")],"resolved-locale":[It,[_r],(a,[r])=>r.evaluate(a).resolvedLocale()]});class Wu{constructor(r,c){var d;this.expression=r,this._warningHistory={},this._evaluator=new al,this._defaultValue=c?(d=c).type==="color"&&Mn(d.default)?new Nt(0,0,0,0):d.type==="color"?Nt.parse(d.default)||null:d.type==="padding"?Li.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?vi.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(r,c,d,m,v,x){return this._evaluator.globals=r,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(r,c,d,m,v,x){this._evaluator.globals=r,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new hn(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function pc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ma}function mc(a,r){const c=new da(ma,sc,[],r?function(m){const v={color:yi,string:It,number:qe,enum:It,boolean:Pt,formatted:ne,padding:F,resolvedImage:U,variableAnchorOffsetCollection:X};return m.type==="array"?se(v[m.value]||Ct,m.length):v[m.type]}(r):void 0),d=c.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?cf(new Wu(d,r)):uo(c.errors)}class qu{constructor(r,c){this.kind=r,this._styleExpression=c,this.isStateDependent=r!=="constant"&&!ll(c.expression)}evaluateWithoutErrorHandling(r,c,d,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,m,v,x)}evaluate(r,c,d,m,v,x){return this._styleExpression.evaluate(r,c,d,m,v,x)}}class gc{constructor(r,c,d,m){this.kind=r,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=r!=="camera"&&!ll(c.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,c,d,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,m,v,x)}evaluate(r,c,d,m,v,x){return this._styleExpression.evaluate(r,c,d,m,v,x)}interpolationFactor(r,c,d){return this.interpolationType?wr.interpolationFactor(this.interpolationType,r,c,d):0}}function Zu(a,r){const c=mc(a,r);if(c.result==="error")return c;const d=c.value.expression,m=oc(d);if(!m&&!ga(r))return uo([new An("","data expressions not supported")]);const v=ac(d,["zoom"]);if(!v&&!uf(r))return uo([new An("","zoom expressions not supported")]);const x=hl(d);return x||v?x instanceof An?uo([x]):x instanceof wr&&!Hu(r)?uo([new An("",'"interpolate" expressions cannot be used with this property')]):cf(x?new gc(m?"camera":"composite",c.value,x.labels,x instanceof wr?x.interpolation:void 0):new qu(m?"constant":"source",c.value)):uo([new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ul{constructor(r,c){this._parameters=r,this._specification=c,Nr(this,$t(this._parameters,this._specification))}static deserialize(r){return new ul(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function hl(a){let r=null;if(a instanceof uc)r=hl(a.result);else if(a instanceof cc){for(const c of a.args)if(r=hl(c),r)break}else(a instanceof co||a instanceof wr)&&a.input instanceof Vr&&a.input.name==="zoom"&&(r=a);return r instanceof An||a.eachChild(c=>{const d=hl(c);d instanceof An?r=d:!r&&d?r=new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&d&&r!==d&&(r=new An("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function dl(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!dl(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const _g={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xu(a){if(a==null)return{filter:()=>!0,needGeometry:!1};dl(a)||(a=_c(a));const r=mc(a,_g);if(r.result==="error")throw new Error(r.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,m)=>r.value.evaluate(c,d,{},m),needGeometry:df(a)}}function yg(a,r){return a<r?-1:a>r?1:0}function df(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(df(a[r]))return!0;return!1}function _c(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?Yu(a[1],a[2],"=="):r==="!="?fl(Yu(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Yu(a[1],a[2],r):r==="any"?(c=a.slice(1),["any"].concat(c.map(_c))):r==="all"?["all"].concat(a.slice(1).map(_c)):r==="none"?["all"].concat(a.slice(1).map(_c).map(fl)):r==="in"?ff(a[1],a.slice(2)):r==="!in"?fl(ff(a[1],a.slice(2))):r==="has"?pf(a[1]):r==="!has"?fl(pf(a[1])):r!=="within"||a;var c}function Yu(a,r,c){switch(a){case"$type":return[`filter-type-${c}`,r];case"$id":return[`filter-id-${c}`,r];default:return[`filter-${c}`,a,r]}}function ff(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(c=>typeof c!=typeof r[0])?["filter-in-large",a,["literal",r.sort(yg)]]:["filter-in-small",a,["literal",r]]}}function pf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function fl(a){return["!",a]}function yc(a){const r=typeof a;if(r==="number"||r==="boolean"||r==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let m="[";for(const v of a)m+=`${yc(v)},`;return`${m}]`}const c=Object.keys(a).sort();let d="{";for(let m=0;m<c.length;m++)d+=`${JSON.stringify(c[m])}:${yc(a[c[m]])},`;return`${d}}`}function vc(a){let r="";for(const c of pn)r+=`/${yc(a[c])}`;return r}function mf(a){const r=a.value;return r?[new He(a.key,r,"constants have been deprecated as of v8")]:[]}function zn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Oo(a){if(Array.isArray(a))return a.map(Oo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const c in a)r[c]=Oo(a[c]);return r}return zn(a)}function er(a){const r=a.key,c=a.value,d=a.valueSpec||{},m=a.objectElementValidators||{},v=a.style,x=a.styleSpec,T=a.validateSpec;let A=[];const I=Qt(c);if(I!=="object")return[new He(r,c,`object expected, ${I} found`)];for(const R in c){const O=R.split(".")[0],B=d[O]||d["*"];let j;if(m[O])j=m[O];else if(d[O])j=T;else if(m["*"])j=m["*"];else{if(!d["*"]){A.push(new He(r,c[R],`unknown property "${R}"`));continue}j=T}A=A.concat(j({key:(r&&`${r}.`)+R,value:c[R],valueSpec:B,style:v,styleSpec:x,object:c,objectKey:R,validateSpec:T},c))}for(const R in d)m[R]||d[R].required&&d[R].default===void 0&&c[R]===void 0&&A.push(new He(r,c,`missing required property "${R}"`));return A}function _a(a){const r=a.value,c=a.valueSpec,d=a.style,m=a.styleSpec,v=a.key,x=a.arrayElementValidator||a.validateSpec;if(Qt(r)!=="array")return[new He(v,r,`array expected, ${Qt(r)} found`)];if(c.length&&r.length!==c.length)return[new He(v,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new He(v,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let T={type:c.value,values:c.values};m.$version<7&&(T.function=c.function),Qt(c.value)==="object"&&(T=c.value);let A=[];for(let I=0;I<r.length;I++)A=A.concat(x({array:r,arrayIndex:I,value:r[I],valueSpec:T,validateSpec:a.validateSpec,style:d,styleSpec:m,key:`${v}[${I}]`}));return A}function pl(a){const r=a.key,c=a.value,d=a.valueSpec;let m=Qt(c);return m==="number"&&c!=c&&(m="NaN"),m!=="number"?[new He(r,c,`number expected, ${m} found`)]:"minimum"in d&&c<d.minimum?[new He(r,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new He(r,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function xc(a){const r=a.valueSpec,c=zn(a.value.type);let d,m,v,x={};const T=c!=="categorical"&&a.value.property===void 0,A=!T,I=Qt(a.value.stops)==="array"&&Qt(a.value.stops[0])==="array"&&Qt(a.value.stops[0][0])==="object",R=er({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(j){if(c==="identity")return[new He(j.key,j.value,'identity function may not have a "stops" property')];let $=[];const Q=j.value;return $=$.concat(_a({key:j.key,value:Q,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O})),Qt(Q)==="array"&&Q.length===0&&$.push(new He(j.key,Q,"array must have at least one stop")),$},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:r,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return c==="identity"&&T&&R.push(new He(a.key,a.value,'missing required property "property"')),c==="identity"||a.value.stops||R.push(new He(a.key,a.value,'missing required property "stops"')),c==="exponential"&&a.valueSpec.expression&&!Hu(a.valueSpec)&&R.push(new He(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(A&&!ga(a.valueSpec)?R.push(new He(a.key,a.value,"property functions not supported")):T&&!uf(a.valueSpec)&&R.push(new He(a.key,a.value,"zoom functions not supported"))),c!=="categorical"&&!I||a.value.property!==void 0||R.push(new He(a.key,a.value,'"property" property is required')),R;function O(j){let $=[];const Q=j.value,oe=j.key;if(Qt(Q)!=="array")return[new He(oe,Q,`array expected, ${Qt(Q)} found`)];if(Q.length!==2)return[new He(oe,Q,`array length 2 expected, length ${Q.length} found`)];if(I){if(Qt(Q[0])!=="object")return[new He(oe,Q,`object expected, ${Qt(Q[0])} found`)];if(Q[0].zoom===void 0)return[new He(oe,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new He(oe,Q,"object stop key must have value")];if(v&&v>zn(Q[0].zoom))return[new He(oe,Q[0].zoom,"stop zoom values must appear in ascending order")];zn(Q[0].zoom)!==v&&(v=zn(Q[0].zoom),m=void 0,x={}),$=$.concat(er({key:`${oe}[0]`,value:Q[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:pl,value:B}}))}else $=$.concat(B({key:`${oe}[0]`,value:Q[0],validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},Q));return pc(Oo(Q[1]))?$.concat([new He(`${oe}[1]`,Q[1],"expressions are not allowed in function stops.")]):$.concat(j.validateSpec({key:`${oe}[1]`,value:Q[1],valueSpec:r,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function B(j,$){const Q=Qt(j.value),oe=zn(j.value),he=j.value!==null?j.value:$;if(d){if(Q!==d)return[new He(j.key,he,`${Q} stop domain type must match previous stop domain type ${d}`)]}else d=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean")return[new He(j.key,he,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&c!=="categorical"){let ve=`number expected, ${Q} found`;return ga(r)&&c===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(j.key,he,ve)]}return c!=="categorical"||Q!=="number"||isFinite(oe)&&Math.floor(oe)===oe?c!=="categorical"&&Q==="number"&&m!==void 0&&oe<m?[new He(j.key,he,"stop domain values must appear in ascending order")]:(m=oe,c==="categorical"&&oe in x?[new He(j.key,he,"stop domain values must be unique")]:(x[oe]=!0,[])):[new He(j.key,he,`integer expected, found ${oe}`)]}}function Fo(a){const r=(a.expressionContext==="property"?Zu:mc)(Oo(a.value),a.valueSpec);if(r.result==="error")return r.value.map(d=>new He(`${a.key}${d.key}`,a.value,d.message));const c=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new He(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ll(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ll(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ac(c,["zoom","feature-state"]))return[new He(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!oc(c))return[new He(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ml(a){const r=a.key,c=a.value,d=a.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(zn(c))===-1&&m.push(new He(r,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(zn(c))===-1&&m.push(new He(r,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),m}function ya(a){return dl(Oo(a.value))?Fo(Nr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):gf(a)}function gf(a){const r=a.value,c=a.key;if(Qt(r)!=="array")return[new He(c,r,`array expected, ${Qt(r)} found`)];const d=a.styleSpec;let m,v=[];if(r.length<1)return[new He(c,r,"filter array must have at least 1 element")];switch(v=v.concat(ml({key:`${c}[0]`,value:r[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),zn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&zn(r[1])==="$type"&&v.push(new He(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new He(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(m=Qt(r[1]),m!=="string"&&v.push(new He(`${c}[1]`,r[1],`string expected, ${m} found`)));for(let x=2;x<r.length;x++)m=Qt(r[x]),zn(r[1])==="$type"?v=v.concat(ml({key:`${c}[${x}]`,value:r[x],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new He(`${c}[${x}]`,r[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)v=v.concat(gf({key:`${c}[${x}]`,value:r[x],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":m=Qt(r[1]),r.length!==2?v.push(new He(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new He(`${c}[1]`,r[1],`string expected, ${m} found`));break;case"within":m=Qt(r[1]),r.length!==2?v.push(new He(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):m!=="object"&&v.push(new He(`${c}[1]`,r[1],`object expected, ${m} found`))}return v}function _f(a,r){const c=a.key,d=a.validateSpec,m=a.style,v=a.styleSpec,x=a.value,T=a.objectKey,A=v[`${r}_${a.layerType}`];if(!A)return[];const I=T.match(/^(.*)-transition$/);if(r==="paint"&&I&&A[I[1]]&&A[I[1]].transition)return d({key:c,value:x,valueSpec:v.transition,style:m,styleSpec:v});const R=a.valueSpec||A[T];if(!R)return[new He(c,x,`unknown property "${T}"`)];let O;if(Qt(x)==="string"&&ga(R)&&!R.tokens&&(O=/^{([^}]+)}$/.exec(x)))return[new He(c,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const B=[];return a.layerType==="symbol"&&(T==="text-field"&&m&&!m.glyphs&&B.push(new He(c,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Mn(Oo(x))&&zn(x.type)==="identity"&&B.push(new He(c,x,'"text-font" does not support identity functions'))),B.concat(d({key:a.key,value:x,valueSpec:R,style:m,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:T}))}function yf(a){return _f(a,"paint")}function vf(a){return _f(a,"layout")}function xf(a){let r=[];const c=a.value,d=a.key,m=a.style,v=a.styleSpec;c.type||c.ref||r.push(new He(d,c,'either "type" or "ref" is required'));let x=zn(c.type);const T=zn(c.ref);if(c.id){const A=zn(c.id);for(let I=0;I<a.arrayIndex;I++){const R=m.layers[I];zn(R.id)===A&&r.push(new He(d,c.id,`duplicate layer id "${c.id}", previously used at line ${R.id.__line__}`))}}if("ref"in c){let A;["type","source","source-layer","filter","layout"].forEach(I=>{I in c&&r.push(new He(d,c[I],`"${I}" is prohibited for ref layers`))}),m.layers.forEach(I=>{zn(I.id)===T&&(A=I)}),A?A.ref?r.push(new He(d,c.ref,"ref cannot reference another ref layer")):x=zn(A.type):r.push(new He(d,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const A=m.sources&&m.sources[c.source],I=A&&zn(A.type);A?I==="vector"&&x==="raster"?r.push(new He(d,c.source,`layer "${c.id}" requires a raster source`)):I!=="raster-dem"&&x==="hillshade"?r.push(new He(d,c.source,`layer "${c.id}" requires a raster-dem source`)):I==="raster"&&x!=="raster"?r.push(new He(d,c.source,`layer "${c.id}" requires a vector source`)):I!=="vector"||c["source-layer"]?I==="raster-dem"&&x!=="hillshade"?r.push(new He(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||I==="geojson"&&A.lineMetrics||r.push(new He(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new He(d,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new He(d,c.source,`source "${c.source}" not found`))}else r.push(new He(d,c,'missing required property "source"'));return r=r.concat(er({key:d,value:c,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${d}.type`,value:c.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:c,objectKey:"type"}),filter:ya,layout:A=>er({layer:c,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":I=>vf(Nr({layerType:x},I))}}),paint:A=>er({layer:c,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":I=>yf(Nr({layerType:x},I))}})}})),r}function Ts(a){const r=a.value,c=a.key,d=Qt(r);return d!=="string"?[new He(c,r,`string expected, ${d} found`)]:[]}const gl={promoteId:function({key:a,value:r}){if(Qt(r)==="string")return Ts({key:a,value:r});{const c=[];for(const d in r)c.push(...Ts({key:`${a}.${d}`,value:r[d]}));return c}}};function Tr(a){const r=a.value,c=a.key,d=a.styleSpec,m=a.style,v=a.validateSpec;if(!r.type)return[new He(c,r,'"type" is required')];const x=zn(r.type);let T;switch(x){case"vector":case"raster":return T=er({key:c,value:r,valueSpec:d[`source_${x.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:gl,validateSpec:v}),T;case"raster-dem":return T=function(A){var I;const R=(I=A.sourceName)!==null&&I!==void 0?I:"",O=A.value,B=A.styleSpec,j=B.source_raster_dem,$=A.style;let Q=[];const oe=Qt(O);if(O===void 0)return Q;if(oe!=="object")return Q.push(new He("source_raster_dem",O,`object expected, ${oe} found`)),Q;const he=zn(O.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],pe=A.value.encoding?`"${A.value.encoding}"`:"Default";for(const be in O)!he&&ve.includes(be)?Q.push(new He(be,O[be],`In "${R}": "${be}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):j[be]?Q=Q.concat(A.validateSpec({key:be,value:O[be],valueSpec:j[be],validateSpec:A.validateSpec,style:$,styleSpec:B})):Q.push(new He(be,O[be],`unknown property "${be}"`));return Q}({sourceName:c,value:r,style:a.style,styleSpec:d,validateSpec:v}),T;case"geojson":if(T=er({key:c,value:r,valueSpec:d.source_geojson,style:m,styleSpec:d,validateSpec:v,objectElementValidators:gl}),r.cluster)for(const A in r.clusterProperties){const[I,R]=r.clusterProperties[A],O=typeof I=="string"?[I,["accumulated"],["get",A]]:I;T.push(...Fo({key:`${c}.${A}.map`,value:R,expressionContext:"cluster-map"})),T.push(...Fo({key:`${c}.${A}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return T;case"video":return er({key:c,value:r,valueSpec:d.source_video,style:m,validateSpec:v,styleSpec:d});case"image":return er({key:c,value:r,valueSpec:d.source_image,style:m,validateSpec:v,styleSpec:d});case"canvas":return[new He(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ml({key:`${c}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function _l(a){const r=a.value,c=a.styleSpec,d=c.light,m=a.style;let v=[];const x=Qt(r);if(r===void 0)return v;if(x!=="object")return v=v.concat([new He("light",r,`object expected, ${x} found`)]),v;for(const T in r){const A=T.match(/^(.*)-transition$/);v=v.concat(A&&d[A[1]]&&d[A[1]].transition?a.validateSpec({key:T,value:r[T],valueSpec:c.transition,validateSpec:a.validateSpec,style:m,styleSpec:c}):d[T]?a.validateSpec({key:T,value:r[T],valueSpec:d[T],validateSpec:a.validateSpec,style:m,styleSpec:c}):[new He(T,r[T],`unknown property "${T}"`)])}return v}function bf(a){const r=a.value,c=a.styleSpec,d=c.terrain,m=a.style;let v=[];const x=Qt(r);if(r===void 0)return v;if(x!=="object")return v=v.concat([new He("terrain",r,`object expected, ${x} found`)]),v;for(const T in r)v=v.concat(d[T]?a.validateSpec({key:T,value:r[T],valueSpec:d[T],validateSpec:a.validateSpec,style:m,styleSpec:c}):[new He(T,r[T],`unknown property "${T}"`)]);return v}function wf(a){let r=[];const c=a.value,d=a.key;if(Array.isArray(c)){const m=[],v=[];for(const x in c)c[x].id&&m.includes(c[x].id)&&r.push(new He(d,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),m.push(c[x].id),c[x].url&&v.includes(c[x].url)&&r.push(new He(d,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),v.push(c[x].url),r=r.concat(er({key:`${d}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return r}return Ts({key:d,value:c})}const Tf={"*":()=>[],array:_a,boolean:function(a){const r=a.value,c=a.key,d=Qt(r);return d!=="boolean"?[new He(c,r,`boolean expected, ${d} found`)]:[]},number:pl,color:function(a){const r=a.key,c=a.value,d=Qt(c);return d!=="string"?[new He(r,c,`color expected, ${d} found`)]:Nt.parse(String(c))?[]:[new He(r,c,`color expected, "${c}" found`)]},constants:mf,enum:ml,filter:ya,function:xc,layer:xf,object:er,source:Tr,light:_l,terrain:bf,string:Ts,formatted:function(a){return Ts(a).length===0?[]:Fo(a)},resolvedImage:function(a){return Ts(a).length===0?[]:Fo(a)},padding:function(a){const r=a.key,c=a.value;if(Qt(c)==="array"){if(c.length<1||c.length>4)return[new He(r,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let m=[];for(let v=0;v<c.length;v++)m=m.concat(a.validateSpec({key:`${r}[${v}]`,value:c[v],validateSpec:a.validateSpec,valueSpec:d}));return m}return pl({key:r,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(a){const r=a.key,c=a.value,d=Qt(c),m=a.styleSpec;if(d!=="array"||c.length<1||c.length%2!=0)return[new He(r,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<c.length;x+=2)v=v.concat(ml({key:`${r}[${x}]`,value:c[x],valueSpec:m.layout_symbol["text-anchor"]})),v=v.concat(_a({key:`${r}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:m}));return v},sprite:wf};function ho(a){const r=a.value,c=a.valueSpec,d=a.styleSpec;return a.validateSpec=ho,c.expression&&Mn(zn(r))?xc(a):c.expression&&pc(Oo(r))?Fo(a):c.type&&Tf[c.type]?Tf[c.type](a):er(Nr({},a,{valueSpec:c.type?d[c.type]:c}))}function Ef(a){const r=a.value,c=a.key,d=Ts(a);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new He(c,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new He(c,r,'"glyphs" url must include a "{range}" token'))),d}function jr(a,r=Le){let c=[];return c=c.concat(ho({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,validateSpec:ho,objectElementValidators:{glyphs:Ef,"*":()=>[]}})),a.constants&&(c=c.concat(mf({key:"constants",value:a.constants}))),bc(c)}function $s(a){return function(r){return a({...r,validateSpec:ho})}}function bc(a){return[].concat(a).sort((r,c)=>r.line-c.line)}function Hs(a){return function(...r){return bc(a.apply(this,r))}}jr.source=Hs($s(Tr)),jr.sprite=Hs($s(wf)),jr.glyphs=Hs($s(Ef)),jr.light=Hs($s(_l)),jr.terrain=Hs($s(bf)),jr.layer=Hs($s(xf)),jr.filter=Hs($s(ya)),jr.paintProperty=Hs($s(yf)),jr.layoutProperty=Hs($s(vf));const Ws=jr,vg=Ws.light,Ku=Ws.paintProperty,Sf=Ws.layoutProperty;function wc(a,r){let c=!1;if(r&&r.length)for(const d of r)a.fire(new Jr(new Error(d.message))),c=!0;return c}class va{constructor(r,c,d){const m=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const x=new Int32Array(this.arrayBuffer);r=x[0],this.d=(c=x[1])+2*(d=x[2]);for(let A=0;A<this.d*this.d;A++){const I=x[3+A],R=x[3+A+1];m.push(I===R?null:x.subarray(I,R))}const T=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=d,this.scale=c/r,this.uid=0;const v=d/c*r;this.min=-v,this.max=r+v}insert(r,c,d,m,v){this._forEachCell(c,d,m,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,c,d,m,v,x){this.cells[v].push(x)}query(r,c,d,m,v){const x=this.min,T=this.max;if(r<=x&&c<=x&&T<=d&&T<=m&&!v)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(r,c,d,m,this._queryCell,A,{},v),A}}_queryCell(r,c,d,m,v,x,T,A){const I=this.cells[v];if(I!==null){const R=this.keys,O=this.bboxes;for(let B=0;B<I.length;B++){const j=I[B];if(T[j]===void 0){const $=4*j;(A?A(O[$+0],O[$+1],O[$+2],O[$+3]):r<=O[$+2]&&c<=O[$+3]&&d>=O[$+0]&&m>=O[$+1])?(T[j]=!0,x.push(R[j])):T[j]=!1}}}}_forEachCell(r,c,d,m,v,x,T,A){const I=this._convertToCellCoord(r),R=this._convertToCellCoord(c),O=this._convertToCellCoord(d),B=this._convertToCellCoord(m);for(let j=I;j<=O;j++)for(let $=R;$<=B;$++){const Q=this.d*$+j;if((!A||A(this._convertFromCellCoord(j),this._convertFromCellCoord($),this._convertFromCellCoord(j+1),this._convertFromCellCoord($+1)))&&v.call(this,r,c,d,m,Q,x,T,A))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,c=3+this.cells.length+1+1;let d=0;for(let x=0;x<this.cells.length;x++)d+=this.cells[x].length;const m=new Int32Array(c+d+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let v=c;for(let x=0;x<r.length;x++){const T=r[x];m[3+x]=v,m.set(T,v),v+=T.length}return m[3+r.length]=v,m.set(this.keys,v),v+=this.keys.length,m[3+r.length+1]=v,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer}static serialize(r,c){const d=r.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(r){return new va(r.buffer)}}const qs={};function it(a,r,c={}){if(qs[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),qs[a]={klass:r,omit:c.omit||[],shallow:c.shallow||[]}}it("Object",Object),it("TransferableGridIndex",va),it("Color",Nt),it("Error",Error),it("AJAXError",Ci),it("ResolvedImage",ln),it("StylePropertyFunction",ul),it("StyleExpression",Wu,{omit:["_evaluator"]}),it("ZoomDependentExpression",gc),it("ZoomConstantExpression",qu),it("CompoundExpression",Vr,{omit:["_evaluate"]});for(const a in ma)ma[a]._classRegistryKey||it(`Expression_${a}`,ma[a]);function Tc(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function fo(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(Tc(a)||Tt(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const c=a;return r&&r.push(c.buffer),c}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const c=[];for(const d of a)c.push(fo(d,r));return c}if(typeof a=="object"){const c=a.constructor,d=c._classRegistryKey;if(!d)throw new Error("can't serialize object of unregistered class");if(!qs[d])throw new Error(`${d} is not registered.`);const m=c.serialize?c.serialize(a,r):{};if(c.serialize){if(r&&m===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in a){if(!a.hasOwnProperty(v)||qs[d].omit.indexOf(v)>=0)continue;const x=a[v];m[v]=qs[d].shallow.indexOf(v)>=0?x:fo(x,r)}a instanceof Error&&(m.message=a.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(m.$name=d),m}throw new Error("can't serialize object of type "+typeof a)}function xa(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||Tc(a)||Tt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(xa);if(typeof a=="object"){const r=a.$name||"Object";if(!qs[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:c}=qs[r];if(!c)throw new Error(`can't deserialize unregistered class ${r}`);if(c.deserialize)return c.deserialize(a);const d=Object.create(c.prototype);for(const m of Object.keys(a)){if(m==="$name")continue;const v=a[m];d[m]=qs[r].shallow.indexOf(m)>=0?v:xa(v)}return d}throw new Error("can't deserialize object of type "+typeof a)}class Af{constructor(){this.first=!0}update(r,c){const d=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=d,!0))}}const et={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Ju(a){for(const r of a)if(eh(r.charCodeAt(0)))return!0;return!1}function Qu(a){for(const r of a)if(!xg(r.charCodeAt(0)))return!1;return!0}function xg(a){return!(et.Arabic(a)||et["Arabic Supplement"](a)||et["Arabic Extended-A"](a)||et["Arabic Presentation Forms-A"](a)||et["Arabic Presentation Forms-B"](a))}function eh(a){return!(a!==746&&a!==747&&(a<4352||!(et["Bopomofo Extended"](a)||et.Bopomofo(a)||et["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||et["CJK Compatibility Ideographs"](a)||et["CJK Compatibility"](a)||et["CJK Radicals Supplement"](a)||et["CJK Strokes"](a)||!(!et["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||et["CJK Unified Ideographs Extension A"](a)||et["CJK Unified Ideographs"](a)||et["Enclosed CJK Letters and Months"](a)||et["Hangul Compatibility Jamo"](a)||et["Hangul Jamo Extended-A"](a)||et["Hangul Jamo Extended-B"](a)||et["Hangul Jamo"](a)||et["Hangul Syllables"](a)||et.Hiragana(a)||et["Ideographic Description Characters"](a)||et.Kanbun(a)||et["Kangxi Radicals"](a)||et["Katakana Phonetic Extensions"](a)||et.Katakana(a)&&a!==12540||!(!et["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!et["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||et["Unified Canadian Aboriginal Syllabics"](a)||et["Unified Canadian Aboriginal Syllabics Extended"](a)||et["Vertical Forms"](a)||et["Yijing Hexagram Symbols"](a)||et["Yi Syllables"](a)||et["Yi Radicals"](a))))}function Pf(a){return!(eh(a)||function(r){return!!(et["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||et["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||et["Letterlike Symbols"](r)||et["Number Forms"](r)||et["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||et["Control Pictures"](r)&&r!==9251||et["Optical Character Recognition"](r)||et["Enclosed Alphanumerics"](r)||et["Geometric Shapes"](r)||et["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||et["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||et["CJK Symbols and Punctuation"](r)||et.Katakana(r)||et["Private Use Area"](r)||et["CJK Compatibility Forms"](r)||et["Small Form Variants"](r)||et["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function If(a){return a>=1424&&a<=2303||et["Arabic Presentation Forms-A"](a)||et["Arabic Presentation Forms-B"](a)}function Cf(a,r){return!(!r&&If(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||et.Khmer(a))}function bg(a){for(const r of a)if(If(r.charCodeAt(0)))return!0;return!1}const th="deferred",nh="loading",ih="loaded";let rh=null,tr="unavailable",po=null;const yl=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(tr="error"),rh&&rh(a)};function sh(){vl.fire(new Mi("pluginStateChange",{pluginStatus:tr,pluginURL:po}))}const vl=new xs,oh=function(){return tr},Mf=function(){if(tr!==th||!po)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");tr=nh,sh(),po&&Kr({url:po},a=>{a?yl(a):(tr=ih,sh())})},Er={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>tr===ih||Er.applyArabicShaping!=null,isLoading:()=>tr===nh,setState(a){if(!Xt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");tr=a.pluginStatus,po=a.pluginURL},isParsed(){if(!Xt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Er.applyArabicShaping!=null&&Er.processBidirectionalText!=null&&Er.processStyledBidirectionalText!=null},getPluginURL(){if(!Xt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return po}};class bn{constructor(r,c){this.zoom=r,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Af,this.transition={})}isSupportedScript(r){return function(c,d){for(const m of c)if(!Cf(m.charCodeAt(0),d))return!1;return!0}(r,Er.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,c=r-Math.floor(r),d=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class Ec{constructor(r,c){this.property=r,this.value=c,this.expression=function(d,m){if(Mn(d))return new ul(d,m);if(pc(d)){const v=Zu(d,m);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=d;return m.type==="color"&&typeof d=="string"?v=Nt.parse(d):m.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(d)&&(v=vi.parse(d)):v=Li.parse(d),{kind:"constant",evaluate:()=>v}}}(c===void 0?r.specification.default:c,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,c,d){return this.property.possiblyEvaluate(this,r,c,d)}}class ah{constructor(r){this.property=r,this.value=new Ec(r,void 0)}transitioned(r,c){return new kf(this.property,this.value,c,Oe({},r.transition,this.transition),r.now)}untransitioned(){return new kf(this.property,this.value,null,{},0)}}class Lf{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return nt(this._values[r].value.value)}setValue(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ah(this._values[r].property)),this._values[r].value=new Ec(this._values[r].property,c===null?void 0:nt(c))}getTransition(r){return nt(this._values[r].transition)}setTransition(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ah(this._values[r].property)),this._values[r].transition=nt(c)||void 0}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d);const m=this.getTransition(c);m!==void 0&&(r[`${c}-transition`]=m)}return r}transitioned(r,c){const d=new Rf(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].transitioned(r,c._values[m]);return d}untransitioned(){const r=new Rf(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].untransitioned();return r}}class kf{constructor(r,c,d,m,v){this.property=r,this.value=c,this.begin=v+m.delay||0,this.end=this.begin+m.duration||0,r.specification.transition&&(m.delay||m.duration)&&(this.prior=d)}possiblyEvaluate(r,c,d){const m=r.now||0,v=this.value.possiblyEvaluate(r,c,d),x=this.prior;if(x){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return x.possiblyEvaluate(r,c,d);{const T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,c,d),v,function(A){if(A<=0)return 0;if(A>=1)return 1;const I=A*A,R=I*A;return 4*(A<.5?R:3*(A-I)+R-.75)}(T))}}return v}}class Rf{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,c,d){const m=new Sc(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(r,c,d);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class wg{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return nt(this._values[r].value)}setValue(r,c){this._values[r]=new Ec(this._values[r].property,c===null?void 0:nt(c))}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d)}return r}possiblyEvaluate(r,c,d){const m=new Sc(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(r,c,d);return m}}class Ui{constructor(r,c,d){this.property=r,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,c,d,m){return this.property.evaluate(this.value,this.parameters,r,c,d,m)}}class Sc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class mt{constructor(r){this.specification=r}possiblyEvaluate(r,c){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(c)}interpolate(r,c,d){const m=br[this.specification.type];return m?m(r,c,d):r}}class bt{constructor(r,c){this.specification=r,this.overrides=c}possiblyEvaluate(r,c,d,m){return new Ui(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(c,null,{},d,m)}:r.expression,c)}interpolate(r,c,d){if(r.value.kind!=="constant"||c.value.kind!=="constant")return r;if(r.value.value===void 0||c.value.value===void 0)return new Ui(this,{kind:"constant",value:void 0},r.parameters);const m=br[this.specification.type];if(m){const v=m(r.value.value,c.value.value,d);return new Ui(this,{kind:"constant",value:v},r.parameters)}return r}evaluate(r,c,d,m,v,x){return r.kind==="constant"?r.value:r.evaluate(c,d,m,v,x)}}class xl extends bt{possiblyEvaluate(r,c,d,m){if(r.value===void 0)return new Ui(this,{kind:"constant",value:void 0},c);if(r.expression.kind==="constant"){const v=r.expression.evaluate(c,null,{},d,m),x=r.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,T=this._calculate(x,x,x,c);return new Ui(this,{kind:"constant",value:T},c)}if(r.expression.kind==="camera"){const v=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new Ui(this,{kind:"constant",value:v},c)}return new Ui(this,r.expression,c)}evaluate(r,c,d,m,v,x){if(r.kind==="source"){const T=r.evaluate(c,d,m,v,x);return this._calculate(T,T,T,c)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},d,m),r.evaluate({zoom:Math.floor(c.zoom)},d,m),r.evaluate({zoom:Math.floor(c.zoom)+1},d,m),c):r.value}_calculate(r,c,d,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:d,to:c}}interpolate(r){return r}}class lh{constructor(r){this.specification=r}possiblyEvaluate(r,c,d,m){if(r.value!==void 0){if(r.expression.kind==="constant"){const v=r.expression.evaluate(c,null,{},d,m);return this._calculate(v,v,v,c)}return this._calculate(r.expression.evaluate(new bn(Math.floor(c.zoom-1),c)),r.expression.evaluate(new bn(Math.floor(c.zoom),c)),r.expression.evaluate(new bn(Math.floor(c.zoom+1),c)),c)}}_calculate(r,c,d,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:d,to:c}}interpolate(r){return r}}class ch{constructor(r){this.specification=r}possiblyEvaluate(r,c,d,m){return!!r.expression.evaluate(c,null,{},d,m)}interpolate(){return!1}}class qn{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in r){const d=r[c];d.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new Ec(d,void 0),v=this.defaultTransitionablePropertyValues[c]=new ah(d);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate({})}}}it("DataDrivenProperty",bt),it("DataConstantProperty",mt),it("CrossFadedDataDrivenProperty",xl),it("CrossFadedProperty",lh),it("ColorRampProperty",ch);const uh="-transition";class Gr extends xs{constructor(r,c){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new wg(c.layout)),c.paint)){this._transitionablePaint=new Lf(c.paint);for(const d in r.paint)this.setPaintProperty(d,r.paint[d],{validate:!1});for(const d in r.layout)this.setLayoutProperty(d,r.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sc(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,c,d={}){c!=null&&this._validate(Sf,`layers.${this.id}.layout.${r}`,r,c,d)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,c):this.visibility=c)}getPaintProperty(r){return r.endsWith(uh)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,c,d={}){if(c!=null&&this._validate(Ku,`layers.${this.id}.paint.${r}`,r,c,d))return!1;if(r.endsWith(uh))return this._transitionablePaint.setTransition(r.slice(0,-11),c||void 0),!1;{const m=this._transitionablePaint._values[r],v=m.property.specification["property-type"]==="cross-faded-data-driven",x=m.value.isDataDriven(),T=m.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);const A=this._transitionablePaint._values[r].value;return A.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(r,T,A)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,c,d){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Re(r,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(r,c,d,m,v={}){return(!v||v.validate!==!1)&&wc(this,r.call(Ws,{key:c,layerType:this.type,objectKey:d,value:m,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const c=this.paint.get(r);if(c instanceof Ui&&ga(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Df={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bo{constructor(r,c){this._structArray=r,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class On{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,c){return r._trim(),c&&(r.isTransferred=!0,c.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const c=Object.create(this.prototype);return c.arrayBuffer=r.arrayBuffer,c.length=r.length,c.capacity=r.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function kn(a,r=1){let c=0,d=0;return{members:a.map(m=>{const v=Df[m.type].BYTES_PER_ELEMENT,x=c=ba(c,Math.max(r,v)),T=m.components||1;return d=Math.max(d,v),c+=v*T,{name:m.name,type:m.type,components:T,offset:x}}),size:ba(c,Math.max(d,r)),alignment:r}}function ba(a,r){return Math.ceil(a/r)*r}class bl extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const m=2*r;return this.int16[m+0]=c,this.int16[m+1]=d,r}}bl.prototype.bytesPerElement=4,it("StructArrayLayout2i4",bl);class wl extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,c,d)}emplace(r,c,d,m){const v=3*r;return this.int16[v+0]=c,this.int16[v+1]=d,this.int16[v+2]=m,r}}wl.prototype.bytesPerElement=6,it("StructArrayLayout3i6",wl);class No extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,r,c,d,m)}emplace(r,c,d,m,v){const x=4*r;return this.int16[x+0]=c,this.int16[x+1]=d,this.int16[x+2]=m,this.int16[x+3]=v,r}}No.prototype.bytesPerElement=8,it("StructArrayLayout4i8",No);class hh extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,m,v,x)}emplace(r,c,d,m,v,x,T){const A=6*r;return this.int16[A+0]=c,this.int16[A+1]=d,this.int16[A+2]=m,this.int16[A+3]=v,this.int16[A+4]=x,this.int16[A+5]=T,r}}hh.prototype.bytesPerElement=12,it("StructArrayLayout2i4i12",hh);class dh extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,m,v,x)}emplace(r,c,d,m,v,x,T){const A=4*r,I=8*r;return this.int16[A+0]=c,this.int16[A+1]=d,this.uint8[I+4]=m,this.uint8[I+5]=v,this.uint8[I+6]=x,this.uint8[I+7]=T,r}}dh.prototype.bytesPerElement=8,it("StructArrayLayout2i4ub8",dh);class wa extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const m=2*r;return this.float32[m+0]=c,this.float32[m+1]=d,r}}wa.prototype.bytesPerElement=8,it("StructArrayLayout2f8",wa);class fh extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x,T,A,I,R){const O=this.length;return this.resize(O+1),this.emplace(O,r,c,d,m,v,x,T,A,I,R)}emplace(r,c,d,m,v,x,T,A,I,R,O){const B=10*r;return this.uint16[B+0]=c,this.uint16[B+1]=d,this.uint16[B+2]=m,this.uint16[B+3]=v,this.uint16[B+4]=x,this.uint16[B+5]=T,this.uint16[B+6]=A,this.uint16[B+7]=I,this.uint16[B+8]=R,this.uint16[B+9]=O,r}}fh.prototype.bytesPerElement=20,it("StructArrayLayout10ui20",fh);class ph extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x,T,A,I,R,O,B){const j=this.length;return this.resize(j+1),this.emplace(j,r,c,d,m,v,x,T,A,I,R,O,B)}emplace(r,c,d,m,v,x,T,A,I,R,O,B,j){const $=12*r;return this.int16[$+0]=c,this.int16[$+1]=d,this.int16[$+2]=m,this.int16[$+3]=v,this.uint16[$+4]=x,this.uint16[$+5]=T,this.uint16[$+6]=A,this.uint16[$+7]=I,this.int16[$+8]=R,this.int16[$+9]=O,this.int16[$+10]=B,this.int16[$+11]=j,r}}ph.prototype.bytesPerElement=24,it("StructArrayLayout4i4ui4i24",ph);class en extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,c,d)}emplace(r,c,d,m){const v=3*r;return this.float32[v+0]=c,this.float32[v+1]=d,this.float32[v+2]=m,r}}en.prototype.bytesPerElement=12,it("StructArrayLayout3f12",en);class _ extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint32[1*r+0]=c,r}}_.prototype.bytesPerElement=4,it("StructArrayLayout1ul4",_);class s extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x,T,A,I){const R=this.length;return this.resize(R+1),this.emplace(R,r,c,d,m,v,x,T,A,I)}emplace(r,c,d,m,v,x,T,A,I,R){const O=10*r,B=5*r;return this.int16[O+0]=c,this.int16[O+1]=d,this.int16[O+2]=m,this.int16[O+3]=v,this.int16[O+4]=x,this.int16[O+5]=T,this.uint32[B+3]=A,this.uint16[O+8]=I,this.uint16[O+9]=R,r}}s.prototype.bytesPerElement=20,it("StructArrayLayout6i1ul2ui20",s);class h extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,m,v,x)}emplace(r,c,d,m,v,x,T){const A=6*r;return this.int16[A+0]=c,this.int16[A+1]=d,this.int16[A+2]=m,this.int16[A+3]=v,this.int16[A+4]=x,this.int16[A+5]=T,r}}h.prototype.bytesPerElement=12,it("StructArrayLayout2i2i2i12",h);class p extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,r,c,d,m,v)}emplace(r,c,d,m,v,x){const T=4*r,A=8*r;return this.float32[T+0]=c,this.float32[T+1]=d,this.float32[T+2]=m,this.int16[A+6]=v,this.int16[A+7]=x,r}}p.prototype.bytesPerElement=16,it("StructArrayLayout2f1f2i16",p);class g extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,r,c,d,m)}emplace(r,c,d,m,v){const x=12*r,T=3*r;return this.uint8[x+0]=c,this.uint8[x+1]=d,this.float32[T+1]=m,this.float32[T+2]=v,r}}g.prototype.bytesPerElement=12,it("StructArrayLayout2ub2f12",g);class y extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,c,d)}emplace(r,c,d,m){const v=3*r;return this.uint16[v+0]=c,this.uint16[v+1]=d,this.uint16[v+2]=m,r}}y.prototype.bytesPerElement=6,it("StructArrayLayout3ui6",y);class E extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x,T,A,I,R,O,B,j,$,Q,oe,he){const ve=this.length;return this.resize(ve+1),this.emplace(ve,r,c,d,m,v,x,T,A,I,R,O,B,j,$,Q,oe,he)}emplace(r,c,d,m,v,x,T,A,I,R,O,B,j,$,Q,oe,he,ve){const pe=24*r,be=12*r,Se=48*r;return this.int16[pe+0]=c,this.int16[pe+1]=d,this.uint16[pe+2]=m,this.uint16[pe+3]=v,this.uint32[be+2]=x,this.uint32[be+3]=T,this.uint32[be+4]=A,this.uint16[pe+10]=I,this.uint16[pe+11]=R,this.uint16[pe+12]=O,this.float32[be+7]=B,this.float32[be+8]=j,this.uint8[Se+36]=$,this.uint8[Se+37]=Q,this.uint8[Se+38]=oe,this.uint32[be+10]=he,this.int16[pe+22]=ve,r}}E.prototype.bytesPerElement=48,it("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",E);class S extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,m,v,x,T,A,I,R,O,B,j,$,Q,oe,he,ve,pe,be,Se,Be,tt,ht,Qe,Je,We,st){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,r,c,d,m,v,x,T,A,I,R,O,B,j,$,Q,oe,he,ve,pe,be,Se,Be,tt,ht,Qe,Je,We,st)}emplace(r,c,d,m,v,x,T,A,I,R,O,B,j,$,Q,oe,he,ve,pe,be,Se,Be,tt,ht,Qe,Je,We,st,Xe){const je=32*r,xt=16*r;return this.int16[je+0]=c,this.int16[je+1]=d,this.int16[je+2]=m,this.int16[je+3]=v,this.int16[je+4]=x,this.int16[je+5]=T,this.int16[je+6]=A,this.int16[je+7]=I,this.uint16[je+8]=R,this.uint16[je+9]=O,this.uint16[je+10]=B,this.uint16[je+11]=j,this.uint16[je+12]=$,this.uint16[je+13]=Q,this.uint16[je+14]=oe,this.uint16[je+15]=he,this.uint16[je+16]=ve,this.uint16[je+17]=pe,this.uint16[je+18]=be,this.uint16[je+19]=Se,this.uint16[je+20]=Be,this.uint16[je+21]=tt,this.uint16[je+22]=ht,this.uint32[xt+12]=Qe,this.float32[xt+13]=Je,this.float32[xt+14]=We,this.uint16[je+30]=st,this.uint16[je+31]=Xe,r}}S.prototype.bytesPerElement=64,it("StructArrayLayout8i15ui1ul2f2ui64",S);class P extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.float32[1*r+0]=c,r}}P.prototype.bytesPerElement=4,it("StructArrayLayout1f4",P);class M extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,c,d)}emplace(r,c,d,m){const v=3*r;return this.uint16[6*r+0]=c,this.float32[v+1]=d,this.float32[v+2]=m,r}}M.prototype.bytesPerElement=12,it("StructArrayLayout1ui2f12",M);class D extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,r,c,d)}emplace(r,c,d,m){const v=4*r;return this.uint32[2*r+0]=c,this.uint16[v+2]=d,this.uint16[v+3]=m,r}}D.prototype.bytesPerElement=8,it("StructArrayLayout1ul2ui8",D);class z extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const m=2*r;return this.uint16[m+0]=c,this.uint16[m+1]=d,r}}z.prototype.bytesPerElement=4,it("StructArrayLayout2ui4",z);class V extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint16[1*r+0]=c,r}}V.prototype.bytesPerElement=2,it("StructArrayLayout1ui2",V);class te extends On{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,r,c,d,m)}emplace(r,c,d,m,v){const x=4*r;return this.float32[x+0]=c,this.float32[x+1]=d,this.float32[x+2]=m,this.float32[x+3]=v,r}}te.prototype.bytesPerElement=16,it("StructArrayLayout4f16",te);class ee extends Bo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}ee.prototype.size=20;class ie extends s{get(r){return new ee(this,r)}}it("CollisionBoxArray",ie);class J extends Bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class ge extends E{get(r){return new J(this,r)}}it("PlacedSymbolArray",ge);class we extends Bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}we.prototype.size=64;class le extends S{get(r){return new we(this,r)}}it("SymbolInstanceArray",le);class ye extends P{getoffsetX(r){return this.float32[1*r+0]}}it("GlyphOffsetArray",ye);class Ae extends wl{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}it("SymbolLineVertexArray",Ae);class Ie extends Bo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ie.prototype.size=12;class Fe extends M{get(r){return new Ie(this,r)}}it("TextAnchorOffsetArray",Fe);class Ve extends Bo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ve.prototype.size=8;class Ue extends D{get(r){return new Ve(this,r)}}it("FeatureIndexArray",Ue);class $e extends bl{}class ut extends bl{}class Ut extends bl{}class Ke extends hh{}class wt extends dh{}class dt extends wa{}class on extends fh{}class Bt extends ph{}class Lt extends en{}class Vt extends _{}class jn extends h{}class mn extends g{}class bi extends y{}class oi extends z{}const Zn=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sr}=Zn;class wn{constructor(r=[]){this.segments=r}prepareSegment(r,c,d,m){let v=this.segments[this.segments.length-1];return r>wn.MAX_VERTEX_ARRAY_LENGTH&&yt(`Max vertices per segment is ${wn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!v||v.vertexLength+r>wn.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const r of this.segments)for(const c in r.vaos)r.vaos[c].destroy()}static simpleSegment(r,c,d,m){return new wn([{vertexOffset:r,primitiveOffset:c,vertexLength:d,primitiveLength:m,vaos:{},sortKey:0}])}}function Es(a,r){return 256*(a=Pe(Math.floor(a),0,255))+Pe(Math.floor(r),0,255)}wn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it("SegmentVector",wn);const Ss=kn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var mo={exports:{}},Uo={exports:{}};Uo.exports=function(a,r){var c,d,m,v,x,T,A,I;for(d=a.length-(c=3&a.length),m=r,x=3432918353,T=461845907,I=0;I<d;)A=255&a.charCodeAt(I)|(255&a.charCodeAt(++I))<<8|(255&a.charCodeAt(++I))<<16|(255&a.charCodeAt(++I))<<24,++I,m=27492+(65535&(v=5*(65535&(m=(m^=A=(65535&(A=(A=(65535&A)*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(A=0,c){case 3:A^=(255&a.charCodeAt(I+2))<<16;case 2:A^=(255&a.charCodeAt(I+1))<<8;case 1:m^=A=(65535&(A=(A=(65535&(A^=255&a.charCodeAt(I)))*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return m^=a.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var Ta=Uo.exports,ki={exports:{}};ki.exports=function(a,r){for(var c,d=a.length,m=r^d,v=0;d>=4;)c=1540483477*(65535&(c=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++v;switch(d){case 3:m^=(255&a.charCodeAt(v+2))<<16;case 2:m^=(255&a.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&a.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var wi=Ta,Vi=ki.exports;mo.exports=wi,mo.exports.murmur3=wi,mo.exports.murmur2=Vi;var Vo=w(mo.exports);class Gn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,c,d,m){this.ids.push(ai(r)),this.positions.push(c,d,m)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=ai(r);let d=0,m=this.ids.length-1;for(;d<m;){const x=d+m>>1;this.ids[x]>=c?m=x:d=x+1}const v=[];for(;this.ids[d]===c;)v.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return v}static serialize(r,c){const d=new Float64Array(r.ids),m=new Uint32Array(r.positions);return nr(d,m,0,d.length-1),c&&c.push(d.buffer,m.buffer),{ids:d,positions:m}}static deserialize(r){const c=new Gn;return c.ids=r.ids,c.positions=r.positions,c.indexed=!0,c}}function ai(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Vo(String(a))}function nr(a,r,c,d){for(;c<d;){const m=a[c+d>>1];let v=c-1,x=d+1;for(;;){do v++;while(a[v]<m);do x--;while(a[x]>m);if(v>=x)break;$n(a,v,x),$n(r,3*v,3*x),$n(r,3*v+1,3*x+1),$n(r,3*v+2,3*x+2)}x-c<d-x?(nr(a,r,c,x),c=x+1):(nr(a,r,x+1,d),d=x)}}function $n(a,r,c){const d=a[r];a[r]=a[c],a[c]=d}it("FeaturePositionMap",Gn);class jo{constructor(r,c){this.gl=r.gl,this.location=c}}class Ac extends jo{constructor(r,c){super(r,c),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class zf extends jo{constructor(r,c){super(r,c),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Of extends jo{constructor(r,c){super(r,c),this.current=Nt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Tg=new Float32Array(16);function mh(a){return[Es(255*a.r,255*a.g),Es(255*a.b,255*a.a)]}class As{constructor(r,c,d){this.value=r,this.uniformNames=c.map(m=>`u_${m}`),this.type=d}setUniform(r,c,d){r.set(d.constantOr(this.value))}getBinding(r,c,d){return this.type==="color"?new Of(r,c):new Ac(r,c)}}class Go{constructor(r,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=r.tlbr}setUniform(r,c,d,m){const v=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&r.set(v)}getBinding(r,c,d){return d.substr(0,9)==="u_pattern"?new zf(r,c):new Ac(r,c)}}class Ps{constructor(r,c,d,m){this.expression=r,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,c,d,m,v){const x=this.paintVertexArray.length,T=this.expression.evaluate(new bn(0),c,{},m,[],v);this.paintVertexArray.resize(r),this._setPaintValue(x,r,T)}updatePaintArray(r,c,d,m){const v=this.expression.evaluate({zoom:0},d,m);this._setPaintValue(r,c,v)}_setPaintValue(r,c,d){if(this.type==="color"){const m=mh(d);for(let v=r;v<c;v++)this.paintVertexArray.emplace(v,m[0],m[1])}else{for(let m=r;m<c;m++)this.paintVertexArray.emplace(m,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class $r{constructor(r,c,d,m,v,x){this.expression=r,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=m,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,c,d,m,v){const x=this.expression.evaluate(new bn(this.zoom),c,{},m,[],v),T=this.expression.evaluate(new bn(this.zoom+1),c,{},m,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(A,r,x,T)}updatePaintArray(r,c,d,m){const v=this.expression.evaluate({zoom:this.zoom},d,m),x=this.expression.evaluate({zoom:this.zoom+1},d,m);this._setPaintValue(r,c,v,x)}_setPaintValue(r,c,d,m){if(this.type==="color"){const v=mh(d),x=mh(m);for(let T=r;T<c;T++)this.paintVertexArray.emplace(T,v[0],v[1],x[0],x[1])}else{for(let v=r;v<c;v++)this.paintVertexArray.emplace(v,d,m);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,m=Pe(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);r.set(m)}getBinding(r,c,d){return new Ac(r,c)}}class Is{constructor(r,c,d,m,v,x){this.expression=r,this.type=c,this.useIntegerZoom=d,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,c,d){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(m,r,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(r,c,d,m,v){this._setPaintValues(r,c,d.patterns&&d.patterns[this.layerId],v)}_setPaintValues(r,c,d,m){if(!m||!d)return;const{min:v,mid:x,max:T}=d,A=m[v],I=m[x],R=m[T];if(A&&I&&R)for(let O=r;O<c;O++)this.zoomInPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],I.pixelRatio,R.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,Ss.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,Ss.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class gh{constructor(r,c,d){this.binders={},this._buffers=[];const m=[];for(const v in r.paint._values){if(!d(v))continue;const x=r.paint.get(v);if(!(x instanceof Ui&&ga(x.property.specification)))continue;const T=wP(v,r.type),A=x.value,I=x.property.specification.type,R=x.property.useIntegerZoom,O=x.property.specification["property-type"],B=O==="cross-faded"||O==="cross-faded-data-driven";if(A.kind==="constant")this.binders[v]=B?new Go(A.value,T):new As(A.value,T,I),m.push(`/u_${v}`);else if(A.kind==="source"||B){const j=fx(v,I,"source");this.binders[v]=B?new Is(A,I,R,c,j,r.id):new Ps(A,T,I,j),m.push(`/a_${v}`)}else{const j=fx(v,I,"composite");this.binders[v]=new $r(A,T,I,R,c,j),m.push(`/z_${v}`)}}this.cacheKey=m.sort().join("")}getMaxValue(r){const c=this.binders[r];return c instanceof Ps||c instanceof $r?c.maxValue:0}populatePaintArrays(r,c,d,m,v){for(const x in this.binders){const T=this.binders[x];(T instanceof Ps||T instanceof $r||T instanceof Is)&&T.populatePaintArray(r,c,d,m,v)}}setConstantPatternPositions(r,c){for(const d in this.binders){const m=this.binders[d];m instanceof Go&&m.setConstantPatternPositions(r,c)}}updatePaintArrays(r,c,d,m,v){let x=!1;for(const T in r){const A=c.getPositions(T);for(const I of A){const R=d.feature(I.index);for(const O in this.binders){const B=this.binders[O];if((B instanceof Ps||B instanceof $r||B instanceof Is)&&B.expression.isStateDependent===!0){const j=m.paint.get(O);B.expression=j.value,B.updatePaintArray(I.start,I.end,R,r[T],v),x=!0}}}}return x}defines(){const r=[];for(const c in this.binders){const d=this.binders[c];(d instanceof As||d instanceof Go)&&r.push(...d.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Ps||d instanceof $r)for(let m=0;m<d.paintVertexAttributes.length;m++)r.push(d.paintVertexAttributes[m].name);else if(d instanceof Is)for(let m=0;m<Ss.members.length;m++)r.push(Ss.members[m].name)}return r}getBinderUniforms(){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof As||d instanceof Go||d instanceof $r)for(const m of d.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,c){const d=[];for(const m in this.binders){const v=this.binders[m];if(v instanceof As||v instanceof Go||v instanceof $r){for(const x of v.uniformNames)if(c[x]){const T=v.getBinding(r,c[x],x);d.push({name:x,property:m,binding:T})}}}return d}setUniforms(r,c,d,m){for(const{name:v,property:x,binding:T}of c)this.binders[x].setUniform(T,m,d.get(x),v)}updatePaintBuffers(r){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(r&&d instanceof Is){const m=r.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(d instanceof Ps||d instanceof $r)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(r){for(const c in this.binders){const d=this.binders[c];(d instanceof Ps||d instanceof $r||d instanceof Is)&&d.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const c=this.binders[r];(c instanceof Ps||c instanceof $r||c instanceof Is)&&c.destroy()}}}class Zs{constructor(r,c,d=()=>!0){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new gh(m,c,d);this.needsUpload=!1,this._featureMap=new Gn,this._bufferOffset=0}populatePaintArrays(r,c,d,m,v,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,c,m,v,x);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,c,d,m){for(const v of d)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,c,v,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function wP(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function fx(a,r,c){const d={color:{source:wa,composite:te},number:{source:P,composite:wa}},m=function(v){return{"line-pattern":{source:on,composite:on},"fill-pattern":{source:on,composite:on},"fill-extrusion-pattern":{source:on,composite:on}}[v]}(a);return m&&m[c]||d[r][c]}it("ConstantBinder",As),it("CrossFadedConstantBinder",Go),it("SourceExpressionBinder",Ps),it("CrossFadedCompositeBinder",Is),it("CompositeExpressionBinder",$r),it("ProgramConfiguration",gh,{omit:["_buffers"]}),it("ProgramConfigurationSet",Zs);const ei=8192,Eg=Math.pow(2,14)-1,px=-Eg-1;function Tl(a){const r=ei/a.extent,c=a.loadGeometry();for(let d=0;d<c.length;d++){const m=c[d];for(let v=0;v<m.length;v++){const x=m[v],T=Math.round(x.x*r),A=Math.round(x.y*r);x.x=Pe(T,px,Eg),x.y=Pe(A,px,Eg),(T<x.x||T>x.x+1||A<x.y||A>x.y+1)&&yt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function El(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?Tl(a):[]}}function Ff(a,r,c,d,m){a.emplaceBack(2*r+(d+1)/2,2*c+(m+1)/2)}class Sg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new ut,this.indexArray=new bi,this.segments=new wn,this.programConfigurations=new Zs(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){const m=this.layers[0],v=[];let x=null,T=!1;m.type==="circle"&&(x=m.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:A,id:I,index:R,sourceLayerIndex:O}of r){const B=this.layers[0]._featureFilter.needGeometry,j=El(A,B);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),j,d))continue;const $=T?x.evaluate(j,{},d):void 0,Q={id:I,properties:A.properties,type:A.type,sourceLayerIndex:O,index:R,geometry:B?j.geometry:Tl(A),patterns:{},sortKey:$};v.push(Q)}T&&v.sort((A,I)=>A.sortKey-I.sortKey);for(const A of v){const{geometry:I,index:R,sourceLayerIndex:O}=A,B=r[R].feature;this.addFeature(A,I,R,d),c.featureIndex.insert(B,I,R,O,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Sr),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,c,d,m){for(const v of c)for(const x of v){const T=x.x,A=x.y;if(T<0||T>=ei||A<0||A>=ei)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),R=I.vertexLength;Ff(this.layoutVertexArray,T,A,-1,-1),Ff(this.layoutVertexArray,T,A,1,-1),Ff(this.layoutVertexArray,T,A,1,1),Ff(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,{},m)}}function mx(a,r){for(let c=0;c<a.length;c++)if(Pc(r,a[c]))return!0;for(let c=0;c<r.length;c++)if(Pc(a,r[c]))return!0;return!!Ag(a,r)}function TP(a,r,c){return!!Pc(a,r)||!!Pg(r,a,c)}function gx(a,r){if(a.length===1)return yx(r,a[0]);for(let c=0;c<r.length;c++){const d=r[c];for(let m=0;m<d.length;m++)if(Pc(a,d[m]))return!0}for(let c=0;c<a.length;c++)if(yx(r,a[c]))return!0;for(let c=0;c<r.length;c++)if(Ag(a,r[c]))return!0;return!1}function EP(a,r,c){if(a.length>1){if(Ag(a,r))return!0;for(let d=0;d<r.length;d++)if(Pg(r[d],a,c))return!0}for(let d=0;d<a.length;d++)if(Pg(a[d],r,c))return!0;return!1}function Ag(a,r){if(a.length===0||r.length===0)return!1;for(let c=0;c<a.length-1;c++){const d=a[c],m=a[c+1];for(let v=0;v<r.length-1;v++)if(SP(d,m,r[v],r[v+1]))return!0}return!1}function SP(a,r,c,d){return Dt(a,c,d)!==Dt(r,c,d)&&Dt(a,r,c)!==Dt(a,r,d)}function Pg(a,r,c){const d=c*c;if(r.length===1)return a.distSqr(r[0])<d;for(let m=1;m<r.length;m++)if(_x(a,r[m-1],r[m])<d)return!0;return!1}function _x(a,r,c){const d=r.distSqr(c);if(d===0)return a.distSqr(r);const m=((a.x-r.x)*(c.x-r.x)+(a.y-r.y)*(c.y-r.y))/d;return a.distSqr(m<0?r:m>1?c:c.sub(r)._mult(m)._add(r))}function yx(a,r){let c,d,m,v=!1;for(let x=0;x<a.length;x++){c=a[x];for(let T=0,A=c.length-1;T<c.length;A=T++)d=c[T],m=c[A],d.y>r.y!=m.y>r.y&&r.x<(m.x-d.x)*(r.y-d.y)/(m.y-d.y)+d.x&&(v=!v)}return v}function Pc(a,r){let c=!1;for(let d=0,m=a.length-1;d<a.length;m=d++){const v=a[d],x=a[m];v.y>r.y!=x.y>r.y&&r.x<(x.x-v.x)*(r.y-v.y)/(x.y-v.y)+v.x&&(c=!c)}return c}function AP(a,r,c){const d=c[0],m=c[2];if(a.x<d.x&&r.x<d.x||a.x>m.x&&r.x>m.x||a.y<d.y&&r.y<d.y||a.y>m.y&&r.y>m.y)return!1;const v=Dt(a,r,c[0]);return v!==Dt(a,r,c[1])||v!==Dt(a,r,c[2])||v!==Dt(a,r,c[3])}function _h(a,r,c){const d=r.paint.get(a).value;return d.kind==="constant"?d.value:c.programConfigurations.get(r.id).getMaxValue(a)}function Bf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Nf(a,r,c,d,m){if(!r[0]&&!r[1])return a;const v=k.convert(r)._mult(m);c==="viewport"&&v._rotate(-d);const x=[];for(let T=0;T<a.length;T++)x.push(a[T].sub(v));return x}let vx,xx;it("CircleBucket",Sg,{omit:["layers"]});var PP={get paint(){return xx=xx||new qn({"circle-radius":new bt(Le.paint_circle["circle-radius"]),"circle-color":new bt(Le.paint_circle["circle-color"]),"circle-blur":new bt(Le.paint_circle["circle-blur"]),"circle-opacity":new bt(Le.paint_circle["circle-opacity"]),"circle-translate":new mt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new mt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt(Le.paint_circle["circle-stroke-opacity"])})},get layout(){return vx=vx||new qn({"circle-sort-key":new bt(Le.layout_circle["circle-sort-key"])})}},ir=1e-6,Ic=typeof Float32Array<"u"?Float32Array:Array;function Ig(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function bx(a,r,c){var d=r[0],m=r[1],v=r[2],x=r[3],T=r[4],A=r[5],I=r[6],R=r[7],O=r[8],B=r[9],j=r[10],$=r[11],Q=r[12],oe=r[13],he=r[14],ve=r[15],pe=c[0],be=c[1],Se=c[2],Be=c[3];return a[0]=pe*d+be*T+Se*O+Be*Q,a[1]=pe*m+be*A+Se*B+Be*oe,a[2]=pe*v+be*I+Se*j+Be*he,a[3]=pe*x+be*R+Se*$+Be*ve,a[4]=(pe=c[4])*d+(be=c[5])*T+(Se=c[6])*O+(Be=c[7])*Q,a[5]=pe*m+be*A+Se*B+Be*oe,a[6]=pe*v+be*I+Se*j+Be*he,a[7]=pe*x+be*R+Se*$+Be*ve,a[8]=(pe=c[8])*d+(be=c[9])*T+(Se=c[10])*O+(Be=c[11])*Q,a[9]=pe*m+be*A+Se*B+Be*oe,a[10]=pe*v+be*I+Se*j+Be*he,a[11]=pe*x+be*R+Se*$+Be*ve,a[12]=(pe=c[12])*d+(be=c[13])*T+(Se=c[14])*O+(Be=c[15])*Q,a[13]=pe*m+be*A+Se*B+Be*oe,a[14]=pe*v+be*I+Se*j+Be*he,a[15]=pe*x+be*R+Se*$+Be*ve,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var yh,IP=bx;function Uf(a,r,c){var d=r[0],m=r[1],v=r[2],x=r[3];return a[0]=c[0]*d+c[4]*m+c[8]*v+c[12]*x,a[1]=c[1]*d+c[5]*m+c[9]*v+c[13]*x,a[2]=c[2]*d+c[6]*m+c[10]*v+c[14]*x,a[3]=c[3]*d+c[7]*m+c[11]*v+c[15]*x,a}yh=new Ic(4),Ic!=Float32Array&&(yh[0]=0,yh[1]=0,yh[2]=0,yh[3]=0);class CP extends Gr{constructor(r){super(r,PP)}createBucket(r){return new Sg(r)}queryRadius(r){const c=r;return _h("circle-radius",this,c)+_h("circle-stroke-width",this,c)+Bf(this.paint.get("circle-translate"))}queryIntersectsFeature(r,c,d,m,v,x,T,A){const I=Nf(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,T),R=this.paint.get("circle-radius").evaluate(c,d)+this.paint.get("circle-stroke-width").evaluate(c,d),O=this.paint.get("circle-pitch-alignment")==="map",B=O?I:function($,Q){return $.map(oe=>wx(oe,Q))}(I,A),j=O?R*T:R;for(const $ of m)for(const Q of $){const oe=O?Q:wx(Q,A);let he=j;const ve=Uf([],[Q.x,Q.y,0,1],A);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=ve[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=x.cameraToCenterDistance/ve[3]),TP(B,oe,he))return!0}return!1}}function wx(a,r){const c=Uf([],[a.x,a.y,0,1],r);return new k(c[0]/c[3],c[1]/c[3])}class Tx extends Sg{}let Ex;it("HeatmapBucket",Tx,{omit:["layers"]});var MP={get paint(){return Ex=Ex||new qn({"heatmap-radius":new bt(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ch(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mt(Le.paint_heatmap["heatmap-opacity"])})}};function Cg(a,{width:r,height:c},d,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*c*d)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${r*c*d}`)}else m=new Uint8Array(r*c*d);return a.width=r,a.height=c,a.data=m,a}function Sx(a,{width:r,height:c},d){if(r===a.width&&c===a.height)return;const m=Cg({},{width:r,height:c},d);Mg(a,m,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,c)},d),a.width=r,a.height=c,a.data=m.data}function Mg(a,r,c,d,m,v){if(m.width===0||m.height===0)return r;if(m.width>a.width||m.height>a.height||c.x>a.width-m.width||c.y>a.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||d.x>r.width-m.width||d.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=a.data,T=r.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<m.height;A++){const I=((c.y+A)*a.width+c.x)*v,R=((d.y+A)*r.width+d.x)*v;for(let O=0;O<m.width*v;O++)T[R+O]=x[I+O]}return r}class vh{constructor(r,c){Cg(this,r,1,c)}resize(r){Sx(this,r,1)}clone(){return new vh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,m,v){Mg(r,c,d,m,v,1)}}class ns{constructor(r,c){Cg(this,r,4,c)}resize(r){Sx(this,r,4)}replace(r,c){c?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new ns({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,m,v){Mg(r,c,d,m,v,4)}}function Ax(a){const r={},c=a.resolution||256,d=a.clips?a.clips.length:1,m=a.image||new ns({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const v=(x,T,A)=>{r[a.evaluationKey]=A;const I=a.expression.evaluate(r);m.data[x+T+0]=Math.floor(255*I.r/I.a),m.data[x+T+1]=Math.floor(255*I.g/I.a),m.data[x+T+2]=Math.floor(255*I.b/I.a),m.data[x+T+3]=Math.floor(255*I.a)};if(a.clips)for(let x=0,T=0;x<d;++x,T+=4*c)for(let A=0,I=0;A<c;A++,I+=4){const R=A/(c-1),{start:O,end:B}=a.clips[x];v(T,I,O*(1-R)+B*R)}else for(let x=0,T=0;x<c;x++,T+=4)v(0,T,x/(c-1));return m}it("AlphaImage",vh),it("RGBAImage",ns);class LP extends Gr{createBucket(r){return new Tx(r)}constructor(r){super(r,MP),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ax({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Px;var kP={get paint(){return Px=Px||new qn({"hillshade-illumination-direction":new mt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mt(Le.paint_hillshade["hillshade-accent-color"])})}};class RP extends Gr{constructor(r){super(r,kP)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const DP=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:zP}=DP;var Lg={exports:{}};function Vf(a,r,c){c=c||2;var d,m,v,x,T,A,I,R=r&&r.length,O=R?r[0]*c:a.length,B=Ix(a,0,O,c,!0),j=[];if(!B||B.next===B.prev)return j;if(R&&(B=function(Q,oe,he,ve){var pe,be,Se,Be=[];for(pe=0,be=oe.length;pe<be;pe++)(Se=Ix(Q,oe[pe]*ve,pe<be-1?oe[pe+1]*ve:Q.length,ve,!1))===Se.next&&(Se.steiner=!0),Be.push(GP(Se));for(Be.sort(UP),pe=0;pe<Be.length;pe++)he=VP(Be[pe],he);return he}(a,r,B,c)),a.length>80*c){d=v=a[0],m=x=a[1];for(var $=c;$<O;$+=c)(T=a[$])<d&&(d=T),(A=a[$+1])<m&&(m=A),T>v&&(v=T),A>x&&(x=A);I=(I=Math.max(v-d,x-m))!==0?32767/I:0}return xh(B,j,c,d,m,I,0),j}function Ix(a,r,c,d,m){var v,x;if(m===Dg(a,r,c,d)>0)for(v=r;v<c;v+=d)x=Lx(v,a[v],a[v+1],x);else for(v=c-d;v>=r;v-=d)x=Lx(v,a[v],a[v+1],x);return x&&jf(x,x.next)&&(wh(x),x=x.next),x}function Sl(a,r){if(!a)return a;r||(r=a);var c,d=a;do if(c=!1,d.steiner||!jf(d,d.next)&&Xn(d.prev,d,d.next)!==0)d=d.next;else{if(wh(d),(d=r=d.prev)===d.next)break;c=!0}while(c||d!==r);return r}function xh(a,r,c,d,m,v,x){if(a){!x&&v&&function(R,O,B,j){var $=R;do $.z===0&&($.z=kg($.x,$.y,O,B,j)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==R);$.prevZ.nextZ=null,$.prevZ=null,function(Q){var oe,he,ve,pe,be,Se,Be,tt,ht=1;do{for(he=Q,Q=null,be=null,Se=0;he;){for(Se++,ve=he,Be=0,oe=0;oe<ht&&(Be++,ve=ve.nextZ);oe++);for(tt=ht;Be>0||tt>0&&ve;)Be!==0&&(tt===0||!ve||he.z<=ve.z)?(pe=he,he=he.nextZ,Be--):(pe=ve,ve=ve.nextZ,tt--),be?be.nextZ=pe:Q=pe,pe.prevZ=be,be=pe;he=ve}be.nextZ=null,ht*=2}while(Se>1)}($)}(a,d,m,v);for(var T,A,I=a;a.prev!==a.next;)if(T=a.prev,A=a.next,v?FP(a,d,m,v):OP(a))r.push(T.i/c|0),r.push(a.i/c|0),r.push(A.i/c|0),wh(a),a=A.next,I=A.next;else if((a=A)===I){x?x===1?xh(a=BP(Sl(a),r,c),r,c,d,m,v,2):x===2&&NP(a,r,c,d,m,v):xh(Sl(a),r,c,d,m,v,1);break}}}function OP(a){var r=a.prev,c=a,d=a.next;if(Xn(r,c,d)>=0)return!1;for(var m=r.x,v=c.x,x=d.x,T=r.y,A=c.y,I=d.y,R=m<v?m<x?m:x:v<x?v:x,O=T<A?T<I?T:I:A<I?A:I,B=m>v?m>x?m:x:v>x?v:x,j=T>A?T>I?T:I:A>I?A:I,$=d.next;$!==r;){if($.x>=R&&$.x<=B&&$.y>=O&&$.y<=j&&Cc(m,T,v,A,x,I,$.x,$.y)&&Xn($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function FP(a,r,c,d){var m=a.prev,v=a,x=a.next;if(Xn(m,v,x)>=0)return!1;for(var T=m.x,A=v.x,I=x.x,R=m.y,O=v.y,B=x.y,j=T<A?T<I?T:I:A<I?A:I,$=R<O?R<B?R:B:O<B?O:B,Q=T>A?T>I?T:I:A>I?A:I,oe=R>O?R>B?R:B:O>B?O:B,he=kg(j,$,r,c,d),ve=kg(Q,oe,r,c,d),pe=a.prevZ,be=a.nextZ;pe&&pe.z>=he&&be&&be.z<=ve;){if(pe.x>=j&&pe.x<=Q&&pe.y>=$&&pe.y<=oe&&pe!==m&&pe!==x&&Cc(T,R,A,O,I,B,pe.x,pe.y)&&Xn(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,be.x>=j&&be.x<=Q&&be.y>=$&&be.y<=oe&&be!==m&&be!==x&&Cc(T,R,A,O,I,B,be.x,be.y)&&Xn(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;pe&&pe.z>=he;){if(pe.x>=j&&pe.x<=Q&&pe.y>=$&&pe.y<=oe&&pe!==m&&pe!==x&&Cc(T,R,A,O,I,B,pe.x,pe.y)&&Xn(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;be&&be.z<=ve;){if(be.x>=j&&be.x<=Q&&be.y>=$&&be.y<=oe&&be!==m&&be!==x&&Cc(T,R,A,O,I,B,be.x,be.y)&&Xn(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function BP(a,r,c){var d=a;do{var m=d.prev,v=d.next.next;!jf(m,v)&&Cx(m,d,d.next,v)&&bh(m,v)&&bh(v,m)&&(r.push(m.i/c|0),r.push(d.i/c|0),r.push(v.i/c|0),wh(d),wh(d.next),d=a=v),d=d.next}while(d!==a);return Sl(d)}function NP(a,r,c,d,m,v){var x=a;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&$P(x,T)){var A=Mx(x,T);return x=Sl(x,x.next),A=Sl(A,A.next),xh(x,r,c,d,m,v,0),void xh(A,r,c,d,m,v,0)}T=T.next}x=x.next}while(x!==a)}function UP(a,r){return a.x-r.x}function VP(a,r){var c=function(m,v){var x,T=v,A=m.x,I=m.y,R=-1/0;do{if(I<=T.y&&I>=T.next.y&&T.next.y!==T.y){var O=T.x+(I-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(O<=A&&O>R&&(R=O,x=T.x<T.next.x?T:T.next,O===A))return x}T=T.next}while(T!==v);if(!x)return null;var B,j=x,$=x.x,Q=x.y,oe=1/0;T=x;do A>=T.x&&T.x>=$&&A!==T.x&&Cc(I<Q?A:R,I,$,Q,I<Q?R:A,I,T.x,T.y)&&(B=Math.abs(I-T.y)/(A-T.x),bh(T,m)&&(B<oe||B===oe&&(T.x>x.x||T.x===x.x&&jP(x,T)))&&(x=T,oe=B)),T=T.next;while(T!==j);return x}(a,r);if(!c)return r;var d=Mx(c,a);return Sl(d,d.next),Sl(c,c.next)}function jP(a,r){return Xn(a.prev,a,r.prev)<0&&Xn(r.next,a,a.next)<0}function kg(a,r,c,d,m){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-c)*m|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-d)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function GP(a){var r=a,c=a;do(r.x<c.x||r.x===c.x&&r.y<c.y)&&(c=r),r=r.next;while(r!==a);return c}function Cc(a,r,c,d,m,v,x,T){return(m-x)*(r-T)>=(a-x)*(v-T)&&(a-x)*(d-T)>=(c-x)*(r-T)&&(c-x)*(v-T)>=(m-x)*(d-T)}function $P(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(c,d){var m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==d.i&&m.next.i!==d.i&&Cx(m,m.next,c,d))return!0;m=m.next}while(m!==c);return!1}(a,r)&&(bh(a,r)&&bh(r,a)&&function(c,d){var m=c,v=!1,x=(c.x+d.x)/2,T=(c.y+d.y)/2;do m.y>T!=m.next.y>T&&m.next.y!==m.y&&x<(m.next.x-m.x)*(T-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==c);return v}(a,r)&&(Xn(a.prev,a,r.prev)||Xn(a,r.prev,r))||jf(a,r)&&Xn(a.prev,a,a.next)>0&&Xn(r.prev,r,r.next)>0)}function Xn(a,r,c){return(r.y-a.y)*(c.x-r.x)-(r.x-a.x)*(c.y-r.y)}function jf(a,r){return a.x===r.x&&a.y===r.y}function Cx(a,r,c,d){var m=$f(Xn(a,r,c)),v=$f(Xn(a,r,d)),x=$f(Xn(c,d,a)),T=$f(Xn(c,d,r));return m!==v&&x!==T||!(m!==0||!Gf(a,c,r))||!(v!==0||!Gf(a,d,r))||!(x!==0||!Gf(c,a,d))||!(T!==0||!Gf(c,r,d))}function Gf(a,r,c){return r.x<=Math.max(a.x,c.x)&&r.x>=Math.min(a.x,c.x)&&r.y<=Math.max(a.y,c.y)&&r.y>=Math.min(a.y,c.y)}function $f(a){return a>0?1:a<0?-1:0}function bh(a,r){return Xn(a.prev,a,a.next)<0?Xn(a,r,a.next)>=0&&Xn(a,a.prev,r)>=0:Xn(a,r,a.prev)<0||Xn(a,a.next,r)<0}function Mx(a,r){var c=new Rg(a.i,a.x,a.y),d=new Rg(r.i,r.x,r.y),m=a.next,v=r.prev;return a.next=r,r.prev=a,c.next=m,m.prev=c,d.next=c,c.prev=d,v.next=d,d.prev=v,d}function Lx(a,r,c,d){var m=new Rg(a,r,c);return d?(m.next=d.next,m.prev=d,d.next.prev=m,d.next=m):(m.prev=m,m.next=m),m}function wh(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Rg(a,r,c){this.i=a,this.x=r,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dg(a,r,c,d){for(var m=0,v=r,x=c-d;v<c;v+=d)m+=(a[x]-a[v])*(a[v+1]+a[x+1]),x=v;return m}Lg.exports=Vf,Lg.exports.default=Vf,Vf.deviation=function(a,r,c,d){var m=r&&r.length,v=Math.abs(Dg(a,0,m?r[0]*c:a.length,c));if(m)for(var x=0,T=r.length;x<T;x++)v-=Math.abs(Dg(a,r[x]*c,x<T-1?r[x+1]*c:a.length,c));var A=0;for(x=0;x<d.length;x+=3){var I=d[x]*c,R=d[x+1]*c,O=d[x+2]*c;A+=Math.abs((a[I]-a[O])*(a[R+1]-a[I+1])-(a[I]-a[R])*(a[O+1]-a[I+1]))}return v===0&&A===0?0:Math.abs((A-v)/v)},Vf.flatten=function(a){for(var r=a[0][0].length,c={vertices:[],holes:[],dimensions:r},d=0,m=0;m<a.length;m++){for(var v=0;v<a[m].length;v++)for(var x=0;x<r;x++)c.vertices.push(a[m][v][x]);m>0&&c.holes.push(d+=a[m-1].length)}return c};var kx=w(Lg.exports);function HP(a,r,c,d,m){Rx(a,r,c,d||a.length-1,m||WP)}function Rx(a,r,c,d,m){for(;d>c;){if(d-c>600){var v=d-c+1,x=r-c+1,T=Math.log(v),A=.5*Math.exp(2*T/3),I=.5*Math.sqrt(T*A*(v-A)/v)*(x-v/2<0?-1:1);Rx(a,r,Math.max(c,Math.floor(r-x*A/v+I)),Math.min(d,Math.floor(r+(v-x)*A/v+I)),m)}var R=a[r],O=c,B=d;for(Th(a,c,r),m(a[d],R)>0&&Th(a,c,d);O<B;){for(Th(a,O,B),O++,B--;m(a[O],R)<0;)O++;for(;m(a[B],R)>0;)B--}m(a[c],R)===0?Th(a,c,B):Th(a,++B,d),B<=r&&(c=B+1),r<=B&&(d=B-1)}}function Th(a,r,c){var d=a[r];a[r]=a[c],a[c]=d}function WP(a,r){return a<r?-1:a>r?1:0}function zg(a,r){const c=a.length;if(c<=1)return[a];const d=[];let m,v;for(let x=0;x<c;x++){const T=Sn(a[x]);T!==0&&(a[x].area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(m&&d.push(m),m=[a[x]]):m.push(a[x]))}if(m&&d.push(m),r>1)for(let x=0;x<d.length;x++)d[x].length<=r||(HP(d[x],r,1,d[x].length-1,qP),d[x]=d[x].slice(0,r));return d}function qP(a,r){return r.area-a.area}function Og(a,r,c){const d=c.patternDependencies;let m=!1;for(const v of r){const x=v.paint.get(`${a}-pattern`);x.isConstant()||(m=!0);const T=x.constantOr(null);T&&(m=!0,d[T.to]=!0,d[T.from]=!0)}return m}function Fg(a,r,c,d,m){const v=m.patternDependencies;for(const x of r){const T=x.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:d-1},c,{},m.availableImages),I=T.evaluate({zoom:d},c,{},m.availableImages),R=T.evaluate({zoom:d+1},c,{},m.availableImages);A=A&&A.name?A.name:A,I=I&&I.name?I.name:I,R=R&&R.name?R.name:R,v[A]=!0,v[I]=!0,v[R]=!0,c.patterns[x.id]={min:A,mid:I,max:R}}}return c}class Bg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ut,this.indexArray=new bi,this.indexArray2=new oi,this.programConfigurations=new Zs(r.layers,r.zoom),this.segments=new wn,this.segments2=new wn,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.hasPattern=Og("fill",this.layers,c);const m=this.layers[0].layout.get("fill-sort-key"),v=!m.isConstant(),x=[];for(const{feature:T,id:A,index:I,sourceLayerIndex:R}of r){const O=this.layers[0]._featureFilter.needGeometry,B=El(T,O);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),B,d))continue;const j=v?m.evaluate(B,{},d,c.availableImages):void 0,$={id:A,properties:T.properties,type:T.type,sourceLayerIndex:R,index:I,geometry:O?B.geometry:Tl(T),patterns:{},sortKey:j};x.push($)}v&&x.sort((T,A)=>T.sortKey-A.sortKey);for(const T of x){const{geometry:A,index:I,sourceLayerIndex:R}=T;if(this.hasPattern){const O=Fg("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(T,A,I,d,{});c.featureIndex.insert(r[I].feature,A,I,R,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}addFeatures(r,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zP),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,c,d,m,v){for(const x of zg(c,500)){let T=0;for(const j of x)T+=j.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),I=A.vertexLength,R=[],O=[];for(const j of x){if(j.length===0)continue;j!==x[0]&&O.push(R.length/2);const $=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),Q=$.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(Q+j.length-1,Q),R.push(j[0].x),R.push(j[0].y);for(let oe=1;oe<j.length;oe++)this.layoutVertexArray.emplaceBack(j[oe].x,j[oe].y),this.indexArray2.emplaceBack(Q+oe-1,Q+oe),R.push(j[oe].x),R.push(j[oe].y);$.vertexLength+=j.length,$.primitiveLength+=j.length}const B=kx(R,O);for(let j=0;j<B.length;j+=3)this.indexArray.emplaceBack(I+B[j],I+B[j+1],I+B[j+2]);A.vertexLength+=T,A.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,v,m)}}let Dx,zx;it("FillBucket",Bg,{omit:["layers","patternFeatures"]});var ZP={get paint(){return zx=zx||new qn({"fill-antialias":new mt(Le.paint_fill["fill-antialias"]),"fill-opacity":new bt(Le.paint_fill["fill-opacity"]),"fill-color":new bt(Le.paint_fill["fill-color"]),"fill-outline-color":new bt(Le.paint_fill["fill-outline-color"]),"fill-translate":new mt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new mt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new xl(Le.paint_fill["fill-pattern"])})},get layout(){return Dx=Dx||new qn({"fill-sort-key":new bt(Le.layout_fill["fill-sort-key"])})}};class XP extends Gr{constructor(r){super(r,ZP)}recalculate(r,c){super.recalculate(r,c);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Bg(r)}queryRadius(){return Bf(this.paint.get("fill-translate"))}queryIntersectsFeature(r,c,d,m,v,x,T){return gx(Nf(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,T),m)}isTileClipped(){return!0}}const YP=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),KP=kn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:JP}=YP;var Ea={},QP=C,Ox=Mc;function Mc(a,r,c,d,m){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=m,a.readFields(eI,this,r)}function eI(a,r,c){a==1?r.id=c.readVarint():a==2?function(d,m){for(var v=d.readVarint()+d.pos;d.pos<v;){var x=m._keys[d.readVarint()],T=m._values[d.readVarint()];m.properties[x]=T}}(c,r):a==3?r.type=c.readVarint():a==4&&(r._geometry=c.pos)}function tI(a){for(var r,c,d=0,m=0,v=a.length,x=v-1;m<v;x=m++)d+=((c=a[x]).x-(r=a[m]).x)*(r.y+c.y);return d}Mc.types=["Unknown","Point","LineString","Polygon"],Mc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,c=a.readVarint()+a.pos,d=1,m=0,v=0,x=0,T=[];a.pos<c;){if(m<=0){var A=a.readVarint();d=7&A,m=A>>3}if(m--,d===1||d===2)v+=a.readSVarint(),x+=a.readSVarint(),d===1&&(r&&T.push(r),r=[]),r.push(new QP(v,x));else{if(d!==7)throw new Error("unknown command "+d);r&&r.push(r[0].clone())}}return r&&T.push(r),T},Mc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,c=1,d=0,m=0,v=0,x=1/0,T=-1/0,A=1/0,I=-1/0;a.pos<r;){if(d<=0){var R=a.readVarint();c=7&R,d=R>>3}if(d--,c===1||c===2)(m+=a.readSVarint())<x&&(x=m),m>T&&(T=m),(v+=a.readSVarint())<A&&(A=v),v>I&&(I=v);else if(c!==7)throw new Error("unknown command "+c)}return[x,A,T,I]},Mc.prototype.toGeoJSON=function(a,r,c){var d,m,v=this.extent*Math.pow(2,c),x=this.extent*a,T=this.extent*r,A=this.loadGeometry(),I=Mc.types[this.type];function R(j){for(var $=0;$<j.length;$++){var Q=j[$];j[$]=[360*(Q.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+T)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(d=0;d<A.length;d++)O[d]=A[d][0];R(A=O);break;case 2:for(d=0;d<A.length;d++)R(A[d]);break;case 3:for(A=function(j){var $=j.length;if($<=1)return[j];for(var Q,oe,he=[],ve=0;ve<$;ve++){var pe=tI(j[ve]);pe!==0&&(oe===void 0&&(oe=pe<0),oe===pe<0?(Q&&he.push(Q),Q=[j[ve]]):Q.push(j[ve]))}return Q&&he.push(Q),he}(A),d=0;d<A.length;d++)for(m=0;m<A[d].length;m++)R(A[d][m])}A.length===1?A=A[0]:I="Multi"+I;var B={type:"Feature",geometry:{type:I,coordinates:A},properties:this.properties};return"id"in this&&(B.id=this.id),B};var nI=Ox,Fx=Bx;function Bx(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(iI,this,r),this.length=this._features.length}function iI(a,r,c){a===15?r.version=c.readVarint():a===1?r.name=c.readString():a===5?r.extent=c.readVarint():a===2?r._features.push(c.pos):a===3?r._keys.push(c.readString()):a===4&&r._values.push(function(d){for(var m=null,v=d.readVarint()+d.pos;d.pos<v;){var x=d.readVarint()>>3;m=x===1?d.readString():x===2?d.readFloat():x===3?d.readDouble():x===4?d.readVarint64():x===5?d.readVarint():x===6?d.readSVarint():x===7?d.readBoolean():null}return m}(c))}Bx.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new nI(this._pbf,r,this.extent,this._keys,this._values)};var rI=Fx;function sI(a,r,c){if(a===3){var d=new rI(c,c.readVarint()+c.pos);d.length&&(r[d.name]=d)}}Ea.VectorTile=function(a,r){this.layers=a.readFields(sI,{},r)},Ea.VectorTileFeature=Ox,Ea.VectorTileLayer=Fx;const oI=Ea.VectorTileFeature.types,Ng=Math.pow(2,13);function Eh(a,r,c,d,m,v,x,T){a.emplaceBack(r,c,2*Math.floor(d*Ng)+x,m*Ng*2,v*Ng*2,Math.round(T))}class Ug{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.centroidVertexArray=new $e,this.indexArray=new bi,this.programConfigurations=new Zs(r.layers,r.zoom),this.segments=new wn,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.features=[],this.hasPattern=Og("fill-extrusion",this.layers,c);for(const{feature:m,id:v,index:x,sourceLayerIndex:T}of r){const A=this.layers[0]._featureFilter.needGeometry,I=El(m,A);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),I,d))continue;const R={id:v,sourceLayerIndex:T,index:x,geometry:A?I.geometry:Tl(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Fg("fill-extrusion",this.layers,R,this.zoom,c)):this.addFeature(R,R.geometry,x,d,{}),c.featureIndex.insert(m,R.geometry,x,T,this.index,!0)}}addFeatures(r,c,d){for(const m of this.features){const{geometry:v}=m;this.addFeature(m,v,m.index,c,d)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,JP),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,KP.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,c,d,m,v){const x={x:0,y:0,vertexCount:0};for(const T of zg(c,500)){let A=0;for(const $ of T)A+=$.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of T){if($.length===0||lI($))continue;let Q=0;for(let oe=0;oe<$.length;oe++){const he=$[oe];if(oe>=1){const ve=$[oe-1];if(!aI(he,ve)){I.vertexLength+4>wn.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=he.sub(ve)._perp()._unit(),be=ve.dist(he);Q+be>32768&&(Q=0),Eh(this.layoutVertexArray,he.x,he.y,pe.x,pe.y,0,0,Q),Eh(this.layoutVertexArray,he.x,he.y,pe.x,pe.y,0,1,Q),x.x+=2*he.x,x.y+=2*he.y,x.vertexCount+=2,Q+=be,Eh(this.layoutVertexArray,ve.x,ve.y,pe.x,pe.y,0,0,Q),Eh(this.layoutVertexArray,ve.x,ve.y,pe.x,pe.y,0,1,Q),x.x+=2*ve.x,x.y+=2*ve.y,x.vertexCount+=2;const Se=I.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+A>wn.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),oI[r.type]!=="Polygon")continue;const R=[],O=[],B=I.vertexLength;for(const $ of T)if($.length!==0){$!==T[0]&&O.push(R.length/2);for(let Q=0;Q<$.length;Q++){const oe=$[Q];Eh(this.layoutVertexArray,oe.x,oe.y,0,0,1,1,0),x.x+=oe.x,x.y+=oe.y,x.vertexCount+=1,R.push(oe.x),R.push(oe.y)}}const j=kx(R,O);for(let $=0;$<j.length;$+=3)this.indexArray.emplaceBack(B+j[$],B+j[$+2],B+j[$+1]);I.primitiveLength+=j.length/3,I.vertexLength+=A}for(let T=0;T<x.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,v,m)}}function aI(a,r){return a.x===r.x&&(a.x<0||a.x>ei)||a.y===r.y&&(a.y<0||a.y>ei)}function lI(a){return a.every(r=>r.x<0)||a.every(r=>r.x>ei)||a.every(r=>r.y<0)||a.every(r=>r.y>ei)}let Nx;it("FillExtrusionBucket",Ug,{omit:["layers","features"]});var cI={get paint(){return Nx=Nx||new qn({"fill-extrusion-opacity":new mt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xl(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class uI extends Gr{constructor(r){super(r,cI)}createBucket(r){return new Ug(r)}queryRadius(){return Bf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,c,d,m,v,x,T,A){const I=Nf(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,T),R=this.paint.get("fill-extrusion-height").evaluate(c,d),O=this.paint.get("fill-extrusion-base").evaluate(c,d),B=function($,Q,oe,he){const ve=[];for(const pe of $){const be=[pe.x,pe.y,0,1];Uf(be,be,Q),ve.push(new k(be[0]/be[3],be[1]/be[3]))}return ve}(I,A),j=function($,Q,oe,he){const ve=[],pe=[],be=he[8]*Q,Se=he[9]*Q,Be=he[10]*Q,tt=he[11]*Q,ht=he[8]*oe,Qe=he[9]*oe,Je=he[10]*oe,We=he[11]*oe;for(const st of $){const Xe=[],je=[];for(const xt of st){const ft=xt.x,zt=xt.y,Tn=he[0]*ft+he[4]*zt+he[12],In=he[1]*ft+he[5]*zt+he[13],ci=he[2]*ft+he[6]*zt+he[14],Hr=he[3]*ft+he[7]*zt+he[15],rr=ci+Be,ti=Hr+tt,Ti=Tn+ht,Di=In+Qe,sr=ci+Je,or=Hr+We,ui=new k((Tn+be)/ti,(In+Se)/ti);ui.z=rr/ti,Xe.push(ui);const hi=new k(Ti/or,Di/or);hi.z=sr/or,je.push(hi)}ve.push(Xe),pe.push(je)}return[ve,pe]}(m,O,R,A);return function($,Q,oe){let he=1/0;gx(oe,Q)&&(he=Ux(oe,Q[0]));for(let ve=0;ve<Q.length;ve++){const pe=Q[ve],be=$[ve];for(let Se=0;Se<pe.length-1;Se++){const Be=pe[Se],tt=[Be,pe[Se+1],be[Se+1],be[Se],Be];mx(oe,tt)&&(he=Math.min(he,Ux(oe,tt)))}}return he!==1/0&&he}(j[0],j[1],B)}}function Sh(a,r){return a.x*r.x+a.y*r.y}function Ux(a,r){if(a.length===1){let c=0;const d=r[c++];let m;for(;!m||d.equals(m);)if(m=r[c++],!m)return 1/0;for(;c<r.length;c++){const v=r[c],x=a[0],T=m.sub(d),A=v.sub(d),I=x.sub(d),R=Sh(T,T),O=Sh(T,A),B=Sh(A,A),j=Sh(I,T),$=Sh(I,A),Q=R*B-O*O,oe=(B*j-O*$)/Q,he=(R*$-O*j)/Q,ve=d.z*(1-oe-he)+m.z*oe+v.z*he;if(isFinite(ve))return ve}return 1/0}{let c=1/0;for(const d of r)c=Math.min(c,d.z);return c}}const hI=kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:dI}=hI,fI=kn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:pI}=fI,mI=Ea.VectorTileFeature.types,gI=Math.cos(Math.PI/180*37.5),Vx=Math.pow(2,14)/.5;class Vg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new wt,this.layoutVertexArray2=new dt,this.indexArray=new bi,this.programConfigurations=new Zs(r.layers,r.zoom),this.segments=new wn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.hasPattern=Og("line",this.layers,c);const m=this.layers[0].layout.get("line-sort-key"),v=!m.isConstant(),x=[];for(const{feature:T,id:A,index:I,sourceLayerIndex:R}of r){const O=this.layers[0]._featureFilter.needGeometry,B=El(T,O);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),B,d))continue;const j=v?m.evaluate(B,{},d):void 0,$={id:A,properties:T.properties,type:T.type,sourceLayerIndex:R,index:I,geometry:O?B.geometry:Tl(T),patterns:{},sortKey:j};x.push($)}v&&x.sort((T,A)=>T.sortKey-A.sortKey);for(const T of x){const{geometry:A,index:I,sourceLayerIndex:R}=T;if(this.hasPattern){const O=Fg("line",this.layers,T,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(T,A,I,d,{});c.featureIndex.insert(r[I].feature,A,I,R,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}addFeatures(r,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,pI)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,dI),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,c,d,m,v){const x=this.layers[0].layout,T=x.get("line-join").evaluate(r,{}),A=x.get("line-cap"),I=x.get("line-miter-limit"),R=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of c)this.addLine(O,r,T,A,I,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,v,m)}addLine(r,c,d,m,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<r.length-1;he++)this.totalDistance+=r[he].dist(r[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=mI[c.type]==="Polygon";let A=r.length;for(;A>=2&&r[A-1].equals(r[A-2]);)A--;let I=0;for(;I<A-1&&r[I].equals(r[I+1]);)I++;if(A<(T?3:2))return;d==="bevel"&&(v=1.05);const R=this.overscaling<=16?15*ei/(512*this.overscaling):0,O=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let B,j,$,Q,oe;this.e1=this.e2=-1,T&&(B=r[A-2],oe=r[I].sub(B)._unit()._perp());for(let he=I;he<A;he++){if($=he===A-1?T?r[I+1]:void 0:r[he+1],$&&r[he].equals($))continue;oe&&(Q=oe),B&&(j=B),B=r[he],oe=$?$.sub(B)._unit()._perp():Q,Q=Q||oe;let ve=Q.add(oe);ve.x===0&&ve.y===0||ve._unit();const pe=Q.x*oe.x+Q.y*oe.y,be=ve.x*oe.x+ve.y*oe.y,Se=be!==0?1/be:1/0,Be=2*Math.sqrt(2-2*be),tt=be<gI&&j&&$,ht=Q.x*oe.y-Q.y*oe.x>0;if(tt&&he>I){const We=B.dist(j);if(We>2*R){const st=B.sub(B.sub(j)._mult(R/We)._round());this.updateDistance(j,st),this.addCurrentVertex(st,Q,0,0,O),j=st}}const Qe=j&&$;let Je=Qe?d:T?"butt":m;if(Qe&&Je==="round"&&(Se<x?Je="miter":Se<=2&&(Je="fakeround")),Je==="miter"&&Se>v&&(Je="bevel"),Je==="bevel"&&(Se>2&&(Je="flipbevel"),Se<v&&(Je="miter")),j&&this.updateDistance(j,B),Je==="miter")ve._mult(Se),this.addCurrentVertex(B,ve,0,0,O);else if(Je==="flipbevel"){if(Se>100)ve=oe.mult(-1);else{const We=Se*Q.add(oe).mag()/Q.sub(oe).mag();ve._perp()._mult(We*(ht?-1:1))}this.addCurrentVertex(B,ve,0,0,O),this.addCurrentVertex(B,ve.mult(-1),0,0,O)}else if(Je==="bevel"||Je==="fakeround"){const We=-Math.sqrt(Se*Se-1),st=ht?We:0,Xe=ht?0:We;if(j&&this.addCurrentVertex(B,Q,st,Xe,O),Je==="fakeround"){const je=Math.round(180*Be/Math.PI/20);for(let xt=1;xt<je;xt++){let ft=xt/je;if(ft!==.5){const Tn=ft-.5;ft+=ft*Tn*(ft-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Tn*Tn+(.848013+pe*(.215638*pe-1.06021)))}const zt=oe.sub(Q)._mult(ft)._add(Q)._unit()._mult(ht?-1:1);this.addHalfVertex(B,zt.x,zt.y,!1,ht,0,O)}}$&&this.addCurrentVertex(B,oe,-st,-Xe,O)}else if(Je==="butt")this.addCurrentVertex(B,ve,0,0,O);else if(Je==="square"){const We=j?1:-1;this.addCurrentVertex(B,ve,We,We,O)}else Je==="round"&&(j&&(this.addCurrentVertex(B,Q,0,0,O),this.addCurrentVertex(B,Q,1,1,O,!0)),$&&(this.addCurrentVertex(B,oe,-1,-1,O,!0),this.addCurrentVertex(B,oe,0,0,O)));if(tt&&he<A-1){const We=B.dist($);if(We>2*R){const st=B.add($.sub(B)._mult(R/We)._round());this.updateDistance(B,st),this.addCurrentVertex(st,oe,0,0,O),B=st}}}}addCurrentVertex(r,c,d,m,v,x=!1){const T=c.y*m-c.x,A=-c.y-c.x*m;this.addHalfVertex(r,c.x+c.y*d,c.y-c.x*d,x,!1,d,v),this.addHalfVertex(r,T,A,x,!0,-m,v),this.distance>Vx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,c,d,m,v,x))}addHalfVertex({x:r,y:c},d,m,v,x,T,A){const I=.5*(this.lineClips?this.scaledDistance*(Vx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(v?1:0),(c<<1)+(x?1:0),Math.round(63*d)+128,Math.round(63*m)+128,1+(T===0?0:T<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),A.primitiveLength++),x?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,c){this.distance+=r.dist(c),this.updateScaledDistance()}}let jx,Gx;it("LineBucket",Vg,{omit:["layers","patternFeatures"]});var $x={get paint(){return Gx=Gx||new qn({"line-opacity":new bt(Le.paint_line["line-opacity"]),"line-color":new bt(Le.paint_line["line-color"]),"line-translate":new mt(Le.paint_line["line-translate"]),"line-translate-anchor":new mt(Le.paint_line["line-translate-anchor"]),"line-width":new bt(Le.paint_line["line-width"]),"line-gap-width":new bt(Le.paint_line["line-gap-width"]),"line-offset":new bt(Le.paint_line["line-offset"]),"line-blur":new bt(Le.paint_line["line-blur"]),"line-dasharray":new lh(Le.paint_line["line-dasharray"]),"line-pattern":new xl(Le.paint_line["line-pattern"]),"line-gradient":new ch(Le.paint_line["line-gradient"])})},get layout(){return jx=jx||new qn({"line-cap":new mt(Le.layout_line["line-cap"]),"line-join":new bt(Le.layout_line["line-join"]),"line-miter-limit":new mt(Le.layout_line["line-miter-limit"]),"line-round-limit":new mt(Le.layout_line["line-round-limit"]),"line-sort-key":new bt(Le.layout_line["line-sort-key"])})}};class _I extends bt{possiblyEvaluate(r,c){return c=new bn(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(r,c)}evaluate(r,c,d,m){return c=Oe({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(r,c,d,m)}}let Hf;class yI extends Gr{constructor(r){super(r,$x),this.gradientVersion=0,Hf||(Hf=new _I($x.paint.properties["line-width"].specification),Hf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof co,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,c){super.recalculate(r,c),this.paint._values["line-floorwidth"]=Hf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Vg(r)}queryRadius(r){const c=r,d=Hx(_h("line-width",this,c),_h("line-gap-width",this,c)),m=_h("line-offset",this,c);return d/2+Math.abs(m)+Bf(this.paint.get("line-translate"))}queryIntersectsFeature(r,c,d,m,v,x,T){const A=Nf(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,T),I=T/2*Hx(this.paint.get("line-width").evaluate(c,d),this.paint.get("line-gap-width").evaluate(c,d)),R=this.paint.get("line-offset").evaluate(c,d);return R&&(m=function(O,B){const j=[];for(let $=0;$<O.length;$++){const Q=O[$],oe=[];for(let he=0;he<Q.length;he++){const ve=Q[he-1],pe=Q[he],be=Q[he+1],Se=he===0?new k(0,0):pe.sub(ve)._unit()._perp(),Be=he===Q.length-1?new k(0,0):be.sub(pe)._unit()._perp(),tt=Se._add(Be)._unit(),ht=tt.x*Be.x+tt.y*Be.y;ht!==0&&tt._mult(1/ht),oe.push(tt._mult(B)._add(pe))}j.push(oe)}return j}(m,R*T)),function(O,B,j){for(let $=0;$<B.length;$++){const Q=B[$];if(O.length>=3){for(let oe=0;oe<Q.length;oe++)if(Pc(O,Q[oe]))return!0}if(EP(O,Q,j))return!0}return!1}(A,m,I)}isTileClipped(){return!0}}function Hx(a,r){return r>0?r+2*a:a}const vI=kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xI=kn([{name:"a_projected_pos",components:3,type:"Float32"}],4);kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bI=kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);kn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wx=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wI=kn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function TI(a,r,c){return a.sections.forEach(d=>{d.text=function(m,v,x){const T=v.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?m=m.toLocaleUpperCase():T==="lowercase"&&(m=m.toLocaleLowerCase()),Er.applyArabicShaping&&(m=Er.applyArabicShaping(m)),m}(d.text,r,c)}),a}kn([{name:"triangle",components:3,type:"Uint16"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),kn([{type:"Float32",name:"offsetX"}]),kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),kn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ah={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var li=24,qx=cn,Zx=function(a,r,c,d,m){var v,x,T=8*m-d-1,A=(1<<T)-1,I=A>>1,R=-7,O=m-1,B=-1,j=a[r+O];for(O+=B,v=j&(1<<-R)-1,j>>=-R,R+=T;R>0;v=256*v+a[r+O],O+=B,R-=8);for(x=v&(1<<-R)-1,v>>=-R,R+=d;R>0;x=256*x+a[r+O],O+=B,R-=8);if(v===0)v=1-I;else{if(v===A)return x?NaN:1/0*(j?-1:1);x+=Math.pow(2,d),v-=I}return(j?-1:1)*x*Math.pow(2,v-d)},Xx=function(a,r,c,d,m,v){var x,T,A,I=8*v-m-1,R=(1<<I)-1,O=R>>1,B=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=0,$=1,Q=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,x=R):(x=Math.floor(Math.log(r)/Math.LN2),r*(A=Math.pow(2,-x))<1&&(x--,A*=2),(r+=x+O>=1?B/A:B*Math.pow(2,1-O))*A>=2&&(x++,A/=2),x+O>=R?(T=0,x=R):x+O>=1?(T=(r*A-1)*Math.pow(2,m),x+=O):(T=r*Math.pow(2,O-1)*Math.pow(2,m),x=0));m>=8;a[c+j]=255&T,j+=$,T/=256,m-=8);for(x=x<<m|T,I+=m;I>0;a[c+j]=255&x,j+=$,x/=256,I-=8);a[c+j-$]|=128*Q};function cn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}cn.Varint=0,cn.Fixed64=1,cn.Bytes=2,cn.Fixed32=5;var jg=4294967296,Yx=1/jg,Kx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function $o(a){return a.type===cn.Bytes?a.readVarint()+a.pos:a.pos+1}function Lc(a,r,c){return c?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function Jx(a,r,c){var d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));c.realloc(d);for(var m=c.pos-1;m>=a;m--)c.buf[m+d]=c.buf[m]}function EI(a,r){for(var c=0;c<a.length;c++)r.writeVarint(a[c])}function SI(a,r){for(var c=0;c<a.length;c++)r.writeSVarint(a[c])}function AI(a,r){for(var c=0;c<a.length;c++)r.writeFloat(a[c])}function PI(a,r){for(var c=0;c<a.length;c++)r.writeDouble(a[c])}function II(a,r){for(var c=0;c<a.length;c++)r.writeBoolean(a[c])}function CI(a,r){for(var c=0;c<a.length;c++)r.writeFixed32(a[c])}function MI(a,r){for(var c=0;c<a.length;c++)r.writeSFixed32(a[c])}function LI(a,r){for(var c=0;c<a.length;c++)r.writeFixed64(a[c])}function kI(a,r){for(var c=0;c<a.length;c++)r.writeSFixed64(a[c])}function Wf(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function kc(a,r,c){a[c]=r,a[c+1]=r>>>8,a[c+2]=r>>>16,a[c+3]=r>>>24}function Qx(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}cn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),m=d>>3,v=this.pos;this.type=7&d,a(m,r,this),this.pos===v&&this.skip(d)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Wf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Qx(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Wf(this.buf,this.pos)+Wf(this.buf,this.pos+4)*jg;return this.pos+=8,a},readSFixed64:function(){var a=Wf(this.buf,this.pos)+Qx(this.buf,this.pos+4)*jg;return this.pos+=8,a},readFloat:function(){var a=Zx(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Zx(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,c,d=this.buf;return r=127&(c=d[this.pos++]),c<128?r:(r|=(127&(c=d[this.pos++]))<<7,c<128?r:(r|=(127&(c=d[this.pos++]))<<14,c<128?r:(r|=(127&(c=d[this.pos++]))<<21,c<128?r:function(m,v,x){var T,A,I=x.buf;if(T=(112&(A=I[x.pos++]))>>4,A<128||(T|=(127&(A=I[x.pos++]))<<3,A<128)||(T|=(127&(A=I[x.pos++]))<<10,A<128)||(T|=(127&(A=I[x.pos++]))<<17,A<128)||(T|=(127&(A=I[x.pos++]))<<24,A<128)||(T|=(1&(A=I[x.pos++]))<<31,A<128))return Lc(m,T,v);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(c=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&Kx?function(c,d,m){return Kx.decode(c.subarray(d,m))}(this.buf,r,a):function(c,d,m){for(var v="",x=d;x<m;){var T,A,I,R=c[x],O=null,B=R>239?4:R>223?3:R>191?2:1;if(x+B>m)break;B===1?R<128&&(O=R):B===2?(192&(T=c[x+1]))==128&&(O=(31&R)<<6|63&T)<=127&&(O=null):B===3?(A=c[x+2],(192&(T=c[x+1]))==128&&(192&A)==128&&((O=(15&R)<<12|(63&T)<<6|63&A)<=2047||O>=55296&&O<=57343)&&(O=null)):B===4&&(A=c[x+2],I=c[x+3],(192&(T=c[x+1]))==128&&(192&A)==128&&(192&I)==128&&((O=(15&R)<<18|(63&T)<<12|(63&A)<<6|63&I)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,B=1):O>65535&&(O-=65536,v+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),v+=String.fromCharCode(O),x+=B}return v}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==cn.Bytes)return a.push(this.readVarint(r));var c=$o(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==cn.Bytes)return a.push(this.readSVarint());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==cn.Bytes)return a.push(this.readBoolean());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==cn.Bytes)return a.push(this.readFloat());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==cn.Bytes)return a.push(this.readDouble());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==cn.Bytes)return a.push(this.readFixed32());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==cn.Bytes)return a.push(this.readSFixed32());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==cn.Bytes)return a.push(this.readFixed64());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==cn.Bytes)return a.push(this.readSFixed64());var r=$o(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===cn.Varint)for(;this.buf[this.pos++]>127;);else if(r===cn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===cn.Fixed32)this.pos+=4;else{if(r!==cn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),kc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),kc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),kc(this.buf,-1&a,this.pos),kc(this.buf,Math.floor(a*Yx),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),kc(this.buf,-1&a,this.pos),kc(this.buf,Math.floor(a*Yx),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,c){var d,m;if(r>=0?(d=r%4294967296|0,m=r/4294967296|0):(m=~(-r/4294967296),4294967295^(d=~(-r%4294967296))?d=d+1|0:(d=0,m=m+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(v,x,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)}(d,0,c),function(v,x){var T=(7&v)<<4;x.buf[x.pos++]|=T|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(m,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(d,m,v){for(var x,T,A=0;A<m.length;A++){if((x=m.charCodeAt(A))>55295&&x<57344){if(!T){x>56319||A+1===m.length?(d[v++]=239,d[v++]=191,d[v++]=189):T=x;continue}if(x<56320){d[v++]=239,d[v++]=191,d[v++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(d[v++]=239,d[v++]=191,d[v++]=189,T=null);x<128?d[v++]=x:(x<2048?d[v++]=x>>6|192:(x<65536?d[v++]=x>>12|224:(d[v++]=x>>18|240,d[v++]=x>>12&63|128),d[v++]=x>>6&63|128),d[v++]=63&x|128)}return v}(this.buf,a,this.pos);var c=this.pos-r;c>=128&&Jx(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),Xx(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Xx(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var c=0;c<r;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,r){this.pos++;var c=this.pos;a(r,this);var d=this.pos-c;d>=128&&Jx(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,r,c){this.writeTag(a,cn.Bytes),this.writeRawMessage(r,c)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,EI,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,SI,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,II,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,AI,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,PI,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,CI,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,MI,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,LI,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,kI,r)},writeBytesField:function(a,r){this.writeTag(a,cn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,cn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,cn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,cn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,cn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,cn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,cn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,cn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,cn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,cn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};var Gg=w(qx);const $g=3;function RI(a,r,c){a===1&&c.readMessage(DI,r)}function DI(a,r,c){if(a===3){const{id:d,bitmap:m,width:v,height:x,left:T,top:A,advance:I}=c.readMessage(zI,{});r.push({id:d,bitmap:new vh({width:v+2*$g,height:x+2*$g},m),metrics:{width:v,height:x,left:T,top:A,advance:I}})}}function zI(a,r,c){a===1?r.id=c.readVarint():a===2?r.bitmap=c.readBytes():a===3?r.width=c.readVarint():a===4?r.height=c.readVarint():a===5?r.left=c.readSVarint():a===6?r.top=c.readSVarint():a===7&&(r.advance=c.readVarint())}const eb=$g;function tb(a){let r=0,c=0;for(const x of a)r+=x.w*x.h,c=Math.max(c,x.w);a.sort((x,T)=>T.h-x.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),c),h:1/0}];let m=0,v=0;for(const x of a)for(let T=d.length-1;T>=0;T--){const A=d[T];if(!(x.w>A.w||x.h>A.h)){if(x.x=A.x,x.y=A.y,v=Math.max(v,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===A.w&&x.h===A.h){const I=d.pop();T<d.length&&(d[T]=I)}else x.h===A.h?(A.x+=x.w,A.w-=x.w):x.w===A.w?(A.y+=x.h,A.h-=x.h):(d.push({x:A.x+x.w,y:A.y,w:A.w-x.w,h:x.h}),A.y+=x.h,A.h-=x.h);break}}return{w:m,h:v,fill:r/(m*v)||0}}const Ar=1;class Hg{constructor(r,{pixelRatio:c,version:d,stretchX:m,stretchY:v,content:x}){this.paddedRect=r,this.pixelRatio=c,this.stretchX=m,this.stretchY=v,this.content=x,this.version=d}get tl(){return[this.paddedRect.x+Ar,this.paddedRect.y+Ar]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ar,this.paddedRect.y+this.paddedRect.h-Ar]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ar)/this.pixelRatio,(this.paddedRect.h-2*Ar)/this.pixelRatio]}}class nb{constructor(r,c){const d={},m={};this.haveRenderCallbacks=[];const v=[];this.addImages(r,d,v),this.addImages(c,m,v);const{w:x,h:T}=tb(v),A=new ns({width:x||1,height:T||1});for(const I in r){const R=r[I],O=d[I].paddedRect;ns.copy(R.data,A,{x:0,y:0},{x:O.x+Ar,y:O.y+Ar},R.data)}for(const I in c){const R=c[I],O=m[I].paddedRect,B=O.x+Ar,j=O.y+Ar,$=R.data.width,Q=R.data.height;ns.copy(R.data,A,{x:0,y:0},{x:B,y:j},R.data),ns.copy(R.data,A,{x:0,y:Q-1},{x:B,y:j-1},{width:$,height:1}),ns.copy(R.data,A,{x:0,y:0},{x:B,y:j+Q},{width:$,height:1}),ns.copy(R.data,A,{x:$-1,y:0},{x:B-1,y:j},{width:1,height:Q}),ns.copy(R.data,A,{x:0,y:0},{x:B+$,y:j},{width:1,height:Q})}this.image=A,this.iconPositions=d,this.patternPositions=m}addImages(r,c,d){for(const m in r){const v=r[m],x={x:0,y:0,w:v.data.width+2*Ar,h:v.data.height+2*Ar};d.push(x),c[m]=new Hg(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(r,c){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in r.updatedImages)this.patchUpdatedImage(this.iconPositions[d],r.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],r.getImage(d),c)}patchUpdatedImage(r,c,d){if(!r||!c||r.version===c.version)return;r.version=c.version;const[m,v]=r.tl;d.update(c.data,void 0,{x:m,y:v})}}var Sa;it("ImagePosition",Hg),it("ImageAtlas",nb),l.ai=void 0,(Sa=l.ai||(l.ai={}))[Sa.none=0]="none",Sa[Sa.horizontal=1]="horizontal",Sa[Sa.vertical=2]="vertical",Sa[Sa.horizontalOnly=3]="horizontalOnly";const Ph=-17;class Ih{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,c){const d=new Ih;return d.scale=r||1,d.fontStack=c,d}static forImage(r){const c=new Ih;return c.imageName=r,c}}class Rc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,c){const d=new Rc;for(let m=0;m<r.sections.length;m++){const v=r.sections[m];v.image?d.addImageSection(v):d.addTextSection(v,c)}return d}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let c="";for(let d=0;d<r.length;d++){const m=r.charCodeAt(d+1)||null,v=r.charCodeAt(d-1)||null;c+=m&&Pf(m)&&!Ah[r[d+1]]||v&&Pf(v)&&!Ah[r[d-1]]||!Ah[r[d]]?r[d]:Ah[r[d]]}return c}(this.text)}trim(){let r=0;for(let d=0;d<this.text.length&&Zf[this.text.charCodeAt(d)];d++)r++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=r&&Zf[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(r,c),this.sectionIndex=this.sectionIndex.slice(r,c)}substring(r,c){const d=new Rc;return d.text=this.text.substring(r,c),d.sectionIndex=this.sectionIndex.slice(r,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,c)=>Math.max(r,this.sections[c].scale),0)}addTextSection(r,c){this.text+=r.text,this.sections.push(Ih.forText(r.scale,r.fontStack||c));const d=this.sections.length-1;for(let m=0;m<r.text.length;++m)this.sectionIndex.push(d)}addImageSection(r){const c=r.image?r.image.name:"";if(c.length===0)return void yt("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Ih.forImage(c)),this.sectionIndex.push(this.sections.length-1)):yt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qf(a,r,c,d,m,v,x,T,A,I,R,O,B,j,$,Q){const oe=Rc.fromFeature(a,m);let he;O===l.ai.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:pe}=Er;if(ve&&oe.sections.length===1){he=[];const Be=ve(oe.toString(),Wg(oe,I,v,r,d,j,$));for(const tt of Be){const ht=new Rc;ht.text=tt,ht.sections=oe.sections;for(let Qe=0;Qe<tt.length;Qe++)ht.sectionIndex.push(0);he.push(ht)}}else if(pe){he=[];const Be=pe(oe.text,oe.sectionIndex,Wg(oe,I,v,r,d,j,$));for(const tt of Be){const ht=new Rc;ht.text=tt[0],ht.sectionIndex=tt[1],ht.sections=oe.sections,he.push(ht)}}else he=function(Be,tt){const ht=[],Qe=Be.text;let Je=0;for(const We of tt)ht.push(Be.substring(Je,We)),Je=We;return Je<Qe.length&&ht.push(Be.substring(Je,Qe.length)),ht}(oe,Wg(oe,I,v,r,d,j,$));const be=[],Se={positionedLines:be,text:oe.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Be,tt,ht,Qe,Je,We,st,Xe,je,xt,ft,zt){let Tn=0,In=Ph,ci=0,Hr=0;const rr=Xe==="right"?1:Xe==="left"?0:.5;let ti=0;for(const ui of Je){ui.trim();const hi=ui.getMaxScale(),ji=(hi-1)*li,ar={positionedGlyphs:[],lineOffset:0};Be.positionedLines[ti]=ar;const Gi=ar.positionedGlyphs;let Pr=0;if(!ui.length()){In+=We,++ti;continue}for(let di=0;di<ui.length();di++){const jt=ui.getSection(di),$i=ui.getSectionIndex(di),zi=ui.getCharCode(di);let fi=0,Cs=null,Xs=null,Ys=null,Ho=li;const Ms=!(je===l.ai.horizontal||!ft&&!eh(zi)||ft&&(Zf[zi]||(Ti=zi,et.Arabic(Ti)||et["Arabic Supplement"](Ti)||et["Arabic Extended-A"](Ti)||et["Arabic Presentation Forms-A"](Ti)||et["Arabic Presentation Forms-B"](Ti))));if(jt.imageName){const rs=Qe[jt.imageName];if(!rs)continue;Ys=jt.imageName,Be.iconsInText=Be.iconsInText||!0,Xs=rs.paddedRect;const Cr=rs.displaySize;jt.scale=jt.scale*li/zt,Cs={width:Cr[0],height:Cr[1],left:Ar,top:-eb,advance:Ms?Cr[1]:Cr[0]},fi=ji+(li-Cr[1]*jt.scale),Ho=Cs.advance;const Wo=Ms?Cr[0]*jt.scale-li*hi:Cr[1]*jt.scale-li*hi;Wo>0&&Wo>Pr&&(Pr=Wo)}else{const rs=ht[jt.fontStack],Cr=rs&&rs[zi];if(Cr&&Cr.rect)Xs=Cr.rect,Cs=Cr.metrics;else{const Wo=tt[jt.fontStack],Rh=Wo&&Wo[zi];if(!Rh)continue;Cs=Rh.metrics}fi=(hi-jt.scale)*li}Ms?(Be.verticalizable=!0,Gi.push({glyph:zi,imageName:Ys,x:Tn,y:In+fi,vertical:Ms,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:$i,metrics:Cs,rect:Xs}),Tn+=Ho*jt.scale+xt):(Gi.push({glyph:zi,imageName:Ys,x:Tn,y:In+fi,vertical:Ms,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:$i,metrics:Cs,rect:Xs}),Tn+=Cs.advance*jt.scale+xt)}Gi.length!==0&&(ci=Math.max(Tn-xt,ci),BI(Gi,0,Gi.length-1,rr,Pr)),Tn=0;const Ir=We*hi+Pr;ar.lineOffset=Math.max(Pr,ji),In+=Ir,Hr=Math.max(Ir,Hr),++ti}var Ti;const Di=In-Ph,{horizontalAlign:sr,verticalAlign:or}=qg(st);(function(ui,hi,ji,ar,Gi,Pr,Ir,di,jt){const $i=(hi-ji)*Gi;let zi=0;zi=Pr!==Ir?-di*ar-Ph:(-ar*jt+.5)*Ir;for(const fi of ui)for(const Cs of fi.positionedGlyphs)Cs.x+=$i,Cs.y+=zi})(Be.positionedLines,rr,sr,or,ci,Hr,We,Di,Je.length),Be.top+=-or*Di,Be.bottom=Be.top+Di,Be.left+=-sr*ci,Be.right=Be.left+ci}(Se,r,c,d,he,x,T,A,O,I,B,Q),!function(Be){for(const tt of Be)if(tt.positionedGlyphs.length!==0)return!1;return!0}(be)&&Se}const Zf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},OI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ib(a,r,c,d,m,v){if(r.imageName){const x=d[r.imageName];return x?x.displaySize[0]*r.scale*li/v+m:0}{const x=c[r.fontStack],T=x&&x[a];return T?T.metrics.advance*r.scale+m:0}}function rb(a,r,c,d){const m=Math.pow(a-r,2);return d?a<r?m/2:2*m:m+Math.abs(c)*c}function FI(a,r,c){let d=0;return a===10&&(d-=1e4),c&&(d+=150),a!==40&&a!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function sb(a,r,c,d,m,v){let x=null,T=rb(r,c,m,v);for(const A of d){const I=rb(r-A.x,c,m,v)+A.badness;I<=T&&(x=A,T=I)}return{index:a,x:r,priorBreak:x,badness:T}}function ob(a){return a?ob(a.priorBreak).concat(a.index):[]}function Wg(a,r,c,d,m,v,x){if(v!=="point")return[];if(!a)return[];const T=[],A=function(B,j,$,Q,oe,he){let ve=0;for(let pe=0;pe<B.length();pe++){const be=B.getSection(pe);ve+=ib(B.getCharCode(pe),be,Q,oe,j,he)}return ve/Math.max(1,Math.ceil(ve/$))}(a,r,c,d,m,x),I=a.text.indexOf("​")>=0;let R=0;for(let B=0;B<a.length();B++){const j=a.getSection(B),$=a.getCharCode(B);if(Zf[$]||(R+=ib($,j,d,m,r,x)),B<a.length()-1){const Q=!((O=$)<11904||!(et["Bopomofo Extended"](O)||et.Bopomofo(O)||et["CJK Compatibility Forms"](O)||et["CJK Compatibility Ideographs"](O)||et["CJK Compatibility"](O)||et["CJK Radicals Supplement"](O)||et["CJK Strokes"](O)||et["CJK Symbols and Punctuation"](O)||et["CJK Unified Ideographs Extension A"](O)||et["CJK Unified Ideographs"](O)||et["Enclosed CJK Letters and Months"](O)||et["Halfwidth and Fullwidth Forms"](O)||et.Hiragana(O)||et["Ideographic Description Characters"](O)||et["Kangxi Radicals"](O)||et["Katakana Phonetic Extensions"](O)||et.Katakana(O)||et["Vertical Forms"](O)||et["Yi Radicals"](O)||et["Yi Syllables"](O)));(OI[$]||Q||j.imageName)&&T.push(sb(B+1,R,A,T,FI($,a.getCharCode(B+1),Q&&I),!1))}}var O;return ob(sb(a.length(),R,A,T,0,!0))}function qg(a){let r=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:r,verticalAlign:c}}function BI(a,r,c,d,m){if(!d&&!m)return;const v=a[c],x=(a[c].x+v.metrics.advance*v.scale)*d;for(let T=r;T<=c;T++)a[T].x-=x,a[T].y+=m}function NI(a,r,c){const{horizontalAlign:d,verticalAlign:m}=qg(c),v=r[0]-a.displaySize[0]*d,x=r[1]-a.displaySize[1]*m;return{image:a,top:x,bottom:x+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function ab(a,r,c,d,m,v){const x=a.image;let T;if(x.content){const oe=x.content,he=x.pixelRatio||1;T=[oe[0]/he,oe[1]/he,x.displaySize[0]-oe[2]/he,x.displaySize[1]-oe[3]/he]}const A=r.left*v,I=r.right*v;let R,O,B,j;c==="width"||c==="both"?(j=m[0]+A-d[3],O=m[0]+I+d[1]):(j=m[0]+(A+I-x.displaySize[0])/2,O=j+x.displaySize[0]);const $=r.top*v,Q=r.bottom*v;return c==="height"||c==="both"?(R=m[1]+$-d[0],B=m[1]+Q+d[2]):(R=m[1]+($+Q-x.displaySize[1])/2,B=R+x.displaySize[1]),{image:x,top:R,right:O,bottom:B,left:j,collisionPadding:T}}const Ch=255,go=128,Aa=Ch*go;function lb(a,r){const{expression:c}=r;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new bn(a+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:m}=c;let v=0;for(;v<d.length&&d[v]<=a;)v++;v=Math.max(0,v-1);let x=v;for(;x<d.length&&d[x]<a+1;)x++;x=Math.min(d.length-1,x);const T=d[v],A=d[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:m}:{kind:"camera",minZoom:T,maxZoom:A,minSize:c.evaluate(new bn(T)),maxSize:c.evaluate(new bn(A)),interpolationType:m}}}function Zg(a,r,c){let d="never";const m=a.get(r);return m?d=m:a.get(c)&&(d="always"),d}const UI=Ea.VectorTileFeature.types,VI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xf(a,r,c,d,m,v,x,T,A,I,R,O,B){const j=T?Math.min(Aa,Math.round(T[0])):0,$=T?Math.min(Aa,Math.round(T[1])):0;a.emplaceBack(r,c,Math.round(32*d),Math.round(32*m),v,x,(j<<1)+(A?1:0),$,16*I,16*R,256*O,256*B)}function Xg(a,r,c){a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c)}function jI(a){for(const r of a.sections)if(bg(r.text))return!0;return!1}class Yg{constructor(r){this.layoutVertexArray=new Bt,this.indexArray=new bi,this.programConfigurations=r,this.segments=new wn,this.dynamicLayoutVertexArray=new Lt,this.opacityVertexArray=new Vt,this.hasVisibleVertices=!1,this.placedSymbolArray=new ge}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,c,d,m){this.isEmpty()||(d&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,vI.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,xI.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,VI,!0),this.opacityVertexBuffer.itemSize=1),(d||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}it("SymbolBuffers",Yg);class Kg{constructor(r,c,d){this.layoutVertexArray=new r,this.layoutAttributes=c,this.indexArray=new d,this.segments=new wn,this.collisionVertexArray=new mn}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,bI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}it("CollisionBuffers",Kg);class Dc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ig([]),this.placementViewportMatrix=Ig([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lb(this.zoom,c["text-size"]),this.iconSizeData=lb(this.zoom,c["icon-size"]);const d=this.layers[0].layout,m=d.get("symbol-sort-key"),v=d.get("symbol-z-order");this.canOverlap=Zg(d,"text-overlap","text-allow-overlap")!=="never"||Zg(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(x=>l.ai[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID}createArrays(){this.text=new Yg(new Zs(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Yg(new Zs(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new ye,this.lineVertexArray=new Ae,this.symbolInstances=new le,this.textAnchorOffsets=new Fe}calculateGlyphDependencies(r,c,d,m,v){for(let x=0;x<r.length;x++)if(c[r.charCodeAt(x)]=!0,(d||m)&&v){const T=Ah[r.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(r,c,d){const m=this.layers[0],v=m.layout,x=v.get("text-font"),T=v.get("text-field"),A=v.get("icon-image"),I=(T.value.kind!=="constant"||T.value.value instanceof xn&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),R=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!I&&!R)return;const B=c.iconDependencies,j=c.glyphDependencies,$=c.availableImages,Q=new bn(this.zoom);for(const{feature:oe,id:he,index:ve,sourceLayerIndex:pe}of r){const be=m._featureFilter.needGeometry,Se=El(oe,be);if(!m._featureFilter.filter(Q,Se,d))continue;let Be,tt;if(be||(Se.geometry=Tl(oe)),I){const Qe=m.getValueAndResolveTokens("text-field",Se,d,$),Je=xn.factory(Qe);jI(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||oh()==="unavailable"||this.hasRTLText&&Er.isParsed())&&(Be=TI(Je,m,Se))}if(R){const Qe=m.getValueAndResolveTokens("icon-image",Se,d,$);tt=Qe instanceof ln?Qe:ln.fromString(Qe)}if(!Be&&!tt)continue;const ht=this.sortFeaturesByKey?O.evaluate(Se,{},d):void 0;if(this.features.push({id:he,text:Be,icon:tt,index:ve,sourceLayerIndex:pe,geometry:Se.geometry,properties:oe.properties,type:UI[oe.type],sortKey:ht}),tt&&(B[tt.name]=!0),Be){const Qe=x.evaluate(Se,{},d).join(","),Je=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(const We of Be.sections)if(We.image)B[We.image.name]=!0;else{const st=Ju(Be.toString()),Xe=We.fontStack||Qe,je=j[Xe]=j[Xe]||{};this.calculateGlyphDependencies(We.text,je,Je,this.allowVerticalPlacement,st)}}}v.get("symbol-placement")==="line"&&(this.features=function(oe){const he={},ve={},pe=[];let be=0;function Se(Qe){pe.push(oe[Qe]),be++}function Be(Qe,Je,We){const st=ve[Qe];return delete ve[Qe],ve[Je]=st,pe[st].geometry[0].pop(),pe[st].geometry[0]=pe[st].geometry[0].concat(We[0]),st}function tt(Qe,Je,We){const st=he[Je];return delete he[Je],he[Qe]=st,pe[st].geometry[0].shift(),pe[st].geometry[0]=We[0].concat(pe[st].geometry[0]),st}function ht(Qe,Je,We){const st=We?Je[0][Je[0].length-1]:Je[0][0];return`${Qe}:${st.x}:${st.y}`}for(let Qe=0;Qe<oe.length;Qe++){const Je=oe[Qe],We=Je.geometry,st=Je.text?Je.text.toString():null;if(!st){Se(Qe);continue}const Xe=ht(st,We),je=ht(st,We,!0);if(Xe in ve&&je in he&&ve[Xe]!==he[je]){const xt=tt(Xe,je,We),ft=Be(Xe,je,pe[xt].geometry);delete he[Xe],delete ve[je],ve[ht(st,pe[ft].geometry,!0)]=ft,pe[xt].geometry=null}else Xe in ve?Be(Xe,je,We):je in he?tt(Xe,je,We):(Se(Qe),he[Xe]=be-1,ve[je]=be-1)}return pe.filter(Qe=>Qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,he)=>oe.sortKey-he.sortKey)}update(r,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(r,c,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,c){const d=this.lineVertexArray.length;if(r.segment!==void 0){let m=r.dist(c[r.segment+1]),v=r.dist(c[r.segment]);const x={};for(let T=r.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:m},T<c.length-1&&(m+=c[T+1].dist(c[T]));for(let T=r.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:v},T>0&&(v+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const A=x[T];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(r,c,d,m,v,x,T,A,I,R,O,B){const j=r.indexArray,$=r.layoutVertexArray,Q=r.segments.prepareSegment(4*c.length,$,j,this.canOverlap?x.sortKey:void 0),oe=this.glyphOffsetArray.length,he=Q.vertexLength,ve=this.allowVerticalPlacement&&T===l.ai.vertical?Math.PI/2:0,pe=x.text&&x.text.sections;for(let be=0;be<c.length;be++){const{tl:Se,tr:Be,bl:tt,br:ht,tex:Qe,pixelOffsetTL:Je,pixelOffsetBR:We,minFontScaleX:st,minFontScaleY:Xe,glyphOffset:je,isSDF:xt,sectionIndex:ft}=c[be],zt=Q.vertexLength,Tn=je[1];Xf($,A.x,A.y,Se.x,Tn+Se.y,Qe.x,Qe.y,d,xt,Je.x,Je.y,st,Xe),Xf($,A.x,A.y,Be.x,Tn+Be.y,Qe.x+Qe.w,Qe.y,d,xt,We.x,Je.y,st,Xe),Xf($,A.x,A.y,tt.x,Tn+tt.y,Qe.x,Qe.y+Qe.h,d,xt,Je.x,We.y,st,Xe),Xf($,A.x,A.y,ht.x,Tn+ht.y,Qe.x+Qe.w,Qe.y+Qe.h,d,xt,We.x,We.y,st,Xe),Xg(r.dynamicLayoutVertexArray,A,ve),j.emplaceBack(zt,zt+1,zt+2),j.emplaceBack(zt+1,zt+2,zt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(je[0]),be!==c.length-1&&ft===c[be+1].sectionIndex||r.programConfigurations.populatePaintArrays($.length,x,x.index,{},B,pe&&pe[ft])}r.placedSymbolArray.emplaceBack(A.x,A.y,oe,this.glyphOffsetArray.length-oe,he,I,R,A.segment,d?d[0]:0,d?d[1]:0,m[0],m[1],T,0,!1,0,O)}_addCollisionDebugVertex(r,c,d,m,v,x){return c.emplaceBack(0,0),r.emplaceBack(d.x,d.y,m,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(r,c,d,m,v,x,T){const A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),I=A.vertexLength,R=v.layoutVertexArray,O=v.collisionVertexArray,B=T.anchorX,j=T.anchorY;this._addCollisionDebugVertex(R,O,x,B,j,new k(r,c)),this._addCollisionDebugVertex(R,O,x,B,j,new k(d,c)),this._addCollisionDebugVertex(R,O,x,B,j,new k(d,m)),this._addCollisionDebugVertex(R,O,x,B,j,new k(r,m)),A.vertexLength+=4;const $=v.indexArray;$.emplaceBack(I,I+1),$.emplaceBack(I+1,I+2),$.emplaceBack(I+2,I+3),$.emplaceBack(I+3,I),A.primitiveLength+=4}addDebugCollisionBoxes(r,c,d,m){for(let v=r;v<c;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kg(jn,Wx.members,oi),this.iconCollisionBox=new Kg(jn,Wx.members,oi);for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(r,c,d,m,v,x,T,A,I){const R={};for(let O=c;O<d;O++){const B=r.get(O);R.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.textFeatureIndex=B.featureIndex;break}for(let O=m;O<v;O++){const B=r.get(O);R.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalTextFeatureIndex=B.featureIndex;break}for(let O=x;O<T;O++){const B=r.get(O);R.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.iconFeatureIndex=B.featureIndex;break}for(let O=A;O<I;O++){const B=r.get(O);R.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalIconFeatureIndex=B.featureIndex;break}return R}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,c){const d=r.placedSymbolArray.get(c),m=d.vertexStartIndex+4*d.numGlyphs;for(let v=d.vertexStartIndex;v<m;v+=4)r.indexArray.emplaceBack(v,v+1,v+2),r.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(r),d=Math.cos(r),m=[],v=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const A=this.symbolInstances.get(T);m.push(0|Math.round(c*A.anchorX+d*A.anchorY)),v.push(A.featureIndex)}return x.sort((T,A)=>m[T]-m[A]||v[A]-v[T]),x}addToSortKeyRanges(r,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((m,v,x)=>{m>=0&&x.indexOf(m)===v&&this.addIndicesForPlacedSymbol(this.text,m)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cb,ub;it("SymbolBucket",Dc,{omit:["layers","collisionBoxArray","features","compareText"]}),Dc.MAX_GLYPHS=65535,Dc.addDynamicAttributes=Xg;var Jg={get paint(){return ub=ub||new qn({"icon-opacity":new bt(Le.paint_symbol["icon-opacity"]),"icon-color":new bt(Le.paint_symbol["icon-color"]),"icon-halo-color":new bt(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new mt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new mt(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt(Le.paint_symbol["text-opacity"]),"text-color":new bt(Le.paint_symbol["text-color"],{runtimeType:yi,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new bt(Le.paint_symbol["text-halo-color"]),"text-halo-width":new bt(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new bt(Le.paint_symbol["text-halo-blur"]),"text-translate":new mt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new mt(Le.paint_symbol["text-translate-anchor"])})},get layout(){return cb=cb||new qn({"symbol-placement":new mt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new mt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mt(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mt(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new mt(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new mt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new mt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt(Le.layout_symbol["icon-size"]),"icon-text-fit":new mt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt(Le.layout_symbol["icon-image"]),"icon-rotate":new bt(Le.layout_symbol["icon-rotate"]),"icon-padding":new bt(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new mt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new bt(Le.layout_symbol["icon-offset"]),"icon-anchor":new bt(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new bt(Le.layout_symbol["text-field"]),"text-font":new bt(Le.layout_symbol["text-font"]),"text-size":new bt(Le.layout_symbol["text-size"]),"text-max-width":new bt(Le.layout_symbol["text-max-width"]),"text-line-height":new mt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new bt(Le.layout_symbol["text-letter-spacing"]),"text-justify":new bt(Le.layout_symbol["text-justify"]),"text-radial-offset":new bt(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mt(Le.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new bt(Le.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new bt(Le.layout_symbol["text-anchor"]),"text-max-angle":new mt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new mt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new bt(Le.layout_symbol["text-rotate"]),"text-padding":new mt(Le.layout_symbol["text-padding"]),"text-keep-upright":new mt(Le.layout_symbol["text-keep-upright"]),"text-transform":new bt(Le.layout_symbol["text-transform"]),"text-offset":new bt(Le.layout_symbol["text-offset"]),"text-allow-overlap":new mt(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new mt(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new mt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new mt(Le.layout_symbol["text-optional"])})}};class hb{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:es,this.defaultValue=r}evaluate(r){if(r.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(r.formattedSection))return c.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it("FormatSectionOverride",hb,{omit:["defaultValue"]});class Yf extends Gr{constructor(r){super(r,Jg)}recalculate(r,c){if(super.recalculate(r,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const m=[];for(const v of d)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,c,d,m){const v=this.layout.get(r).evaluate(c,{},d,m),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||pc(x.value)||!v?v:function(T,A){return A.replace(/{([^{}]+)}/g,(I,R)=>T&&R in T?String(T[R]):"")}(c.properties,v)}createBucket(r){return new Dc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Jg.paint.overridableProperties){if(!Yf.hasPaintOverride(this.layout,r))continue;const c=this.paint.get(r),d=new hb(c),m=new Wu(d,c.property.specification);let v=null;v=c.value.kind==="constant"||c.value.kind==="source"?new qu("source",m):new gc("composite",m,c.value.zoomStops),this.paint._values[r]=new Ui(c.property,v,c.parameters)}}_handleOverridablePaintPropertyUpdate(r,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&Yf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,c){const d=r.get("text-field"),m=Jg.paint.properties[c];let v=!1;const x=T=>{for(const A of T)if(m.overrides&&m.overrides.hasOverride(A))return void(v=!0)};if(d.value.kind==="constant"&&d.value.value instanceof xn)x(d.value.value.sections);else if(d.value.kind==="source"){const T=I=>{v||(I instanceof ts&&un(I.value)===ne?x(I.value.sections):I instanceof fc?x(I.sections):I.eachChild(T))},A=d.value;A._styleExpression&&T(A._styleExpression.expression)}return v}}let db;var GI={get paint(){return db=db||new qn({"background-color":new mt(Le.paint_background["background-color"]),"background-pattern":new lh(Le.paint_background["background-pattern"]),"background-opacity":new mt(Le.paint_background["background-opacity"])})}};class $I extends Gr{constructor(r){super(r,GI)}}let fb;var HI={get paint(){return fb=fb||new qn({"raster-opacity":new mt(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new mt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new mt(Le.paint_raster["raster-saturation"]),"raster-contrast":new mt(Le.paint_raster["raster-contrast"]),"raster-resampling":new mt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new mt(Le.paint_raster["raster-fade-duration"])})}};class WI extends Gr{constructor(r){super(r,HI)}}class qI extends Gr{constructor(r){super(r,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ZI{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Qg=63710088e-1;class Pa{constructor(r,c){if(isNaN(r)||isNaN(c))throw new Error(`Invalid LngLat object: (${r}, ${c})`);if(this.lng=+r,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pa(ze(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const c=Math.PI/180,d=this.lat*c,m=r.lat*c,v=Math.sin(d)*Math.sin(m)+Math.cos(d)*Math.cos(m)*Math.cos((r.lng-this.lng)*c);return Qg*Math.acos(Math.min(v,1))}static convert(r){if(r instanceof Pa)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Pa(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Pa(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const pb=2*Math.PI*Qg;function mb(a){return pb*Math.cos(a*Math.PI/180)}function gb(a){return(180+a)/360}function _b(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function yb(a,r){return a/mb(r)}function vb(a){return 360*a-180}function e_(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class Kf{constructor(r,c,d=0){this.x=+r,this.y=+c,this.z=+d}static fromLngLat(r,c=0){const d=Pa.convert(r);return new Kf(gb(d.lng),_b(d.lat),yb(c,d.lat))}toLngLat(){return new Pa(vb(this.x),e_(this.y))}toAltitude(){return this.z*mb(e_(this.y))}meterInMercatorCoordinateUnits(){return 1/pb*(r=e_(this.y),1/Math.cos(r*Math.PI/180));var r}}function xb(a,r,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[a*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}class t_{constructor(r,c,d){if(r<0||r>25||d<0||d>=Math.pow(2,r)||c<0||c>=Math.pow(2,r))throw new Error(`x=${c}, y=${d}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=c,this.y=d,this.key=Mh(0,r,r,c,d)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,c,d){const m=(x=this.y,T=this.z,A=xb(256*(v=this.x),256*(x=Math.pow(2,T)-x-1),T),I=xb(256*(v+1),256*(x+1),T),A[0]+","+A[1]+","+I[0]+","+I[1]);var v,x,T,A,I;const R=function(O,B,j){let $,Q="";for(let oe=O;oe>0;oe--)$=1<<oe-1,Q+=(B&$?1:0)+(j&$?2:0);return Q}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,m)}isChildOf(r){const c=this.z-r.z;return c>0&&r.x===this.x>>c&&r.y===this.y>>c}getTilePoint(r){const c=Math.pow(2,this.z);return new k((r.x*c-this.x)*ei,(r.y*c-this.y)*ei)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bb{constructor(r,c){this.wrap=r,this.canonical=c,this.key=Mh(r,c.z,c.z,c.x,c.y)}}class is{constructor(r,c,d,m,v){if(r<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${d}`);this.overscaledZ=r,this.wrap=c,this.canonical=new t_(d,+m,+v),this.key=Mh(c,r,d,m,v)}clone(){return new is(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-r;return r>this.canonical.z?new is(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new is(r,this.wrap,r,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(r,c){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-r;return r>this.canonical.z?Mh(this.wrap*+c,r,this.canonical.z,this.canonical.x,this.canonical.y):Mh(this.wrap*+c,r,r,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const c=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>c&&r.canonical.y===this.canonical.y>>c}children(r){if(this.overscaledZ>=r)return[new is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,m=2*this.canonical.y;return[new is(c,this.wrap,c,d,m),new is(c,this.wrap,c,d+1,m),new is(c,this.wrap,c,d,m+1),new is(c,this.wrap,c,d+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new is(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Kf(r.x-this.wrap,r.y))}}function Mh(a,r,c,d,m){(a*=2)<0&&(a=-1*a-1);const v=1<<c;return(v*v*a+v*m+d).toString(36)+c.toString(36)+r.toString(36)}it("CanonicalTileID",t_),it("OverscaledTileID",is,{omit:["posMatrix"]});class wb{constructor(r,c,d,m=1,v=1,x=1,T=0){if(this.uid=r,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void yt(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const A=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=v,this.blueFactor=x,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<A;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(A,I)]=this.data[this._idx(A-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,A)]=this.data[this._idx(I,A-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(A,-1)]=this.data[this._idx(A-1,0)],this.data[this._idx(-1,A)]=this.data[this._idx(0,A-1)],this.data[this._idx(A,A)]=this.data[this._idx(A-1,A-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<A;I++)for(let R=0;R<A;R++){const O=this.get(I,R);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(r,c){const d=new Uint8Array(this.data.buffer),m=4*this._idx(r,c);return this.unpack(d[m],d[m+1],d[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,c){if(r<-1||r>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(r+1)}unpack(r,c,d){return r*this.redFactor+c*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new ns({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,c,d){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=c*this.dim,v=c*this.dim+this.dim,x=d*this.dim,T=d*this.dim+this.dim;switch(c){case-1:m=v-1;break;case 1:v=m+1}switch(d){case-1:x=T-1;break;case 1:T=x+1}const A=-c*this.dim,I=-d*this.dim;for(let R=x;R<T;R++)for(let O=m;O<v;O++)this.data[this._idx(O,R)]=r.data[this._idx(O+A,R+I)]}}it("DEMData",wb);class Tb{constructor(r){this._stringToNumber={},this._numberToString=[];for(let c=0;c<r.length;c++){const d=r[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class Eb{constructor(r,c,d,m,v){this.type="Feature",this._vectorTileFeature=r,r._z=c,r._x=d,r._y=m,this.properties=r.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(r[c]=this[c]);return r}}class Sb{constructor(r,c){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new va(ei,16,0),this.grid3D=new va(ei,16,0),this.featureIndexArray=new Ue,this.promoteId=c}insert(r,c,d,m,v,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,m,v);const A=x?this.grid3D:this.grid;for(let I=0;I<c.length;I++){const R=c[I],O=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const j=R[B];O[0]=Math.min(O[0],j.x),O[1]=Math.min(O[1],j.y),O[2]=Math.max(O[2],j.x),O[3]=Math.max(O[3],j.y)}O[0]<ei&&O[1]<ei&&O[2]>=0&&O[3]>=0&&A.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ea.VectorTile(new Gg(this.rawTileData)).layers,this.sourceLayerCoder=new Tb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,c,d,m){this.loadVTLayers();const v=r.params||{},x=ei/r.tileSize/r.scale,T=Xu(v.filter),A=r.queryGeometry,I=r.queryPadding*x,R=Pb(A),O=this.grid.query(R.minX-I,R.minY-I,R.maxX+I,R.maxY+I),B=Pb(r.cameraQueryGeometry),j=this.grid3D.query(B.minX-I,B.minY-I,B.maxX+I,B.maxY+I,(oe,he,ve,pe)=>function(be,Se,Be,tt,ht){for(const Je of be)if(Se<=Je.x&&Be<=Je.y&&tt>=Je.x&&ht>=Je.y)return!0;const Qe=[new k(Se,Be),new k(Se,ht),new k(tt,ht),new k(tt,Be)];if(be.length>2){for(const Je of Qe)if(Pc(be,Je))return!0}for(let Je=0;Je<be.length-1;Je++)if(AP(be[Je],be[Je+1],Qe))return!0;return!1}(r.cameraQueryGeometry,oe-I,he-I,ve+I,pe+I));for(const oe of j)O.push(oe);O.sort(XI);const $={};let Q;for(let oe=0;oe<O.length;oe++){const he=O[oe];if(he===Q)continue;Q=he;const ve=this.featureIndexArray.get(he);let pe=null;this.loadMatchingFeature($,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,T,v.layers,v.availableImages,c,d,m,(be,Se,Be)=>(pe||(pe=Tl(be)),Se.queryIntersectsFeature(A,be,Be,pe,this.z,r.transform,x,r.pixelPosMatrix)))}return $}loadMatchingFeature(r,c,d,m,v,x,T,A,I,R,O){const B=this.bucketLayerIDs[c];if(x&&!function(oe,he){for(let ve=0;ve<oe.length;ve++)if(he.indexOf(oe[ve])>=0)return!0;return!1}(x,B))return;const j=this.sourceLayerCoder.decode(d),$=this.vtLayers[j].feature(m);if(v.needGeometry){const oe=El($,!0);if(!v.filter(new bn(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!v.filter(new bn(this.tileID.overscaledZ),$))return;const Q=this.getId($,j);for(let oe=0;oe<B.length;oe++){const he=B[oe];if(x&&x.indexOf(he)<0)continue;const ve=A[he];if(!ve)continue;let pe={};Q&&R&&(pe=R.getState(ve.sourceLayer||"_geojsonTileLayer",Q));const be=Oe({},I[he]);be.paint=Ab(be.paint,ve.paint,$,pe,T),be.layout=Ab(be.layout,ve.layout,$,pe,T);const Se=!O||O($,ve,pe);if(!Se)continue;const Be=new Eb($,this.z,this.x,this.y,Q);Be.layer=be;let tt=r[he];tt===void 0&&(tt=r[he]=[]),tt.push({featureIndex:m,feature:Be,intersectionZ:Se})}}lookupSymbolFeatures(r,c,d,m,v,x,T,A){const I={};this.loadVTLayers();const R=Xu(v);for(const O of r)this.loadMatchingFeature(I,d,m,O,R,x,T,A,c);return I}hasLayer(r){for(const c of this.bucketLayerIDs)for(const d of c)if(r===d)return!0;return!1}getId(r,c){let d=r.id;return this.promoteId&&(d=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function Ab(a,r,c,d,m){return Ee(a,(v,x)=>{const T=r instanceof Sc?r.get(x):null;return T&&T.evaluate?T.evaluate(c,d,m):T})}function Pb(a){let r=1/0,c=1/0,d=-1/0,m=-1/0;for(const v of a)r=Math.min(r,v.x),c=Math.min(c,v.y),d=Math.max(d,v.x),m=Math.max(m,v.y);return{minX:r,minY:c,maxX:d,maxY:m}}function XI(a,r){return r-a}function Ib(a,r,c,d,m){const v=[];for(let x=0;x<a.length;x++){const T=a[x];let A;for(let I=0;I<T.length-1;I++){let R=T[I],O=T[I+1];R.x<r&&O.x<r||(R.x<r?R=new k(r,R.y+(r-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x<r&&(O=new k(r,R.y+(r-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y<c&&O.y<c||(R.y<c?R=new k(R.x+(c-R.y)/(O.y-R.y)*(O.x-R.x),c)._round():O.y<c&&(O=new k(R.x+(c-R.y)/(O.y-R.y)*(O.x-R.x),c)._round()),R.x>=d&&O.x>=d||(R.x>=d?R=new k(d,R.y+(d-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x>=d&&(O=new k(d,R.y+(d-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y>=m&&O.y>=m||(R.y>=m?R=new k(R.x+(m-R.y)/(O.y-R.y)*(O.x-R.x),m)._round():O.y>=m&&(O=new k(R.x+(m-R.y)/(O.y-R.y)*(O.x-R.x),m)._round()),A&&R.equals(A[A.length-1])||(A=[R],v.push(A)),A.push(O)))))}}return v}it("FeatureIndex",Sb,{omit:["rawTileData","sourceLayerCoder"]});class Ia extends k{constructor(r,c,d,m){super(r,c),this.angle=d,m!==void 0&&(this.segment=m)}clone(){return new Ia(this.x,this.y,this.angle,this.segment)}}function Cb(a,r,c,d,m){if(r.segment===void 0||c===0)return!0;let v=r,x=r.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=a[x].dist(v),v=a[x]}T+=a[x].dist(a[x+1]),x++;const A=[];let I=0;for(;T<c/2;){const R=a[x],O=a[x+1];if(!O)return!1;let B=a[x-1].angleTo(R)-R.angleTo(O);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:T,angleDelta:B}),I+=B;T-A[0].distance>d;)I-=A.shift().angleDelta;if(I>m)return!1;x++,T+=R.dist(O)}return!0}function Mb(a){let r=0;for(let c=0;c<a.length-1;c++)r+=a[c].dist(a[c+1]);return r}function Lb(a,r,c){return a?.6*r*c:0}function kb(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function YI(a,r,c,d,m,v){const x=Lb(c,m,v),T=kb(c,d)*v;let A=0;const I=Mb(a)/2;for(let R=0;R<a.length-1;R++){const O=a[R],B=a[R+1],j=O.dist(B);if(A+j>I){const $=(I-A)/j,Q=br.number(O.x,B.x,$),oe=br.number(O.y,B.y,$),he=new Ia(Q,oe,B.angleTo(O),R);return he._round(),!x||Cb(a,he,T,x,r)?he:void 0}A+=j}}function KI(a,r,c,d,m,v,x,T,A){const I=Lb(d,v,x),R=kb(d,m),O=R*x,B=a[0].x===0||a[0].x===A||a[0].y===0||a[0].y===A;return r-O<r/4&&(r=O+r/4),Rb(a,B?r/2*T%r:(R/2+2*v)*x*T%r,r,I,c,O,B,!1,A)}function Rb(a,r,c,d,m,v,x,T,A){const I=v/2,R=Mb(a);let O=0,B=r-c,j=[];for(let $=0;$<a.length-1;$++){const Q=a[$],oe=a[$+1],he=Q.dist(oe),ve=oe.angleTo(Q);for(;B+c<O+he;){B+=c;const pe=(B-O)/he,be=br.number(Q.x,oe.x,pe),Se=br.number(Q.y,oe.y,pe);if(be>=0&&be<A&&Se>=0&&Se<A&&B-I>=0&&B+I<=R){const Be=new Ia(be,Se,ve,$);Be._round(),d&&!Cb(a,Be,v,d,m)||j.push(Be)}}O+=he}return T||j.length||x||(j=Rb(a,O/2,c,d,m,v,x,!0,A)),j}it("Anchor",Ia);const zc=Ar;function Db(a,r,c,d){const m=[],v=a.image,x=v.pixelRatio,T=v.paddedRect.w-2*zc,A=v.paddedRect.h-2*zc,I=a.right-a.left,R=a.bottom-a.top,O=v.stretchX||[[0,T]],B=v.stretchY||[[0,A]],j=(We,st)=>We+st[1]-st[0],$=O.reduce(j,0),Q=B.reduce(j,0),oe=T-$,he=A-Q;let ve=0,pe=$,be=0,Se=Q,Be=0,tt=oe,ht=0,Qe=he;if(v.content&&d){const We=v.content;ve=Jf(O,0,We[0]),be=Jf(B,0,We[1]),pe=Jf(O,We[0],We[2]),Se=Jf(B,We[1],We[3]),Be=We[0]-ve,ht=We[1]-be,tt=We[2]-We[0]-pe,Qe=We[3]-We[1]-Se}const Je=(We,st,Xe,je)=>{const xt=Qf(We.stretch-ve,pe,I,a.left),ft=ep(We.fixed-Be,tt,We.stretch,$),zt=Qf(st.stretch-be,Se,R,a.top),Tn=ep(st.fixed-ht,Qe,st.stretch,Q),In=Qf(Xe.stretch-ve,pe,I,a.left),ci=ep(Xe.fixed-Be,tt,Xe.stretch,$),Hr=Qf(je.stretch-be,Se,R,a.top),rr=ep(je.fixed-ht,Qe,je.stretch,Q),ti=new k(xt,zt),Ti=new k(In,zt),Di=new k(In,Hr),sr=new k(xt,Hr),or=new k(ft/x,Tn/x),ui=new k(ci/x,rr/x),hi=r*Math.PI/180;if(hi){const Gi=Math.sin(hi),Pr=Math.cos(hi),Ir=[Pr,-Gi,Gi,Pr];ti._matMult(Ir),Ti._matMult(Ir),sr._matMult(Ir),Di._matMult(Ir)}const ji=We.stretch+We.fixed,ar=st.stretch+st.fixed;return{tl:ti,tr:Ti,bl:sr,br:Di,tex:{x:v.paddedRect.x+zc+ji,y:v.paddedRect.y+zc+ar,w:Xe.stretch+Xe.fixed-ji,h:je.stretch+je.fixed-ar},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:or,pixelOffsetBR:ui,minFontScaleX:tt/x/I,minFontScaleY:Qe/x/R,isSDF:c}};if(d&&(v.stretchX||v.stretchY)){const We=zb(O,oe,$),st=zb(B,he,Q);for(let Xe=0;Xe<We.length-1;Xe++){const je=We[Xe],xt=We[Xe+1];for(let ft=0;ft<st.length-1;ft++)m.push(Je(je,st[ft],xt,st[ft+1]))}}else m.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return m}function Jf(a,r,c){let d=0;for(const m of a)d+=Math.max(r,Math.min(c,m[1]))-Math.max(r,Math.min(c,m[0]));return d}function zb(a,r,c){const d=[{fixed:-zc,stretch:0}];for(const[m,v]of a){const x=d[d.length-1];d.push({fixed:m-x.stretch,stretch:x.stretch}),d.push({fixed:m-x.stretch,stretch:x.stretch+(v-m)})}return d.push({fixed:r+zc,stretch:c}),d}function Qf(a,r,c,d){return a/r*c+d}function ep(a,r,c,d){return a-r*c/d}class tp{constructor(r,c,d,m,v,x,T,A,I,R){if(this.boxStartIndex=r.length,I){let O=x.top,B=x.bottom;const j=x.collisionPadding;j&&(O-=j[1],B+=j[3]);let $=B-O;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let O=x.top*T-A[0],B=x.bottom*T+A[2],j=x.left*T-A[3],$=x.right*T+A[1];const Q=x.collisionPadding;if(Q&&(j-=Q[0]*T,O-=Q[1]*T,$+=Q[2]*T,B+=Q[3]*T),R){const oe=new k(j,O),he=new k($,O),ve=new k(j,B),pe=new k($,B),be=R*Math.PI/180;oe._rotate(be),he._rotate(be),ve._rotate(be),pe._rotate(be),j=Math.min(oe.x,he.x,ve.x,pe.x),$=Math.max(oe.x,he.x,ve.x,pe.x),O=Math.min(oe.y,he.y,ve.y,pe.y),B=Math.max(oe.y,he.y,ve.y,pe.y)}r.emplaceBack(c.x,c.y,j,O,$,B,d,m,v)}this.boxEndIndex=r.length}}class JI{constructor(r=[],c=QI){if(this.data=r,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:c,compare:d}=this,m=c[r];for(;r>0;){const v=r-1>>1,x=c[v];if(d(m,x)>=0)break;c[r]=x,r=v}c[r]=m}_down(r){const{data:c,compare:d}=this,m=this.length>>1,v=c[r];for(;r<m;){let x=1+(r<<1),T=c[x];const A=x+1;if(A<this.length&&d(c[A],T)<0&&(x=A,T=c[A]),d(T,v)>=0)break;c[r]=T,r=x}c[r]=v}}function QI(a,r){return a<r?-1:a>r?1:0}function eC(a,r=1,c=!1){let d=1/0,m=1/0,v=-1/0,x=-1/0;const T=a[0];for(let j=0;j<T.length;j++){const $=T[j];(!j||$.x<d)&&(d=$.x),(!j||$.y<m)&&(m=$.y),(!j||$.x>v)&&(v=$.x),(!j||$.y>x)&&(x=$.y)}const A=Math.min(v-d,x-m);let I=A/2;const R=new JI([],tC);if(A===0)return new k(d,m);for(let j=d;j<v;j+=A)for(let $=m;$<x;$+=A)R.push(new Oc(j+I,$+I,I,a));let O=function(j){let $=0,Q=0,oe=0;const he=j[0];for(let ve=0,pe=he.length,be=pe-1;ve<pe;be=ve++){const Se=he[ve],Be=he[be],tt=Se.x*Be.y-Be.x*Se.y;Q+=(Se.x+Be.x)*tt,oe+=(Se.y+Be.y)*tt,$+=3*tt}return new Oc(Q/$,oe/$,0,j)}(a),B=R.length;for(;R.length;){const j=R.pop();(j.d>O.d||!O.d)&&(O=j,c&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,B)),j.max-O.d<=r||(I=j.h/2,R.push(new Oc(j.p.x-I,j.p.y-I,I,a)),R.push(new Oc(j.p.x+I,j.p.y-I,I,a)),R.push(new Oc(j.p.x-I,j.p.y+I,I,a)),R.push(new Oc(j.p.x+I,j.p.y+I,I,a)),B+=4)}return c&&(console.log(`num probes: ${B}`),console.log(`best distance: ${O.d}`)),O.p}function tC(a,r){return r.max-a.max}function Oc(a,r,c,d){this.p=new k(a,r),this.h=c,this.d=function(m,v){let x=!1,T=1/0;for(let A=0;A<v.length;A++){const I=v[A];for(let R=0,O=I.length,B=O-1;R<O;B=R++){const j=I[R],$=I[B];j.y>m.y!=$.y>m.y&&m.x<($.x-j.x)*(m.y-j.y)/($.y-j.y)+j.x&&(x=!x),T=Math.min(T,_x(m,j,$))}}return(x?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var Ri;l.aq=void 0,(Ri=l.aq||(l.aq={}))[Ri.center=1]="center",Ri[Ri.left=2]="left",Ri[Ri.right=3]="right",Ri[Ri.top=4]="top",Ri[Ri.bottom=5]="bottom",Ri[Ri["top-left"]=6]="top-left",Ri[Ri["top-right"]=7]="top-right",Ri[Ri["bottom-left"]=8]="bottom-left",Ri[Ri["bottom-right"]=9]="bottom-right";const Ca=7,n_=Number.POSITIVE_INFINITY;function Ob(a,r){return r[1]!==n_?function(c,d,m){let v=0,x=0;switch(d=Math.abs(d),m=Math.abs(m),c){case"top-right":case"top-left":case"top":x=m-Ca;break;case"bottom-right":case"bottom-left":case"bottom":x=-m+Ca}switch(c){case"top-right":case"bottom-right":case"right":v=-d;break;case"top-left":case"bottom-left":case"left":v=d}return[v,x]}(a,r[0],r[1]):function(c,d){let m=0,v=0;d<0&&(d=0);const x=d/Math.SQRT2;switch(c){case"top-right":case"top-left":v=x-Ca;break;case"bottom-right":case"bottom-left":v=-x+Ca;break;case"bottom":v=-d+Ca;break;case"top":v=d-Ca}switch(c){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=d;break;case"right":m=-d}return[m,v]}(a,r[0])}function Fb(a,r,c){var d;const m=a.layout,v=(d=m.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(r,{},c);if(v){const T=v.values,A=[];for(let I=0;I<T.length;I+=2){const R=A[I]=T[I],O=T[I+1].map(B=>B*li);R.startsWith("top")?O[1]-=Ca:R.startsWith("bottom")&&(O[1]+=Ca),A[I+1]=O}return new vi(A)}const x=m.get("text-variable-anchor");if(x){let T;T=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(r,{},c)*li,n_]:m.get("text-offset").evaluate(r,{},c).map(I=>I*li);const A=[];for(const I of x)A.push(I,Ob(I,T));return new vi(A)}return null}function i_(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nC(a,r,c,d,m,v,x,T,A,I,R){let O=v.textMaxSize.evaluate(r,{});O===void 0&&(O=x);const B=a.layers[0].layout,j=B.get("icon-offset").evaluate(r,{},R),$=Nb(c.horizontal),Q=x/24,oe=a.tilePixelRatio*Q,he=a.tilePixelRatio*O/24,ve=a.tilePixelRatio*T,pe=a.tilePixelRatio*B.get("symbol-spacing"),be=B.get("text-padding")*a.tilePixelRatio,Se=function(je,xt,ft,zt=1){const Tn=je.get("icon-padding").evaluate(xt,{},ft),In=Tn&&Tn.values;return[In[0]*zt,In[1]*zt,In[2]*zt,In[3]*zt]}(B,r,R,a.tilePixelRatio),Be=B.get("text-max-angle")/180*Math.PI,tt=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",ht=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Qe=B.get("symbol-placement"),Je=pe/2,We=B.get("icon-text-fit");let st;d&&We!=="none"&&(a.allowVerticalPlacement&&c.vertical&&(st=ab(d,c.vertical,We,B.get("icon-text-fit-padding"),j,Q)),$&&(d=ab(d,$,We,B.get("icon-text-fit-padding"),j,Q)));const Xe=(je,xt)=>{xt.x<0||xt.x>=ei||xt.y<0||xt.y>=ei||function(ft,zt,Tn,In,ci,Hr,rr,ti,Ti,Di,sr,or,ui,hi,ji,ar,Gi,Pr,Ir,di,jt,$i,zi,fi,Cs){const Xs=ft.addToLineVertexArray(zt,Tn);let Ys,Ho,Ms,rs,Cr=0,Wo=0,Rh=0,Gb=0,h_=-1,d_=-1;const qo={};let $b=Vo("");if(ft.allowVerticalPlacement&&In.vertical){const Hi=ti.layout.get("text-rotate").evaluate(jt,{},fi)+90;Ms=new tp(Ti,zt,Di,sr,or,In.vertical,ui,hi,ji,Hi),rr&&(rs=new tp(Ti,zt,Di,sr,or,rr,Gi,Pr,ji,Hi))}if(ci){const Hi=ti.layout.get("icon-rotate").evaluate(jt,{}),ss=ti.layout.get("icon-text-fit")!=="none",Al=Db(ci,Hi,zi,ss),Js=rr?Db(rr,Hi,zi,ss):void 0;Ho=new tp(Ti,zt,Di,sr,or,ci,Gi,Pr,!1,Hi),Cr=4*Al.length;const Pl=ft.iconSizeData;let _o=null;Pl.kind==="source"?(_o=[go*ti.layout.get("icon-size").evaluate(jt,{})],_o[0]>Aa&&yt(`${ft.layerIds[0]}: Value for "icon-size" is >= ${Ch}. Reduce your "icon-size".`)):Pl.kind==="composite"&&(_o=[go*$i.compositeIconSizes[0].evaluate(jt,{},fi),go*$i.compositeIconSizes[1].evaluate(jt,{},fi)],(_o[0]>Aa||_o[1]>Aa)&&yt(`${ft.layerIds[0]}: Value for "icon-size" is >= ${Ch}. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,Al,_o,di,Ir,jt,l.ai.none,zt,Xs.lineStartIndex,Xs.lineLength,-1,fi),h_=ft.icon.placedSymbolArray.length-1,Js&&(Wo=4*Js.length,ft.addSymbols(ft.icon,Js,_o,di,Ir,jt,l.ai.vertical,zt,Xs.lineStartIndex,Xs.lineLength,-1,fi),d_=ft.icon.placedSymbolArray.length-1)}const Hb=Object.keys(In.horizontal);for(const Hi of Hb){const ss=In.horizontal[Hi];if(!Ys){$b=Vo(ss.text);const Js=ti.layout.get("text-rotate").evaluate(jt,{},fi);Ys=new tp(Ti,zt,Di,sr,or,ss,ui,hi,ji,Js)}const Al=ss.positionedLines.length===1;if(Rh+=Bb(ft,zt,ss,Hr,ti,ji,jt,ar,Xs,In.vertical?l.ai.horizontal:l.ai.horizontalOnly,Al?Hb:[Hi],qo,h_,$i,fi),Al)break}In.vertical&&(Gb+=Bb(ft,zt,In.vertical,Hr,ti,ji,jt,ar,Xs,l.ai.vertical,["vertical"],qo,d_,$i,fi));const sC=Ys?Ys.boxStartIndex:ft.collisionBoxArray.length,oC=Ys?Ys.boxEndIndex:ft.collisionBoxArray.length,aC=Ms?Ms.boxStartIndex:ft.collisionBoxArray.length,lC=Ms?Ms.boxEndIndex:ft.collisionBoxArray.length,cC=Ho?Ho.boxStartIndex:ft.collisionBoxArray.length,uC=Ho?Ho.boxEndIndex:ft.collisionBoxArray.length,hC=rs?rs.boxStartIndex:ft.collisionBoxArray.length,dC=rs?rs.boxEndIndex:ft.collisionBoxArray.length;let Ks=-1;const ip=(Hi,ss)=>Hi&&Hi.circleDiameter?Math.max(Hi.circleDiameter,ss):ss;Ks=ip(Ys,Ks),Ks=ip(Ms,Ks),Ks=ip(Ho,Ks),Ks=ip(rs,Ks);const Wb=Ks>-1?1:0;Wb&&(Ks*=Cs/li),ft.glyphOffsetArray.length>=Dc.MAX_GLYPHS&&yt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jt.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,jt.sortKey);const fC=Fb(ti,jt,fi),[pC,mC]=function(Hi,ss){const Al=Hi.length,Js=ss==null?void 0:ss.values;if((Js==null?void 0:Js.length)>0)for(let Pl=0;Pl<Js.length;Pl+=2){const _o=Js[Pl+1];Hi.emplaceBack(l.aq[Js[Pl]],_o[0],_o[1])}return[Al,Hi.length]}(ft.textAnchorOffsets,fC);ft.symbolInstances.emplaceBack(zt.x,zt.y,qo.right>=0?qo.right:-1,qo.center>=0?qo.center:-1,qo.left>=0?qo.left:-1,qo.vertical||-1,h_,d_,$b,sC,oC,aC,lC,cC,uC,hC,dC,Di,Rh,Gb,Cr,Wo,Wb,0,ui,Ks,pC,mC)}(a,xt,je,c,d,m,st,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,oe,[be,be,be,be],tt,A,ve,Se,ht,j,r,v,I,R,x)};if(Qe==="line")for(const je of Ib(r.geometry,0,0,ei,ei)){const xt=KI(je,pe,Be,c.vertical||$,d,24,he,a.overscaling,ei);for(const ft of xt)$&&iC(a,$.text,Je,ft)||Xe(je,ft)}else if(Qe==="line-center"){for(const je of r.geometry)if(je.length>1){const xt=YI(je,Be,c.vertical||$,d,24,he);xt&&Xe(je,xt)}}else if(r.type==="Polygon")for(const je of zg(r.geometry,0)){const xt=eC(je,16);Xe(je[0],new Ia(xt.x,xt.y,0))}else if(r.type==="LineString")for(const je of r.geometry)Xe(je,new Ia(je[0].x,je[0].y,0));else if(r.type==="Point")for(const je of r.geometry)for(const xt of je)Xe([xt],new Ia(xt.x,xt.y,0))}function Bb(a,r,c,d,m,v,x,T,A,I,R,O,B,j,$){const Q=function(ve,pe,be,Se,Be,tt,ht,Qe){const Je=Se.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,We=[];for(const st of pe.positionedLines)for(const Xe of st.positionedGlyphs){if(!Xe.rect)continue;const je=Xe.rect||{};let xt=eb+1,ft=!0,zt=1,Tn=0;const In=(Be||Qe)&&Xe.vertical,ci=Xe.metrics.advance*Xe.scale/2;if(Qe&&pe.verticalizable&&(Tn=st.lineOffset/2-(Xe.imageName?-(li-Xe.metrics.width*Xe.scale)/2:(Xe.scale-1)*li)),Xe.imageName){const di=ht[Xe.imageName];ft=di.sdf,zt=di.pixelRatio,xt=Ar/zt}const Hr=Be?[Xe.x+ci,Xe.y]:[0,0];let rr=Be?[0,0]:[Xe.x+ci+be[0],Xe.y+be[1]-Tn],ti=[0,0];In&&(ti=rr,rr=[0,0]);const Ti=Xe.metrics.isDoubleResolution?2:1,Di=(Xe.metrics.left-xt)*Xe.scale-ci+rr[0],sr=(-Xe.metrics.top-xt)*Xe.scale+rr[1],or=Di+je.w/Ti*Xe.scale/zt,ui=sr+je.h/Ti*Xe.scale/zt,hi=new k(Di,sr),ji=new k(or,sr),ar=new k(Di,ui),Gi=new k(or,ui);if(In){const di=new k(-ci,ci-Ph),jt=-Math.PI/2,$i=li/2-ci,zi=new k(5-Ph-$i,-(Xe.imageName?$i:0)),fi=new k(...ti);hi._rotateAround(jt,di)._add(zi)._add(fi),ji._rotateAround(jt,di)._add(zi)._add(fi),ar._rotateAround(jt,di)._add(zi)._add(fi),Gi._rotateAround(jt,di)._add(zi)._add(fi)}if(Je){const di=Math.sin(Je),jt=Math.cos(Je),$i=[jt,-di,di,jt];hi._matMult($i),ji._matMult($i),ar._matMult($i),Gi._matMult($i)}const Pr=new k(0,0),Ir=new k(0,0);We.push({tl:hi,tr:ji,bl:ar,br:Gi,tex:je,writingMode:pe.writingMode,glyphOffset:Hr,sectionIndex:Xe.sectionIndex,isSDF:ft,pixelOffsetTL:Pr,pixelOffsetBR:Ir,minFontScaleX:0,minFontScaleY:0})}return We}(0,c,T,m,v,x,d,a.allowVerticalPlacement),oe=a.textSizeData;let he=null;oe.kind==="source"?(he=[go*m.layout.get("text-size").evaluate(x,{})],he[0]>Aa&&yt(`${a.layerIds[0]}: Value for "text-size" is >= ${Ch}. Reduce your "text-size".`)):oe.kind==="composite"&&(he=[go*j.compositeTextSizes[0].evaluate(x,{},$),go*j.compositeTextSizes[1].evaluate(x,{},$)],(he[0]>Aa||he[1]>Aa)&&yt(`${a.layerIds[0]}: Value for "text-size" is >= ${Ch}. Reduce your "text-size".`)),a.addSymbols(a.text,Q,he,T,v,x,I,r,A.lineStartIndex,A.lineLength,B,$);for(const ve of R)O[ve]=a.text.placedSymbolArray.length-1;return 4*Q.length}function Nb(a){for(const r in a)return a[r];return null}function iC(a,r,c,d){const m=a.compareText;if(r in m){const v=m[r];for(let x=v.length-1;x>=0;x--)if(d.dist(v[x])<c)return!0}else m[r]=[];return m[r].push(d),!1}const Ub=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class r_{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,d]=new Uint8Array(r,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=d>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=Ub[15&d];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(r,2,1),[T]=new Uint32Array(r,4,1);return new r_(T,x,v,r)}constructor(r,c=64,d=Float64Array,m){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=d,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const v=Ub.indexOf(this.ArrayType),x=2*r*this.ArrayType.BYTES_PER_ELEMENT,T=r*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-T%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${d}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+A,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+A),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+A,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=r)}add(r,c){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=r,this.coords[this._pos++]=c,d}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return s_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,c,d,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:T}=this,A=[0,v.length-1,0],I=[];for(;A.length;){const R=A.pop()||0,O=A.pop()||0,B=A.pop()||0;if(O-B<=T){for(let oe=B;oe<=O;oe++){const he=x[2*oe],ve=x[2*oe+1];he>=r&&he<=d&&ve>=c&&ve<=m&&I.push(v[oe])}continue}const j=B+O>>1,$=x[2*j],Q=x[2*j+1];$>=r&&$<=d&&Q>=c&&Q<=m&&I.push(v[j]),(R===0?r<=$:c<=Q)&&(A.push(B),A.push(j-1),A.push(1-R)),(R===0?d>=$:m>=Q)&&(A.push(j+1),A.push(O),A.push(1-R))}return I}within(r,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:x}=this,T=[0,m.length-1,0],A=[],I=d*d;for(;T.length;){const R=T.pop()||0,O=T.pop()||0,B=T.pop()||0;if(O-B<=x){for(let oe=B;oe<=O;oe++)jb(v[2*oe],v[2*oe+1],r,c)<=I&&A.push(m[oe]);continue}const j=B+O>>1,$=v[2*j],Q=v[2*j+1];jb($,Q,r,c)<=I&&A.push(m[j]),(R===0?r-d<=$:c-d<=Q)&&(T.push(B),T.push(j-1),T.push(1-R)),(R===0?r+d>=$:c+d>=Q)&&(T.push(j+1),T.push(O),T.push(1-R))}return A}}function s_(a,r,c,d,m,v){if(m-d<=c)return;const x=d+m>>1;Vb(a,r,x,d,m,v),s_(a,r,c,d,x-1,1-v),s_(a,r,c,x+1,m,1-v)}function Vb(a,r,c,d,m,v){for(;m>d;){if(m-d>600){const I=m-d+1,R=c-d+1,O=Math.log(I),B=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*B*(I-B)/I)*(R-I/2<0?-1:1);Vb(a,r,c,Math.max(d,Math.floor(c-R*B/I+j)),Math.min(m,Math.floor(c+(I-R)*B/I+j)),v)}const x=r[2*c+v];let T=d,A=m;for(Lh(a,r,d,c),r[2*m+v]>x&&Lh(a,r,d,m);T<A;){for(Lh(a,r,T,A),T++,A--;r[2*T+v]<x;)T++;for(;r[2*A+v]>x;)A--}r[2*d+v]===x?Lh(a,r,d,A):(A++,Lh(a,r,A,m)),A<=c&&(d=A+1),c<=A&&(m=A-1)}}function Lh(a,r,c,d){o_(a,c,d),o_(r,2*c,2*d),o_(r,2*c+1,2*d+1)}function o_(a,r,c){const d=a[r];a[r]=a[c],a[c]=d}function jb(a,r,c,d){const m=a-c,v=r-d;return m*m+v*v}var a_;l.bh=void 0,(a_=l.bh||(l.bh={})).create="create",a_.load="load",a_.fullLoad="fullLoad";let np=null,kh=[];const l_=1e3/60,c_="loadTime",u_="fullLoadTime",rC={mark(a){performance.mark(a)},frame(a){const r=a;np!=null&&kh.push(r-np),np=r},clearMetrics(){np=null,kh=[],performance.clearMeasures(c_),performance.clearMeasures(u_);for(const a in l.bh)performance.clearMarks(l.bh[a])},getPerformanceMetrics(){performance.measure(c_,l.bh.create,l.bh.load),performance.measure(u_,l.bh.create,l.bh.fullLoad);const a=performance.getEntriesByName(c_)[0].duration,r=performance.getEntriesByName(u_)[0].duration,c=kh.length,d=1/(kh.reduce((v,x)=>v+x,0)/c/1e3),m=kh.filter(v=>v>l_).reduce((v,x)=>v+(x-l_)/l_,0);return{loadTime:a,fullLoadTime:r,fps:d,percentDroppedFrames:m/(c+m)*100,totalFrames:c}}};l.$=function(a,r,c){var d,m,v,x,T,A,I,R,O,B,j,$,Q=c[0],oe=c[1],he=c[2];return r===a?(a[12]=r[0]*Q+r[4]*oe+r[8]*he+r[12],a[13]=r[1]*Q+r[5]*oe+r[9]*he+r[13],a[14]=r[2]*Q+r[6]*oe+r[10]*he+r[14],a[15]=r[3]*Q+r[7]*oe+r[11]*he+r[15]):(m=r[1],v=r[2],x=r[3],T=r[4],A=r[5],I=r[6],R=r[7],O=r[8],B=r[9],j=r[10],$=r[11],a[0]=d=r[0],a[1]=m,a[2]=v,a[3]=x,a[4]=T,a[5]=A,a[6]=I,a[7]=R,a[8]=O,a[9]=B,a[10]=j,a[11]=$,a[12]=d*Q+T*oe+O*he+r[12],a[13]=m*Q+A*oe+B*he+r[13],a[14]=v*Q+I*oe+j*he+r[14],a[15]=x*Q+R*oe+$*he+r[15]),a},l.A=Ic,l.B=br,l.C=class{constructor(a,r,c){this.receive=d=>{const m=d.data,v=m.id;if(v&&(!m.targetMapId||this.mapId===m.targetMapId))if(m.type==="<cancel>"){delete this.tasks[v];const x=this.cancelCallbacks[v];delete this.cancelCallbacks[v],x&&x()}else Xt()||m.mustQueue?(this.tasks[v]=m,this.taskQueue.push(v),this.invoker.trigger()):this.processTask(v,m)},this.process=()=>{if(!this.taskQueue.length)return;const d=this.taskQueue.shift(),m=this.tasks[d];delete this.tasks[d],this.taskQueue.length&&this.invoker.trigger(),m&&this.processTask(d,m)},this.target=a,this.parent=r,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new ZI(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Xt()?a:window}send(a,r,c,d,m=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[v]=c);const x=[],T={id:v,type:a,hasCallback:!!c,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:fo(r,x)};return this.target.postMessage(T,{transfer:x}),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}processTask(a,r){if(r.type==="<response>"){const c=this.callbacks[a];delete this.callbacks[a],c&&(r.error?c(xa(r.error)):c(null,xa(r.data)))}else{let c=!1;const d=[],m=r.hasCallback?(T,A)=>{c=!0,delete this.cancelCallbacks[a];const I={id:a,type:"<response>",sourceMapId:this.mapId,error:T?fo(T):null,data:fo(A,d)};this.target.postMessage(I,{transfer:d})}:T=>{c=!0};let v=null;const x=xa(r.data);if(this.parent[r.type])v=this.parent[r.type](r.sourceMapId,x,m);else if("getWorkerSource"in this.parent){const T=r.type.split(".");v=this.parent.getWorkerSource(r.sourceMapId,T[0],x.source)[T[1]](x,m)}else m(new Error(`Could not find function ${r.type}`));!c&&v&&v.cancel&&(this.cancelCallbacks[a]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=mt,l.E=xs,l.F=function(a,r){const c={};for(let d=0;d<r.length;d++){const m=r[d];m in a&&(c[m]=a[m])}return c},l.G=gb,l.H=_b,l.I=Hg,l.J=G,l.K=Z,l.L=Pa,l.M=Ot,l.N=ei,l.O=is,l.P=k,l.Q=kn,l.R=ns,l.S=wn,l.T=Lf,l.U=Kf,l.V=class extends No{},l.W=t_,l.X=function(a,r){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){r(null,c)};for(let d=0;d<a.length;d++){const m=window.document.createElement("source");Bi(a[d])||(c.crossOrigin="Anonymous"),m.src=a[d],c.appendChild(m)}return{cancel:()=>{}}},l.Y=He,l.Z=function(){var a=new Ic(16);return Ic!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l._=b,l.a=Tt,l.a$=class extends V{},l.a0=function(a,r,c){var d=c[0],m=c[1],v=c[2];return a[0]=r[0]*d,a[1]=r[1]*d,a[2]=r[2]*d,a[3]=r[3]*d,a[4]=r[4]*m,a[5]=r[5]*m,a[6]=r[6]*m,a[7]=r[7]*m,a[8]=r[8]*v,a[9]=r[9]*v,a[10]=r[10]*v,a[11]=r[11]*v,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.a1=bx,l.a2=function(){return Me++},l.a3=ie,l.a4=Dc,l.a5=function(){Er.isLoading()||Er.isLoaded()||oh()!=="deferred"||Mf()},l.a6=Xu,l.a7=El,l.a8=bn,l.a9=Eb,l.aA=yl,l.aB=function(a){a=a.slice();const r=Object.create(null);for(let c=0;c<a.length;c++)r[a[c].id]=a[c];for(let c=0;c<a.length;c++)"ref"in a[c]&&(a[c]=Ki(a[c],r[a[c].ref]));return a},l.aC=function(a){if(a.type==="custom")return new qI(a);switch(a.type){case"background":return new $I(a);case"circle":return new CP(a);case"fill":return new XP(a);case"fill-extrusion":return new uI(a);case"heatmap":return new LP(a);case"hillshade":return new RP(a);case"line":return new yI(a);case"raster":return new WI(a);case"symbol":return new Yf(a)}},l.aD=nt,l.aE=function(a,r){if(!a)return[{command:Wt.setStyle,args:[r]}];let c=[];try{if(!sn(a.version,r.version))return[{command:Wt.setStyle,args:[r]}];sn(a.center,r.center)||c.push({command:Wt.setCenter,args:[r.center]}),sn(a.zoom,r.zoom)||c.push({command:Wt.setZoom,args:[r.zoom]}),sn(a.bearing,r.bearing)||c.push({command:Wt.setBearing,args:[r.bearing]}),sn(a.pitch,r.pitch)||c.push({command:Wt.setPitch,args:[r.pitch]}),sn(a.sprite,r.sprite)||c.push({command:Wt.setSprite,args:[r.sprite]}),sn(a.glyphs,r.glyphs)||c.push({command:Wt.setGlyphs,args:[r.glyphs]}),sn(a.transition,r.transition)||c.push({command:Wt.setTransition,args:[r.transition]}),sn(a.light,r.light)||c.push({command:Wt.setLight,args:[r.light]});const d={},m=[];(function(x,T,A,I){let R;for(R in T=T||{},x=x||{})Object.prototype.hasOwnProperty.call(x,R)&&(Object.prototype.hasOwnProperty.call(T,R)||lo(R,A,I));for(R in T)Object.prototype.hasOwnProperty.call(T,R)&&(Object.prototype.hasOwnProperty.call(x,R)?sn(x[R],T[R])||(x[R].type==="geojson"&&T[R].type==="geojson"&&Lo(x,T,R)?A.push({command:Wt.setGeoJSONSourceData,args:[R,T[R].data]}):Fr(R,T,A,I)):Or(R,T,A))})(a.sources,r.sources,m,d);const v=[];a.layers&&a.layers.forEach(x=>{d[x.source]?c.push({command:Wt.removeLayer,args:[x.id]}):v.push(x)}),c=c.concat(m),function(x,T,A){T=T||[];const I=(x=x||[]).map(Qr),R=T.map(Qr),O=x.reduce(Br,{}),B=T.reduce(Br,{}),j=I.slice(),$=Object.create(null);let Q,oe,he,ve,pe,be,Se;for(Q=0,oe=0;Q<I.length;Q++)he=I[Q],Object.prototype.hasOwnProperty.call(B,he)?oe++:(A.push({command:Wt.removeLayer,args:[he]}),j.splice(j.indexOf(he,oe),1));for(Q=0,oe=0;Q<R.length;Q++)he=R[R.length-1-Q],j[j.length-1-Q]!==he&&(Object.prototype.hasOwnProperty.call(O,he)?(A.push({command:Wt.removeLayer,args:[he]}),j.splice(j.lastIndexOf(he,j.length-oe),1)):oe++,be=j[j.length-Q],A.push({command:Wt.addLayer,args:[B[he],be]}),j.splice(j.length-Q,0,he),$[he]=!0);for(Q=0;Q<R.length;Q++)if(he=R[Q],ve=O[he],pe=B[he],!$[he]&&!sn(ve,pe))if(sn(ve.source,pe.source)&&sn(ve["source-layer"],pe["source-layer"])&&sn(ve.type,pe.type)){for(Se in Us(ve.layout,pe.layout,A,he,null,Wt.setLayoutProperty),Us(ve.paint,pe.paint,A,he,null,Wt.setPaintProperty),sn(ve.filter,pe.filter)||A.push({command:Wt.setFilter,args:[he,pe.filter]}),sn(ve.minzoom,pe.minzoom)&&sn(ve.maxzoom,pe.maxzoom)||A.push({command:Wt.setLayerZoomRange,args:[he,pe.minzoom,pe.maxzoom]}),ve)Object.prototype.hasOwnProperty.call(ve,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Us(ve[Se],pe[Se],A,he,Se.slice(6),Wt.setPaintProperty):sn(ve[Se],pe[Se])||A.push({command:Wt.setLayerProperty,args:[he,Se,pe[Se]]}));for(Se in pe)Object.prototype.hasOwnProperty.call(pe,Se)&&!Object.prototype.hasOwnProperty.call(ve,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Us(ve[Se],pe[Se],A,he,Se.slice(6),Wt.setPaintProperty):sn(ve[Se],pe[Se])||A.push({command:Wt.setLayerProperty,args:[he,Se,pe[Se]]}))}else A.push({command:Wt.removeLayer,args:[he]}),be=j[j.lastIndexOf(he)+1],A.push({command:Wt.addLayer,args:[pe,be]})}(v,r.layers,c)}catch(d){console.warn("Unable to compute style diff:",d),c=[{command:Wt.setStyle,args:[r]}]}return c},l.aF=function(a){const r=[],c=a.id;return c===void 0&&r.push({message:`layers.${c}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),r},l.aG=function a(r,c){if(Array.isArray(r)){if(!Array.isArray(c)||r.length!==c.length)return!1;for(let d=0;d<r.length;d++)if(!a(r[d],c[d]))return!1;return!0}if(typeof r=="object"&&r!==null&&c!==null){if(typeof c!="object"||Object.keys(r).length!==Object.keys(c).length)return!1;for(const d in r)if(!a(r[d],c[d]))return!1;return!0}return r===c},l.aH=Ee,l.aI=Re,l.aJ=vl,l.aK=function(a){return a({pluginStatus:tr,pluginURL:po}),vl.on("pluginStateChange",a),a},l.aL=class extends jo{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.aM=Ac,l.aN=class extends jo{constructor(a,r){super(a,r),this.current=Tg}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.aO=zf,l.aP=class extends jo{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.aQ=class extends jo{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.aR=Of,l.aS=function(a,r,c,d,m,v,x){var T=1/(r-c),A=1/(d-m),I=1/(v-x);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*I,a[11]=0,a[12]=(r+c)*T,a[13]=(m+d)*A,a[14]=(x+v)*I,a[15]=1,a},l.aT=Nt,l.aU=IP,l.aV=class extends p{},l.aW=wI,l.aX=class extends y{},l.aY=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.aZ=Ax,l.a_=$e,l.aa=function(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,m,v)=>{const x=m||v;return r[d]=!x||x.toLowerCase(),""}),r["max-age"]){const c=parseInt(r["max-age"],10);isNaN(c)?delete r["max-age"]:r["max-age"]=c}return r},l.ab=function(a,r){const c=[];for(const d in a)d in r||c.push(d);return c},l.ac=function(a){if(Ye==null){const r=a.navigator?a.navigator.userAgent:null;Ye=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Ye},l.ad=Pe,l.ae=function(a,r,c){var d=Math.sin(c),m=Math.cos(c),v=r[0],x=r[1],T=r[2],A=r[3],I=r[4],R=r[5],O=r[6],B=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=v*m+I*d,a[1]=x*m+R*d,a[2]=T*m+O*d,a[3]=A*m+B*d,a[4]=I*m-v*d,a[5]=R*m-x*d,a[6]=O*m-T*d,a[7]=B*m-A*d,a},l.af=function(a){var r=new Ic(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},l.ag=Uf,l.ah=function(a,r){let c=0,d=0;if(a.kind==="constant")d=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:m,minZoom:v,maxZoom:x}=a,T=m?Pe(wr.interpolationFactor(m,r,v,x),0,1):0;a.kind==="camera"?d=br.number(a.minSize,a.maxSize,T):c=T}return{uSizeT:c,uSize:d}},l.aj=function(a,{uSize:r,uSizeT:c},{lowerSize:d,upperSize:m}){return a.kind==="source"?d/go:a.kind==="composite"?br.number(d/go,m/go,c):r},l.ak=Xg,l.al=function(a,r,c,d){const m=r.y-a.y,v=r.x-a.x,x=d.y-c.y,T=d.x-c.x,A=x*v-T*m;if(A===0)return null;const I=(T*(a.y-c.y)-x*(a.x-c.x))/A;return new k(a.x+I*v,a.y+I*m)},l.am=Ib,l.an=mx,l.ao=Ig,l.ap=li,l.ar=Zg,l.as=function(a,r){var c=r[0],d=r[1],m=r[2],v=r[3],x=r[4],T=r[5],A=r[6],I=r[7],R=r[8],O=r[9],B=r[10],j=r[11],$=r[12],Q=r[13],oe=r[14],he=r[15],ve=c*T-d*x,pe=c*A-m*x,be=c*I-v*x,Se=d*A-m*T,Be=d*I-v*T,tt=m*I-v*A,ht=R*Q-O*$,Qe=R*oe-B*$,Je=R*he-j*$,We=O*oe-B*Q,st=O*he-j*Q,Xe=B*he-j*oe,je=ve*Xe-pe*st+be*We+Se*Je-Be*Qe+tt*ht;return je?(a[0]=(T*Xe-A*st+I*We)*(je=1/je),a[1]=(m*st-d*Xe-v*We)*je,a[2]=(Q*tt-oe*Be+he*Se)*je,a[3]=(B*Be-O*tt-j*Se)*je,a[4]=(A*Je-x*Xe-I*Qe)*je,a[5]=(c*Xe-m*Je+v*Qe)*je,a[6]=(oe*be-$*tt-he*pe)*je,a[7]=(R*tt-B*be+j*pe)*je,a[8]=(x*st-T*Je+I*ht)*je,a[9]=(d*Je-c*st-v*ht)*je,a[10]=($*Be-Q*be+he*ve)*je,a[11]=(O*be-R*Be-j*ve)*je,a[12]=(T*Qe-x*We-A*ht)*je,a[13]=(c*We-d*Qe+m*ht)*je,a[14]=(Q*pe-$*Se-oe*ve)*je,a[15]=(R*Se-O*pe+B*ve)*je,a):null},l.at=i_,l.au=qg,l.av=r_,l.aw=function(){const a={},r=Le.$version;for(const c in Le.$root){const d=Le.$root[c];if(d.required){let m=null;m=c==="version"?r:d.type==="array"?[]:{},m!=null&&(a[c]=m)}}return a},l.ax=Wt,l.ay=Af,l.az=tn,l.b=function(a,r){const c=new Blob([new Uint8Array(a)],{type:"image/png"});createImageBitmap(c).then(d=>{r(null,d)}).catch(d=>{r(new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=bi,l.b1=function(a,r){var c=a[0],d=a[1],m=a[2],v=a[3],x=a[4],T=a[5],A=a[6],I=a[7],R=a[8],O=a[9],B=a[10],j=a[11],$=a[12],Q=a[13],oe=a[14],he=a[15],ve=r[0],pe=r[1],be=r[2],Se=r[3],Be=r[4],tt=r[5],ht=r[6],Qe=r[7],Je=r[8],We=r[9],st=r[10],Xe=r[11],je=r[12],xt=r[13],ft=r[14],zt=r[15];return Math.abs(c-ve)<=ir*Math.max(1,Math.abs(c),Math.abs(ve))&&Math.abs(d-pe)<=ir*Math.max(1,Math.abs(d),Math.abs(pe))&&Math.abs(m-be)<=ir*Math.max(1,Math.abs(m),Math.abs(be))&&Math.abs(v-Se)<=ir*Math.max(1,Math.abs(v),Math.abs(Se))&&Math.abs(x-Be)<=ir*Math.max(1,Math.abs(x),Math.abs(Be))&&Math.abs(T-tt)<=ir*Math.max(1,Math.abs(T),Math.abs(tt))&&Math.abs(A-ht)<=ir*Math.max(1,Math.abs(A),Math.abs(ht))&&Math.abs(I-Qe)<=ir*Math.max(1,Math.abs(I),Math.abs(Qe))&&Math.abs(R-Je)<=ir*Math.max(1,Math.abs(R),Math.abs(Je))&&Math.abs(O-We)<=ir*Math.max(1,Math.abs(O),Math.abs(We))&&Math.abs(B-st)<=ir*Math.max(1,Math.abs(B),Math.abs(st))&&Math.abs(j-Xe)<=ir*Math.max(1,Math.abs(j),Math.abs(Xe))&&Math.abs($-je)<=ir*Math.max(1,Math.abs($),Math.abs(je))&&Math.abs(Q-xt)<=ir*Math.max(1,Math.abs(Q),Math.abs(xt))&&Math.abs(oe-ft)<=ir*Math.max(1,Math.abs(oe),Math.abs(ft))&&Math.abs(he-zt)<=ir*Math.max(1,Math.abs(he),Math.abs(zt))},l.b2=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.b3=function(a,r,c){return a[0]=r[0]*c[0],a[1]=r[1]*c[1],a[2]=r[2]*c[2],a[3]=r[3]*c[3],a},l.b4=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},l.b5=ze,l.b6=bb,l.b7=yb,l.b8=function(a,r,c,d,m){var v,x=1/Math.tan(r/2);return a[0]=x/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,m!=null&&m!==1/0?(a[10]=(m+d)*(v=1/(d-m)),a[14]=2*m*d*v):(a[10]=-1,a[14]=-2*d),a},l.b9=function(a,r,c){var d=Math.sin(c),m=Math.cos(c),v=r[4],x=r[5],T=r[6],A=r[7],I=r[8],R=r[9],O=r[10],B=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=v*m+I*d,a[5]=x*m+R*d,a[6]=T*m+O*d,a[7]=A*m+B*d,a[8]=I*m-v*d,a[9]=R*m-x*d,a[10]=O*m-T*d,a[11]=B*m-A*d,a},l.bA=C,l.bB=qx,l.bC=mc,l.bD=Er,l.ba=fe,l.bb=Te,l.bc=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.bd=class extends wl{},l.be=Qg,l.bf=vb,l.bg=rC,l.bi=Ci,l.bj=function(a,r,c=!1){if(tr===th||tr===nh||tr===ih)throw new Error("setRTLTextPlugin cannot be called multiple times.");po=Ii.resolveURL(a),tr=th,rh=r,sh(),c||Mf()},l.bk=oh,l.bl=function(a,r){const c={};for(let m=0;m<a.length;m++){const v=r&&r[a[m].id]||vc(a[m]);r&&(r[a[m].id]=v);let x=c[v];x||(x=c[v]=[]),x.push(a[m])}const d=[];for(const m in c)d.push(c[m]);return d},l.bm=it,l.bn=Tb,l.bo=Sb,l.bp=nb,l.bq=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=ei/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0],c=r.layout,d=r._unevaluatedLayout._values,m={layoutIconSize:d["icon-size"].possiblyEvaluate(new bn(a.bucket.zoom+1),a.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new bn(a.bucket.zoom+1),a.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new bn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:R}=a.bucket.textSizeData;m.compositeTextSizes=[d["text-size"].possiblyEvaluate(new bn(I),a.canonical),d["text-size"].possiblyEvaluate(new bn(R),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:R}=a.bucket.iconSizeData;m.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new bn(I),a.canonical),d["icon-size"].possiblyEvaluate(new bn(R),a.canonical)]}const v=c.get("text-line-height")*li,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),A=c.get("text-size");for(const I of a.bucket.features){const R=c.get("text-font").evaluate(I,{},a.canonical).join(","),O=A.evaluate(I,{},a.canonical),B=m.layoutTextSize.evaluate(I,{},a.canonical),j=m.layoutIconSize.evaluate(I,{},a.canonical),$={horizontal:{},vertical:void 0},Q=I.text;let oe,he=[0,0];if(Q){const be=Q.toString(),Se=c.get("text-letter-spacing").evaluate(I,{},a.canonical)*li,Be=Qu(be)?Se:0,tt=c.get("text-anchor").evaluate(I,{},a.canonical),ht=Fb(r,I,a.canonical);if(!ht){const Xe=c.get("text-radial-offset").evaluate(I,{},a.canonical);he=Xe?Ob(tt,[Xe*li,n_]):c.get("text-offset").evaluate(I,{},a.canonical).map(je=>je*li)}let Qe=x?"center":c.get("text-justify").evaluate(I,{},a.canonical);const Je=c.get("symbol-placement"),We=Je==="point"?c.get("text-max-width").evaluate(I,{},a.canonical)*li:0,st=()=>{a.bucket.allowVerticalPlacement&&Ju(be)&&($.vertical=qf(Q,a.glyphMap,a.glyphPositions,a.imagePositions,R,We,v,tt,"left",Be,he,l.ai.vertical,!0,Je,B,O))};if(!x&&ht){const Xe=new Set;if(Qe==="auto")for(let xt=0;xt<ht.values.length;xt+=2)Xe.add(i_(ht.values[xt]));else Xe.add(Qe);let je=!1;for(const xt of Xe)if(!$.horizontal[xt])if(je)$.horizontal[xt]=$.horizontal[0];else{const ft=qf(Q,a.glyphMap,a.glyphPositions,a.imagePositions,R,We,v,"center",xt,Be,he,l.ai.horizontal,!1,Je,B,O);ft&&($.horizontal[xt]=ft,je=ft.positionedLines.length===1)}st()}else{Qe==="auto"&&(Qe=i_(tt));const Xe=qf(Q,a.glyphMap,a.glyphPositions,a.imagePositions,R,We,v,tt,Qe,Be,he,l.ai.horizontal,!1,Je,B,O);Xe&&($.horizontal[Qe]=Xe),st(),Ju(be)&&x&&T&&($.vertical=qf(Q,a.glyphMap,a.glyphPositions,a.imagePositions,R,We,v,tt,Qe,Be,he,l.ai.vertical,!1,Je,B,O))}}let ve=!1;if(I.icon&&I.icon.name){const be=a.imageMap[I.icon.name];be&&(oe=NI(a.imagePositions[I.icon.name],c.get("icon-offset").evaluate(I,{},a.canonical),c.get("icon-anchor").evaluate(I,{},a.canonical)),ve=!!be.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&yt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==a.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const pe=Nb($.horizontal)||$.vertical;a.bucket.iconsInText=!!pe&&pe.iconsInText,(pe||oe)&&nC(a.bucket,I,$,oe,a.imageMap,m,B,j,he,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.br=Vg,l.bs=Bg,l.bt=Ug,l.bu=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.bv=Gg,l.bw=Ea,l.bx=function(a,r,c,d,m){return b(this,void 0,void 0,function*(){if(Z())try{return yield Ot(a,r,c,d,m)}catch{}return function(v,x,T,A,I){const R=v.width,O=v.height;Mt&&Kt||(Mt=new OffscreenCanvas(R,O),Kt=Mt.getContext("2d",{willReadFrequently:!0})),Mt.width=R,Mt.height=O,Kt.drawImage(v,0,0,R,O);const B=Kt.getImageData(x,T,A,I);return Kt.clearRect(0,0,R,O),B.data}(a,r,c,d,m)})},l.by=wb,l.bz=w,l.c=dn,l.d=function(a,r){const c=new Image;c.onload=()=>{r(null,c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=pt})},c.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(a)],{type:"image/png"});c.src=a.byteLength?URL.createObjectURL(d):pt},l.e=Oe,l.f=function(a,r){return Yi(Oe(a,{type:"json"}),r)},l.g=fn,l.h=Ii,l.i=Xt,l.j=Jr,l.k=Mi,l.l=Kr,l.m=Yi,l.n=function(a){return new Gg(a).readFields(RI,[])},l.o=function(a,r,c){if(!a.length)return c(null,[]);let d=a.length;const m=new Array(a.length);let v=null;a.forEach((x,T)=>{r(x,(A,I)=>{A&&(v=A),m[T]=I,--d==0&&c(v,m)})})},l.p=tb,l.q=vh,l.r=qn,l.s=Bi,l.t=vg,l.u=et,l.v=Le,l.w=yt,l.x=wc,l.y=Ws,l.z=function([a,r,c]){return r+=90,r*=Math.PI/180,c*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(c),y:a*Math.sin(r)*Math.sin(c),z:a*Math.cos(c)}}}),u(["./shared"],function(l){class b{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,U){for(const se of F){this._layerConfigs[se.id]=se;const ae=this._layers[se.id]=l.aC(se);ae._featureFilter=l.a6(ae.filter),this.keyCache[se.id]&&delete this.keyCache[se.id]}for(const se of U)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const X=l.bl(Object.values(this._layerConfigs),this.keyCache);for(const se of X){const ae=se.map(De=>this._layers[De.id]),xe=ae[0];if(xe.visibility==="none")continue;const me=xe.source||"";let ue=this.familiesBySource[me];ue||(ue=this.familiesBySource[me]={});const _e=xe.sourceLayer||"_geojsonTileLayer";let ke=ue[_e];ke||(ke=ue[_e]=[]),ke.push(ae)}}}class w{constructor(F){const U={},X=[];for(const me in F){const ue=F[me],_e=U[me]={};for(const ke in ue){const De=ue[+ke];if(!De||De.bitmap.width===0||De.bitmap.height===0)continue;const Ne={x:0,y:0,w:De.bitmap.width+2,h:De.bitmap.height+2};X.push(Ne),_e[ke]={rect:Ne,metrics:De.metrics}}}const{w:se,h:ae}=l.p(X),xe=new l.q({width:se||1,height:ae||1});for(const me in F){const ue=F[me];for(const _e in ue){const ke=ue[+_e];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const De=U[me][_e].rect;l.q.copy(ke.bitmap,xe,{x:0,y:0},{x:De.x+1,y:De.y+1},ke.bitmap)}}this.image=xe,this.positions=U}}l.bm("GlyphAtlas",w);class C{constructor(F){this.tileID=new l.O(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(F,U,X,se,ae){this.status="parsing",this.data=F,this.collisionBoxArray=new l.a3;const xe=new l.bn(Object.keys(F.layers).sort()),me=new l.bo(this.tileID,this.promoteId);me.bucketLayerIDs=[];const ue={},_e={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:X},ke=U.familiesBySource[this.source];for(const kt in ke){const Rt=F.layers[kt];if(!Rt)continue;Rt.version===1&&l.w(`Vector tile source "${this.source}" layer "${kt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Un=xe.encode(kt),nn=[];for(let Cn=0;Cn<Rt.length;Cn++){const ri=Rt.feature(Cn),Ji=me.getId(ri,kt);nn.push({feature:ri,id:Ji,index:Cn,sourceLayerIndex:Un})}for(const Cn of ke[kt]){const ri=Cn[0];ri.source!==this.source&&l.w(`layer.source = ${ri.source} does not equal this.source = ${this.source}`),ri.minzoom&&this.zoom<Math.floor(ri.minzoom)||ri.maxzoom&&this.zoom>=ri.maxzoom||ri.visibility!=="none"&&(L(Cn,this.zoom,X),(ue[ri.id]=ri.createBucket({index:me.bucketLayerIDs.length,layers:Cn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Un,sourceID:this.source})).populate(nn,_e,this.tileID.canonical),me.bucketLayerIDs.push(Cn.map(Ji=>Ji.id)))}}let De,Ne,gt,St;const ot=l.aH(_e.glyphDependencies,kt=>Object.keys(kt).map(Number));this.inFlightDependencies.forEach(kt=>kt==null?void 0:kt.cancel()),this.inFlightDependencies=[];const vt=++this.dependencySentinel;Object.keys(ot).length?this.inFlightDependencies.push(se.send("getGlyphs",{uid:this.uid,stacks:ot,source:this.source,tileID:this.tileID,type:"glyphs"},(kt,Rt)=>{vt===this.dependencySentinel&&(De||(De=kt,Ne=Rt,Jt.call(this)))})):Ne={};const At=Object.keys(_e.iconDependencies);At.length?this.inFlightDependencies.push(se.send("getImages",{icons:At,source:this.source,tileID:this.tileID,type:"icons"},(kt,Rt)=>{vt===this.dependencySentinel&&(De||(De=kt,gt=Rt,Jt.call(this)))})):gt={};const qt=Object.keys(_e.patternDependencies);function Jt(){if(De)return ae(De);if(Ne&&gt&&St){const kt=new w(Ne),Rt=new l.bp(gt,St);for(const Un in ue){const nn=ue[Un];nn instanceof l.a4?(L(nn.layers,this.zoom,X),l.bq({bucket:nn,glyphMap:Ne,glyphPositions:kt.positions,imageMap:gt,imagePositions:Rt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):nn.hasPattern&&(nn instanceof l.br||nn instanceof l.bs||nn instanceof l.bt)&&(L(nn.layers,this.zoom,X),nn.addFeatures(_e,this.tileID.canonical,Rt.patternPositions))}this.status="done",ae(null,{buckets:Object.values(ue).filter(Un=>!Un.isEmpty()),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kt.image,imageAtlas:Rt,glyphMap:this.returnDependencies?Ne:null,iconMap:this.returnDependencies?gt:null,glyphPositions:this.returnDependencies?kt.positions:null})}}qt.length?this.inFlightDependencies.push(se.send("getImages",{icons:qt,source:this.source,tileID:this.tileID,type:"patterns"},(kt,Rt)=>{vt===this.dependencySentinel&&(De||(De=kt,St=Rt,Jt.call(this)))})):St={},Jt.call(this)}}function L(ne,F,U){const X=new l.a8(F);for(const se of ne)se.recalculate(X,U)}function k(ne,F){const U=l.l(ne.request,(X,se,ae,xe)=>{if(X)F(X);else if(se)try{const me=new l.bw.VectorTile(new l.bv(se));F(null,{vectorTile:me,rawData:se,cacheControl:ae,expires:xe})}catch(me){const ue=new Uint8Array(se);let _e=`Unable to parse the tile at ${ne.request.url}, `;_e+=ue[0]===31&&ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${me.messge}`,F(new Error(_e))}});return()=>{U.cancel(),F()}}class H{constructor(F,U,X,se){this.actor=F,this.layerIndex=U,this.availableImages=X,this.loadVectorData=se||k,this.fetching={},this.loading={},this.loaded={}}loadTile(F,U){const X=F.uid;this.loading||(this.loading={});const se=!!(F&&F.request&&F.request.collectResourceTiming)&&new l.bu(F.request),ae=this.loading[X]=new C(F);ae.abort=this.loadVectorData(F,(xe,me)=>{if(delete this.loading[X],xe||!me)return ae.status="done",this.loaded[X]=ae,U(xe);const ue=me.rawData,_e={};me.expires&&(_e.expires=me.expires),me.cacheControl&&(_e.cacheControl=me.cacheControl);const ke={};if(se){const De=se.finish();De&&(ke.resourceTiming=JSON.parse(JSON.stringify(De)))}ae.vectorTile=me.vectorTile,ae.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,(De,Ne)=>{if(delete this.fetching[X],De||!Ne)return U(De);U(null,l.e({rawTileData:ue.slice(0)},Ne,_e,ke))}),this.loaded=this.loaded||{},this.loaded[X]=ae,this.fetching[X]={rawTileData:ue,cacheControl:_e,resourceTiming:ke}})}reloadTile(F,U){const X=this.loaded,se=F.uid;if(X&&X[se]){const ae=X[se];ae.showCollisionBoxes=F.showCollisionBoxes,ae.status==="parsing"?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,me)=>{if(xe||!me)return U(xe,me);let ue;if(this.fetching[se]){const{rawTileData:_e,cacheControl:ke,resourceTiming:De}=this.fetching[se];delete this.fetching[se],ue=l.e({rawTileData:_e.slice(0)},me,ke,De)}else ue=me;U(null,ue)}):ae.status==="done"&&(ae.vectorTile?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,U):U())}}abortTile(F,U){const X=this.loading,se=F.uid;X&&X[se]&&X[se].abort&&(X[se].abort(),delete X[se]),U()}removeTile(F,U){const X=this.loaded,se=F.uid;X&&X[se]&&delete X[se],U()}}class K{constructor(){this.loaded={}}loadTile(F,U){return l._(this,void 0,void 0,function*(){const{uid:X,encoding:se,rawImageData:ae,redFactor:xe,greenFactor:me,blueFactor:ue,baseShift:_e}=F,ke=ae.width+2,De=ae.height+2,Ne=l.a(ae)?new l.R({width:ke,height:De},yield l.bx(ae,-1,-1,ke,De)):ae,gt=new l.by(X,Ne,se,xe,me,ue,_e);this.loaded=this.loaded||{},this.loaded[X]=gt,U(null,gt)})}removeTile(F){const U=this.loaded,X=F.uid;U&&U[X]&&delete U[X]}}function re(ne,F){if(ne.length!==0){ce(ne[0],F);for(var U=1;U<ne.length;U++)ce(ne[U],!F)}}function ce(ne,F){for(var U=0,X=0,se=0,ae=ne.length,xe=ae-1;se<ae;xe=se++){var me=(ne[se][0]-ne[xe][0])*(ne[xe][1]+ne[se][1]),ue=U+me;X+=Math.abs(U)>=Math.abs(me)?U-ue+me:me-ue+U,U=ue}U+X>=0!=!!F&&ne.reverse()}var W=l.bz(function ne(F,U){var X,se=F&&F.type;if(se==="FeatureCollection")for(X=0;X<F.features.length;X++)ne(F.features[X],U);else if(se==="GeometryCollection")for(X=0;X<F.geometries.length;X++)ne(F.geometries[X],U);else if(se==="Feature")ne(F.geometry,U);else if(se==="Polygon")re(F.coordinates,U);else if(se==="MultiPolygon")for(X=0;X<F.coordinates.length;X++)re(F.coordinates[X],U);return F});const G=l.bw.VectorTileFeature.prototype.toGeoJSON;var Z={exports:{}},fe=l.bA,Te=l.bw.VectorTileFeature,Pe=ze;function ze(ne,F){this.options=F||{},this.features=ne,this.length=ne.length}function Oe(ne,F){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=F||4096}ze.prototype.feature=function(ne){return new Oe(this.features[ne],this.options.extent)},Oe.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var F=0;F<ne.length;F++){for(var U=ne[F],X=[],se=0;se<U.length;se++)X.push(new fe(U[se][0],U[se][1]));this.geometry.push(X)}return this.geometry},Oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,F=1/0,U=-1/0,X=1/0,se=-1/0,ae=0;ae<ne.length;ae++)for(var xe=ne[ae],me=0;me<xe.length;me++){var ue=xe[me];F=Math.min(F,ue.x),U=Math.max(U,ue.x),X=Math.min(X,ue.y),se=Math.max(se,ue.y)}return[F,X,U,se]},Oe.prototype.toGeoJSON=Te.prototype.toGeoJSON;var Me=l.bB,Ee=Pe;function Re(ne){var F=new Me;return function(U,X){for(var se in U.layers)X.writeMessage(3,nt,U.layers[se])}(ne,F),F.finish()}function nt(ne,F){var U;F.writeVarintField(15,ne.version||1),F.writeStringField(1,ne.name||""),F.writeVarintField(5,ne.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<ne.length;U++)X.feature=ne.feature(U),F.writeMessage(2,rt,X);var se=X.keys;for(U=0;U<se.length;U++)F.writeStringField(3,se[U]);var ae=X.values;for(U=0;U<ae.length;U++)F.writeMessage(4,Ye,ae[U])}function rt(ne,F){var U=ne.feature;U.id!==void 0&&F.writeVarintField(1,U.id),F.writeMessage(2,yt,ne),F.writeVarintField(3,U.type),F.writeMessage(4,Xt,U)}function yt(ne,F){var U=ne.feature,X=ne.keys,se=ne.values,ae=ne.keycache,xe=ne.valuecache;for(var me in U.properties){var ue=U.properties[me],_e=ae[me];if(ue!==null){_e===void 0&&(X.push(me),ae[me]=_e=X.length-1),F.writeVarint(_e);var ke=typeof ue;ke!=="string"&&ke!=="boolean"&&ke!=="number"&&(ue=JSON.stringify(ue));var De=ke+":"+ue,Ne=xe[De];Ne===void 0&&(se.push(ue),xe[De]=Ne=se.length-1),F.writeVarint(Ne)}}}function Dt(ne,F){return(F<<3)+(7&ne)}function Sn(ne){return ne<<1^ne>>31}function Xt(ne,F){for(var U=ne.loadGeometry(),X=ne.type,se=0,ae=0,xe=U.length,me=0;me<xe;me++){var ue=U[me],_e=1;X===1&&(_e=ue.length),F.writeVarint(Dt(1,_e));for(var ke=X===3?ue.length-1:ue.length,De=0;De<ke;De++){De===1&&X!==1&&F.writeVarint(Dt(2,ke-1));var Ne=ue[De].x-se,gt=ue[De].y-ae;F.writeVarint(Sn(Ne)),F.writeVarint(Sn(gt)),se+=Ne,ae+=gt}X===3&&F.writeVarint(Dt(7,1))}}function Ye(ne,F){var U=typeof ne;U==="string"?F.writeStringField(1,ne):U==="boolean"?F.writeBooleanField(7,ne):U==="number"&&(ne%1!=0?F.writeDoubleField(3,ne):ne<0?F.writeSVarintField(6,ne):F.writeVarintField(5,ne))}Z.exports=Re,Z.exports.fromVectorTileJs=Re,Z.exports.fromGeojsonVt=function(ne,F){F=F||{};var U={};for(var X in ne)U[X]=new Ee(ne[X].features,F),U[X].name=X,U[X].version=F.version,U[X].extent=F.extent;return Re({layers:U})},Z.exports.GeoJSONWrapper=Ee;var Tt=l.bz(Z.exports);const pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},Ot=Math.fround||(Mt=new Float32Array(1),ne=>(Mt[0]=+ne,Mt[0]));var Mt;const Kt=3,vn=5,mr=6;class Ii{constructor(F){this.options=Object.assign(Object.create(pt),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:U,minZoom:X,maxZoom:se}=this.options;U&&console.time("total time");const ae=`prepare ${F.length} points`;U&&console.time(ae),this.points=F;const xe=[];for(let ue=0;ue<F.length;ue++){const _e=F[ue];if(!_e.geometry)continue;const[ke,De]=_e.geometry.coordinates,Ne=Ot(tn(ke)),gt=Ot(fn(De));xe.push(Ne,gt,1/0,ue,-1,1),this.options.reduce&&xe.push(0)}let me=this.trees[se+1]=this._createTree(xe);U&&console.timeEnd(ae);for(let ue=se;ue>=X;ue--){const _e=+Date.now();me=this.trees[ue]=this._createTree(this._cluster(me,ue)),U&&console.log("z%d: %d clusters in %dms",ue,me.numItems,+Date.now()-_e)}return U&&console.timeEnd("total time"),this}getClusters(F,U){let X=((F[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,F[1]));let ae=F[2]===180?180:((F[2]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)X=-180,ae=180;else if(X>ae){const De=this.getClusters([X,se,180,xe],U),Ne=this.getClusters([-180,se,ae,xe],U);return De.concat(Ne)}const me=this.trees[this._limitZoom(U)],ue=me.range(tn(X),fn(xe),tn(ae),fn(se)),_e=me.data,ke=[];for(const De of ue){const Ne=this.stride*De;ke.push(_e[Ne+vn]>1?dn(_e,Ne,this.clusterProps):this.points[_e[Ne+Kt]])}return ke}getChildren(F){const U=this._getOriginId(F),X=this._getOriginZoom(F),se="No cluster with the specified id.",ae=this.trees[X];if(!ae)throw new Error(se);const xe=ae.data;if(U*this.stride>=xe.length)throw new Error(se);const me=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ue=ae.within(xe[U*this.stride],xe[U*this.stride+1],me),_e=[];for(const ke of ue){const De=ke*this.stride;xe[De+4]===F&&_e.push(xe[De+vn]>1?dn(xe,De,this.clusterProps):this.points[xe[De+Kt]])}if(_e.length===0)throw new Error(se);return _e}getLeaves(F,U,X){const se=[];return this._appendLeaves(se,F,U=U||10,X=X||0,0),se}getTile(F,U,X){const se=this.trees[this._limitZoom(F)],ae=Math.pow(2,F),{extent:xe,radius:me}=this.options,ue=me/xe,_e=(X-ue)/ae,ke=(X+1+ue)/ae,De={features:[]};return this._addTileFeatures(se.range((U-ue)/ae,_e,(U+1+ue)/ae,ke),se.data,U,X,ae,De),U===0&&this._addTileFeatures(se.range(1-ue/ae,_e,1,ke),se.data,ae,X,ae,De),U===ae-1&&this._addTileFeatures(se.range(0,_e,ue/ae,ke),se.data,-1,X,ae,De),De.features.length?De:null}getClusterExpansionZoom(F){let U=this._getOriginZoom(F)-1;for(;U<=this.options.maxZoom;){const X=this.getChildren(F);if(U++,X.length!==1)break;F=X[0].properties.cluster_id}return U}_appendLeaves(F,U,X,se,ae){const xe=this.getChildren(U);for(const me of xe){const ue=me.properties;if(ue&&ue.cluster?ae+ue.point_count<=se?ae+=ue.point_count:ae=this._appendLeaves(F,ue.cluster_id,X,se,ae):ae<se?ae++:F.push(me),F.length===X)break}return ae}_createTree(F){const U=new l.av(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<F.length;X+=this.stride)U.add(F[X],F[X+1]);return U.finish(),U.data=F,U}_addTileFeatures(F,U,X,se,ae,xe){for(const me of F){const ue=me*this.stride,_e=U[ue+vn]>1;let ke,De,Ne;if(_e)ke=Ci(U,ue,this.clusterProps),De=U[ue],Ne=U[ue+1];else{const ot=this.points[U[ue+Kt]];ke=ot.properties;const[vt,At]=ot.geometry.coordinates;De=tn(vt),Ne=fn(At)}const gt={type:1,geometry:[[Math.round(this.options.extent*(De*ae-X)),Math.round(this.options.extent*(Ne*ae-se))]],tags:ke};let St;St=_e||this.options.generateId?U[ue+Kt]:this.points[U[ue+Kt]].id,St!==void 0&&(gt.id=St),xe.features.push(gt)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,U){const{radius:X,extent:se,reduce:ae,minPoints:xe}=this.options,me=X/(se*Math.pow(2,U)),ue=F.data,_e=[],ke=this.stride;for(let De=0;De<ue.length;De+=ke){if(ue[De+2]<=U)continue;ue[De+2]=U;const Ne=ue[De],gt=ue[De+1],St=F.within(ue[De],ue[De+1],me),ot=ue[De+vn];let vt=ot;for(const At of St){const qt=At*ke;ue[qt+2]>U&&(vt+=ue[qt+vn])}if(vt>ot&&vt>=xe){let At,qt=Ne*ot,Jt=gt*ot,kt=-1;const Rt=((De/ke|0)<<5)+(U+1)+this.points.length;for(const Un of St){const nn=Un*ke;if(ue[nn+2]<=U)continue;ue[nn+2]=U;const Cn=ue[nn+vn];qt+=ue[nn]*Cn,Jt+=ue[nn+1]*Cn,ue[nn+4]=Rt,ae&&(At||(At=this._map(ue,De,!0),kt=this.clusterProps.length,this.clusterProps.push(At)),ae(At,this._map(ue,nn)))}ue[De+4]=Rt,_e.push(qt/vt,Jt/vt,1/0,Rt,-1,vt),ae&&_e.push(kt)}else{for(let At=0;At<ke;At++)_e.push(ue[De+At]);if(vt>1)for(const At of St){const qt=At*ke;if(!(ue[qt+2]<=U)){ue[qt+2]=U;for(let Jt=0;Jt<ke;Jt++)_e.push(ue[qt+Jt])}}}}return _e}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,U,X){if(F[U+vn]>1){const xe=this.clusterProps[F[U+mr]];return X?Object.assign({},xe):xe}const se=this.points[F[U+Kt]].properties,ae=this.options.map(se);return X&&ae===se?Object.assign({},ae):ae}}function dn(ne,F,U){return{type:"Feature",id:ne[F+Kt],properties:Ci(ne,F,U),geometry:{type:"Point",coordinates:[(X=ne[F],360*(X-.5)),vs(ne[F+1])]}};var X}function Ci(ne,F,U){const X=ne[F+vn],se=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,ae=ne[F+mr],xe=ae===-1?{}:Object.assign({},U[ae]);return Object.assign(xe,{cluster:!0,cluster_id:ne[F+Kt],point_count:X,point_count_abbreviated:se})}function tn(ne){return ne/360+.5}function fn(ne){const F=Math.sin(ne*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function vs(ne){const F=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Yi(ne,F,U,X){for(var se,ae=X,xe=U-F>>1,me=U-F,ue=ne[F],_e=ne[F+1],ke=ne[U],De=ne[U+1],Ne=F+3;Ne<U;Ne+=3){var gt=Kr(ne[Ne],ne[Ne+1],ue,_e,ke,De);if(gt>ae)se=Ne,ae=gt;else if(gt===ae){var St=Math.abs(Ne-xe);St<me&&(se=Ne,me=St)}}ae>X&&(se-F>3&&Yi(ne,F,se,X),ne[se+2]=ae,U-se>3&&Yi(ne,se,U,X))}function Kr(ne,F,U,X,se,ae){var xe=se-U,me=ae-X;if(xe!==0||me!==0){var ue=((ne-U)*xe+(F-X)*me)/(xe*xe+me*me);ue>1?(U=se,X=ae):ue>0&&(U+=xe*ue,X+=me*ue)}return(xe=ne-U)*xe+(me=F-X)*me}function Bi(ne,F,U,X){var se={id:ne===void 0?null:ne,type:F,geometry:U,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ae){var xe=ae.geometry,me=ae.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")zr(ae,xe);else if(me==="Polygon"||me==="MultiLineString")for(var ue=0;ue<xe.length;ue++)zr(ae,xe[ue]);else if(me==="MultiPolygon")for(ue=0;ue<xe.length;ue++)for(var _e=0;_e<xe[ue].length;_e++)zr(ae,xe[ue][_e])}(se),se}function zr(ne,F){for(var U=0;U<F.length;U+=3)ne.minX=Math.min(ne.minX,F[U]),ne.minY=Math.min(ne.minY,F[U+1]),ne.maxX=Math.max(ne.maxX,F[U]),ne.maxY=Math.max(ne.maxY,F[U+1])}function gi(ne,F,U,X){if(F.geometry){var se=F.geometry.coordinates,ae=F.geometry.type,xe=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),me=[],ue=F.id;if(U.promoteId?ue=F.properties[U.promoteId]:U.generateId&&(ue=X||0),ae==="Point")Mi(se,me);else if(ae==="MultiPoint")for(var _e=0;_e<se.length;_e++)Mi(se[_e],me);else if(ae==="LineString")Jr(se,me,xe,!1);else if(ae==="MultiLineString"){if(U.lineMetrics){for(_e=0;_e<se.length;_e++)Jr(se[_e],me=[],xe,!1),ne.push(Bi(ue,"LineString",me,F.properties));return}xs(se,me,xe,!1)}else if(ae==="Polygon")xs(se,me,xe,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(_e=0;_e<F.geometry.geometries.length;_e++)gi(ne,{id:ue,geometry:F.geometry.geometries[_e],properties:F.properties},U,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<se.length;_e++){var ke=[];xs(se[_e],ke,xe,!0),me.push(ke)}}ne.push(Bi(ue,ae,me,F.properties))}}function Mi(ne,F){F.push(Le(ne[0])),F.push(pn(ne[1])),F.push(0)}function Jr(ne,F,U,X){for(var se,ae,xe=0,me=0;me<ne.length;me++){var ue=Le(ne[me][0]),_e=pn(ne[me][1]);F.push(ue),F.push(_e),F.push(0),me>0&&(xe+=X?(se*_e-ue*ae)/2:Math.sqrt(Math.pow(ue-se,2)+Math.pow(_e-ae,2))),se=ue,ae=_e}var ke=F.length-3;F[2]=1,Yi(F,0,ke,U),F[ke+2]=1,F.size=Math.abs(xe),F.start=0,F.end=F.size}function xs(ne,F,U,X){for(var se=0;se<ne.length;se++){var ae=[];Jr(ne[se],ae,U,X),F.push(ae)}}function Le(ne){return ne/360+.5}function pn(ne){var F=Math.sin(ne*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function Ki(ne,F,U,X,se,ae,xe,me){if(X/=F,ae>=(U/=F)&&xe<X)return ne;if(xe<U||ae>=X)return null;for(var ue=[],_e=0;_e<ne.length;_e++){var ke=ne[_e],De=ke.geometry,Ne=ke.type,gt=se===0?ke.minX:ke.minY,St=se===0?ke.maxX:ke.maxY;if(gt>=U&&St<X)ue.push(ke);else if(!(St<U||gt>=X)){var ot=[];if(Ne==="Point"||Ne==="MultiPoint")sn(De,ot,U,X,se);else if(Ne==="LineString")Wt(De,ot,U,X,se,!1,me.lineMetrics);else if(Ne==="MultiLineString")lo(De,ot,U,X,se,!1);else if(Ne==="Polygon")lo(De,ot,U,X,se,!0);else if(Ne==="MultiPolygon")for(var vt=0;vt<De.length;vt++){var At=[];lo(De[vt],At,U,X,se,!0),At.length&&ot.push(At)}if(ot.length){if(me.lineMetrics&&Ne==="LineString"){for(vt=0;vt<ot.length;vt++)ue.push(Bi(ke.id,Ne,ot[vt],ke.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(ot.length===1?(Ne="LineString",ot=ot[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=ot.length===3?"Point":"MultiPoint"),ue.push(Bi(ke.id,Ne,ot,ke.tags))}}}return ue.length?ue:null}function sn(ne,F,U,X,se){for(var ae=0;ae<ne.length;ae+=3){var xe=ne[ae+se];xe>=U&&xe<=X&&(F.push(ne[ae]),F.push(ne[ae+1]),F.push(ne[ae+2]))}}function Wt(ne,F,U,X,se,ae,xe){for(var me,ue,_e=Or(ne),ke=se===0?Lo:Us,De=ne.start,Ne=0;Ne<ne.length-3;Ne+=3){var gt=ne[Ne],St=ne[Ne+1],ot=ne[Ne+2],vt=ne[Ne+3],At=ne[Ne+4],qt=se===0?gt:St,Jt=se===0?vt:At,kt=!1;xe&&(me=Math.sqrt(Math.pow(gt-vt,2)+Math.pow(St-At,2))),qt<U?Jt>U&&(ue=ke(_e,gt,St,vt,At,U),xe&&(_e.start=De+me*ue)):qt>X?Jt<X&&(ue=ke(_e,gt,St,vt,At,X),xe&&(_e.start=De+me*ue)):Fr(_e,gt,St,ot),Jt<U&&qt>=U&&(ue=ke(_e,gt,St,vt,At,U),kt=!0),Jt>X&&qt<=X&&(ue=ke(_e,gt,St,vt,At,X),kt=!0),!ae&&kt&&(xe&&(_e.end=De+me*ue),F.push(_e),_e=Or(ne)),xe&&(De+=me)}var Rt=ne.length-3;gt=ne[Rt],St=ne[Rt+1],ot=ne[Rt+2],(qt=se===0?gt:St)>=U&&qt<=X&&Fr(_e,gt,St,ot),Rt=_e.length-3,ae&&Rt>=3&&(_e[Rt]!==_e[0]||_e[Rt+1]!==_e[1])&&Fr(_e,_e[0],_e[1],_e[2]),_e.length&&F.push(_e)}function Or(ne){var F=[];return F.size=ne.size,F.start=ne.start,F.end=ne.end,F}function lo(ne,F,U,X,se,ae){for(var xe=0;xe<ne.length;xe++)Wt(ne[xe],F,U,X,se,ae,!1)}function Fr(ne,F,U,X){ne.push(F),ne.push(U),ne.push(X)}function Lo(ne,F,U,X,se,ae){var xe=(ae-F)/(X-F);return ne.push(ae),ne.push(U+(se-U)*xe),ne.push(1),xe}function Us(ne,F,U,X,se,ae){var xe=(ae-U)/(se-U);return ne.push(F+(X-F)*xe),ne.push(ae),ne.push(1),xe}function Qr(ne,F){for(var U=[],X=0;X<ne.length;X++){var se,ae=ne[X],xe=ae.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")se=Br(ae.geometry,F);else if(xe==="MultiLineString"||xe==="Polygon"){se=[];for(var me=0;me<ae.geometry.length;me++)se.push(Br(ae.geometry[me],F))}else if(xe==="MultiPolygon")for(se=[],me=0;me<ae.geometry.length;me++){for(var ue=[],_e=0;_e<ae.geometry[me].length;_e++)ue.push(Br(ae.geometry[me][_e],F));se.push(ue)}U.push(Bi(ae.id,xe,se,ae.tags))}return U}function Br(ne,F){var U=[];U.size=ne.size,ne.start!==void 0&&(U.start=ne.start,U.end=ne.end);for(var X=0;X<ne.length;X+=3)U.push(ne[X]+F,ne[X+1],ne[X+2]);return U}function He(ne,F){if(ne.transformed)return ne;var U,X,se,ae=1<<ne.z,xe=ne.x,me=ne.y;for(U=0;U<ne.features.length;U++){var ue=ne.features[U],_e=ue.geometry,ke=ue.type;if(ue.geometry=[],ke===1)for(X=0;X<_e.length;X+=2)ue.geometry.push(Nr(_e[X],_e[X+1],F,ae,xe,me));else for(X=0;X<_e.length;X++){var De=[];for(se=0;se<_e[X].length;se+=2)De.push(Nr(_e[X][se],_e[X][se+1],F,ae,xe,me));ue.geometry.push(De)}}return ne.transformed=!0,ne}function Nr(ne,F,U,X,se,ae){return[Math.round(U*(ne*X-se)),Math.round(U*(F*X-ae))]}function An(ne,F,U,X,se){for(var ae=F===se.maxZoom?0:se.tolerance/((1<<F)*se.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:X,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},me=0;me<ne.length;me++){xe.numFeatures++,Vs(xe,ne[me],ae,se);var ue=ne[me].minX,_e=ne[me].minY,ke=ne[me].maxX,De=ne[me].maxY;ue<xe.minX&&(xe.minX=ue),_e<xe.minY&&(xe.minY=_e),ke>xe.maxX&&(xe.maxX=ke),De>xe.maxY&&(xe.maxY=De)}return xe}function Vs(ne,F,U,X){var se=F.geometry,ae=F.type,xe=[];if(ae==="Point"||ae==="MultiPoint")for(var me=0;me<se.length;me+=3)xe.push(se[me]),xe.push(se[me+1]),ne.numPoints++,ne.numSimplified++;else if(ae==="LineString")es(xe,se,ne,U,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(me=0;me<se.length;me++)es(xe,se[me],ne,U,ae==="Polygon",me===0);else if(ae==="MultiPolygon")for(var ue=0;ue<se.length;ue++){var _e=se[ue];for(me=0;me<_e.length;me++)es(xe,_e[me],ne,U,!0,me===0)}if(xe.length){var ke=F.tags||null;if(ae==="LineString"&&X.lineMetrics){for(var De in ke={},F.tags)ke[De]=F.tags[De];ke.mapbox_clip_start=se.start/se.size,ke.mapbox_clip_end=se.end/se.size}var Ne={geometry:xe,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:ke};F.id!==null&&(Ne.id=F.id),ne.features.push(Ne)}}function es(ne,F,U,X,se,ae){var xe=X*X;if(X>0&&F.size<(se?xe:X))U.numPoints+=F.length/3;else{for(var me=[],ue=0;ue<F.length;ue+=3)(X===0||F[ue+2]>xe)&&(U.numSimplified++,me.push(F[ue]),me.push(F[ue+1])),U.numPoints++;se&&function(_e,ke){for(var De=0,Ne=0,gt=_e.length,St=gt-2;Ne<gt;St=Ne,Ne+=2)De+=(_e[Ne]-_e[St])*(_e[Ne+1]+_e[St+1]);if(De>0===ke)for(Ne=0,gt=_e.length;Ne<gt/2;Ne+=2){var ot=_e[Ne],vt=_e[Ne+1];_e[Ne]=_e[gt-2-Ne],_e[Ne+1]=_e[gt-1-Ne],_e[gt-2-Ne]=ot,_e[gt-1-Ne]=vt}}(me,ae),ne.push(me)}}function qe(ne,F){var U=(F=this.options=function(se,ae){for(var xe in ae)se[xe]=ae[xe];return se}(Object.create(this.options),F)).debug;if(U&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(se,ae){var xe=[];if(se.type==="FeatureCollection")for(var me=0;me<se.features.length;me++)gi(xe,se.features[me],ae,me);else gi(xe,se.type==="Feature"?se:{geometry:se},ae);return xe}(ne,F);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(se,ae){var xe=ae.buffer/ae.extent,me=se,ue=Ki(se,1,-1-xe,xe,0,-1,2,ae),_e=Ki(se,1,1-xe,2+xe,0,-1,2,ae);return(ue||_e)&&(me=Ki(se,1,-xe,1+xe,0,-1,2,ae)||[],ue&&(me=Qr(ue,1).concat(me)),_e&&(me=me.concat(Qr(_e,-1)))),me}(X,F),X.length&&this.splitTile(X,0,0,0),U&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function It(ne,F,U){return 32*((1<<ne)*U+F)+ne}function Pt(ne,F){return F?ne.properties[F]:ne.id}function yi(ne,F){if(ne==null)return!0;if(ne.type==="Feature")return Pt(ne,F)!=null;if(ne.type==="FeatureCollection"){const U=new Set;for(const X of ne.features){const se=Pt(X,F);if(se==null||U.has(se))return!1;U.add(se)}return!0}return!1}function gr(ne,F){const U=new Map;if(ne!=null)if(ne.type==="Feature")U.set(Pt(ne,F),ne);else for(const X of ne.features)U.set(Pt(X,F),X);return U}qe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qe.prototype.splitTile=function(ne,F,U,X,se,ae,xe){for(var me=[ne,F,U,X],ue=this.options,_e=ue.debug;me.length;){X=me.pop(),U=me.pop(),F=me.pop(),ne=me.pop();var ke=1<<F,De=It(F,U,X),Ne=this.tiles[De];if(!Ne&&(_e>1&&console.time("creation"),Ne=this.tiles[De]=An(ne,F,U,X,ue),this.tileCoords.push({z:F,x:U,y:X}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,U,X,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var gt="z"+F;this.stats[gt]=(this.stats[gt]||0)+1,this.total++}if(Ne.source=ne,se){if(F===ue.maxZoom||F===se)continue;var St=1<<se-F;if(U!==Math.floor(ae/St)||X!==Math.floor(xe/St))continue}else if(F===ue.indexMaxZoom||Ne.numPoints<=ue.indexMaxPoints)continue;if(Ne.source=null,ne.length!==0){_e>1&&console.time("clipping");var ot,vt,At,qt,Jt,kt,Rt=.5*ue.buffer/ue.extent,Un=.5-Rt,nn=.5+Rt,Cn=1+Rt;ot=vt=At=qt=null,Jt=Ki(ne,ke,U-Rt,U+nn,0,Ne.minX,Ne.maxX,ue),kt=Ki(ne,ke,U+Un,U+Cn,0,Ne.minX,Ne.maxX,ue),ne=null,Jt&&(ot=Ki(Jt,ke,X-Rt,X+nn,1,Ne.minY,Ne.maxY,ue),vt=Ki(Jt,ke,X+Un,X+Cn,1,Ne.minY,Ne.maxY,ue),Jt=null),kt&&(At=Ki(kt,ke,X-Rt,X+nn,1,Ne.minY,Ne.maxY,ue),qt=Ki(kt,ke,X+Un,X+Cn,1,Ne.minY,Ne.maxY,ue),kt=null),_e>1&&console.timeEnd("clipping"),me.push(ot||[],F+1,2*U,2*X),me.push(vt||[],F+1,2*U,2*X+1),me.push(At||[],F+1,2*U+1,2*X),me.push(qt||[],F+1,2*U+1,2*X+1)}}},qe.prototype.getTile=function(ne,F,U){var X=this.options,se=X.extent,ae=X.debug;if(ne<0||ne>24)return null;var xe=1<<ne,me=It(ne,F=(F%xe+xe)%xe,U);if(this.tiles[me])return He(this.tiles[me],se);ae>1&&console.log("drilling down to z%d-%d-%d",ne,F,U);for(var ue,_e=ne,ke=F,De=U;!ue&&_e>0;)_e--,ke=Math.floor(ke/2),De=Math.floor(De/2),ue=this.tiles[It(_e,ke,De)];return ue&&ue.source?(ae>1&&console.log("found parent tile z%d-%d-%d",_e,ke,De),ae>1&&console.time("drilling down"),this.splitTile(ue.source,_e,ke,De,ne,F,U),ae>1&&console.timeEnd("drilling down"),this.tiles[me]?He(this.tiles[me],se):null):null};class Ct extends H{constructor(F,U,X,se){super(F,U,X),this._dataUpdateable=new Map,this.loadGeoJSON=(ae,xe)=>{const{promoteId:me}=ae;if(ae.request)return l.f(ae.request,(ue,_e,ke,De)=>{this._dataUpdateable=yi(_e,me)?gr(_e,me):void 0,xe(ue,_e,ke,De)});if(typeof ae.data=="string")try{const ue=JSON.parse(ae.data);this._dataUpdateable=yi(ue,me)?gr(ue,me):void 0,xe(null,ue)}catch{xe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`))}else ae.dataDiff?this._dataUpdateable?(function(ue,_e,ke){var De,Ne,gt,St;if(_e.removeAll&&ue.clear(),_e.remove)for(const ot of _e.remove)ue.delete(ot);if(_e.add)for(const ot of _e.add){const vt=Pt(ot,ke);vt!=null&&ue.set(vt,ot)}if(_e.update)for(const ot of _e.update){let vt=ue.get(ot.id);if(vt==null)continue;const At=!ot.removeAllProperties&&(((De=ot.removeProperties)===null||De===void 0?void 0:De.length)>0||((Ne=ot.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0);if((ot.newGeometry||ot.removeAllProperties||At)&&(vt=Object.assign({},vt),ue.set(ot.id,vt),At&&(vt.properties=Object.assign({},vt.properties))),ot.newGeometry&&(vt.geometry=ot.newGeometry),ot.removeAllProperties)vt.properties={};else if(((gt=ot.removeProperties)===null||gt===void 0?void 0:gt.length)>0)for(const qt of ot.removeProperties)Object.prototype.hasOwnProperty.call(vt.properties,qt)&&delete vt.properties[qt];if(((St=ot.addOrUpdateProperties)===null||St===void 0?void 0:St.length)>0)for(const{key:qt,value:Jt}of ot.addOrUpdateProperties)vt.properties[qt]=Jt}}(this._dataUpdateable,ae.dataDiff,me),xe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):xe(new Error(`Cannot update existing geojson data in ${ae.source}`)):xe(new Error(`Input data given to '${ae.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,se&&(this.loadGeoJSON=se)}loadGeoJSONTile(F,U){const X=F.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const se=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!se)return U(null,null);const ae=new class{constructor(me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=me.length,this._features=me}feature(me){return new class{constructor(ue){this._feature=ue,this.extent=l.N,this.type=ue.type,this.properties=ue.tags,"id"in ue&&!isNaN(ue.id)&&(this.id=parseInt(ue.id,10))}loadGeometry(){if(this._feature.type===1){const ue=[];for(const _e of this._feature.geometry)ue.push([new l.P(_e[0],_e[1])]);return ue}{const ue=[];for(const _e of this._feature.geometry){const ke=[];for(const De of _e)ke.push(new l.P(De[0],De[1]));ue.push(ke)}return ue}}toGeoJSON(ue,_e,ke){return G.call(this,ue,_e,ke)}}(this._features[me])}}(se.features);let xe=Tt(ae);xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),U(null,{vectorTile:ae,rawData:xe.buffer})}loadData(F,U){var X;(X=this._pendingRequest)===null||X===void 0||X.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const se=!!(F&&F.request&&F.request.collectResourceTiming)&&new l.bu(F.request);this._pendingCallback=U,this._pendingRequest=this.loadGeoJSON(F,(ae,xe)=>{if(delete this._pendingCallback,delete this._pendingRequest,ae||!xe)return U(ae);if(typeof xe!="object")return U(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{W(xe,!0);try{if(F.filter){const ue=l.bC(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));xe={type:"FeatureCollection",features:xe.features.filter(ke=>ue.value.evaluate({zoom:0},ke))}}this._geoJSONIndex=F.cluster?new Ii(function({superclusterOptions:ue,clusterProperties:_e}){if(!_e||!ue)return ue;const ke={},De={},Ne={accumulated:null,zoom:0},gt={properties:null},St=Object.keys(_e);for(const ot of St){const[vt,At]=_e[ot],qt=l.bC(At),Jt=l.bC(typeof vt=="string"?[vt,["accumulated"],["get",ot]]:vt);ke[ot]=qt.value,De[ot]=Jt.value}return ue.map=ot=>{gt.properties=ot;const vt={};for(const At of St)vt[At]=ke[At].evaluate(Ne,gt);return vt},ue.reduce=(ot,vt)=>{gt.properties=vt;for(const At of St)Ne.accumulated=ot[At],ot[At]=De[At].evaluate(Ne,gt)},ue}(F)).load(xe.features):function(ue,_e){return new qe(ue,_e)}(xe,F.geojsonVtOptions)}catch(ue){return U(ue)}this.loaded={};const me={};if(se){const ue=se.finish();ue&&(me.resourceTiming={},me.resourceTiming[F.source]=JSON.parse(JSON.stringify(ue)))}U(null,me)}})}reloadTile(F,U){const X=this.loaded;return X&&X[F.uid]?super.reloadTile(F,U):this.loadTile(F,U)}removeSource(F,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),U()}getClusterExpansionZoom(F,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(X){U(X)}}getClusterChildren(F,U){try{U(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(X){U(X)}}getClusterLeaves(F,U){try{U(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(X){U(X)}}}class _r{constructor(F){this.self=F,this.actor=new l.C(F,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:H,geojson:Ct},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,X)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=X},this.self.registerRTLTextPlugin=U=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=U.applyArabicShaping,l.bD.processBidirectionalText=U.processBidirectionalText,l.bD.processStyledBidirectionalText=U.processStyledBidirectionalText}}setReferrer(F,U){this.referrer=U}setImages(F,U,X){this.availableImages[F]=U;for(const se in this.workerSources[F]){const ae=this.workerSources[F][se];for(const xe in ae)ae[xe].availableImages=U}X()}setLayers(F,U,X){this.getLayerIndex(F).replace(U),X()}updateLayers(F,U,X){this.getLayerIndex(F).update(U.layers,U.removedIds),X()}loadTile(F,U,X){this.getWorkerSource(F,U.type,U.source).loadTile(U,X)}loadDEMTile(F,U,X){this.getDEMWorkerSource(F,U.source).loadTile(U,X)}reloadTile(F,U,X){this.getWorkerSource(F,U.type,U.source).reloadTile(U,X)}abortTile(F,U,X){this.getWorkerSource(F,U.type,U.source).abortTile(U,X)}removeTile(F,U,X){this.getWorkerSource(F,U.type,U.source).removeTile(U,X)}removeDEMTile(F,U){this.getDEMWorkerSource(F,U.source).removeTile(U)}removeSource(F,U,X){if(!this.workerSources[F]||!this.workerSources[F][U.type]||!this.workerSources[F][U.type][U.source])return;const se=this.workerSources[F][U.type][U.source];delete this.workerSources[F][U.type][U.source],se.removeSource!==void 0?se.removeSource(U,X):X()}loadWorkerSource(F,U,X){try{this.self.importScripts(U.url),X()}catch(se){X(se.toString())}}syncRTLPluginState(F,U,X){try{l.bD.setState(U);const se=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&se!=null){this.self.importScripts(se);const ae=l.bD.isParsed();X(ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),ae)}}catch(se){X(se.toString())}}getAvailableImages(F){let U=this.availableImages[F];return U||(U=[]),U}getLayerIndex(F){let U=this.layerIndexes[F];return U||(U=this.layerIndexes[F]=new b),U}getWorkerSource(F,U,X){return this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][U]||(this.workerSources[F][U]={}),this.workerSources[F][U][X]||(this.workerSources[F][U][X]=new this.workerSourceTypes[U]({send:(se,ae,xe)=>{this.actor.send(se,ae,xe,F)}},this.getLayerIndex(F),this.getAvailableImages(F))),this.workerSources[F][U][X]}getDEMWorkerSource(F,U){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][U]||(this.demWorkerSources[F][U]=new K),this.demWorkerSources[F][U]}}return l.i()&&(self.worker=new _r(self)),_r}),u(["./shared"],function(l){var b="3.6.2";class w{static testProp(s){if(!w.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in w.docStyle)return s[h];return s[0]}static create(s,h,p){const g=window.document.createElement(s);return h!==void 0&&(g.className=h),p&&p.appendChild(g),g}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(s,h){s.style[w.transformProp]=h}static addEventListener(s,h,p,g={}){s.addEventListener(h,p,"passive"in g?g:g.capture)}static removeEventListener(s,h,p,g={}){s.removeEventListener(h,p,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static mousePos(s,h){const p=s.getBoundingClientRect();return new l.P(h.clientX-p.left-s.clientLeft,h.clientY-p.top-s.clientTop)}static touchPos(s,h){const p=s.getBoundingClientRect(),g=[];for(let y=0;y<h.length;y++)g.push(new l.P(h[y].clientX-p.left-s.clientLeft,h[y].clientY-p.top-s.clientTop));return g}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(_){!H&&k&&(K?re(_):L=_)}};let L,k,H=!1,K=!1;function re(_){const s=_.createTexture();_.bindTexture(_.TEXTURE_2D,s);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,k),_.isContextLost())return;C.supported=!0}catch{}_.deleteTexture(s),H=!0}var ce,W;typeof document<"u"&&(k=document.createElement("img"),k.onload=function(){L&&re(L),L=null,K=!0},k.onerror=function(){H=!0,L=null},k.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let s,h,p,g;_.resetRequestQueue=()=>{s=[],h=0,p=0,g={}},_.addThrottleControl=M=>{const D=p++;return g[D]=M,D},_.removeThrottleControl=M=>{delete g[M],S()},_.getImage=(M,D,z=!0)=>{C.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*");const V={requestParameters:M,supportImageRefresh:z,callback:D,cancelled:!1,completed:!1,cancel:()=>{V.completed||V.cancelled||(V.cancelled=!0,V.innerRequest&&(V.innerRequest.cancel(),h--),S())}};return s.push(V),S(),V};const y=M=>{const{requestParameters:D,supportImageRefresh:z,callback:V}=M;return l.e(D,{type:"image"}),(z!==!1||l.i()||l.g(D.url)||D.headers&&!Object.keys(D.headers).reduce((te,ee)=>te&&ee==="accept",!0)?l.m:P)(D,(te,ee,ie,J)=>{E(M,V,te,ee,ie,J)})},E=(M,D,z,V,te,ee)=>{z?D(z):V instanceof HTMLImageElement||l.a(V)?D(null,V):V&&((ie,J)=>{typeof createImageBitmap=="function"?l.b(ie,J):l.d(ie,J)})(V,(ie,J)=>{ie!=null?D(ie):J!=null&&D(null,J,{cacheControl:te,expires:ee})}),M.cancelled||(M.completed=!0,h--,S())},S=()=>{const M=(()=>{const D=Object.keys(g);let z=!1;if(D.length>0){for(const V of D)if(z=g[V](),z)break}return z})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=h;D<M&&s.length>0;D++){const z=s.shift();if(z.cancelled){D--;continue}const V=y(z);h++,z.innerRequest=V}},P=(M,D)=>{const z=new Image,V=M.url;let te=!1;const ee=M.credentials;return ee&&ee==="include"?z.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!l.s(V))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{D(null,z),z.onerror=z.onload=null},z.onerror=()=>{te||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=V,{cancel:()=>{te=!0,z.src=""}}}}(ce||(ce={})),ce.resetRequestQueue(),function(_){_.Glyphs="Glyphs",_.Image="Image",_.Source="Source",_.SpriteImage="SpriteImage",_.SpriteJSON="SpriteJSON",_.Style="Style",_.Tile="Tile",_.Unknown="Unknown"}(W||(W={}));class G{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,p){const g=function(y){const E=y.match(Z);if(!E)throw new Error(`Unable to parse URL "${y}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(s);return g.path+=`${h}${p}`,function(y){const E=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${E}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fe(_){var s=new l.A(3);return s[0]=_[0],s[1]=_[1],s[2]=_[2],s}var Te,Pe=function(_,s,h){return _[0]=s[0]-h[0],_[1]=s[1]-h[1],_[2]=s[2]-h[2],_};Te=new l.A(3),l.A!=Float32Array&&(Te[0]=0,Te[1]=0,Te[2]=0);var ze=function(_){var s=_[0],h=_[1];return s*s+h*h};function Oe(_){const s=[];if(typeof _=="string")s.push({id:"default",url:_});else if(_&&_.length>0){const h=[];for(const{id:p,url:g}of _){const y=`${p}${g}`;h.indexOf(y)===-1&&(h.push(y),s.push({id:p,url:g}))}}return s}function Me(_,s,h,p,g){if(p)return void _(p);if(g!==Object.values(s).length||g!==Object.values(h).length)return;const y={};for(const E in s){y[E]={};const S=l.h.getImageCanvasContext(h[E]),P=s[E];for(const M in P){const{width:D,height:z,x:V,y:te,sdf:ee,pixelRatio:ie,stretchX:J,stretchY:ge,content:we}=P[M];y[E][M]={data:null,pixelRatio:ie,sdf:ee,stretchX:J,stretchY:ge,content:we,spriteData:{width:D,height:z,x:V,y:te,context:S}}}}_(null,y)}(function(){var _=new l.A(2);l.A!=Float32Array&&(_[0]=0,_[1]=0)})();class Ee{constructor(s,h,p,g){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(h,g)}update(s,h,p){const{width:g,height:y}=s,E=!(this.size&&this.size[0]===g&&this.size[1]===y||p),{context:S}=this,{gl:P}=S;if(this.useMipmap=!!(h&&h.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[g,y],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.a(s)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,s):P.texImage2D(P.TEXTURE_2D,0,this.format,g,y,0,this.format,P.UNSIGNED_BYTE,s.data);else{const{x:M,y:D}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.a(s)?P.texSubImage2D(P.TEXTURE_2D,0,M,D,P.RGBA,P.UNSIGNED_BYTE,s):P.texSubImage2D(P.TEXTURE_2D,0,M,D,g,y,P.RGBA,P.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(s,h,p){const{context:g}=this,{gl:y}=g;y.bindTexture(y.TEXTURE_2D,this.texture),p!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=y.LINEAR),s!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,p||s),this.filter=s),h!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,h),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Re(_){const{userImage:s}=_;return!!(s&&s.render&&s.render())&&(_.data.replace(new Uint8Array(s.data.buffer)),!0)}class nt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(s){const h=this.images[s];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new l.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let p=!0;const g=h.data||h.spriteData;return this._validateStretch(h.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,h){if(!s)return!0;let p=0;for(const g of s){if(g[0]<p||g[1]<g[0]||h<g[1])return!1;p=g[1]}return!0}_validateContent(s,h){if(!s)return!0;if(s.length!==4)return!1;const p=h.spriteData,g=p&&p.width||h.data.width,y=p&&p.height||h.data.height;return!(s[0]<0||g<s[0]||s[1]<0||y<s[1]||s[2]<0||g<s[2]||s[3]<0||y<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,h,p=!0){const g=this.getImage(s);if(p&&(g.data.width!==h.data.width||g.data.height!==h.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=g.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let p=!0;if(!this.isLoaded())for(const g of s)this.images[g]||(p=!1);this.isLoaded()||p?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const p={};for(const g of s){let y=this.getImage(g);y||(this.fire(new l.k("styleimagemissing",{id:g})),y=this.getImage(g)),y?p[g]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:l.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],p=this.getImage(s);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new l.I(g,p);this.patterns[s]={bin:g,position:y}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ee(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const y in this.patterns)s.push(this.patterns[y].bin);const{w:h,h:p}=l.p(s),g=this.atlasImage;g.resize({width:h||1,height:p||1});for(const y in this.patterns){const{bin:E}=this.patterns[y],S=E.x+1,P=E.y+1,M=this.getImage(y).data,D=M.width,z=M.height;l.R.copy(M,g,{x:0,y:0},{x:S,y:P},{width:D,height:z}),l.R.copy(M,g,{x:0,y:z-1},{x:S,y:P-1},{width:D,height:1}),l.R.copy(M,g,{x:0,y:0},{x:S,y:P+z},{width:D,height:1}),l.R.copy(M,g,{x:D-1,y:0},{x:S-1,y:P},{width:1,height:z}),l.R.copy(M,g,{x:0,y:0},{x:S+D,y:P},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||l.w(`Image with ID: "${h}" was not found`),Re(p)&&this.updateImage(h,p)}}}const rt=1e20;function yt(_,s,h,p,g,y,E,S,P){for(let M=s;M<s+p;M++)Dt(_,h*y+M,y,g,E,S,P);for(let M=h;M<h+g;M++)Dt(_,M*y+s,1,p,E,S,P)}function Dt(_,s,h,p,g,y,E){y[0]=0,E[0]=-rt,E[1]=rt,g[0]=_[s];for(let S=1,P=0,M=0;S<p;S++){g[S]=_[s+S*h];const D=S*S;do{const z=y[P];M=(g[S]-g[z]+D-z*z)/(S-z)/2}while(M<=E[P]&&--P>-1);P++,y[P]=S,E[P]=M,E[P+1]=rt}for(let S=0,P=0;S<p;S++){for(;E[P+1]<S;)P++;const M=y[P],D=S-M;_[s+S*h]=g[M]+D*D}}class Sn{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const p=[];for(const g in s)for(const y of s[g])p.push({stack:g,id:y});l.o(p,({stack:g,id:y},E)=>{let S=this.entries[g];S||(S=this.entries[g]={glyphs:{},requests:{},ranges:{}});let P=S.glyphs[y];if(P!==void 0)return void E(null,{stack:g,id:y,glyph:P});if(P=this._tinySDF(S,g,y),P)return S.glyphs[y]=P,void E(null,{stack:g,id:y,glyph:P});const M=Math.floor(y/256);if(256*M>65535)return void E(new Error("glyphs > 65535 not supported"));if(S.ranges[M])return void E(null,{stack:g,id:y,glyph:P});if(!this.url)return void E(new Error("glyphsUrl is not set"));let D=S.requests[M];D||(D=S.requests[M]=[],Sn.loadGlyphRange(g,M,this.url,this.requestManager,(z,V)=>{if(V){for(const te in V)this._doesCharSupportLocalGlyph(+te)||(S.glyphs[+te]=V[+te]);S.ranges[M]=!0}for(const te of D)te(z,V);delete S.requests[M]})),D.push((z,V)=>{z?E(z):V&&E(null,{stack:g,id:y,glyph:V[y]||null})})},(g,y)=>{if(g)h(g);else if(y){const E={};for(const{stack:S,id:P,glyph:M}of y)(E[S]||(E[S]={}))[P]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};h(null,E)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](s)||l.u["Hangul Syllables"](s)||l.u.Hiragana(s)||l.u.Katakana(s))}_tinySDF(s,h,p){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(p))return;let y=s.tinySDF;if(!y){let S="400";/bold/i.test(h)?S="900":/medium/i.test(h)?S="500":/light/i.test(h)&&(S="200"),y=s.tinySDF=new Sn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:S})}const E=y.draw(String.fromCharCode(p));return{id:p,bitmap:new l.q({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Sn.loadGlyphRange=function(_,s,h,p,g){const y=256*s,E=y+255,S=p.transformRequest(h.replace("{fontstack}",_).replace("{range}",`${y}-${E}`),W.Glyphs);l.l(S,(P,M)=>{if(P)g(P);else if(M){const D={};for(const z of l.n(M))D[z.id]=z;g(null,D)}})},Sn.TinySDF=class{constructor({fontSize:_=24,buffer:s=3,radius:h=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:y="normal",fontStyle:E="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=h;const S=this.size=_+4*s,P=this._createCanvas(S),M=this.ctx=P.getContext("2d",{willReadFrequently:!0});M.font=`${E} ${y} ${_}px ${g}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(_){const s=document.createElement("canvas");return s.width=s.height=_,s}draw(_){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:y}=this.ctx.measureText(_),E=Math.ceil(h),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-g))),P=Math.min(this.size-this.buffer,E+Math.ceil(p)),M=S+2*this.buffer,D=P+2*this.buffer,z=Math.max(M*D,0),V=new Uint8ClampedArray(z),te={data:V,width:M,height:D,glyphWidth:S,glyphHeight:P,glyphTop:E,glyphLeft:0,glyphAdvance:s};if(S===0||P===0)return te;const{ctx:ee,buffer:ie,gridInner:J,gridOuter:ge}=this;ee.clearRect(ie,ie,S,P),ee.fillText(_,ie,ie+E);const we=ee.getImageData(ie,ie,S,P);ge.fill(rt,0,z),J.fill(0,0,z);for(let le=0;le<P;le++)for(let ye=0;ye<S;ye++){const Ae=we.data[4*(le*S+ye)+3]/255;if(Ae===0)continue;const Ie=(le+ie)*M+ye+ie;if(Ae===1)ge[Ie]=0,J[Ie]=rt;else{const Fe=.5-Ae;ge[Ie]=Fe>0?Fe*Fe:0,J[Ie]=Fe<0?Fe*Fe:0}}yt(ge,0,0,M,D,M,this.f,this.v,this.z),yt(J,ie,ie,S,P,M,this.f,this.v,this.z);for(let le=0;le<z;le++){const ye=Math.sqrt(ge[le])-Math.sqrt(J[le]);V[le]=Math.round(255-255*(ye/this.radius+this.cutoff))}return te}};class Xt{constructor(){this.specification=l.v.light.position}possiblyEvaluate(s,h){return l.z(s.expression.evaluate(h))}interpolate(s,h,p){return{x:l.B.number(s.x,h.x,p),y:l.B.number(s.y,h.y,p),z:l.B.number(s.z,h.z,p)}}}let Ye;class Tt extends l.E{constructor(s){super(),Ye=Ye||new l.r({anchor:new l.D(l.v.light.anchor),position:new Xt,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Ye),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.t,s,h))for(const p in s){const g=s[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),g):this._transitionable.setValue(p,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,p){return(!p||p.validate!==!1)&&l.x(this,s.call(l.y,l.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class pt{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const p=s.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,h)),this.dashEntry[p]}getDashRanges(s,h,p){const g=[];let y=s.length%2==1?-s[s.length-1]*p:0,E=s[0]*p,S=!0;g.push({left:y,right:E,isDash:S,zeroLength:s[0]===0});let P=s[0];for(let M=1;M<s.length;M++){S=!S;const D=s[M];y=P*p,P+=D,E=P*p,g.push({left:y,right:E,isDash:S,zeroLength:D===0})}return g}addRoundDash(s,h,p){const g=h/2;for(let y=-p;y<=p;y++){const E=this.width*(this.nextRow+p+y);let S=0,P=s[S];for(let M=0;M<this.width;M++){M/P.right>1&&(P=s[++S]);const D=Math.abs(M-P.left),z=Math.abs(M-P.right),V=Math.min(D,z);let te;const ee=y/p*(g+1);if(P.isDash){const ie=g-Math.abs(ee);te=Math.sqrt(V*V+ie*ie)}else te=g-Math.sqrt(V*V+ee*ee);this.data[E+M]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(s){for(let S=s.length-1;S>=0;--S){const P=s[S],M=s[S+1];P.zeroLength?s.splice(S,1):M&&M.isDash===P.isDash&&(M.left=P.left,s.splice(S,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const g=this.width*this.nextRow;let y=0,E=s[y];for(let S=0;S<this.width;S++){S/E.right>1&&(E=s[++y]);const P=Math.abs(S-E.left),M=Math.abs(S-E.right),D=Math.min(P,M);this.data[g+S]=Math.max(0,Math.min(255,(E.isDash?D:-D)+128))}}addDash(s,h){const p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<s.length;S++)y+=s[S];if(y!==0){const S=this.width/y,P=this.getDashRanges(s,this.width,S);h?this.addRoundDash(P,S,p):this.addRegularDash(P)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:y};return this.nextRow+=g,this.dirty=!0,E}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Ot{constructor(s,h,p){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=p;const g=this.workerPool.acquire(p);for(let y=0;y<g.length;y++){const E=new l.C(g[y],h,p);E.name=`Worker ${y}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,p){l.o(this.actors,(g,y)=>{g.send(s,h,y)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}}function Mt(_,s,h){const p=function(g,y){if(g)return h(g);if(y){const E=l.F(l.e(y,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(E.vectorLayers=y.vector_layers,E.vectorLayerIds=E.vectorLayers.map(S=>S.id)),h(null,E)}};return _.url?l.f(s.transformRequest(_.url,W.Source),p):l.h.frame(()=>p(null,_))}class Kt{constructor(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof l.L?new l.L(s.lng,s.lat):l.L.convert(s),this}setSouthWest(s){return this._sw=s instanceof l.L?new l.L(s.lng,s.lat):l.L.convert(s),this}extend(s){const h=this._sw,p=this._ne;let g,y;if(s instanceof l.L)g=s,y=s;else{if(!(s instanceof Kt))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Kt.convert(s)):this.extend(l.L.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(l.L.convert(s)):this;if(g=s._sw,y=s._ne,!g||!y)return this}return h||p?(h.lng=Math.min(g.lng,h.lng),h.lat=Math.min(g.lat,h.lat),p.lng=Math.max(y.lng,p.lng),p.lat=Math.max(y.lat,p.lat)):(this._sw=new l.L(g.lng,g.lat),this._ne=new l.L(y.lng,y.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:h,lat:p}=l.L.convert(s);let g=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g}static convert(s){return s instanceof Kt?s:s&&new Kt(s)}static fromLngLat(s,h=0){const p=360*h/40075017,g=p/Math.cos(Math.PI/180*s.lat);return new Kt(new l.L(s.lng-g,s.lat-p),new l.L(s.lng+g,s.lat+p))}}class vn{constructor(s,h,p){this.bounds=Kt.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),p=Math.floor(l.G(this.bounds.getWest())*h),g=Math.floor(l.H(this.bounds.getNorth())*h),y=Math.ceil(l.G(this.bounds.getEast())*h),E=Math.ceil(l.H(this.bounds.getSouth())*h);return s.x>=p&&s.x<y&&s.y>=g&&s.y<E}}class mr extends l.E{constructor(s,h,p,g){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Mt(this._options,this.map._requestManager,(y,E)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new l.j(y)):E&&(l.e(this,E),E.bounds&&(this.tileBounds=new vn(E.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(h,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(p,W.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(E,S){return delete s.request,s.aborted?h(null):E&&E.status!==404?h(E):(S&&S.resourceTiming&&(s.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&s.setExpiryData(S),s.loadVectorData(S,this.map.painter),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",g,y.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",g,y.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ii extends l.E{constructor(s,h,p,g){super(),this.id=s,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},h),l.e(this,l.F(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Mt(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new l.j(s)):h&&(l.e(this,h),h.bounds&&(this.tileBounds=new vn(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}serialize(){return l.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=ce.getImage(this.map._requestManager.transformRequest(p,W.Tile),(g,y,E)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(g)s.state="errored",h(g);else if(y){this.map._refreshExpiredTiles&&E&&s.setExpiryData(E);const S=this.map.painter.context,P=S.gl;s.texture=this.map.painter.getTileTexture(y.width),s.texture?s.texture.update(y,{useMipmap:!0}):(s.texture=new Ee(S,y,P.RGBA,{useMipmap:!0}),s.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),s.state="loaded",h(null)}},this.map._refreshExpiredTiles)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}class dn extends Ii{constructor(s,h,p,g){super(s,h,p,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(p,W.Tile);function y(E,S){E&&(s.state="errored",h(E)),S&&(s.dem=S,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.request=ce.getImage(g,(E,S,P)=>l._(this,void 0,void 0,function*(){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(E)s.state="errored",h(E);else if(S){this.map._refreshExpiredTiles&&s.setExpiryData(P);const M=l.a(S)&&l.J()?S:yield function(z){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){const V=z.width+2,te=z.height+2;try{return new l.R({width:V,height:te},yield l.M(z,-1,-1,V,te))}catch{}}return l.h.getImageData(z,1)})}(S),D={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",D,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(s){const h=s.canonical,p=Math.pow(2,h.z),g=(h.x-1+p)%p,y=h.x===0?s.wrap-1:s.wrap,E=(h.x+1+p)%p,S=h.x+1===p?s.wrap+1:s.wrap,P={};return P[new l.O(s.overscaledZ,y,h.z,g,h.y).key]={backfilled:!1},P[new l.O(s.overscaledZ,S,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(P[new l.O(s.overscaledZ,y,h.z,g,h.y-1).key]={backfilled:!1},P[new l.O(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},P[new l.O(s.overscaledZ,S,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(P[new l.O(s.overscaledZ,y,h.z,g,h.y+1).key]={backfilled:!1},P[new l.O(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},P[new l.O(s.overscaledZ,S,h.z,E,h.y+1).key]={backfilled:!1}),P}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class Ci extends l.E{constructor(s,h,p,g){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(g),this._data=h.data,this._options=l.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const y=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*y,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*y,extent:l.N,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.N,radius:(h.clusterRadius||50)*y,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,p,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:p},g),this}_updateWorkerData(s){const h=l.e({},this.workerOptions);s?h.dataDiff=s:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),W.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(p,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let y=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y=g.resourceTiming[this.id].slice(0)),p)return void this.fire(new l.j(p));const E={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(E,{resourceTiming:y}),this.fire(new l.k("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(s,h){const p=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const g={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(p,g,(y,E)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):y?h(y):(s.loadVectorData(E,this.map.painter,p==="reloadTile"),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var tn=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class fn extends l.E{constructor(s,h,p,g){super(),this.load=(y,E)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ce.getImage(this.map._requestManager.transformRequest(this.url,W.Image),(S,P)=>{this._request=null,this._loaded=!0,S?this.fire(new l.j(S)):P&&(this.image=P,y&&(this.coordinates=y),E&&E(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,E=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ee(y,this.image,E.RGBA),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE));let S=!1;for(const P in this.tiles){const M=this.tiles[P];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,S=!0)}S&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=s,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=h}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(s){this.coordinates=s;const h=s.map(l.U.fromLngLat);this.tileID=function(g){let y=1/0,E=1/0,S=-1/0,P=-1/0;for(const V of g)y=Math.min(y,V.x),E=Math.min(E,V.y),S=Math.max(S,V.x),P=Math.max(P,V.y);const M=Math.max(S-y,P-E),D=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),z=Math.pow(2,D);return new l.W(D,Math.floor((y+S)/2*z),Math.floor((E+P)/2*z))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.N,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.N),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}hasTransition(){return!1}}class vs extends fn{constructor(s,h,p,g){super(s,h,p,g),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const E of y.urls)this.urls.push(this.map._requestManager.transformRequest(E,W.Source).url);l.X(this.urls,(E,S)=>{this._loaded=!0,E?this.fire(new l.j(E)):S&&(this.video=S,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,E=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.texSubImage2D(E.TEXTURE_2D,0,0,0,E.RGBA,E.UNSIGNED_BYTE,this.video)):(this.texture=new Ee(y,this.video,E.RGBA),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE));let S=!1;for(const P in this.tiles){const M=this.tiles[P];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,S=!0)}S&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=h}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Yi extends fn{constructor(s,h,p,g){super(s,h,p,g),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const E=this.map.painter.context,S=E.gl;this.boundsBuffer||(this.boundsBuffer=E.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ee(E,this.canvas,S.RGBA,{premultiply:!0});let P=!1;for(const M in this.tiles){const D=this.tiles[M];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,P=!0)}P&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(E=>typeof E!="number"))||this.fire(new l.j(new l.Y(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Kr={},Bi=_=>{switch(_){case"geojson":return Ci;case"image":return fn;case"raster":return Ii;case"raster-dem":return dn;case"vector":return mr;case"video":return vs;case"canvas":return Yi}return Kr[_]};function zr(_,s){const h=l.Z();return l.$(h,h,[1,1,0]),l.a0(h,h,[.5*_.width,.5*_.height,1]),l.a1(h,h,_.calculatePosMatrix(s.toUnwrapped()))}function gi(_,s,h,p,g,y){const E=function(z,V,te){if(z)for(const ee of z){const ie=V[ee];if(ie&&ie.source===te&&ie.type==="fill-extrusion")return!0}else for(const ee in V){const ie=V[ee];if(ie.source===te&&ie.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,_.id),S=y.maxPitchScaleFactor(),P=_.tilesIn(p,S,E);P.sort(Mi);const M=[];for(const z of P)M.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(s,h,_._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,g,y,S,zr(_.transform,z.tileID))});const D=function(z){const V={},te={};for(const ee of z){const ie=ee.queryResults,J=ee.wrappedTileID,ge=te[J]=te[J]||{};for(const we in ie){const le=ie[we],ye=ge[we]=ge[we]||{},Ae=V[we]=V[we]||[];for(const Ie of le)ye[Ie.featureIndex]||(ye[Ie.featureIndex]=!0,Ae.push(Ie))}}return V}(M);for(const z in D)D[z].forEach(V=>{const te=V.feature,ee=_.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=ee});return D}function Mi(_,s){const h=_.tileID,p=s.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class Jr{constructor(s,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=l.a2(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,y){const E={};if(!y)return E;for(const S of g){const P=S.layerIds.map(M=>y.getLayer(M)).filter(Boolean);if(P.length!==0){S.layers=P,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(M=>P.filter(D=>D.id===M)[0]));for(const M of P)E[M.id]=S}}return E}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof l.a4){if(this.hasSymbolBuckets=!0,!p)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof l.a4&&y.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(g).queryRadius(y))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ee(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ee(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,p,g,y,E,S,P,M,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:y,scale:E,tileSize:this.tileSize,pixelPosMatrix:D,transform:P,params:S,queryPadding:this.queryPadding*M},s,h,p):{}}querySourceFeatures(s,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const g=p.loadVTLayers(),y=h&&h.sourceLayer?h.sourceLayer:"",E=g._geojsonTileLayer||g[y];if(!E)return;const S=l.a6(h&&h.filter),{z:P,x:M,y:D}=this.tileID.canonical,z={z:P,x:M,y:D};for(let V=0;V<E.length;V++){const te=E.feature(V);if(S.needGeometry){const J=l.a7(te,!0);if(!S.filter(new l.a8(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!S.filter(new l.a8(this.tileID.overscaledZ),te))continue;const ee=p.getId(te,y),ie=new l.a9(te,P,M,D,ee);ie.tile=z,s.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const p=l.aa(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let g=!1;if(this.expirationTime>p)g=!1;else if(h)if(this.expirationTime<h)g=!0;else{const y=this.expirationTime-h;y?this.expirationTime=p+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!h.style.hasLayer(g))continue;const y=this.buckets[g],E=y.layers[0].sourceLayer||"_geojsonTileLayer",S=p[E],P=s[E];if(!S||!P||Object.keys(P).length===0)continue;y.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=h&&h.style&&h.style.getLayer(g);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=l.h.now()+s}setDependencies(s,h){const p={};for(const g of h)p[g]=!0;this.dependencies[s]=p}hasDependency(s,h){for(const p of s){const g=this.dependencies[p];if(g){for(const y of h)if(g[y])return!0}}return!1}}class xs{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,p){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:h,timeout:void 0};if(p!==void 0&&(y.timeout=setTimeout(()=>{this.remove(s,y)},p)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const p=s.wrapped().key,g=h===void 0?0:this.data[p].indexOf(h),y=this.data[p][g];return this.data[p].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(y.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const p in this.data)for(const g of this.data[p])s(g.value)||h.push(g);for(const p of h)this.remove(p.value.tileID,p)}}class Le{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,p){const g=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},l.e(this.stateChanges[s][g],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const y in this.state[s])y!==g&&(this.deletedStates[s][y]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const y in this.state[s][g])p[y]||(this.deletedStates[s][g][y]=null)}else for(const y in p)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][y]===null&&delete this.deletedStates[s][g][y]}removeFeatureState(s,h,p){if(this.deletedStates[s]===null)return;const g=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&h!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][p]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(p in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][p]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,h){const p=String(h),g=l.e({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const y=this.deletedStates[s][h];if(y===null)return{};for(const E in y)delete g[E]}return g}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const p={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const E in this.stateChanges[g])this.state[g][E]||(this.state[g][E]={}),l.e(this.state[g][E],this.stateChanges[g][E]),y[E]=this.state[g][E];p[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const E in this.state[g])y[E]={},this.state[g][E]={};else for(const E in this.deletedStates[g]){if(this.deletedStates[g][E]===null)this.state[g][E]={};else for(const S of Object.keys(this.deletedStates[g][E]))delete this.state[g][E][S];y[E]=this.state[g][E]}p[g]=p[g]||{},l.e(p[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const g in s)s[g].setFeatureState(p,h)}}class pn extends l.E{constructor(s,h,p){super(),this.id=s,this.dispatcher=p,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,y,E,S)=>{const P=new(Bi(y.type))(g,y,E,S);if(P.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${P.id}`);return P})(s,h,p,this),this._tiles={},this._cache=new xs(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Le,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new l.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Ki).map(s=>s.key)}getRenderableIds(s){const h=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&h.push(this._tiles[p]);return s?h.sort((p,g)=>{const y=p.tileID,E=g.tileID,S=new l.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),P=new l.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-E.overscaledZ||P.y-S.y||P.x-S.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(Ki).map(p=>p.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,s,h)))}_tileLoaded(s,h,p,g){if(g)return s.state="errored",void(g.status!==404?this._source.fire(new l.j(g,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=l.h.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let g=0;g<h.length;g++){const y=h[g];if(s.neighboringTiles&&s.neighboringTiles[y]){const E=this.getTileByID(y);p(s,E),p(E,s)}}function p(g,y){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let E=y.tileID.canonical.x-g.tileID.canonical.x;const S=y.tileID.canonical.y-g.tileID.canonical.y,P=Math.pow(2,g.tileID.canonical.z),M=y.tileID.key;E===0&&S===0||Math.abs(S)>1||(Math.abs(E)>1&&(Math.abs(E+P)===1?E+=P:Math.abs(E-P)===1&&(E-=P)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,E,S),g.neighboringTiles&&g.neighboringTiles[M]&&(g.neighboringTiles[M].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,p,g){for(const y in this._tiles){let E=this._tiles[y];if(g[y]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let S=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const M=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[M.key],E&&E.hasData()&&(S=M)}let P=S;for(;P.overscaledZ>h;)if(P=P.scaledTo(P.overscaledZ-1),s[P.key]){g[S.key]=S;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=s.overscaledZ-1;p>=h;p--){const g=s.scaledTo(p),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const p={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+h),p[y.tileID.key]=y}this._tiles=p;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new l.O(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(D=>this._source.hasTile(D)))):p=[];const g=s.coveringZoomLevel(this._source),y=Math.max(g-pn.maxOverzooming,this._source.minzoom),E=Math.max(g+pn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const z of p)if(z.canonical.z>this._source.minzoom){const V=z.scaledTo(z.canonical.z-1);D[V.key]=V;const te=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));D[te.key]=te}p=p.concat(Object.values(D))}const S=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const P=this._updateRetainedTiles(p,g);if(sn(this._source.type)){const D={},z={},V=Object.keys(P),te=l.h.now();for(const ee of V){const ie=P[ee],J=this._tiles[ee];if(!J||J.fadeEndTime!==0&&J.fadeEndTime<=te)continue;const ge=this.findLoadedParent(ie,y);ge&&(this._addTile(ge.tileID),D[ge.tileID.key]=ge.tileID),z[ee]=ie}this._retainLoadedChildren(z,g,E,P);for(const ee in D)P[ee]||(this._coveredTiles[ee]=!0,P[ee]=D[ee]);if(h){const ee={},ie={};for(const J of p)this._tiles[J.key].hasData()?ee[J.key]=J:ie[J.key]=J;for(const J in ie){const ge=ie[J].children(this._source.maxzoom);this._tiles[ge[0].key]&&this._tiles[ge[1].key]&&this._tiles[ge[2].key]&&this._tiles[ge[3].key]&&(ee[ge[0].key]=P[ge[0].key]=ge[0],ee[ge[1].key]=P[ge[1].key]=ge[1],ee[ge[2].key]=P[ge[2].key]=ge[2],ee[ge[3].key]=P[ge[3].key]=ge[3],delete ie[J])}for(const J in ie){const ge=this.findLoadedParent(ie[J],this._source.minzoom);if(ge){ee[ge.tileID.key]=P[ge.tileID.key]=ge.tileID;for(const we in ee)ee[we].isChildOf(ge.tileID)&&delete ee[we]}}for(const J in this._tiles)ee[J]||(this._coveredTiles[J]=!0)}}for(const D in P)this._tiles[D].clearFadeHold();const M=l.ab(this._tiles,P);for(const D of M){const z=this._tiles[D];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const p={},g={},y=Math.max(h-pn.maxOverzooming,this._source.minzoom),E=Math.max(h+pn.maxUnderzooming,this._source.minzoom),S={};for(const P of s){const M=this._addTile(P);p[P.key]=P,M.hasData()||h<this._source.maxzoom&&(S[P.key]=P)}this._retainLoadedChildren(S,h,E,p);for(const P of s){let M=this._tiles[P.key];if(M.hasData())continue;if(h+1>this._source.maxzoom){const z=P.children(this._source.maxzoom)[0],V=this.getTile(z);if(V&&V.hasData()){p[z.key]=z;continue}}else{const z=P.children(this._source.maxzoom);if(p[z[0].key]&&p[z[1].key]&&p[z[2].key]&&p[z[3].key])continue}let D=M.wasRequested();for(let z=P.overscaledZ-1;z>=y;--z){const V=P.scaledTo(z);if(g[V.key])break;if(g[V.key]=!0,M=this.getTile(V),!M&&D&&(M=this._addTile(V)),M){const te=M.hasData();if((D||te)&&(p[V.key]=V),D=M.wasRequested(),te)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let p,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){p=this._loadedParentTiles[g.key];break}h.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(p=this._getLoadedTile(y),p)break;g=y}for(const y of h)this._loadedParentTiles[y]=p}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const p=h;return h||(h=new Jr(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,p||this._source.fire(new l.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=h.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,p){const g=[],y=this.transform;if(!y)return g;const E=p?y.getCameraQueryGeometry(s):s,S=s.map(ee=>y.pointCoordinate(ee,this.terrain)),P=E.map(ee=>y.pointCoordinate(ee,this.terrain)),M=this.getIds();let D=1/0,z=1/0,V=-1/0,te=-1/0;for(const ee of P)D=Math.min(D,ee.x),z=Math.min(z,ee.y),V=Math.max(V,ee.x),te=Math.max(te,ee.y);for(let ee=0;ee<M.length;ee++){const ie=this._tiles[M[ee]];if(ie.holdingForFade())continue;const J=ie.tileID,ge=Math.pow(2,y.zoom-ie.tileID.overscaledZ),we=h*ie.queryPadding*l.N/ie.tileSize/ge,le=[J.getTilePoint(new l.U(D,z)),J.getTilePoint(new l.U(V,te))];if(le[0].x-we<l.N&&le[0].y-we<l.N&&le[1].x+we>=0&&le[1].y+we>=0){const ye=S.map(Ie=>J.getTilePoint(Ie)),Ae=P.map(Ie=>J.getTilePoint(Ie));g.push({tile:ie,tileID:J,queryGeometry:ye,cameraQueryGeometry:Ae,scale:ge})}}return g}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(sn(this._source.type)){const s=l.h.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=s)return!0}return!1}setFeatureState(s,h,p){this._state.updateState(s=s||"_geojsonTileLayer",h,p)}removeFeatureState(s,h,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,p)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,p){const g=this._tiles[s];g&&g.setDependencies(h,p)}reloadTilesForDependencies(s,h){for(const p in this._tiles)this._tiles[p].hasDependency(s,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,h))}}function Ki(_,s){const h=Math.abs(2*_.wrap)-+(_.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return _.overscaledZ-s.overscaledZ||p-h||s.canonical.y-_.canonical.y||s.canonical.x-_.canonical.x}function sn(_){return _==="raster"||_==="image"||_==="video"}pn.maxOverzooming=10,pn.maxUnderzooming=3;const Wt="mapboxgl_preloaded_worker_pool";class Or{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Or.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Wt]}numActive(){return Object.keys(this.active).length}}const lo=Math.floor(l.h.hardwareConcurrency/2);let Fr;function Lo(){return Fr||(Fr=new Or),Fr}Or.workerCount=l.ac(globalThis)?Math.max(Math.min(lo,3),1):1;class Us{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.ad(s,0,1);let h=1,p=this._distances[h];const g=s*this.paddedLength+this.padding;for(;p<g&&h<this._distances.length;)p=this._distances[++h];const y=h-1,E=this._distances[y],S=p-E,P=S>0?(g-E)/S:0;return this.points[y].mult(1-P).add(this.points[h].mult(P))}}function Qr(_,s){let h=!0;return _==="always"||_!=="never"&&s!=="never"||(h=!1),h}class Br{constructor(s,h,p){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,p,g,y){this._forEachCell(h,p,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(s,h,p,g){this._forEachCell(h-g,p-g,h+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(p),this.circles.push(g)}_insertBoxCell(s,h,p,g,y,E){this.boxCells[y].push(E)}_insertCircleCell(s,h,p,g,y,E){this.circleCells[y].push(E)}_query(s,h,p,g,y,E,S){if(p<0||s>this.width||g<0||h>this.height)return[];const P=[];if(s<=0&&h<=0&&this.width<=p&&this.height<=g){if(y)return[{key:null,x1:s,y1:h,x2:p,y2:g}];for(let M=0;M<this.boxKeys.length;M++)P.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const D=this.circles[3*M],z=this.circles[3*M+1],V=this.circles[3*M+2];P.push({key:this.circleKeys[M],x1:D-V,y1:z-V,x2:D+V,y2:z+V})}}else this._forEachCell(s,h,p,g,this._queryCell,P,{hitTest:y,overlapMode:E,seenUids:{box:{},circle:{}}},S);return P}query(s,h,p,g){return this._query(s,h,p,g,!1,null)}hitTest(s,h,p,g,y,E){return this._query(s,h,p,g,!0,y,E).length>0}hitTestCircle(s,h,p,g,y){const E=s-p,S=s+p,P=h-p,M=h+p;if(S<0||E>this.width||M<0||P>this.height)return!1;const D=[];return this._forEachCell(E,P,S,M,this._queryCellCircle,D,{hitTest:!0,overlapMode:g,circle:{x:s,y:h,radius:p},seenUids:{box:{},circle:{}}},y),D.length>0}_queryCell(s,h,p,g,y,E,S,P){const{seenUids:M,hitTest:D,overlapMode:z}=S,V=this.boxCells[y];if(V!==null){const ee=this.bboxes;for(const ie of V)if(!M.box[ie]){M.box[ie]=!0;const J=4*ie,ge=this.boxKeys[ie];if(s<=ee[J+2]&&h<=ee[J+3]&&p>=ee[J+0]&&g>=ee[J+1]&&(!P||P(ge))&&(!D||!Qr(z,ge.overlapMode))&&(E.push({key:ge,x1:ee[J],y1:ee[J+1],x2:ee[J+2],y2:ee[J+3]}),D))return!0}}const te=this.circleCells[y];if(te!==null){const ee=this.circles;for(const ie of te)if(!M.circle[ie]){M.circle[ie]=!0;const J=3*ie,ge=this.circleKeys[ie];if(this._circleAndRectCollide(ee[J],ee[J+1],ee[J+2],s,h,p,g)&&(!P||P(ge))&&(!D||!Qr(z,ge.overlapMode))){const we=ee[J],le=ee[J+1],ye=ee[J+2];if(E.push({key:ge,x1:we-ye,y1:le-ye,x2:we+ye,y2:le+ye}),D)return!0}}}return!1}_queryCellCircle(s,h,p,g,y,E,S,P){const{circle:M,seenUids:D,overlapMode:z}=S,V=this.boxCells[y];if(V!==null){const ee=this.bboxes;for(const ie of V)if(!D.box[ie]){D.box[ie]=!0;const J=4*ie,ge=this.boxKeys[ie];if(this._circleAndRectCollide(M.x,M.y,M.radius,ee[J+0],ee[J+1],ee[J+2],ee[J+3])&&(!P||P(ge))&&!Qr(z,ge.overlapMode))return E.push(!0),!0}}const te=this.circleCells[y];if(te!==null){const ee=this.circles;for(const ie of te)if(!D.circle[ie]){D.circle[ie]=!0;const J=3*ie,ge=this.circleKeys[ie];if(this._circlesCollide(ee[J],ee[J+1],ee[J+2],M.x,M.y,M.radius)&&(!P||P(ge))&&!Qr(z,ge.overlapMode))return E.push(!0),!0}}}_forEachCell(s,h,p,g,y,E,S,P){const M=this._convertToXCellCoord(s),D=this._convertToYCellCoord(h),z=this._convertToXCellCoord(p),V=this._convertToYCellCoord(g);for(let te=M;te<=z;te++)for(let ee=D;ee<=V;ee++)if(y.call(this,s,h,p,g,this.xCellCount*ee+te,E,S,P))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,p,g,y,E){const S=g-s,P=y-h,M=p+E;return M*M>S*S+P*P}_circleAndRectCollide(s,h,p,g,y,E,S){const P=(E-g)/2,M=Math.abs(s-(g+P));if(M>P+p)return!1;const D=(S-y)/2,z=Math.abs(h-(y+D));if(z>D+p)return!1;if(M<=P||z<=D)return!0;const V=M-P,te=z-D;return V*V+te*te<=p*p}}function He(_,s,h,p,g){const y=l.Z();return s?(l.a0(y,y,[1/g,1/g,1]),h||l.ae(y,y,p.angle)):l.a1(y,p.labelPlaneMatrix,_),y}function Nr(_,s,h,p,g){if(s){const y=l.af(_);return l.a0(y,y,[g,g,1]),h||l.ae(y,y,-p.angle),y}return p.glCoordMatrix}function An(_,s,h){let p;h?(p=[_.x,_.y,h(_.x,_.y),1],l.ag(p,p,s)):(p=[_.x,_.y,0,1],se(p,p,s));const g=p[3];return{point:new l.P(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function Vs(_,s){return .5+_/s*.5}function es(_,s){const h=_[0]/_[3],p=_[1]/_[3];return h>=-s[0]&&h<=s[0]&&p>=-s[1]&&p<=s[1]}function qe(_,s,h,p,g,y,E,S,P,M){const D=p?_.textSizeData:_.iconSizeData,z=l.ah(D,h.transform.zoom),V=[256/h.width*2+1,256/h.height*2+1],te=p?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;te.clear();const ee=_.lineVertexArray,ie=p?_.text.placedSymbolArray:_.icon.placedSymbolArray,J=h.transform.width/h.transform.height;let ge=!1;for(let we=0;we<ie.length;we++){const le=ie.get(we);if(le.hidden||le.writingMode===l.ai.vertical&&!ge){X(le.numGlyphs,te);continue}let ye;if(ge=!1,M?(ye=[le.anchorX,le.anchorY,M(le.anchorX,le.anchorY),1],l.ag(ye,ye,s)):(ye=[le.anchorX,le.anchorY,0,1],se(ye,ye,s)),!es(ye,V)){X(le.numGlyphs,te);continue}const Ae=Vs(h.transform.cameraToCenterDistance,ye[3]),Ie=l.aj(D,z,le),Fe=E?Ie/Ae:Ie*Ae,Ve=new l.P(le.anchorX,le.anchorY),Ue=An(Ve,g,M).point,$e={projections:{},offsets:{}},ut=yi(le,Fe,!1,S,s,g,y,_.glyphOffsetArray,ee,te,Ue,Ve,$e,J,P,M);ge=ut.useVertical,(ut.notEnoughRoom||ge||ut.needsFlipping&&yi(le,Fe,!0,S,s,g,y,_.glyphOffsetArray,ee,te,Ue,Ve,$e,J,P,M).notEnoughRoom)&&X(le.numGlyphs,te)}p?_.text.dynamicLayoutVertexBuffer.updateData(te):_.icon.dynamicLayoutVertexBuffer.updateData(te)}function It(_,s,h,p,g,y,E,S,P,M,D,z,V){const te=S.glyphStartIndex+S.numGlyphs,ee=S.lineStartIndex,ie=S.lineStartIndex+S.lineLength,J=s.getoffsetX(S.glyphStartIndex),ge=s.getoffsetX(te-1),we=F(_*J,h,p,g,y,E,S.segment,ee,ie,P,M,D,z,V);if(!we)return null;const le=F(_*ge,h,p,g,y,E,S.segment,ee,ie,P,M,D,z,V);return le?{first:we,last:le}:null}function Pt(_,s,h,p){return _===l.ai.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*p?{useVertical:!0}:(_===l.ai.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function yi(_,s,h,p,g,y,E,S,P,M,D,z,V,te,ee,ie){const J=s/24,ge=_.lineOffsetX*J,we=_.lineOffsetY*J;let le;if(_.numGlyphs>1){const ye=_.glyphStartIndex+_.numGlyphs,Ae=_.lineStartIndex,Ie=_.lineStartIndex+_.lineLength,Fe=It(J,S,ge,we,h,D,z,_,P,y,V,ee,ie);if(!Fe)return{notEnoughRoom:!0};const Ve=An(Fe.first.point,E,ie).point,Ue=An(Fe.last.point,E,ie).point;if(p&&!h){const $e=Pt(_.writingMode,Ve,Ue,te);if($e)return $e}le=[Fe.first];for(let $e=_.glyphStartIndex+1;$e<ye-1;$e++)le.push(F(J*S.getoffsetX($e),ge,we,h,D,z,_.segment,Ae,Ie,P,y,V,ee,ie));le.push(Fe.last)}else{if(p&&!h){const Ae=An(z,g,ie).point,Ie=_.lineStartIndex+_.segment+1,Fe=new l.P(P.getx(Ie),P.gety(Ie)),Ve=An(Fe,g,ie),Ue=Ve.signedDistanceFromCamera>0?Ve.point:gr(z,Fe,Ae,1,g,ie),$e=Pt(_.writingMode,Ae,Ue,te);if($e)return $e}const ye=F(J*S.getoffsetX(_.glyphStartIndex),ge,we,h,D,z,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,P,y,V,ee,ie);if(!ye)return{notEnoughRoom:!0};le=[ye]}for(const ye of le)l.ak(M,ye.point,ye.angle);return{}}function gr(_,s,h,p,g,y){const E=An(_.add(_.sub(s)._unit()),g,y).point,S=h.sub(E);return h.add(S._mult(p/S.mag()))}function Ct(_,s){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:g,tileAnchorPoint:y,distanceFromAnchor:E,getElevation:S,previousVertex:P,direction:M,absOffsetX:D}=s;if(h.projections[_])return h.projections[_];const z=new l.P(p.getx(_),p.gety(_)),V=An(z,g,S);if(V.signedDistanceFromCamera>0)return h.projections[_]=V.point,V.point;const te=_-M;return gr(E===0?y:new l.P(p.getx(te),p.gety(te)),z,P,D-E+1,g,S)}function _r(_,s,h){return _._unit()._perp()._mult(s*h)}function ne(_,s,h,p,g,y,E,S){const{projectionCache:P,direction:M}=S;if(P.offsets[_])return P.offsets[_];const D=h.add(s);if(_+M<p||_+M>=g)return P.offsets[_]=D,D;const z=Ct(_+M,S),V=_r(z.sub(h),E,M),te=h.add(V),ee=z.add(V);return P.offsets[_]=l.al(y,D,te,ee)||D,P.offsets[_]}function F(_,s,h,p,g,y,E,S,P,M,D,z,V,te){const ee=p?_-s:_+s;let ie=ee>0?1:-1,J=0;p&&(ie*=-1,J=Math.PI),ie<0&&(J+=Math.PI);let ge,we,le=ie>0?S+E:S+E+1,ye=g,Ae=g,Ie=0,Fe=0;const Ve=Math.abs(ee),Ue=[];let $e;for(;Ie+Fe<=Ve;){if(le+=ie,le<S||le>=P)return null;Ie+=Fe,Ae=ye,we=ge;const Ke={projectionCache:z,lineVertexArray:M,labelPlaneMatrix:D,tileAnchorPoint:y,distanceFromAnchor:Ie,getElevation:te,previousVertex:Ae,direction:ie,absOffsetX:Ve};if(ye=Ct(le,Ke),h===0)Ue.push(Ae),$e=ye.sub(Ae);else{let wt;const dt=ye.sub(Ae);wt=dt.mag()===0?_r(Ct(le+ie,Ke).sub(ye),h,ie):_r(dt,h,ie),we||(we=Ae.add(wt)),ge=ne(le,wt,ye,S,P,we,h,Ke),Ue.push(we),$e=ge.sub(we)}Fe=$e.mag()}const ut=$e._mult((Ve-Ie)/Fe)._add(we||Ae),Ut=J+Math.atan2(ye.y-Ae.y,ye.x-Ae.x);return Ue.push(ut),{point:ut,angle:V?Ut:0,path:Ue}}const U=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function X(_,s){for(let h=0;h<_;h++){const p=s.length;s.resize(p+4),s.float32.set(U,3*p)}}function se(_,s,h){const p=s[0],g=s[1];return _[0]=h[0]*p+h[4]*g+h[12],_[1]=h[1]*p+h[5]*g+h[13],_[3]=h[3]*p+h[7]*g+h[15],_}const ae=100;class xe{constructor(s,h=new Br(s.width+200,s.height+200,25),p=new Br(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ae,this.screenBottomBoundary=s.height+ae,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,p,g,y,E){const S=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY,E),P=p*S.perspectiveRatio,M=s.x1*P+S.point.x,D=s.y1*P+S.point.y,z=s.x2*P+S.point.x,V=s.y2*P+S.point.y;return!this.isInsideGrid(M,D,z,V)||h!=="always"&&this.grid.hitTest(M,D,z,V,h,y)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[M,D,z,V],offscreen:this.isOffscreen(M,D,z,V)}}placeCollisionCircles(s,h,p,g,y,E,S,P,M,D,z,V,te,ee){const ie=[],J=new l.P(h.anchorX,h.anchorY),ge=An(J,E,ee),we=Vs(this.transform.cameraToCenterDistance,ge.signedDistanceFromCamera),le=(D?y/we:y*we)/l.ap,ye=An(J,S,ee).point,Ae=It(le,g,h.lineOffsetX*le,h.lineOffsetY*le,!1,ye,J,h,p,S,{projections:{},offsets:{}},!1,ee);let Ie=!1,Fe=!1,Ve=!0;if(Ae){const Ue=.5*V*we+te,$e=new l.P(-100,-100),ut=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Ut=new Us,Ke=Ae.first,wt=Ae.last;let dt=[];for(let Lt=Ke.path.length-1;Lt>=1;Lt--)dt.push(Ke.path[Lt]);for(let Lt=1;Lt<wt.path.length;Lt++)dt.push(wt.path[Lt]);const on=2.5*Ue;if(P){const Lt=dt.map(Vt=>An(Vt,P,ee));dt=Lt.some(Vt=>Vt.signedDistanceFromCamera<=0)?[]:Lt.map(Vt=>Vt.point)}let Bt=[];if(dt.length>0){const Lt=dt[0].clone(),Vt=dt[0].clone();for(let jn=1;jn<dt.length;jn++)Lt.x=Math.min(Lt.x,dt[jn].x),Lt.y=Math.min(Lt.y,dt[jn].y),Vt.x=Math.max(Vt.x,dt[jn].x),Vt.y=Math.max(Vt.y,dt[jn].y);Bt=Lt.x>=$e.x&&Vt.x<=ut.x&&Lt.y>=$e.y&&Vt.y<=ut.y?[dt]:Vt.x<$e.x||Lt.x>ut.x||Vt.y<$e.y||Lt.y>ut.y?[]:l.am([dt],$e.x,$e.y,ut.x,ut.y)}for(const Lt of Bt){Ut.reset(Lt,.25*Ue);let Vt=0;Vt=Ut.length<=.5*Ue?1:Math.ceil(Ut.paddedLength/on)+1;for(let jn=0;jn<Vt;jn++){const mn=jn/Math.max(Vt-1,1),bi=Ut.lerp(mn),oi=bi.x+ae,Zn=bi.y+ae;ie.push(oi,Zn,Ue,0);const Sr=oi-Ue,wn=Zn-Ue,Es=oi+Ue,Ss=Zn+Ue;if(Ve=Ve&&this.isOffscreen(Sr,wn,Es,Ss),Fe=Fe||this.isInsideGrid(Sr,wn,Es,Ss),s!=="always"&&this.grid.hitTestCircle(oi,Zn,Ue,s,z)&&(Ie=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Ie}}}}return{circles:!M&&Ie||!Fe||we<this.perspectiveRatioCutoff?[]:ie,offscreen:Ve,collisionDetected:Ie}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,g=1/0,y=-1/0,E=-1/0;for(const D of s){const z=new l.P(D.x+ae,D.y+ae);p=Math.min(p,z.x),g=Math.min(g,z.y),y=Math.max(y,z.x),E=Math.max(E,z.y),h.push(z)}const S=this.grid.query(p,g,y,E).concat(this.ignoredGrid.query(p,g,y,E)),P={},M={};for(const D of S){const z=D.key;if(P[z.bucketInstanceId]===void 0&&(P[z.bucketInstanceId]={}),P[z.bucketInstanceId][z.featureIndex])continue;const V=[new l.P(D.x1,D.y1),new l.P(D.x2,D.y1),new l.P(D.x2,D.y2),new l.P(D.x1,D.y2)];l.an(h,V)&&(P[z.bucketInstanceId][z.featureIndex]=!0,M[z.bucketInstanceId]===void 0&&(M[z.bucketInstanceId]=[]),M[z.bucketInstanceId].push(z.featureIndex))}return M}insertCollisionBox(s,h,p,g,y,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:y,collisionGroupID:E,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,p,g,y,E){const S=p?this.ignoredGrid:this.grid,P={bucketInstanceId:g,featureIndex:y,collisionGroupID:E,overlapMode:h};for(let M=0;M<s.length;M+=4)S.insertCircle(P,s[M],s[M+1],s[M+2])}projectAndGetPerspectiveRatio(s,h,p,g){let y;return g?(y=[h,p,g(h,p),1],l.ag(y,y,s)):(y=[h,p,0,1],se(y,y,s)),{point:new l.P((y[0]/y[3]+1)/2*this.transform.width+ae,(-y[1]/y[3]+1)/2*this.transform.height+ae),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(s,h,p,g){return p<ae||s>=this.screenRightBoundary||g<ae||h>this.screenBottomBoundary}isInsideGrid(s,h,p,g){return p>=0&&s<this.gridRightBoundary&&g>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.ao([]);return l.$(s,s,[-100,-100,0]),s}}function me(_,s,h){return s*(l.N/(_.tileSize*Math.pow(2,h-_.tileID.overscaledZ)))}class ue{constructor(s,h,p,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class _e{constructor(s,h,p,g,y){this.text=new ue(s?s.text:null,h,p,y),this.icon=new ue(s?s.icon:null,h,g,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ke{constructor(s,h,p){this.text=s,this.icon=h,this.skipFade=p}}class De{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class Ne{constructor(s,h,p,g,y){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=y}}class gt{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[s]}}function St(_,s,h,p,g){const{horizontalAlign:y,verticalAlign:E}=l.au(_);return new l.P(-(y-.5)*s+p[0]*g,-(E-.5)*h+p[1]*g)}function ot(_,s,h,p,g,y){const{x1:E,x2:S,y1:P,y2:M,anchorPointX:D,anchorPointY:z}=_,V=new l.P(s,h);return p&&V._rotate(g?y:-y),{x1:E+V.x,y1:P+V.y,x2:S+V.x,y2:M+V.y,anchorPointX:D,anchorPointY:z}}class vt{constructor(s,h,p,g,y){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new xe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new gt(g),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,p,g){const y=p.getBucket(h),E=p.latestFeatureIndex;if(!y||!E||h.id!==y.layerIds[0])return;const S=p.collisionBoxArray,P=y.layers[0].layout,M=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/l.N,z=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),V=P.get("text-pitch-alignment")==="map",te=P.get("text-rotation-alignment")==="map",ee=me(p,1,this.transform.zoom),ie=He(z,V,te,this.transform,ee);let J=null;if(V){const we=Nr(z,V,te,this.transform,ee);J=l.a1([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[y.bucketInstanceId]=new Ne(y.bucketInstanceId,E,y.sourceLayerIndex,y.index,p.tileID);const ge={bucket:y,layout:P,posMatrix:z,textLabelPlaneMatrix:ie,labelToScreenMatrix:J,scale:M,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:l.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(g)for(const we of y.sortKeyRanges){const{sortKey:le,symbolInstanceStart:ye,symbolInstanceEnd:Ae}=we;s.push({sortKey:le,symbolInstanceStart:ye,symbolInstanceEnd:Ae,parameters:ge})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(s,h,p,g,y,E,S,P,M,D,z,V,te,ee,ie,J){const ge=l.aq[s.textAnchor],we=[s.textOffset0,s.textOffset1],le=St(ge,p,g,we,y),ye=this.collisionIndex.placeCollisionBox(ot(h,le.x,le.y,E,S,this.transform.angle),z,P,M,D.predicate,J);if((!ie||this.collisionIndex.placeCollisionBox(ot(ie,le.x,le.y,E,S,this.transform.angle),z,P,M,D.predicate,J).box.length!==0)&&ye.box.length>0){let Ae;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:we,width:p,height:g,anchor:ge,textBoxScale:y,prevAnchor:Ae},this.markUsedJustification(te,ge,V,ee),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ee,V),this.placedOrientations[V.crossTileID]=ee),{shift:le,placedGlyphBoxes:ye}}}placeLayerBucketPart(s,h,p){const{bucket:g,layout:y,posMatrix:E,textLabelPlaneMatrix:S,labelToScreenMatrix:P,textPixelRatio:M,holdingForFade:D,collisionBoxArray:z,partiallyEvaluatedTextSize:V,collisionGroup:te}=s.parameters,ee=y.get("text-optional"),ie=y.get("icon-optional"),J=l.ar(y,"text-overlap","text-allow-overlap"),ge=J==="always",we=l.ar(y,"icon-overlap","icon-allow-overlap"),le=we==="always",ye=y.get("text-rotation-alignment")==="map",Ae=y.get("text-pitch-alignment")==="map",Ie=y.get("icon-text-fit")!=="none",Fe=y.get("symbol-z-order")==="viewport-y",Ve=ge&&(le||!g.hasIconData()||ie),Ue=le&&(ge||!g.hasTextData()||ee);!g.collisionArrays&&z&&g.deserializeCollisionBoxes(z);const $e=this.retainedQueryData[g.bucketInstanceId].tileID,ut=this.terrain?(Ke,wt)=>this.terrain.getElevation($e,Ke,wt):null,Ut=(Ke,wt)=>{var dt,on;if(h[Ke.crossTileID])return;if(D)return void(this.placements[Ke.crossTileID]=new ke(!1,!1,!1));let Bt=!1,Lt=!1,Vt=!0,jn=null,mn={box:null,offscreen:null},bi={box:null},oi=null,Zn=null,Sr=null,wn=0,Es=0,Ss=0;wt.textFeatureIndex?wn=wt.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(wn=Ke.featureIndex),wt.verticalTextFeatureIndex&&(Es=wt.verticalTextFeatureIndex);const mo=wt.textBox;if(mo){const ki=Gn=>{let ai=l.ai.horizontal;if(g.allowVerticalPlacement&&!Gn&&this.prevPlacement){const nr=this.prevPlacement.placedOrientations[Ke.crossTileID];nr&&(this.placedOrientations[Ke.crossTileID]=nr,ai=nr,this.markUsedOrientation(g,ai,Ke))}return ai},wi=(Gn,ai)=>{if(g.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&wt.verticalTextBox){for(const nr of g.writingModes)if(nr===l.ai.vertical?(mn=ai(),bi=mn):mn=Gn(),mn&&mn.box&&mn.box.length)break}else mn=Gn()},Vi=Ke.textAnchorOffsetStartIndex,Vo=Ke.textAnchorOffsetEndIndex;if(Vo===Vi){const Gn=(ai,nr)=>{const $n=this.collisionIndex.placeCollisionBox(ai,J,M,E,te.predicate,ut);return $n&&$n.box&&$n.box.length&&(this.markUsedOrientation(g,nr,Ke),this.placedOrientations[Ke.crossTileID]=nr),$n};wi(()=>Gn(mo,l.ai.horizontal),()=>{const ai=wt.verticalTextBox;return g.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&ai?Gn(ai,l.ai.vertical):{box:null,offscreen:null}}),ki(mn&&mn.box&&mn.box.length)}else{let Gn=l.aq[(on=(dt=this.prevPlacement)===null||dt===void 0?void 0:dt.variableOffsets[Ke.crossTileID])===null||on===void 0?void 0:on.anchor];const ai=($n,jo,Ac)=>{const zf=$n.x2-$n.x1,Of=$n.y2-$n.y1,Tg=Ke.textBoxScale,mh=Ie&&we==="never"?jo:null;let As={box:[],offscreen:!1},Go=J==="never"?1:2,Ps="never";Gn&&Go++;for(let $r=0;$r<Go;$r++){for(let Is=Vi;Is<Vo;Is++){const gh=g.textAnchorOffsets.get(Is);if(Gn&&gh.textAnchor!==Gn)continue;const Zs=this.attemptAnchorPlacement(gh,$n,zf,Of,Tg,ye,Ae,M,E,te,Ps,Ke,g,Ac,mh,ut);if(Zs&&(As=Zs.placedGlyphBoxes,As&&As.box&&As.box.length))return Bt=!0,jn=Zs.shift,As}Gn?Gn=null:Ps=J}return As};wi(()=>ai(mo,wt.iconBox,l.ai.horizontal),()=>{const $n=wt.verticalTextBox;return g.allowVerticalPlacement&&!(mn&&mn.box&&mn.box.length)&&Ke.numVerticalGlyphVertices>0&&$n?ai($n,wt.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),mn&&(Bt=mn.box,Vt=mn.offscreen);const nr=ki(mn&&mn.box);if(!Bt&&this.prevPlacement){const $n=this.prevPlacement.variableOffsets[Ke.crossTileID];$n&&(this.variableOffsets[Ke.crossTileID]=$n,this.markUsedJustification(g,$n.anchor,Ke,nr))}}}if(oi=mn,Bt=oi&&oi.box&&oi.box.length>0,Vt=oi&&oi.offscreen,Ke.useRuntimeCollisionCircles){const ki=g.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),wi=l.aj(g.textSizeData,V,ki),Vi=y.get("text-padding");Zn=this.collisionIndex.placeCollisionCircles(J,ki,g.lineVertexArray,g.glyphOffsetArray,wi,E,S,P,p,Ae,te.predicate,Ke.collisionCircleDiameter,Vi,ut),Zn.circles.length&&Zn.collisionDetected&&!p&&l.w("Collisions detected, but collision boxes are not shown"),Bt=ge||Zn.circles.length>0&&!Zn.collisionDetected,Vt=Vt&&Zn.offscreen}if(wt.iconFeatureIndex&&(Ss=wt.iconFeatureIndex),wt.iconBox){const ki=wi=>{const Vi=Ie&&jn?ot(wi,jn.x,jn.y,ye,Ae,this.transform.angle):wi;return this.collisionIndex.placeCollisionBox(Vi,we,M,E,te.predicate,ut)};bi&&bi.box&&bi.box.length&&wt.verticalIconBox?(Sr=ki(wt.verticalIconBox),Lt=Sr.box.length>0):(Sr=ki(wt.iconBox),Lt=Sr.box.length>0),Vt=Vt&&Sr.offscreen}const Uo=ee||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,Ta=ie||Ke.numIconVertices===0;if(Uo||Ta?Ta?Uo||(Lt=Lt&&Bt):Bt=Lt&&Bt:Lt=Bt=Lt&&Bt,Bt&&oi&&oi.box&&this.collisionIndex.insertCollisionBox(oi.box,J,y.get("text-ignore-placement"),g.bucketInstanceId,bi&&bi.box&&Es?Es:wn,te.ID),Lt&&Sr&&this.collisionIndex.insertCollisionBox(Sr.box,we,y.get("icon-ignore-placement"),g.bucketInstanceId,Ss,te.ID),Zn&&(Bt&&this.collisionIndex.insertCollisionCircles(Zn.circles,J,y.get("text-ignore-placement"),g.bucketInstanceId,wn,te.ID),p)){const ki=g.bucketInstanceId;let wi=this.collisionCircleArrays[ki];wi===void 0&&(wi=this.collisionCircleArrays[ki]=new De);for(let Vi=0;Vi<Zn.circles.length;Vi+=4)wi.circles.push(Zn.circles[Vi+0]),wi.circles.push(Zn.circles[Vi+1]),wi.circles.push(Zn.circles[Vi+2]),wi.circles.push(Zn.collisionDetected?1:0)}if(Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new ke(Bt||Ve,Lt||Ue,Vt||g.justReloaded),h[Ke.crossTileID]=!0};if(Fe){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=g.getSortedSymbolIndexes(this.transform.angle);for(let wt=Ke.length-1;wt>=0;--wt){const dt=Ke[wt];Ut(g.symbolInstances.get(dt),g.collisionArrays[dt])}}else for(let Ke=s.symbolInstanceStart;Ke<s.symbolInstanceEnd;Ke++)Ut(g.symbolInstances.get(Ke),g.collisionArrays[Ke]);if(p&&g.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[g.bucketInstanceId];l.as(Ke.invProjMatrix,E),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,h,p,g){let y;y=g===l.ai.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.at(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of E)S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:p.crossTileID)}markUsedOrientation(s,h,p){const g=h===l.ai.horizontal||h===l.ai.horizontalOnly?h:0,y=h===l.ai.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const S of E)s.text.placedSymbolArray.get(S).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const g=h?h.symbolFadeChange(s):1,y=h?h.opacities:{},E=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(const P in this.placements){const M=this.placements[P],D=y[P];D?(this.opacities[P]=new _e(D,g,M.text,M.icon),p=p||M.text!==D.text.placed||M.icon!==D.icon.placed):(this.opacities[P]=new _e(null,g,M.text,M.icon,M.skipFade),p=p||M.text||M.icon)}for(const P in y){const M=y[P];if(!this.opacities[P]){const D=new _e(M,g,!1,!1);D.isHidden()||(this.opacities[P]=D,p=p||M.text.placed||M.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in S)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=S[P]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const p={};for(const g of h){const y=g.getBucket(s);y&&g.latestFeatureIndex&&s.id===y.layerIds[0]&&this.updateBucketOpacities(y,p,g.collisionBoxArray)}}updateBucketOpacities(s,h,p){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0],y=g.layout,E=new _e(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),M=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=y.get("text-rotation-alignment")==="map",z=y.get("text-pitch-alignment")==="map",V=y.get("icon-text-fit")!=="none",te=new _e(null,0,S&&(P||!s.hasIconData()||y.get("icon-optional")),P&&(S||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const ee=(ie,J,ge)=>{for(let we=0;we<J/4;we++)ie.opacityVertexArray.emplaceBack(ge);ie.hasVisibleVertices=ie.hasVisibleVertices||ge!==Ji};for(let ie=0;ie<s.symbolInstances.length;ie++){const J=s.symbolInstances.get(ie),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:we,crossTileID:le}=J;let ye=this.opacities[le];h[le]?ye=E:ye||(ye=te,this.opacities[le]=ye),h[le]=!0;const Ae=J.numIconVertices>0,Ie=this.placedOrientations[J.crossTileID],Fe=Ie===l.ai.vertical,Ve=Ie===l.ai.horizontal||Ie===l.ai.horizontalOnly;if(ge>0||we>0){const Ue=ri(ye.text);ee(s.text,ge,Fe?Ji:Ue),ee(s.text,we,Ve?Ji:Ue);const $e=ye.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach(Ke=>{Ke>=0&&(s.text.placedSymbolArray.get(Ke).hidden=$e||Fe?1:0)}),J.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=$e||Ve?1:0);const ut=this.variableOffsets[J.crossTileID];ut&&this.markUsedJustification(s,ut.anchor,J,Ie);const Ut=this.placedOrientations[J.crossTileID];Ut&&(this.markUsedJustification(s,"left",J,Ut),this.markUsedOrientation(s,Ut,J))}if(Ae){const Ue=ri(ye.icon),$e=!(V&&J.verticalPlacedIconSymbolIndex&&Fe);J.placedIconSymbolIndex>=0&&(ee(s.icon,J.numIconVertices,$e?Ue:Ji),s.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=ye.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(ee(s.icon,J.numVerticalIconVertices,$e?Ji:Ue),s.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ue=s.collisionArrays[ie];if(Ue){let $e=new l.P(0,0);if(Ue.textBox||Ue.verticalTextBox){let Ut=!0;if(M){const Ke=this.variableOffsets[le];Ke?($e=St(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textBoxScale),D&&$e._rotate(z?this.transform.angle:-this.transform.angle)):Ut=!1}Ue.textBox&&At(s.textCollisionBox.collisionVertexArray,ye.text.placed,!Ut||Fe,$e.x,$e.y),Ue.verticalTextBox&&At(s.textCollisionBox.collisionVertexArray,ye.text.placed,!Ut||Ve,$e.x,$e.y)}const ut=!!(!Ve&&Ue.verticalIconBox);Ue.iconBox&&At(s.iconCollisionBox.collisionVertexArray,ye.icon.placed,ut,V?$e.x:0,V?$e.y:0),Ue.verticalIconBox&&At(s.iconCollisionBox.collisionVertexArray,ye.icon.placed,!ut,V?$e.x:0,V?$e.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ie.invProjMatrix,s.placementViewportMatrix=ie.viewportMatrix,s.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function At(_,s,h,p,g){_.emplaceBack(s?1:0,h?1:0,p||0,g||0),_.emplaceBack(s?1:0,h?1:0,p||0,g||0),_.emplaceBack(s?1:0,h?1:0,p||0,g||0),_.emplaceBack(s?1:0,h?1:0,p||0,g||0)}const qt=Math.pow(2,25),Jt=Math.pow(2,24),kt=Math.pow(2,17),Rt=Math.pow(2,16),Un=Math.pow(2,9),nn=Math.pow(2,8),Cn=Math.pow(2,1);function ri(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const s=_.placed?1:0,h=Math.floor(127*_.opacity);return h*qt+s*Jt+h*kt+s*Rt+h*Un+s*nn+h*Cn+s}const Ji=0;class ko{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,p,g,y){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,P)=>S.sortKey-P.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,y())return!0;return!1}}class si{constructor(s,h,p,g,y,E,S,P){this.placement=new vt(s,h,E,S,P),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,h,p){const g=l.h.now(),y=()=>!this._forceFullPlacement&&l.h.now()-g>2;for(;this._currentPlacementIndex>=0;){const E=h[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ko(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const yr=512/l.N/2;class bs{constructor(s,h,p){this.tileID=s,this.bucketInstanceId=p,this._symbolsByKey={};const g=new Map;for(let y=0;y<h.length;y++){const E=h.get(y),S=E.key,P=g.get(S);P?P.push(E):g.set(S,[E])}for(const[y,E]of g){const S={positions:E.map(P=>({x:Math.floor(P.anchorX*yr),y:Math.floor(P.anchorY*yr)})),crossTileIDs:E.map(P=>P.crossTileID)};if(S.positions.length>128){const P=new l.av(S.positions.length,16,Uint16Array);for(const{x:M,y:D}of S.positions)P.add(M,D);P.finish(),delete S.positions,S.index=P}this._symbolsByKey[y]=S}}getScaledCoordinates(s,h){const{x:p,y:g,z:y}=this.tileID.canonical,{x:E,y:S,z:P}=h.canonical,M=yr/Math.pow(2,P-y),D=(S*l.N+s.anchorY)*M,z=g*l.N*yr;return{x:Math.floor((E*l.N+s.anchorX)*M-p*l.N*yr),y:Math.floor(D-z)}}findMatches(s,h,p){const g=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let y=0;y<s.length;y++){const E=s.get(y);if(E.crossTileID)continue;const S=this._symbolsByKey[E.key];if(!S)continue;const P=this.getScaledCoordinates(E,h);if(S.index){const M=S.index.range(P.x-g,P.y-g,P.x+g,P.y+g).sort();for(const D of M){const z=S.crossTileIDs[D];if(!p[z]){p[z]=!0,E.crossTileID=z;break}}}else if(S.positions)for(let M=0;M<S.positions.length;M++){const D=S.positions[M],z=S.crossTileIDs[M];if(Math.abs(D.x-P.x)<=g&&Math.abs(D.y-P.y)<=g&&!p[z]){p[z]=!0,E.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Nt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class js{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const p in this.indexes){const g=this.indexes[p],y={};for(const E in g){const S=g[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),y[S.tileID.key]=S}this.indexes[p]=y}this.lng=s}addBucket(s,h,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let y=0;y<h.symbolInstances.length;y++)h.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const y in this.indexes){const E=this.indexes[y];if(Number(y)>s.overscaledZ)for(const S in E){const P=E[S];P.tileID.isChildOf(s)&&P.findMatches(h.symbolInstances,s,g)}else{const S=E[s.scaledTo(Number(y)).key];S&&S.findMatches(h.symbolInstances,s,g)}}for(let y=0;y<h.symbolInstances.length;y++){const E=h.symbolInstances.get(y);E.crossTileID||(E.crossTileID=p.generate(),g[E.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new bs(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const p of h.getCrossTileIDsLists())for(const g of p)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let h=!1;for(const p in this.indexes){const g=this.indexes[p];for(const y in g)s[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[y]),delete g[y],h=!0)}return h}}class Ni{constructor(){this.layerIndexes={},this.crossTileIDs=new Nt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,p){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new js);let y=!1;const E={};g.handleWrapJump(p);for(const S of h){const P=S.getBucket(s);P&&s.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(S.tileID,P,this.crossTileIDs)&&(y=!0),E[P.bucketInstanceId]=!0)}return g.removeStaleBuckets(E)&&(y=!0),y}pruneUnusedLayers(s){const h={};s.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const xn=(_,s)=>l.x(_,s&&s.filter(h=>h.identifier!=="source.canvas")),Li=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),nc=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),vi=l.aw();class ln extends l.E{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Ot(Lo(),this,s._getMapId()),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new Sn(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new pt(256,512),this.crossTileSymbolIndex=new Ni,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());const p=this;this._rtlTextPluginCallback=ln.registerForPluginStateChange(g=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,E)=>{if(l.aA(y),E&&E.every(S=>S))for(const S in p.sourceCaches){const P=p.sourceCaches[S].getSource().type;P!=="vector"&&P!=="geojson"||p.sourceCaches[S].reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.sourceCaches[g.sourceId];if(!y)return;const E=y.getSource();if(E&&E.vectorLayerIds)for(const S in this._layers){const P=this._layers[S];P.source===E.id&&this._validateLayer(P)}})}loadURL(s,h={},p){this.fire(new l.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const g=this.map._requestManager.transformRequest(s,W.Style);this._request=l.f(g,(y,E)=>{this._request=null,y?this.fire(new l.j(y)):E&&this._load(E,h,p)})}loadJSON(s,h={},p){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,h.validate=h.validate!==!1,this._load(s,h,p)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(vi,{validate:!1})}_load(s,h,p){var g;const y=h.transformStyle?h.transformStyle(p,s):s;if(!h.validate||!xn(this,l.y(y))){this._loaded=!0,this.stylesheet=y;for(const E in y.sources)this.addSource(E,y.sources[E],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Tt(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const s=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of s){const p=l.aC(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(s,h=!1,p=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(g,y,E,S){const P=Oe(g),M=P.length,D=E>1?"@2x":"",z={},V={},te={};for(const{id:ee,url:ie}of P){const J=y.transformRequest(y.normalizeSpriteURL(ie,D,".json"),W.SpriteJSON),ge=`${ee}_${J.url}`;z[ge]=l.f(J,(ye,Ae)=>{delete z[ge],V[ee]=Ae,Me(S,V,te,ye,M)});const we=y.transformRequest(y.normalizeSpriteURL(ie,D,".png"),W.SpriteImage),le=`${ee}_${we.url}`;z[le]=ce.getImage(we,(ye,Ae)=>{delete z[le],te[ee]=Ae,Me(S,V,te,ye,M)})}return{cancel(){for(const ee of Object.values(z))ee.cancel()}}}(s,this.map._requestManager,this.map.getPixelRatio(),(g,y)=>{if(this._spriteRequest=null,g)this.fire(new l.j(g));else if(y)for(const E in y){this._spritesImagesIds[E]=[];const S=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(P=>!(P in y)):[];for(const P of S)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(const P in y[E]){const M=E==="default"?P:`${E}:${P}`;this._spritesImagesIds[E].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,y[E][P],!1):this.imageManager.addImage(M,y[E][P]),h&&(this._changedImages[M]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),p&&p(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const p=s.sourceLayer;if(!p)return;const g=h.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.j(new Error(`Source layer "${p}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const h=this._serializedAllLayers();if(!s||s.length===0)return Object.values(h);const p=[];for(const g of s)h[g]&&p.push(h[g]);return p}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const g=this._layers[p];g.type!=="custom"&&(s[p]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(g.length||y.length)&&this._updateWorkerLayers(g,y);for(const E in this._updatedSources){const S=this._updatedSources[E];if(S==="reload")this._reloadSource(E);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const g in this.sourceCaches){const y=this.sourceCaches[g];p[g]=y.used,y.used=!1}for(const g of this._order){const y=this._layers[g];y.recalculate(s,this._availableImages),!y.isHidden(s.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const g in p){const y=this.sourceCaches[g];p[g]!==y.used&&y.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,h={}){this._checkLoaded();const p=this.serialize();if(s=h.transformStyle?h.transformStyle(p,s):s,xn(this,l.y(s)))return!1;(s=l.aD(s)).layers=l.aB(s.layers);const g=l.aE(p,s).filter(E=>!(E.command in nc));if(g.length===0)return!1;const y=g.filter(E=>!(E.command in Li));if(y.length>0)throw new Error(`Unimplemented: ${y.map(E=>E.command).join(", ")}.`);for(const E of g)E.command!=="setTransition"&&this[E.command].apply(this,E.args);return this.stylesheet=s,this._serializedLayers=null,!0}addImage(s,h){if(this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.y.source,`sources.${s}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const g=this.sourceCaches[s]=new pn(s,h,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new l.j(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,p={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let y;if(s.type==="custom"){if(xn(this,l.aF(s)))return;y=l.aC(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=l.aD(s),s=l.e(s,{source:g})),this._validate(l.y.layer,`layers.${g}`,s,{arrayIndex:-1},p))return;y=l.aC(s),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,g),this._layerOrderChanged=!0,this._layers[g]=y,this._removedLayers[g]&&y.source&&y.type!=="custom"){const S=this._removedLayers[g];delete this._removedLayers[g],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const p=this._order.indexOf(s);this._order.splice(p,1);const g=h?this._order.indexOf(h):this._order.length;h&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,p){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===h&&g.maxzoom===p||(h!=null&&(g.minzoom=h),p!=null&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,p={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!l.aG(g.filter,h))return h==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.y.filter,`layers.${g.id}.filter`,h,null,p)||(g.filter=l.aD(h),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.aD(this.getLayer(s).filter)}setLayoutProperty(s,h,p,g={}){this._checkLoaded();const y=this.getLayer(s);y?l.aG(y.getLayoutProperty(h),p)||(y.setLayoutProperty(h,p,g),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const p=this.getLayer(s);if(p)return p.getLayoutProperty(h);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,p,g={}){this._checkLoaded();const y=this.getLayer(s);y?l.aG(y.getPaintProperty(h),p)||(y.setPaintProperty(h,p,g)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const p=s.source,g=s.sourceLayer,y=this.sourceCaches[p];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${p}' does not exist in the map's style.`)));const E=y.getSource().type;E==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||g?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(g,s.id,h)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const p=s.source,g=this.sourceCaches[p];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${p}' does not exist in the map's style.`)));const y=g.getSource().type,E=y==="vector"?s.sourceLayer:void 0;y!=="vector"||E?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(E,s.id,h):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,p=s.sourceLayer,g=this.sourceCaches[h];if(g!==void 0)return g.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(p,s.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=l.aH(this.sourceCaches,y=>y.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aI({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:h,terrain:p},y=>y!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=E=>this._layers[E].type==="fill-extrusion",p={},g=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(h(S)){p[S]=E;for(const P of s){const M=P[S];if(M)for(const D of M)g.push(D)}}}g.sort((E,S)=>S.intersectionZ-E.intersectionZ);const y=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(h(S))for(let P=g.length-1;P>=0;P--){const M=g[P].feature;if(p[M.layer.id]<E)break;y.push(M),g.pop()}else for(const P of s){const M=P[S];if(M)for(const D of M)y.push(D.feature)}}return y}queryRenderedFeatures(s,h,p){h&&h.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",h.filter,null,h);const g={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const S of h.layers){const P=this._layers[S];if(!P)return this.fire(new l.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];g[P.source]=!0}}const y=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const S in this.sourceCaches)h.layers&&!g[S]||y.push(gi(this.sourceCaches[S],this._layers,E,s,h,p));return this.placement&&y.push(function(S,P,M,D,z,V,te){const ee={},ie=V.queryRenderedSymbols(D),J=[];for(const ge of Object.keys(ie).map(Number))J.push(te[ge]);J.sort(Mi);for(const ge of J){const we=ge.featureIndex.lookupSymbolFeatures(ie[ge.bucketInstanceId],P,ge.bucketIndex,ge.sourceLayerIndex,z.filter,z.layers,z.availableImages,S);for(const le in we){const ye=ee[le]=ee[le]||[],Ae=we[le];Ae.sort((Ie,Fe)=>{const Ve=ge.featureSortOrder;if(Ve){const Ue=Ve.indexOf(Ie.featureIndex);return Ve.indexOf(Fe.featureIndex)-Ue}return Fe.featureIndex-Ie.featureIndex});for(const Ie of Ae)ye.push(Ie)}}for(const ge in ee)ee[ge].forEach(we=>{const le=we.feature,ye=M[S[ge].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ye});return ee}(this._layers,E,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(s,h){h&&h.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[s];return p?function(g,y){const E=g.getRenderableIds().map(M=>g.getTileByID(M)),S=[],P={};for(let M=0;M<E.length;M++){const D=E[M],z=D.tileID.canonical.key;P[z]||(P[z]=!0,D.querySourceFeatures(S,y))}return S}(p,h):[]}addSourceType(s,h,p){return Bi(s)?p(new Error(`A source type called "${s}" already exists.`)):(((g,y)=>{Kr[g]=y})(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const E in s)if(!l.aG(s[E],p[E])){g=!0;break}if(!g)return;const y={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(y)}_validate(s,h,p,g,y={}){return(!y||y.validate!==!1)&&xn(this,s.call(l.y,l.e({key:h,style:this.serialize(),value:p,styleSpec:l.v},g)))}_remove(s=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,p,g,y=!1){let E=!1,S=!1;const P={};for(const M of this._order){const D=this._layers[M];if(D.type!=="symbol")continue;if(!P[D.source]){const V=this.sourceCaches[D.source];P[D.source]=V.getRenderableIds(!0).map(te=>V.getTileByID(te)).sort((te,ee)=>ee.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ee.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(D,P[D.source],s.center.lng);E=E||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),s.zoom))&&(this.pauseablePlacement=new si(s,this.map.terrain,this._order,y,h,p,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(const M of this._order){const D=this._layers[M];D.type==="symbol"&&this.placement.updateLayerOpacities(D,P[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const g=this.sourceCaches[h.source];g&&g.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,p){this.glyphManager.getGlyphs(h.stacks,p);const g=this.sourceCaches[h.source];g&&g.setDependencies(h.tileID.key,h.type,[""])}getResource(s,h,p){return l.m(h,p)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,h={}){this._checkLoaded(),s&&this._validate(l.y.glyphs,"glyphs",s,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,h,p={},g){this._checkLoaded();const y=[{id:s,url:h}],E=[...Oe(this.stylesheet.sprite),...y];this._validate(l.y.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(y,!0,g))}removeSprite(s){this._checkLoaded();const h=Oe(this.stylesheet.sprite);if(h.find(p=>p.id===s)){if(this._spritesImagesIds[s])for(const p of this._spritesImagesIds[s])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===s),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Oe(this.stylesheet.sprite)}setSprite(s,h={},p){this._checkLoaded(),s&&this._validate(l.y.sprite,"sprite",s,null,h)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,p):(this._unloadSprite(),p&&p(null)))}}ln.registerForPluginStateChange=l.aK;var Gs=l.Q([{name:"a_pos",type:"Int16",components:2}]),ws="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const un={prelude:Ht(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ht(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ht(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ht(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ht("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ht(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ht(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ht("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ht("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ht("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ht(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ht(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ht(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ht(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ht(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ht(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ht(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ht(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ht(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ht(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ht(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ht(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ht(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ht("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ws),terrainDepth:Ht("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ws),terrainCoords:Ht("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ws)};function Ht(_,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),g=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=y?y.concat(g):g,S={};return{fragmentSource:_=_.replace(h,(P,M,D,z,V)=>(S[V]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${D} ${z} ${V};
#else
uniform ${D} ${z} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${D} ${z} ${V} = u_${V};
#endif
`)),vertexSource:s=s.replace(h,(P,M,D,z,V)=>{const te=z==="float"?"vec2":"vec4",ee=V.match(/color/)?"color":te;return S[V]?M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${D} ${te} a_${V};
varying ${D} ${z} ${V};
#else
uniform ${D} ${z} u_${V};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${D} ${z} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${ee}(a_${V}, u_${V}_t);
#else
    ${D} ${z} ${V} = u_${V};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${D} ${te} a_${V};
#else
uniform ${D} ${z} u_${V};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${D} ${z} ${V} = a_${V};
#else
    ${D} ${z} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${D} ${z} ${V} = unpack_mix_${ee}(a_${V}, u_${V}_t);
#else
    ${D} ${z} ${V} = u_${V};
#endif
`}),staticAttributes:p,staticUniforms:E}}class ts{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,p,g,y,E,S,P,M){this.context=s;let D=this.boundPaintVertexBuffers.length!==g.length;for(let z=0;!D&&z<g.length;z++)this.boundPaintVertexBuffers[z]!==g[z]&&(D=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||D||this.boundIndexBuffer!==y||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==M?this.freshBind(h,p,g,y,E,S,P,M):(s.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),P&&P.bind(),M&&M.bind())}freshBind(s,h,p,g,y,E,S,P){const M=s.numAttributes,D=this.context,z=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=P,h.enableAttributes(z,s);for(const V of p)V.enableAttributes(z,s);E&&E.enableAttributes(z,s),S&&S.enableAttributes(z,s),P&&P.enableAttributes(z,s),h.bind(),h.setVertexAttribPointers(z,s,y);for(const V of p)V.bind(),V.setVertexAttribPointers(z,s,y);E&&(E.bind(),E.setVertexAttribPointers(z,s,y)),g&&g.bind(),S&&(S.bind(),S.setVertexAttribPointers(z,s,y)),P&&(P.bind(),P.setVertexAttribPointers(z,s,y)),D.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function hn(_){const s=[];for(let h=0;h<_.length;h++){if(_[h]===null)continue;const p=_[h].split(" ");s.push(p.pop())}return s}class vr{constructor(s,h,p,g,y,E){const S=s.gl;this.program=S.createProgram();const P=hn(h.staticAttributes),M=p?p.getBinderAttributes():[],D=P.concat(M),z=un.prelude.staticUniforms?hn(un.prelude.staticUniforms):[],V=h.staticUniforms?hn(h.staticUniforms):[],te=p?p.getBinderUniforms():[],ee=z.concat(V).concat(te),ie=[];for(const Ie of ee)ie.indexOf(Ie)<0&&ie.push(Ie);const J=p?p.defines():[];y&&J.push("#define OVERDRAW_INSPECTOR;"),E&&J.push("#define TERRAIN3D;");const ge=J.concat(un.prelude.fragmentSource,h.fragmentSource).join(`
`),we=J.concat(un.prelude.vertexSource,h.vertexSource).join(`
`),le=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(le,ge),S.compileShader(le),!S.getShaderParameter(le,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(le)}`);S.attachShader(this.program,le);const ye=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(ye,we),S.compileShader(ye),!S.getShaderParameter(ye,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(ye)}`);S.attachShader(this.program,ye),this.attributes={};const Ae={};this.numAttributes=D.length;for(let Ie=0;Ie<this.numAttributes;Ie++)D[Ie]&&(S.bindAttribLocation(this.program,Ie,D[Ie]),this.attributes[D[Ie]]=Ie);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(ye),S.deleteShader(le);for(let Ie=0;Ie<ie.length;Ie++){const Fe=ie[Ie];if(Fe&&!Ae[Fe]){const Ve=S.getUniformLocation(this.program,Fe);Ve&&(Ae[Fe]=Ve)}}this.fixedUniforms=g(s,Ae),this.terrainUniforms=((Ie,Fe)=>({u_depth:new l.aL(Ie,Fe.u_depth),u_terrain:new l.aL(Ie,Fe.u_terrain),u_terrain_dim:new l.aM(Ie,Fe.u_terrain_dim),u_terrain_matrix:new l.aN(Ie,Fe.u_terrain_matrix),u_terrain_unpack:new l.aO(Ie,Fe.u_terrain_unpack),u_terrain_exaggeration:new l.aM(Ie,Fe.u_terrain_exaggeration)}))(s,Ae),this.binderUniforms=p?p.getUniforms(s,Ae):[]}draw(s,h,p,g,y,E,S,P,M,D,z,V,te,ee,ie,J,ge,we){const le=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(g),s.setColorMode(y),s.setCullFace(E),P){s.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,P.depthTexture),s.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,P.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(P[Ae])}for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(S[Ae]);ie&&ie.setUniforms(s,this.binderUniforms,te,{zoom:ee});let ye=0;switch(h){case le.LINES:ye=2;break;case le.TRIANGLES:ye=3;break;case le.LINE_STRIP:ye=1}for(const Ae of V.get()){const Ie=Ae.vaos||(Ae.vaos={});(Ie[M]||(Ie[M]=new ts)).bind(s,this,D,ie?ie.getPaintVertexBuffers():[],z,Ae.vertexOffset,J,ge,we),le.drawElements(h,Ae.primitiveLength*ye,le.UNSIGNED_SHORT,Ae.primitiveOffset*ye*2)}}}function Qi(_,s,h){const p=1/me(h,1,s.transform.tileZoom),g=Math.pow(2,h.tileID.overscaledZ),y=h.tileSize*Math.pow(2,s.transform.tileZoom)/g,E=y*(h.tileID.canonical.x+h.tileID.wrap*g),S=y*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const ha=(_,s,h,p)=>{const g=s.style.light,y=g.properties.get("position"),E=[y.x,y.y,y.z],S=function(){var M=new l.A(9);return l.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();g.properties.get("anchor")==="viewport"&&function(M,D){var z=Math.sin(D),V=Math.cos(D);M[0]=V,M[1]=z,M[2]=0,M[3]=-z,M[4]=V,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(S,-s.transform.angle),function(M,D,z){var V=D[0],te=D[1],ee=D[2];M[0]=V*z[0]+te*z[3]+ee*z[6],M[1]=V*z[1]+te*z[4]+ee*z[7],M[2]=V*z[2]+te*z[5]+ee*z[8]}(E,E,S);const P=g.properties.get("color");return{u_matrix:_,u_lightpos:E,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+h,u_opacity:p}},Ur=(_,s,h,p,g,y,E)=>l.e(ha(_,s,h,p),Qi(y,s,E),{u_height_factor:-Math.pow(2,g.overscaledZ)/E.tileSize/8}),ol=_=>({u_matrix:_}),al=(_,s,h,p)=>l.e(ol(_),Qi(h,s,p)),da=(_,s)=>({u_matrix:_,u_world:s}),q=(_,s,h,p,g)=>l.e(al(_,s,h,p),{u_world:g}),Y=(_,s,h,p)=>{const g=_.transform;let y,E;if(p.paint.get("circle-pitch-alignment")==="map"){const S=me(h,1,g.zoom);y=!0,E=[S,S]}else y=!1,E=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(s.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:E}},de=(_,s,h)=>{const p=me(h,1,s.zoom),g=Math.pow(2,s.zoom-h.tileID.overscaledZ),y=h.tileID.overscaleFactor();return{u_matrix:_,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*g),s.pixelsToGLUnits[1]/(p*g)],u_overscale_factor:y}},Ce=(_,s,h=1)=>({u_matrix:_,u_color:s,u_overlay:0,u_overlay_scale:h}),Ge=_=>({u_matrix:_}),ct=(_,s,h,p)=>({u_matrix:_,u_extrude_scale:me(s,1,h),u_intensity:p});function Ft(_,s){const h=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new l.U(0,p/h).toLngLat().lat,new l.U(0,(p+1)/h).toLngLat().lat]}const Vn=(_,s,h,p)=>{const g=_.transform;return{u_matrix:ic(_,s,h,p),u_ratio:1/me(s,1,g.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Qn=(_,s,h,p,g)=>l.e(Vn(_,s,h,g),{u_image:0,u_image_height:p}),xi=(_,s,h,p,g)=>{const y=_.transform,E=tf(s,y);return{u_matrix:ic(_,s,h,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/me(s,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},xr=(_,s,h,p,g,y)=>{const E=_.lineAtlas,S=tf(s,_.transform),P=h.layout.get("line-cap")==="round",M=E.getDash(p.from,P),D=E.getDash(p.to,P),z=M.width*g.fromScale,V=D.width*g.toScale;return l.e(Vn(_,s,h,y),{u_patternscale_a:[S/z,-M.height/2],u_patternscale_b:[S/V,-D.height/2],u_sdfgamma:E.width/(256*Math.min(z,V)*_.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:D.y,u_mix:g.t})};function tf(_,s){return 1/me(_,1,s.tileZoom)}function ic(_,s,h,p){return _.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const nf=(_,s,h,p,g)=>{return{u_matrix:_,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(E=g.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(y=g.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:rf(g.paint.get("raster-hue-rotate"))};var y,E};function rf(_){_*=Math.PI/180;const s=Math.sin(_),h=Math.cos(_);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const Du=(_,s,h,p,g,y,E,S,P,M)=>{const D=g.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:D.width/D.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+P,u_pitch_with_map:+p,u_texsize:M,u_texture:0}},zu=(_,s,h,p,g,y,E,S,P,M,D)=>{const z=g.transform;return l.e(Du(_,s,h,p,g,y,E,S,P,M),{u_gamma_scale:p?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:1})},Ro=(_,s,h,p,g,y,E,S,P,M)=>l.e(zu(_,s,h,p,g,y,E,S,!0,P),{u_texsize_icon:M,u_texture_icon:1}),rc=(_,s,h)=>({u_matrix:_,u_opacity:s,u_color:h}),Vr=(_,s,h,p,g,y)=>l.e(function(E,S,P,M){const D=P.imageManager.getPattern(E.from.toString()),z=P.imageManager.getPattern(E.to.toString()),{width:V,height:te}=P.imageManager.getPixelSize(),ee=Math.pow(2,M.tileID.overscaledZ),ie=M.tileSize*Math.pow(2,P.transform.tileZoom)/ee,J=ie*(M.tileID.canonical.x+M.tileID.wrap*ee),ge=ie*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[V,te],u_mix:S.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/me(M,1,P.transform.tileZoom),u_pixel_coord_upper:[J>>16,ge>>16],u_pixel_coord_lower:[65535&J,65535&ge]}}(p,y,h,g),{u_matrix:_,u_opacity:s}),sc={fillExtrusion:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_lightpos:new l.aP(_,s.u_lightpos),u_lightintensity:new l.aM(_,s.u_lightintensity),u_lightcolor:new l.aP(_,s.u_lightcolor),u_vertical_gradient:new l.aM(_,s.u_vertical_gradient),u_opacity:new l.aM(_,s.u_opacity)}),fillExtrusionPattern:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_lightpos:new l.aP(_,s.u_lightpos),u_lightintensity:new l.aM(_,s.u_lightintensity),u_lightcolor:new l.aP(_,s.u_lightcolor),u_vertical_gradient:new l.aM(_,s.u_vertical_gradient),u_height_factor:new l.aM(_,s.u_height_factor),u_image:new l.aL(_,s.u_image),u_texsize:new l.aQ(_,s.u_texsize),u_pixel_coord_upper:new l.aQ(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(_,s.u_pixel_coord_lower),u_scale:new l.aP(_,s.u_scale),u_fade:new l.aM(_,s.u_fade),u_opacity:new l.aM(_,s.u_opacity)}),fill:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix)}),fillPattern:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_image:new l.aL(_,s.u_image),u_texsize:new l.aQ(_,s.u_texsize),u_pixel_coord_upper:new l.aQ(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(_,s.u_pixel_coord_lower),u_scale:new l.aP(_,s.u_scale),u_fade:new l.aM(_,s.u_fade)}),fillOutline:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_world:new l.aQ(_,s.u_world)}),fillOutlinePattern:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_world:new l.aQ(_,s.u_world),u_image:new l.aL(_,s.u_image),u_texsize:new l.aQ(_,s.u_texsize),u_pixel_coord_upper:new l.aQ(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(_,s.u_pixel_coord_lower),u_scale:new l.aP(_,s.u_scale),u_fade:new l.aM(_,s.u_fade)}),circle:(_,s)=>({u_camera_to_center_distance:new l.aM(_,s.u_camera_to_center_distance),u_scale_with_map:new l.aL(_,s.u_scale_with_map),u_pitch_with_map:new l.aL(_,s.u_pitch_with_map),u_extrude_scale:new l.aQ(_,s.u_extrude_scale),u_device_pixel_ratio:new l.aM(_,s.u_device_pixel_ratio),u_matrix:new l.aN(_,s.u_matrix)}),collisionBox:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_camera_to_center_distance:new l.aM(_,s.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(_,s.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(_,s.u_extrude_scale),u_overscale_factor:new l.aM(_,s.u_overscale_factor)}),collisionCircle:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_inv_matrix:new l.aN(_,s.u_inv_matrix),u_camera_to_center_distance:new l.aM(_,s.u_camera_to_center_distance),u_viewport_size:new l.aQ(_,s.u_viewport_size)}),debug:(_,s)=>({u_color:new l.aR(_,s.u_color),u_matrix:new l.aN(_,s.u_matrix),u_overlay:new l.aL(_,s.u_overlay),u_overlay_scale:new l.aM(_,s.u_overlay_scale)}),clippingMask:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix)}),heatmap:(_,s)=>({u_extrude_scale:new l.aM(_,s.u_extrude_scale),u_intensity:new l.aM(_,s.u_intensity),u_matrix:new l.aN(_,s.u_matrix)}),heatmapTexture:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_world:new l.aQ(_,s.u_world),u_image:new l.aL(_,s.u_image),u_color_ramp:new l.aL(_,s.u_color_ramp),u_opacity:new l.aM(_,s.u_opacity)}),hillshade:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_image:new l.aL(_,s.u_image),u_latrange:new l.aQ(_,s.u_latrange),u_light:new l.aQ(_,s.u_light),u_shadow:new l.aR(_,s.u_shadow),u_highlight:new l.aR(_,s.u_highlight),u_accent:new l.aR(_,s.u_accent)}),hillshadePrepare:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_image:new l.aL(_,s.u_image),u_dimension:new l.aQ(_,s.u_dimension),u_zoom:new l.aM(_,s.u_zoom),u_unpack:new l.aO(_,s.u_unpack)}),line:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_ratio:new l.aM(_,s.u_ratio),u_device_pixel_ratio:new l.aM(_,s.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(_,s.u_units_to_pixels)}),lineGradient:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_ratio:new l.aM(_,s.u_ratio),u_device_pixel_ratio:new l.aM(_,s.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(_,s.u_units_to_pixels),u_image:new l.aL(_,s.u_image),u_image_height:new l.aM(_,s.u_image_height)}),linePattern:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_texsize:new l.aQ(_,s.u_texsize),u_ratio:new l.aM(_,s.u_ratio),u_device_pixel_ratio:new l.aM(_,s.u_device_pixel_ratio),u_image:new l.aL(_,s.u_image),u_units_to_pixels:new l.aQ(_,s.u_units_to_pixels),u_scale:new l.aP(_,s.u_scale),u_fade:new l.aM(_,s.u_fade)}),lineSDF:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_ratio:new l.aM(_,s.u_ratio),u_device_pixel_ratio:new l.aM(_,s.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(_,s.u_units_to_pixels),u_patternscale_a:new l.aQ(_,s.u_patternscale_a),u_patternscale_b:new l.aQ(_,s.u_patternscale_b),u_sdfgamma:new l.aM(_,s.u_sdfgamma),u_image:new l.aL(_,s.u_image),u_tex_y_a:new l.aM(_,s.u_tex_y_a),u_tex_y_b:new l.aM(_,s.u_tex_y_b),u_mix:new l.aM(_,s.u_mix)}),raster:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_tl_parent:new l.aQ(_,s.u_tl_parent),u_scale_parent:new l.aM(_,s.u_scale_parent),u_buffer_scale:new l.aM(_,s.u_buffer_scale),u_fade_t:new l.aM(_,s.u_fade_t),u_opacity:new l.aM(_,s.u_opacity),u_image0:new l.aL(_,s.u_image0),u_image1:new l.aL(_,s.u_image1),u_brightness_low:new l.aM(_,s.u_brightness_low),u_brightness_high:new l.aM(_,s.u_brightness_high),u_saturation_factor:new l.aM(_,s.u_saturation_factor),u_contrast_factor:new l.aM(_,s.u_contrast_factor),u_spin_weights:new l.aP(_,s.u_spin_weights)}),symbolIcon:(_,s)=>({u_is_size_zoom_constant:new l.aL(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(_,s.u_is_size_feature_constant),u_size_t:new l.aM(_,s.u_size_t),u_size:new l.aM(_,s.u_size),u_camera_to_center_distance:new l.aM(_,s.u_camera_to_center_distance),u_pitch:new l.aM(_,s.u_pitch),u_rotate_symbol:new l.aL(_,s.u_rotate_symbol),u_aspect_ratio:new l.aM(_,s.u_aspect_ratio),u_fade_change:new l.aM(_,s.u_fade_change),u_matrix:new l.aN(_,s.u_matrix),u_label_plane_matrix:new l.aN(_,s.u_label_plane_matrix),u_coord_matrix:new l.aN(_,s.u_coord_matrix),u_is_text:new l.aL(_,s.u_is_text),u_pitch_with_map:new l.aL(_,s.u_pitch_with_map),u_texsize:new l.aQ(_,s.u_texsize),u_texture:new l.aL(_,s.u_texture)}),symbolSDF:(_,s)=>({u_is_size_zoom_constant:new l.aL(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(_,s.u_is_size_feature_constant),u_size_t:new l.aM(_,s.u_size_t),u_size:new l.aM(_,s.u_size),u_camera_to_center_distance:new l.aM(_,s.u_camera_to_center_distance),u_pitch:new l.aM(_,s.u_pitch),u_rotate_symbol:new l.aL(_,s.u_rotate_symbol),u_aspect_ratio:new l.aM(_,s.u_aspect_ratio),u_fade_change:new l.aM(_,s.u_fade_change),u_matrix:new l.aN(_,s.u_matrix),u_label_plane_matrix:new l.aN(_,s.u_label_plane_matrix),u_coord_matrix:new l.aN(_,s.u_coord_matrix),u_is_text:new l.aL(_,s.u_is_text),u_pitch_with_map:new l.aL(_,s.u_pitch_with_map),u_texsize:new l.aQ(_,s.u_texsize),u_texture:new l.aL(_,s.u_texture),u_gamma_scale:new l.aM(_,s.u_gamma_scale),u_device_pixel_ratio:new l.aM(_,s.u_device_pixel_ratio),u_is_halo:new l.aL(_,s.u_is_halo)}),symbolTextAndIcon:(_,s)=>({u_is_size_zoom_constant:new l.aL(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(_,s.u_is_size_feature_constant),u_size_t:new l.aM(_,s.u_size_t),u_size:new l.aM(_,s.u_size),u_camera_to_center_distance:new l.aM(_,s.u_camera_to_center_distance),u_pitch:new l.aM(_,s.u_pitch),u_rotate_symbol:new l.aL(_,s.u_rotate_symbol),u_aspect_ratio:new l.aM(_,s.u_aspect_ratio),u_fade_change:new l.aM(_,s.u_fade_change),u_matrix:new l.aN(_,s.u_matrix),u_label_plane_matrix:new l.aN(_,s.u_label_plane_matrix),u_coord_matrix:new l.aN(_,s.u_coord_matrix),u_is_text:new l.aL(_,s.u_is_text),u_pitch_with_map:new l.aL(_,s.u_pitch_with_map),u_texsize:new l.aQ(_,s.u_texsize),u_texsize_icon:new l.aQ(_,s.u_texsize_icon),u_texture:new l.aL(_,s.u_texture),u_texture_icon:new l.aL(_,s.u_texture_icon),u_gamma_scale:new l.aM(_,s.u_gamma_scale),u_device_pixel_ratio:new l.aM(_,s.u_device_pixel_ratio),u_is_halo:new l.aL(_,s.u_is_halo)}),background:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_opacity:new l.aM(_,s.u_opacity),u_color:new l.aR(_,s.u_color)}),backgroundPattern:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_opacity:new l.aM(_,s.u_opacity),u_image:new l.aL(_,s.u_image),u_pattern_tl_a:new l.aQ(_,s.u_pattern_tl_a),u_pattern_br_a:new l.aQ(_,s.u_pattern_br_a),u_pattern_tl_b:new l.aQ(_,s.u_pattern_tl_b),u_pattern_br_b:new l.aQ(_,s.u_pattern_br_b),u_texsize:new l.aQ(_,s.u_texsize),u_mix:new l.aM(_,s.u_mix),u_pattern_size_a:new l.aQ(_,s.u_pattern_size_a),u_pattern_size_b:new l.aQ(_,s.u_pattern_size_b),u_scale_a:new l.aM(_,s.u_scale_a),u_scale_b:new l.aM(_,s.u_scale_b),u_pixel_coord_upper:new l.aQ(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(_,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(_,s.u_tile_units_to_pixels)}),terrain:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_texture:new l.aL(_,s.u_texture),u_ele_delta:new l.aM(_,s.u_ele_delta)}),terrainDepth:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_ele_delta:new l.aM(_,s.u_ele_delta)}),terrainCoords:(_,s)=>({u_matrix:new l.aN(_,s.u_matrix),u_texture:new l.aL(_,s.u_texture),u_terrain_coords_id:new l.aM(_,s.u_terrain_coords_id),u_ele_delta:new l.aM(_,s.u_ele_delta)})};class oc{constructor(s,h,p){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ll={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ac{constructor(s,h,p,g){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=g,this.context=s;const y=s.gl;this.buffer=y.createBuffer(),s.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let p=0;p<this.attributes.length;p++){const g=h.attributes[this.attributes[p].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,h,p){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],E=h.attributes[y.name];E!==void 0&&s.vertexAttribPointer(E,y.components,s[ll[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fa=new WeakMap;function co(_){var s;if(fa.has(_))return fa.get(_);{const h=(s=_.getParameter(_.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return fa.set(_,h),h}}class Gt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lc extends Gt{getDefault(){return l.aT.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class br extends Gt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class wr extends Gt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ou extends Gt{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class cc extends Gt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class uc extends Gt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Fu extends Gt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Bu extends Gt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class hc extends Gt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Nu extends Gt{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Uu extends Gt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class dc extends Gt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class sf extends Gt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class of extends Gt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class pa extends Gt{getDefault(){return l.aT.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class ug extends Gt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class hg extends Gt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class dg extends Gt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class fg extends Gt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class pg extends Gt{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class mg extends Gt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Vu extends Gt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class fc extends Gt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class ju extends Gt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Gu extends Gt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class ma extends Gt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class af extends Gt{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class lf extends Gt{getDefault(){return null}set(s){var h;if(s===this.current&&!this.dirty)return;const p=this.gl;co(p)?p.bindVertexArray(s):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class $u extends Gt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Do extends Gt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class cf extends Gt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class uo extends Gt{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class ga extends uo{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class uf extends uo{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Hu extends uo{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Qt{constructor(s,h,p,g,y){this.context=s,this.width=h,this.height=p;const E=s.gl,S=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new ga(s,S),g)this.depthAttachment=y?new Hu(s,S):new uf(s,S);else if(y)throw new Error("Stencil cannot be setted without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class Mn{constructor(s,h,p){this.blendFunction=s,this.blendColor=h,this.mask=p}}Mn.Replace=[1,0],Mn.disabled=new Mn(Mn.Replace,l.aT.transparent,[!1,!1,!1,!1]),Mn.unblended=new Mn(Mn.Replace,l.aT.transparent,[!0,!0,!0,!0]),Mn.alphaBlended=new Mn([1,771],l.aT.transparent,[!0,!0,!0,!0]);class gg{constructor(s){var h,p;if(this.gl=s,this.clearColor=new lc(this),this.clearDepth=new br(this),this.clearStencil=new wr(this),this.colorMask=new Ou(this),this.depthMask=new cc(this),this.stencilMask=new uc(this),this.stencilFunc=new Fu(this),this.stencilOp=new Bu(this),this.stencilTest=new hc(this),this.depthRange=new Nu(this),this.depthTest=new Uu(this),this.depthFunc=new dc(this),this.blend=new sf(this),this.blendFunc=new of(this),this.blendColor=new pa(this),this.blendEquation=new ug(this),this.cullFace=new hg(this),this.cullFaceSide=new dg(this),this.frontFace=new fg(this),this.program=new pg(this),this.activeTexture=new mg(this),this.viewport=new Vu(this),this.bindFramebuffer=new fc(this),this.bindRenderbuffer=new ju(this),this.bindTexture=new Gu(this),this.bindVertexBuffer=new ma(this),this.bindElementBuffer=new af(this),this.bindVertexArray=new lf(this),this.pixelStoreUnpack=new $u(this),this.pixelStoreUnpackPremultiplyAlpha=new Do(this),this.pixelStoreUnpackFlipY=new cf(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),co(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=s.RGBA16F)!==null&&h!==void 0?h:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(p=s.RGB16F)!==null&&p!==void 0?p:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new oc(this,s,h)}createVertexBuffer(s,h,p){return new ac(this,s,h,p)}createRenderbuffer(s,h,p){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,s,h,p),this.bindRenderbuffer.set(null),y}createFramebuffer(s,h,p,g){return new Qt(this,s,h,p,g)}clear({color:s,depth:h,stencil:p}){const g=this.gl;let y=0;s&&(y|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(y|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(y|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),g.clear(y)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){l.aG(s.blendFunction,Mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return co(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var h;return co(this.gl)?this.gl.deleteVertexArray(s):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class $t{constructor(s,h,p){this.func=s,this.mask=h,this.range=p}}$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);const zo=7680;class Ln{constructor(s,h,p,g,y,E){this.test=s,this.ref=h,this.mask=p,this.fail=g,this.depthFail=y,this.pass=E}}Ln.disabled=new Ln({func:519,mask:0},0,0,zo,zo,zo);class Pn{constructor(s,h,p){this.enable=s,this.mode=h,this.frontFace=p}}let cl;function hf(_,s,h,p,g,y,E){const S=_.context,P=S.gl,M=_.useProgram("collisionBox"),D=[];let z=0,V=0;for(let le=0;le<p.length;le++){const ye=p[le],Ae=s.getTile(ye),Ie=Ae.getBucket(h);if(!Ie)continue;let Fe=ye.posMatrix;g[0]===0&&g[1]===0||(Fe=_.translatePosMatrix(ye.posMatrix,Ae,g,y));const Ve=E?Ie.textCollisionBox:Ie.iconCollisionBox,Ue=Ie.collisionCircleArray;if(Ue.length>0){const $e=l.Z(),ut=Fe;l.aU($e,Ie.placementInvProjMatrix,_.transform.glCoordMatrix),l.aU($e,$e,Ie.placementViewportMatrix),D.push({circleArray:Ue,circleOffset:V,transform:ut,invTransform:$e,coord:ye}),z+=Ue.length/4,V=z}Ve&&M.draw(S,P.LINES,$t.disabled,Ln.disabled,_.colorModeForRenderPass(),Pn.disabled,de(Fe,_.transform,Ae),_.style.map.terrain&&_.style.map.terrain.getTerrainData(ye),h.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,_.transform.zoom,null,null,Ve.collisionVertexBuffer)}if(!E||!D.length)return;const te=_.useProgram("collisionCircle"),ee=new l.aV;ee.resize(4*z),ee._trim();let ie=0;for(const le of D)for(let ye=0;ye<le.circleArray.length/4;ye++){const Ae=4*ye,Ie=le.circleArray[Ae+0],Fe=le.circleArray[Ae+1],Ve=le.circleArray[Ae+2],Ue=le.circleArray[Ae+3];ee.emplace(ie++,Ie,Fe,Ve,Ue,0),ee.emplace(ie++,Ie,Fe,Ve,Ue,1),ee.emplace(ie++,Ie,Fe,Ve,Ue,2),ee.emplace(ie++,Ie,Fe,Ve,Ue,3)}(!cl||cl.length<2*z)&&(cl=function(le){const ye=2*le,Ae=new l.aX;Ae.resize(ye),Ae._trim();for(let Ie=0;Ie<ye;Ie++){const Fe=6*Ie;Ae.uint16[Fe+0]=4*Ie+0,Ae.uint16[Fe+1]=4*Ie+1,Ae.uint16[Fe+2]=4*Ie+2,Ae.uint16[Fe+3]=4*Ie+2,Ae.uint16[Fe+4]=4*Ie+3,Ae.uint16[Fe+5]=4*Ie+0}return Ae}(z));const J=S.createIndexBuffer(cl,!0),ge=S.createVertexBuffer(ee,l.aW.members,!0);for(const le of D){const ye={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(we=_.transform).cameraToCenterDistance,u_viewport_size:[we.width,we.height]};te.draw(S,P.TRIANGLES,$t.disabled,Ln.disabled,_.colorModeForRenderPass(),Pn.disabled,ye,_.style.map.terrain&&_.style.map.terrain.getTerrainData(le.coord),h.id,ge,J,l.S.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,_.transform.zoom,null,null,null)}var we;ge.destroy(),J.destroy()}Pn.disabled=new Pn(!1,1029,2305),Pn.backCCW=new Pn(!0,1029,2305);const Wu=l.ao(new Float32Array(16));function pc(_,s,h,p,g,y){const{horizontalAlign:E,verticalAlign:S}=l.au(_);return new l.P((-(E-.5)*s/g+p[0])*y,(-(S-.5)*h/g+p[1])*y)}function mc(_,s,h,p,g,y,E,S,P,M,D){const z=_.text.placedSymbolArray,V=_.text.dynamicLayoutVertexArray,te=_.icon.dynamicLayoutVertexArray,ee={};V.clear();for(let ie=0;ie<z.length;ie++){const J=z.get(ie),ge=J.hidden||!J.crossTileID||_.allowVerticalPlacement&&!J.placedOrientation?null:p[J.crossTileID];if(ge){const we=new l.P(J.anchorX,J.anchorY),le=An(we,h?E:y,D),ye=Vs(g.cameraToCenterDistance,le.signedDistanceFromCamera);let Ae=l.aj(_.textSizeData,P,J)*ye/l.ap;h&&(Ae*=_.tilePixelRatio/S);const{width:Ie,height:Fe,anchor:Ve,textOffset:Ue,textBoxScale:$e}=ge,ut=pc(Ve,Ie,Fe,Ue,$e,Ae),Ut=h?An(we.add(ut),y,D).point:le.point.add(s?ut.rotate(-g.angle):ut),Ke=_.allowVerticalPlacement&&J.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let wt=0;wt<J.numGlyphs;wt++)l.ak(V,Ut,Ke);M&&J.associatedIconIndex>=0&&(ee[J.associatedIconIndex]={shiftedAnchor:Ut,angle:Ke})}else X(J.numGlyphs,V)}if(M){te.clear();const ie=_.icon.placedSymbolArray;for(let J=0;J<ie.length;J++){const ge=ie.get(J);if(ge.hidden)X(ge.numGlyphs,te);else{const we=ee[J];if(we)for(let le=0;le<ge.numGlyphs;le++)l.ak(te,we.shiftedAnchor,we.angle);else X(ge.numGlyphs,te)}}_.icon.dynamicLayoutVertexBuffer.updateData(te)}_.text.dynamicLayoutVertexBuffer.updateData(V)}function qu(_,s,h){return h.iconsInText&&s?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function gc(_,s,h,p,g,y,E,S,P,M,D,z){const V=_.context,te=V.gl,ee=_.transform,ie=S==="map",J=P==="map",ge=S!=="viewport"&&h.layout.get("symbol-placement")!=="point",we=ie&&!J&&!ge,le=!h.layout.get("symbol-sort-key").isConstant();let ye=!1;const Ae=_.depthModeForSublayer(0,$t.ReadOnly),Ie=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Fe=[];for(const Ve of p){const Ue=s.getTile(Ve),$e=Ue.getBucket(h);if(!$e)continue;const ut=g?$e.text:$e.icon;if(!ut||!ut.segments.get().length||!ut.hasVisibleVertices)continue;const Ut=ut.programConfigurations.get(h.id),Ke=g||$e.sdfIcons,wt=g?$e.textSizeData:$e.iconSizeData,dt=J||ee.pitch!==0,on=_.useProgram(qu(Ke,g,$e),Ut),Bt=l.ah(wt,ee.zoom),Lt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ve);let Vt,jn,mn,bi,oi=[0,0],Zn=null;if(g)jn=Ue.glyphAtlasTexture,mn=te.LINEAR,Vt=Ue.glyphAtlasTexture.size,$e.iconsInText&&(oi=Ue.imageAtlasTexture.size,Zn=Ue.imageAtlasTexture,bi=dt||_.options.rotating||_.options.zooming||wt.kind==="composite"||wt.kind==="camera"?te.LINEAR:te.NEAREST);else{const Gn=h.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;jn=Ue.imageAtlasTexture,mn=Ke||_.options.rotating||_.options.zooming||Gn||dt?te.LINEAR:te.NEAREST,Vt=Ue.imageAtlasTexture.size}const Sr=me(Ue,1,_.transform.zoom),wn=He(Ve.posMatrix,J,ie,_.transform,Sr),Es=Nr(Ve.posMatrix,J,ie,_.transform,Sr),Ss=Ie&&$e.hasTextData(),mo=h.layout.get("icon-text-fit")!=="none"&&Ss&&$e.hasIconData();if(ge){const Gn=_.style.map.terrain?(nr,$n)=>_.style.map.terrain.getElevation(Ve,nr,$n):null,ai=h.layout.get("text-rotation-alignment")==="map";qe($e,Ve.posMatrix,_,g,wn,Es,J,M,ai,Gn)}const Uo=_.translatePosMatrix(Ve.posMatrix,Ue,y,E),Ta=ge||g&&Ie||mo?Wu:wn,ki=_.translatePosMatrix(Es,Ue,y,E,!0),wi=Ke&&h.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vi;Vi=Ke?$e.iconsInText?Ro(wt.kind,Bt,we,J,_,Uo,Ta,ki,Vt,oi):zu(wt.kind,Bt,we,J,_,Uo,Ta,ki,g,Vt):Du(wt.kind,Bt,we,J,_,Uo,Ta,ki,g,Vt);const Vo={program:on,buffers:ut,uniformValues:Vi,atlasTexture:jn,atlasTextureIcon:Zn,atlasInterpolation:mn,atlasInterpolationIcon:bi,isSDF:Ke,hasHalo:wi};if(le&&$e.canOverlap){ye=!0;const Gn=ut.segments.get();for(const ai of Gn)Fe.push({segments:new l.S([ai]),sortKey:ai.sortKey,state:Vo,terrainData:Lt})}else Fe.push({segments:ut.segments,sortKey:0,state:Vo,terrainData:Lt})}ye&&Fe.sort((Ve,Ue)=>Ve.sortKey-Ue.sortKey);for(const Ve of Fe){const Ue=Ve.state;if(V.activeTexture.set(te.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,te.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(V.activeTexture.set(te.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Ue.isSDF){const $e=Ue.uniformValues;Ue.hasHalo&&($e.u_is_halo=1,Zu(Ue.buffers,Ve.segments,h,_,Ue.program,Ae,D,z,$e,Ve.terrainData)),$e.u_is_halo=0}Zu(Ue.buffers,Ve.segments,h,_,Ue.program,Ae,D,z,Ue.uniformValues,Ve.terrainData)}}function Zu(_,s,h,p,g,y,E,S,P,M){const D=p.context;g.draw(D,D.gl.TRIANGLES,y,E,S,Pn.disabled,P,M,h.id,_.layoutVertexBuffer,_.indexBuffer,s,h.paint,p.transform.zoom,_.programConfigurations.get(h.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function ul(_,s,h,p,g){if(!h||!p||!p.imageAtlas)return;const y=p.imageAtlas.patternPositions;let E=y[h.to.toString()],S=y[h.from.toString()];if(!E&&S&&(E=S),!S&&E&&(S=E),!E||!S){const P=g.getPaintProperty(s);E=y[P],S=y[P]}E&&S&&_.setConstantPatternPositions(E,S)}function hl(_,s,h,p,g,y,E){const S=_.context.gl,P="fill-pattern",M=h.paint.get(P),D=M&&M.constantOr(1),z=h.getCrossfadeParameters();let V,te,ee,ie,J;E?(te=D&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=S.LINES):(te=D?"fillPattern":"fill",V=S.TRIANGLES);const ge=M.constantOr(null);for(const we of p){const le=s.getTile(we);if(D&&!le.patternsLoaded())continue;const ye=le.getBucket(h);if(!ye)continue;const Ae=ye.programConfigurations.get(h.id),Ie=_.useProgram(te,Ae),Fe=_.style.map.terrain&&_.style.map.terrain.getTerrainData(we);D&&(_.context.activeTexture.set(S.TEXTURE0),le.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Ae.updatePaintBuffers(z)),ul(Ae,P,ge,le,h);const Ve=Fe?we:null,Ue=_.translatePosMatrix(Ve?Ve.posMatrix:we.posMatrix,le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){ie=ye.indexBuffer2,J=ye.segments2;const $e=[S.drawingBufferWidth,S.drawingBufferHeight];ee=te==="fillOutlinePattern"&&D?q(Ue,_,z,le,$e):da(Ue,$e)}else ie=ye.indexBuffer,J=ye.segments,ee=D?al(Ue,_,z,le):ol(Ue);Ie.draw(_.context,V,g,_.stencilModeForClipping(we),y,Pn.disabled,ee,Fe,h.id,ye.layoutVertexBuffer,ie,J,h.paint,_.transform.zoom,Ae)}}function dl(_,s,h,p,g,y,E){const S=_.context,P=S.gl,M="fill-extrusion-pattern",D=h.paint.get(M),z=D.constantOr(1),V=h.getCrossfadeParameters(),te=h.paint.get("fill-extrusion-opacity"),ee=D.constantOr(null);for(const ie of p){const J=s.getTile(ie),ge=J.getBucket(h);if(!ge)continue;const we=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ie),le=ge.programConfigurations.get(h.id),ye=_.useProgram(z?"fillExtrusionPattern":"fillExtrusion",le);z&&(_.context.activeTexture.set(P.TEXTURE0),J.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),le.updatePaintBuffers(V)),ul(le,M,ee,J,h);const Ae=_.translatePosMatrix(ie.posMatrix,J,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ie=h.paint.get("fill-extrusion-vertical-gradient"),Fe=z?Ur(Ae,_,Ie,te,ie,V,J):ha(Ae,_,Ie,te);ye.draw(S,S.gl.TRIANGLES,g,y,E,Pn.backCCW,Fe,we,h.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,h.paint,_.transform.zoom,le,_.style.map.terrain&&ge.centroidVertexBuffer)}}function _g(_,s,h,p,g,y,E){const S=_.context,P=S.gl,M=h.fbo;if(!M)return;const D=_.useProgram("hillshade"),z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,M.colorAttachment.get()),D.draw(S,P.TRIANGLES,g,y,E,Pn.disabled,((V,te,ee,ie)=>{const J=ee.paint.get("hillshade-shadow-color"),ge=ee.paint.get("hillshade-highlight-color"),we=ee.paint.get("hillshade-accent-color");let le=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=V.transform.angle);const ye=!V.options.moving;return{u_matrix:ie?ie.posMatrix:V.transform.calculatePosMatrix(te.tileID.toUnwrapped(),ye),u_image:0,u_latrange:Ft(0,te.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),le],u_shadow:J,u_highlight:ge,u_accent:we}})(_,h,p,z?s:null),z,p.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function Xu(_,s,h,p,g,y){const E=_.context,S=E.gl,P=s.dem;if(P&&P.data){const M=P.dim,D=P.stride,z=P.getPixels();if(E.activeTexture.set(S.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||_.getTileTexture(D),s.demTexture){const te=s.demTexture;te.update(z,{premultiply:!1}),te.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else s.demTexture=new Ee(E,z,S.RGBA,{premultiply:!1}),s.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);E.activeTexture.set(S.TEXTURE0);let V=s.fbo;if(!V){const te=new Ee(E,{width:M,height:M,data:null},S.RGBA);te.bind(S.LINEAR,S.CLAMP_TO_EDGE),V=s.fbo=E.createFramebuffer(M,M,!0,!1),V.colorAttachment.set(te.texture)}E.bindFramebuffer.set(V.framebuffer),E.viewport.set([0,0,M,M]),_.useProgram("hillshadePrepare").draw(E,S.TRIANGLES,p,g,y,Pn.disabled,((te,ee)=>{const ie=ee.stride,J=l.Z();return l.aS(J,0,l.N,-l.N,0,0,1),l.$(J,J,[0,-l.N,0]),{u_matrix:J,u_image:1,u_dimension:[ie,ie],u_zoom:te.overscaledZ,u_unpack:ee.getUnpackVector()}})(s.tileID,P),null,h.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function yg(_,s,h,p,g,y){const E=p.paint.get("raster-fade-duration");if(!y&&E>0){const S=l.h.now(),P=(S-_.timeAdded)/E,M=s?(S-s.timeAdded)/E:-1,D=h.getSource(),z=g.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),V=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(_.tileID.overscaledZ-z),te=V&&_.refreshedUponExpiration?1:l.ad(V?P:1-M,0,1);return _.refreshedUponExpiration&&P>=1&&(_.refreshedUponExpiration=!1),s?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const df=new l.aT(1,0,0,1),_c=new l.aT(0,1,0,1),Yu=new l.aT(0,0,1,1),ff=new l.aT(1,0,1,1),pf=new l.aT(0,1,1,1);function fl(_,s,h,p){vc(_,0,s+h/2,_.transform.width,h,p)}function yc(_,s,h,p){vc(_,s-h/2,0,h,_.transform.height,p)}function vc(_,s,h,p,g,y){const E=_.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*_.pixelRatio,h*_.pixelRatio,p*_.pixelRatio,g*_.pixelRatio),E.clear({color:y}),S.disable(S.SCISSOR_TEST)}function mf(_,s,h){const p=_.context,g=p.gl,y=h.posMatrix,E=_.useProgram("debug"),S=$t.disabled,P=Ln.disabled,M=_.colorModeForRenderPass(),D="$debug",z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(h);p.activeTexture.set(g.TEXTURE0);const V=s.getTileByID(h.key).latestRawTileData,te=Math.floor((V&&V.byteLength||0)/1024),ee=s.getTile(h).tileSize,ie=512/Math.min(ee,512)*(h.overscaledZ/_.transform.zoom)*.5;let J=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(J+=` => ${h.overscaledZ}`),function(ge,we){ge.initDebugOverlayCanvas();const le=ge.debugOverlayCanvas,ye=ge.context.gl,Ae=ge.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,le.width,le.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(we,5,5),Ae.strokeText(we,5,5),ge.debugOverlayTexture.update(le),ge.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(_,`${J} ${te}kB`),E.draw(p,g.TRIANGLES,S,P,Mn.alphaBlended,Pn.disabled,Ce(y,l.aT.transparent,ie),null,D,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),E.draw(p,g.LINE_STRIP,S,P,M,Pn.disabled,Ce(y,l.aT.red),z,D,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function zn(_,s,h){const p=_.context,g=p.gl,y=_.colorModeForRenderPass(),E=new $t(g.LEQUAL,$t.ReadWrite,_.depthRangeFor3D),S=_.useProgram("terrain"),P=s.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,_.width,_.height]);for(const M of h){const D=_.renderToTexture.getTexture(M),z=s.getTerrainData(M.tileID);p.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,D.texture);const V={u_matrix:_.transform.calculatePosMatrix(M.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(_.transform.zoom)};S.draw(p,g.TRIANGLES,E,Ln.disabled,y,Pn.backCCW,V,z,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}class Oo{constructor(s,h){this.context=new gg(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=pn.maxUnderzooming+pn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ni}resize(s,h,p){if(this.width=Math.floor(s*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,h=new l.a_;h.emplaceBack(0,0),h.emplaceBack(l.N,0),h.emplaceBack(0,l.N),h.emplaceBack(l.N,l.N),this.tileExtentBuffer=s.createVertexBuffer(h,Gs.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);const p=new l.a_;p.emplaceBack(0,0),p.emplaceBack(l.N,0),p.emplaceBack(0,l.N),p.emplaceBack(l.N,l.N),this.debugBuffer=s.createVertexBuffer(p,Gs.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);const g=new l.V;g.emplaceBack(0,0,0,0),g.emplaceBack(l.N,0,l.N,0),g.emplaceBack(0,l.N,0,l.N),g.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=s.createVertexBuffer(g,tn.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);const y=new l.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,Gs.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);const E=new l.a$;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(E);const S=new l.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(S);const P=this.context.gl;this.stencilClearMode=new Ln({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.Z();l.aS(p,0,this.width,this.height,0,0,1),l.a0(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,$t.disabled,this.stencilClearMode,Mn.disabled,Pn.disabled,Ge(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const p=this.context,g=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Mn.disabled),p.setDepthMode($t.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const S=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);y.draw(p,g.TRIANGLES,$t.disabled,new Ln({func:g.ALWAYS,mask:0},S,255,g.KEEP,g.KEEP,g.REPLACE),Mn.disabled,Pn.disabled,Ge(E.posMatrix),P,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Ln({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new Ln({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,p=s.sort((E,S)=>S.overscaledZ-E.overscaledZ),g=p[p.length-1].overscaledZ,y=p[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const E={};for(let S=0;S<y;S++)E[S+g]=new Ln({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=y,[E,p]}return[{[g]:Ln.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Mn([s.CONSTANT_COLOR,s.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mn.unblended:Mn.alphaBlended}depthModeForSublayer(s,h,p){if(!this.opaquePassEnabledForLayer())return $t.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new $t(p||this.context.gl.LEQUAL,h,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();const p=this.style._order,g=this.style.sourceCaches,y={},E={},S={};for(const P in g){const M=g[P];M.used&&M.prepare(this.context),y[P]=M.getVisibleCoordinates(),E[P]=y[P].slice().reverse(),S[P]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<p.length;P++)if(this.style._layers[p[P]].is3D()){this.opaquePassCutoff=P;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const P=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(M,D){const z=M.context,V=z.gl,te=Mn.unblended,ee=new $t(V.LEQUAL,$t.ReadWrite,[0,1]),ie=D.getTerrainMesh(),J=D.sourceCache.getRenderableTiles(),ge=M.useProgram("terrainDepth");z.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,M.width/devicePixelRatio,M.height/devicePixelRatio]),z.clear({color:l.aT.transparent,depth:1});for(const we of J){const le=D.getTerrainData(we.tileID),ye={u_matrix:M.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_ele_delta:D.getMeshFrameDelta(M.transform.zoom)};ge.draw(z,V.TRIANGLES,ee,Ln.disabled,te,Pn.backCCW,ye,le,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,M.width,M.height])}(this,this.style.map.terrain),function(M,D){const z=M.context,V=z.gl,te=Mn.unblended,ee=new $t(V.LEQUAL,$t.ReadWrite,[0,1]),ie=D.getTerrainMesh(),J=D.getCoordsTexture(),ge=D.sourceCache.getRenderableTiles(),we=M.useProgram("terrainCoords");z.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,M.width/devicePixelRatio,M.height/devicePixelRatio]),z.clear({color:l.aT.transparent,depth:1}),D.coordsIndex=[];for(const le of ge){const ye=D.getTerrainData(le.tileID);z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,J.texture);const Ae={u_matrix:M.transform.calculatePosMatrix(le.tileID.toUnwrapped()),u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0,u_ele_delta:D.getMeshFrameDelta(M.transform.zoom)};we.draw(z,V.TRIANGLES,ee,Ln.disabled,te,Pn.backCCW,Ae,ye,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments),D.coordsIndex.push(le.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,M.width,M.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const P of p){const M=this.style._layers[P];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const D=E[M.source];(M.type==="custom"||D.length)&&this.renderLayer(this,g[M.source],M,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[p[this.currentLayer]],M=g[P.source],D=y[P.source];this._renderTileClippingMasks(P,D),this.renderLayer(this,M,P,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const P=this.style._layers[p[this.currentLayer]],M=g[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P))continue;const D=(P.type==="symbol"?S:E)[P.source];this._renderTileClippingMasks(P,y[P.source]),this.renderLayer(this,M,P,D)}if(this.options.showTileBoundaries){const P=function(M,D){let z=null;const V=Object.values(M._layers).flatMap(J=>J.source&&!J.isHidden(D)?[M.sourceCaches[J.source]]:[]),te=V.filter(J=>J.getSource().type==="vector"),ee=V.filter(J=>J.getSource().type!=="vector"),ie=J=>{(!z||z.getSource().maxzoom<J.getSource().maxzoom)&&(z=J)};return te.forEach(J=>ie(J)),z||ee.forEach(J=>ie(J)),z}(this.style,this.transform.zoom);P&&function(M,D,z){for(let V=0;V<z.length;V++)mf(M,D,z[V])}(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const M=P.transform.padding;fl(P,P.transform.height-(M.top||0),3,df),fl(P,M.bottom||0,3,_c),yc(P,M.left||0,3,Yu),yc(P,P.transform.width-(M.right||0),3,ff);const D=P.transform.centerPoint;(function(z,V,te,ee){vc(z,V-1,te-10,2,20,ee),vc(z,V-10,te-1,20,2,ee)})(P,D.x,P.transform.height-D.y,pf)}(this),this.context.setDefault()}renderLayer(s,h,p,g){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(g||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(y,E,S,P,M){if(y.renderPass!=="translucent")return;const D=Ln.disabled,z=y.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(V,te,ee,ie,J,ge,we){const le=te.transform,ye=J==="map",Ae=ge==="map";for(const Ie of V){const Fe=ie.getTile(Ie),Ve=Fe.getBucket(ee);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const Ue=l.ah(Ve.textSizeData,le.zoom),$e=me(Fe,1,te.transform.zoom),ut=He(Ie.posMatrix,Ae,ye,te.transform,$e),Ut=ee.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(Ue){const Ke=Math.pow(2,le.zoom-Fe.tileID.overscaledZ);mc(Ve,ye,Ae,we,le,ut,Ie.posMatrix,Ke,Ue,Ut,te.style.map.terrain?(wt,dt)=>te.style.map.terrain.getElevation(Ie,wt,dt):null)}}}(P,y,S,E,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),M),S.paint.get("icon-opacity").constantOr(1)!==0&&gc(y,E,S,P,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),D,z),S.paint.get("text-opacity").constantOr(1)!==0&&gc(y,E,S,P,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),D,z),E.map.showCollisionBoxes&&(hf(y,E,S,P,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),hf(y,E,S,P,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))})(s,h,p,g,this.style.placement.variableOffsets);break;case"circle":(function(y,E,S,P){if(y.renderPass!=="translucent")return;const M=S.paint.get("circle-opacity"),D=S.paint.get("circle-stroke-width"),z=S.paint.get("circle-stroke-opacity"),V=!S.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(D.constantOr(1)===0||z.constantOr(1)===0))return;const te=y.context,ee=te.gl,ie=y.depthModeForSublayer(0,$t.ReadOnly),J=Ln.disabled,ge=y.colorModeForRenderPass(),we=[];for(let le=0;le<P.length;le++){const ye=P[le],Ae=E.getTile(ye),Ie=Ae.getBucket(S);if(!Ie)continue;const Fe=Ie.programConfigurations.get(S.id),Ve=y.useProgram("circle",Fe),Ue=Ie.layoutVertexBuffer,$e=Ie.indexBuffer,ut=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ye),Ut={programConfiguration:Fe,program:Ve,layoutVertexBuffer:Ue,indexBuffer:$e,uniformValues:Y(y,ye,Ae,S),terrainData:ut};if(V){const Ke=Ie.segments.get();for(const wt of Ke)we.push({segments:new l.S([wt]),sortKey:wt.sortKey,state:Ut})}else we.push({segments:Ie.segments,sortKey:0,state:Ut})}V&&we.sort((le,ye)=>le.sortKey-ye.sortKey);for(const le of we){const{programConfiguration:ye,program:Ae,layoutVertexBuffer:Ie,indexBuffer:Fe,uniformValues:Ve,terrainData:Ue}=le.state;Ae.draw(te,ee.TRIANGLES,ie,J,ge,Pn.disabled,Ve,Ue,S.id,Ie,Fe,le.segments,S.paint,y.transform.zoom,ye)}})(s,h,p,g);break;case"heatmap":(function(y,E,S,P){if(S.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const M=y.context,D=M.gl,z=Ln.disabled,V=new Mn([D.ONE,D.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function(te,ee,ie){const J=te.gl;te.activeTexture.set(J.TEXTURE1),te.viewport.set([0,0,ee.width/4,ee.height/4]);let ge=ie.heatmapFbo;if(ge)J.bindTexture(J.TEXTURE_2D,ge.colorAttachment.get()),te.bindFramebuffer.set(ge.framebuffer);else{const we=J.createTexture();J.bindTexture(J.TEXTURE_2D,we),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),ge=ie.heatmapFbo=te.createFramebuffer(ee.width/4,ee.height/4,!1,!1),function(le,ye,Ae,Ie){var Fe,Ve;const Ue=le.gl,$e=(Fe=le.HALF_FLOAT)!==null&&Fe!==void 0?Fe:Ue.UNSIGNED_BYTE,ut=(Ve=le.RGBA16F)!==null&&Ve!==void 0?Ve:Ue.RGBA;Ue.texImage2D(Ue.TEXTURE_2D,0,ut,ye.width/4,ye.height/4,0,Ue.RGBA,$e,null),Ie.colorAttachment.set(Ae)}(te,ee,we,ge)}})(M,y,S),M.clear({color:l.aT.transparent});for(let te=0;te<P.length;te++){const ee=P[te];if(E.hasRenderableParent(ee))continue;const ie=E.getTile(ee),J=ie.getBucket(S);if(!J)continue;const ge=J.programConfigurations.get(S.id),we=y.useProgram("heatmap",ge),{zoom:le}=y.transform;we.draw(M,D.TRIANGLES,$t.disabled,z,V,Pn.disabled,ct(ee.posMatrix,ie,le,S.paint.get("heatmap-intensity")),null,S.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,S.paint,y.transform.zoom,ge)}M.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(M,D){const z=M.context,V=z.gl,te=D.heatmapFbo;if(!te)return;z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,te.colorAttachment.get()),z.activeTexture.set(V.TEXTURE1);let ee=D.colorRampTexture;ee||(ee=D.colorRampTexture=new Ee(z,D.colorRamp,V.RGBA)),ee.bind(V.LINEAR,V.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(z,V.TRIANGLES,$t.disabled,Ln.disabled,M.colorModeForRenderPass(),Pn.disabled,((ie,J,ge,we)=>{const le=l.Z();l.aS(le,0,ie.width,ie.height,0,0,1);const ye=ie.context.gl;return{u_matrix:le,u_world:[ye.drawingBufferWidth,ye.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:J.paint.get("heatmap-opacity")}})(M,D),null,D.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,D.paint,M.transform.zoom)}(y,S))})(s,h,p,g);break;case"line":(function(y,E,S,P){if(y.renderPass!=="translucent")return;const M=S.paint.get("line-opacity"),D=S.paint.get("line-width");if(M.constantOr(1)===0||D.constantOr(1)===0)return;const z=y.depthModeForSublayer(0,$t.ReadOnly),V=y.colorModeForRenderPass(),te=S.paint.get("line-dasharray"),ee=S.paint.get("line-pattern"),ie=ee.constantOr(1),J=S.paint.get("line-gradient"),ge=S.getCrossfadeParameters(),we=ie?"linePattern":te?"lineSDF":J?"lineGradient":"line",le=y.context,ye=le.gl;let Ae=!0;for(const Ie of P){const Fe=E.getTile(Ie);if(ie&&!Fe.patternsLoaded())continue;const Ve=Fe.getBucket(S);if(!Ve)continue;const Ue=Ve.programConfigurations.get(S.id),$e=y.context.program.get(),ut=y.useProgram(we,Ue),Ut=Ae||ut.program!==$e,Ke=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ie),wt=ee.constantOr(null);if(wt&&Fe.imageAtlas){const Bt=Fe.imageAtlas,Lt=Bt.patternPositions[wt.to.toString()],Vt=Bt.patternPositions[wt.from.toString()];Lt&&Vt&&Ue.setConstantPatternPositions(Lt,Vt)}const dt=Ke?Ie:null,on=ie?xi(y,Fe,S,ge,dt):te?xr(y,Fe,S,te,ge,dt):J?Qn(y,Fe,S,Ve.lineClipsArray.length,dt):Vn(y,Fe,S,dt);if(ie)le.activeTexture.set(ye.TEXTURE0),Fe.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Ue.updatePaintBuffers(ge);else if(te&&(Ut||y.lineAtlas.dirty))le.activeTexture.set(ye.TEXTURE0),y.lineAtlas.bind(le);else if(J){const Bt=Ve.gradients[S.id];let Lt=Bt.texture;if(S.gradientVersion!==Bt.version){let Vt=256;if(S.stepInterpolant){const jn=E.getSource().maxzoom,mn=Ie.canonical.z===jn?Math.ceil(1<<y.transform.maxZoom-Ie.canonical.z):1;Vt=l.ad(l.aY(Ve.maxLineLength/l.N*1024*mn),256,le.maxTextureSize)}Bt.gradient=l.aZ({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:Vt,image:Bt.gradient||void 0,clips:Ve.lineClipsArray}),Bt.texture?Bt.texture.update(Bt.gradient):Bt.texture=new Ee(le,Bt.gradient,ye.RGBA),Bt.version=S.gradientVersion,Lt=Bt.texture}le.activeTexture.set(ye.TEXTURE0),Lt.bind(S.stepInterpolant?ye.NEAREST:ye.LINEAR,ye.CLAMP_TO_EDGE)}ut.draw(le,ye.TRIANGLES,z,y.stencilModeForClipping(Ie),V,Pn.disabled,on,Ke,S.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,S.paint,y.transform.zoom,Ue,Ve.layoutVertexBuffer2),Ae=!1}})(s,h,p,g);break;case"fill":(function(y,E,S,P){const M=S.paint.get("fill-color"),D=S.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const z=y.colorModeForRenderPass(),V=S.paint.get("fill-pattern"),te=y.opaquePassEnabledForLayer()&&!V.constantOr(1)&&M.constantOr(l.aT.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===te){const ee=y.depthModeForSublayer(1,y.renderPass==="opaque"?$t.ReadWrite:$t.ReadOnly);hl(y,E,S,P,ee,z,!1)}if(y.renderPass==="translucent"&&S.paint.get("fill-antialias")){const ee=y.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly);hl(y,E,S,P,ee,z,!0)}})(s,h,p,g);break;case"fill-extrusion":(function(y,E,S,P){const M=S.paint.get("fill-extrusion-opacity");if(M!==0&&y.renderPass==="translucent"){const D=new $t(y.context.gl.LEQUAL,$t.ReadWrite,y.depthRangeFor3D);if(M!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))dl(y,E,S,P,D,Ln.disabled,Mn.disabled),dl(y,E,S,P,D,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const z=y.colorModeForRenderPass();dl(y,E,S,P,D,Ln.disabled,z)}}})(s,h,p,g);break;case"hillshade":(function(y,E,S,P){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const M=y.context,D=y.depthModeForSublayer(0,$t.ReadOnly),z=y.colorModeForRenderPass(),[V,te]=y.renderPass==="translucent"?y.stencilConfigForOverlap(P):[{},P];for(const ee of te){const ie=E.getTile(ee);ie.needsHillshadePrepare!==void 0&&ie.needsHillshadePrepare&&y.renderPass==="offscreen"?Xu(y,ie,S,D,Ln.disabled,z):y.renderPass==="translucent"&&_g(y,ee,ie,S,D,V[ee.overscaledZ],z)}M.viewport.set([0,0,y.width,y.height])})(s,h,p,g);break;case"raster":(function(y,E,S,P){if(y.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!P.length)return;const M=y.context,D=M.gl,z=E.getSource(),V=y.useProgram("raster"),te=y.colorModeForRenderPass(),[ee,ie]=z instanceof fn?[{},P]:y.stencilConfigForOverlap(P),J=ie[ie.length-1].overscaledZ,ge=!y.options.moving;for(const we of ie){const le=y.depthModeForSublayer(we.overscaledZ-J,S.paint.get("raster-opacity")===1?$t.ReadWrite:$t.ReadOnly,D.LESS),ye=E.getTile(we);ye.registerFadeDuration(S.paint.get("raster-fade-duration"));const Ae=E.findLoadedParent(we,0),Ie=yg(ye,Ae,E,S,y.transform,y.style.map.terrain);let Fe,Ve;const Ue=S.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;M.activeTexture.set(D.TEXTURE0),ye.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(D.TEXTURE1),Ae?(Ae.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),Fe=Math.pow(2,Ae.tileID.overscaledZ-ye.tileID.overscaledZ),Ve=[ye.tileID.canonical.x*Fe%1,ye.tileID.canonical.y*Fe%1]):ye.texture.bind(Ue,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const $e=y.style.map.terrain&&y.style.map.terrain.getTerrainData(we),ut=$e?we:null,Ut=ut?ut.posMatrix:y.transform.calculatePosMatrix(we.toUnwrapped(),ge),Ke=nf(Ut,Ve||[0,0],Fe||1,Ie,S);z instanceof fn?V.draw(M,D.TRIANGLES,le,Ln.disabled,te,Pn.disabled,Ke,$e,S.id,z.boundsBuffer,y.quadTriangleIndexBuffer,z.boundsSegments):V.draw(M,D.TRIANGLES,le,ee[we.overscaledZ],te,Pn.disabled,Ke,$e,S.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(s,h,p,g);break;case"background":(function(y,E,S,P){const M=S.paint.get("background-color"),D=S.paint.get("background-opacity");if(D===0)return;const z=y.context,V=z.gl,te=y.transform,ee=te.tileSize,ie=S.paint.get("background-pattern");if(y.isPatternMissing(ie))return;const J=!ie&&M.a===1&&D===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==J)return;const ge=Ln.disabled,we=y.depthModeForSublayer(0,J==="opaque"?$t.ReadWrite:$t.ReadOnly),le=y.colorModeForRenderPass(),ye=y.useProgram(ie?"backgroundPattern":"background"),Ae=P||te.coveringTiles({tileSize:ee,terrain:y.style.map.terrain});ie&&(z.activeTexture.set(V.TEXTURE0),y.imageManager.bind(y.context));const Ie=S.getCrossfadeParameters();for(const Fe of Ae){const Ve=P?Fe.posMatrix:y.transform.calculatePosMatrix(Fe.toUnwrapped()),Ue=ie?Vr(Ve,D,y,ie,{tileID:Fe,tileSize:ee},Ie):rc(Ve,D,M),$e=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Fe);ye.draw(z,V.TRIANGLES,we,ge,le,Pn.disabled,Ue,$e,S.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(s,0,p,g);break;case"custom":(function(y,E,S){const P=y.context,M=S.implementation;if(y.renderPass==="offscreen"){const D=M.prerender;D&&(y.setCustomLayerDefaults(),P.setColorMode(y.colorModeForRenderPass()),D.call(M,P.gl,y.transform.customLayerMatrix()),P.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),P.setColorMode(y.colorModeForRenderPass()),P.setStencilMode(Ln.disabled);const D=M.renderingMode==="3d"?new $t(y.context.gl.LEQUAL,$t.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,$t.ReadOnly);P.setDepthMode(D),M.render(P.gl,y.transform.customLayerMatrix()),P.setDirty(),y.setBaseState(),P.bindFramebuffer.set(null)}})(s,0,p)}}translatePosMatrix(s,h,p,g,y){if(!p[0]&&!p[1])return s;const E=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(E){const M=Math.sin(E),D=Math.cos(E);p=[p[0]*D-p[1]*M,p[0]*M+p[1]*D]}const S=[y?p[0]:me(h,p[0],this.transform.zoom),y?p[1]:me(h,p[1],this.transform.zoom),0],P=new Float32Array(16);return l.$(P,s,S),P}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!h||!p}useProgram(s,h){this.cache=this.cache||{};const p=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new vr(this.context,un[s],h,sc[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ee(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:h}=this.context.gl;return this.width!==s||this.height!==h}}class er{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,p){const g=Math.pow(2,p),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const P=1/(S=l.ag([],S,s))[3]/h*g;return l.b3(S,S,[P,P,1/S[3],P])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const P=function(V,te){var ee=te[0],ie=te[1],J=te[2],ge=ee*ee+ie*ie+J*J;return ge>0&&(ge=1/Math.sqrt(ge)),V[0]=te[0]*ge,V[1]=te[1]*ge,V[2]=te[2]*ge,V}([],function(V,te,ee){var ie=te[0],J=te[1],ge=te[2],we=ee[0],le=ee[1],ye=ee[2];return V[0]=J*ye-ge*le,V[1]=ge*we-ie*ye,V[2]=ie*le-J*we,V}([],Pe([],y[S[0]],y[S[1]]),Pe([],y[S[2]],y[S[1]]))),M=-((D=P)[0]*(z=y[S[1]])[0]+D[1]*z[1]+D[2]*z[2]);var D,z;return P.concat(M)});return new er(y,E)}}class _a{constructor(s,h){this.min=s,this.max=h,this.center=function(p,g,y){return p[0]=.5*g[0],p[1]=.5*g[1],p[2]=.5*g[2],p}([],function(p,g,y){return p[0]=g[0]+y[0],p[1]=g[1]+y[1],p[2]=g[2]+y[2],p}([],this.min,this.max))}quadrant(s){const h=[s%2==0,s<2],p=fe(this.min),g=fe(this.max);for(let y=0;y<h.length;y++)p[y]=h[y]?this.min[y]:this.center[y],g[y]=h[y]?this.center[y]:this.max[y];return g[2]=this.max[2],new _a(p,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let g=0;g<s.planes.length;g++){const y=s.planes[g];let E=0;for(let S=0;S<h.length;S++)l.b4(y,h[S])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let g=0;g<3;g++){let y=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let S=0;S<s.points.length;S++){const P=s.points[S][g]-this.min[g];y=Math.min(y,P),E=Math.max(E,P)}if(E<0||y>this.max[g]-this.min[g])return 0}return 1}}class pl{constructor(s=0,h=0,p=0,g=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=p,this.right=g}interpolate(s,h,p){return h.top!=null&&s.top!=null&&(this.top=l.B.number(s.top,h.top,p)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.B.number(s.bottom,h.bottom,p)),h.left!=null&&s.left!=null&&(this.left=l.B.number(s.left,h.left,p)),h.right!=null&&s.right!=null&&(this.right=l.B.number(s.right,h.right,p)),this}getCenter(s,h){const p=l.ad((this.left+s-this.right)/2,0,s),g=l.ad((this.top+h-this.bottom)/2,0,h);return new l.P(p,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new pl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class xc{constructor(s,h,p,g,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const s=new xc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this._minEleveationForCurrentTile=s._minEleveationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-l.b5(s,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new l.A(4);return l.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,g,y){var E=g[0],S=g[1],P=g[2],M=g[3],D=Math.sin(y),z=Math.cos(y);p[0]=E*z+P*D,p[1]=S*z+M*D,p[2]=E*-D+P*z,p[3]=S*-D+M*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=l.ad(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,p){this._unmodified=!1,this._edgeInsets.interpolate(s,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new l.b6(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),y=this.pointCoordinate(new l.P(this.width,this.height)),E=this.pointCoordinate(new l.P(0,this.height)),S=Math.floor(Math.min(p.x,g.x,y.x,E.x)),P=Math.floor(Math.max(p.x,g.x,y.x,E.x)),M=1;for(let D=S-M;D<=P+M;D++)D!==0&&h.push(new l.b6(D,s))}return h}coveringTiles(s){var h,p;let g=this.coveringZoomLevel(s);const y=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),S=l.U.fromLngLat(this.center),P=Math.pow(2,g),M=[P*E.x,P*E.y,0],D=[P*S.x,P*S.y,0],z=er.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let V=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=g);const te=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,ee=le=>({aabb:new _a([le*P,0,0],[(le+1)*P,P,0]),zoom:0,x:0,y:0,wrap:le,fullyVisible:!1}),ie=[],J=[],ge=g,we=s.reparseOverscaled?y:g;if(this._renderWorldCopies)for(let le=1;le<=3;le++)ie.push(ee(-le)),ie.push(ee(le));for(ie.push(ee(0));ie.length>0;){const le=ie.pop(),ye=le.x,Ae=le.y;let Ie=le.fullyVisible;if(!Ie){const ut=le.aabb.intersects(z);if(ut===0)continue;Ie=ut===2}const Fe=s.terrain?M:D,Ve=le.aabb.distanceX(Fe),Ue=le.aabb.distanceY(Fe),$e=Math.max(Math.abs(Ve),Math.abs(Ue));if(le.zoom===ge||$e>te+(1<<ge-le.zoom)-2&&le.zoom>=V){const ut=ge-le.zoom,Ut=M[0]-.5-(ye<<ut),Ke=M[1]-.5-(Ae<<ut);J.push({tileID:new l.O(le.zoom===ge?we:le.zoom,le.wrap,le.zoom,ye,Ae),distanceSq:ze([D[0]-.5-ye,D[1]-.5-Ae]),tileDistanceToCamera:Math.sqrt(Ut*Ut+Ke*Ke)})}else for(let ut=0;ut<4;ut++){const Ut=(ye<<1)+ut%2,Ke=(Ae<<1)+(ut>>1),wt=le.zoom+1;let dt=le.aabb.quadrant(ut);if(s.terrain){const on=new l.O(wt,le.wrap,wt,Ut,Ke),Bt=s.terrain.getMinMaxElevation(on),Lt=(h=Bt.minElevation)!==null&&h!==void 0?h:this.elevation,Vt=(p=Bt.maxElevation)!==null&&p!==void 0?p:this.elevation;dt=new _a([dt.min[0],dt.min[1],Lt],[dt.max[0],dt.max[1],Vt])}ie.push({aabb:dt,zoom:wt,x:Ut,y:Ke,wrap:le.wrap,fullyVisible:Ie})}}return J.sort((le,ye)=>le.distanceSq-ye.distanceSq).map(le=>le.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=l.ad(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(s.lng)*this.worldSize,l.H(h)*this.worldSize)}unproject(s){return new l.U(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),p=s.getElevationForLngLatZoom(h,this.tileZoom);if(!(this.elevation-p))return;const g=this.getCameraPosition(),y=l.U.fromLngLat(g.lngLat,g.altitude),E=l.U.fromLngLat(h,p),S=y.x-E.x,P=y.y-E.y,M=y.z-E.z,D=Math.sqrt(S*S+P*P+M*M),z=this.scaleZoom(this.cameraToCenterDistance/D/this.tileSize);this._elevation=p,this._center=h,this.zoom=z}setLocationAtPoint(s,h){const p=this.pointCoordinate(h),g=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(s),E=new l.U(y.x-(p.x-g.x),y.y-(p.y-g.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),h.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return l.U.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const V=h.pointCoordinate(s);if(V!=null)return V}const p=[s.x,s.y,0,1],g=[s.x,s.y,1,1];l.ag(p,p,this.pixelMatrixInverse),l.ag(g,g,this.pixelMatrixInverse);const y=p[3],E=g[3],S=p[1]/y,P=g[1]/E,M=p[2]/y,D=g[2]/E,z=M===D?0:(0-M)/(D-M);return new l.U(l.B.number(p[0]/y,g[0]/E,z)/this.worldSize,l.B.number(S,P,z)/this.worldSize)}coordinatePoint(s,h=0,p=this.pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,h,1];return l.ag(g,g,p),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Kt().extend(this.pointLocation(new l.P(0,s))).extend(this.pointLocation(new l.P(this.width,s))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Kt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const p=s.key,g=h?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];const y=s.canonical,E=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*s.wrap,P=l.ao(new Float64Array(16));return l.$(P,P,[S*E,y.y*E,0]),l.a0(P,P,[E/l.N,E/l.N,1]),l.a1(P,h?this.alignedProjMatrix:this.projMatrix,P),g[p]=new Float32Array(P),g[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,p,g,y=-90,E=90,S=-180,P=180;const M=this.size,D=this._unmodified;if(this.latRange){const te=this.latRange;y=l.H(te[1])*this.worldSize,E=l.H(te[0])*this.worldSize,s=E-y<M.y?M.y/(E-y):0}if(this.lngRange){const te=this.lngRange;S=l.b5(l.G(te[0])*this.worldSize,0,this.worldSize),P=l.b5(l.G(te[1])*this.worldSize,0,this.worldSize),P<S&&(P+=this.worldSize),h=P-S<M.x?M.x/(P-S):0}const z=this.point,V=Math.max(h||0,s||0);if(V)return this.center=this.unproject(new l.P(h?(P+S)/2:z.x,s?(E+y)/2:z.y)),this.zoom+=this.scaleZoom(V),this._unmodified=D,void(this._constraining=!1);if(this.latRange){const te=z.y,ee=M.y/2;te-ee<y&&(g=y+ee),te+ee>E&&(g=E-ee)}if(this.lngRange){const te=(S+P)/2,ee=l.b5(z.x,te-this.worldSize/2,te+this.worldSize/2),ie=M.x/2;ee-ie<S&&(p=S+ie),ee+ie>P&&(p=P-ie)}p===void 0&&g===void 0||(this.center=this.unproject(new l.P(p!==void 0?p:z.x,g!==void 0?g:z.y)).wrap()),this._unmodified=D,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let g=l.ao(new Float64Array(16));l.a0(g,g,[this.width/2,-this.height/2,1]),l.$(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.ao(new Float64Array(16)),l.a0(g,g,[1,-1,1]),l.$(g,g,[-1,-1,0]),l.a0(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this._minEleveationForCurrentTile),S=y-E*this._pixelPerMeter/Math.cos(this._pitch),P=E<0?S:y,M=Math.PI/2+this._pitch,D=this._fov*(.5+s.y/this.height),z=Math.sin(D)*P/Math.sin(l.ad(Math.PI-M-D,.01,Math.PI-.01)),V=this.getHorizon(),te=2*Math.atan(V/this.cameraToCenterDistance)*(.5+s.y/(2*V)),ee=Math.sin(te)*P/Math.sin(l.ad(Math.PI-M-te,.01,Math.PI-.01)),ie=Math.min(z,ee),J=1.01*(Math.cos(Math.PI/2-this._pitch)*ie+P),ge=this.height/50;g=new Float64Array(16),l.b8(g,this._fov,this.width/this.height,ge,J),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,l.a0(g,g,[1,-1,1]),l.$(g,g,[0,0,-this.cameraToCenterDistance]),l.b9(g,g,this._pitch),l.ae(g,g,this.angle),l.$(g,g,[-h,-p,0]),this.mercatorMatrix=l.a0([],g,[this.worldSize,this.worldSize,this.worldSize]),l.a0(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,g),l.$(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.as([],g),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,g);const we=this.width%2/2,le=this.height%2/2,ye=Math.cos(this.angle),Ae=Math.sin(this.angle),Ie=h-Math.round(h)+ye*we+Ae*le,Fe=p-Math.round(p)+ye*le+Ae*we,Ve=new Float64Array(g);if(l.$(Ve,Ve,[Ie>.5?Ie-1:Ie,Fe>.5?Fe-1:Fe,0]),this.alignedProjMatrix=Ve,g=l.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.P(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.ag(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let p=h.x,g=h.y,y=h.x,E=h.y;for(const S of s)p=Math.min(p,S.x),g=Math.min(g,S.y),y=Math.max(y,S.x),E=Math.max(E,S.y);return[new l.P(p,g),new l.P(y,g),new l.P(y,E),new l.P(p,E),new l.P(p,g)]}}}function Fo(_,s){let h,p=!1,g=null,y=null;const E=()=>{g=null,p&&(_.apply(y,h),g=setTimeout(E,s),p=!1)};return(...S)=>(p=!0,y=this,h=S,g||E(),g)}class ml{constructor(s){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(p=g)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Fo(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),E=Math.round(h.lng*y)/y,S=Math.round(h.lat*y)/y,P=this._map.getBearing(),M=this._map.getPitch();let D="";if(D+=s?`/${E}/${S}/${p}`:`${p}/${S}/${E}`,(P||M)&&(D+="/"+Math.round(10*P)/10),M&&(D+=`/${Math.round(M)}`),this._hashName){const z=this._hashName;let V=!1;const te=window.location.hash.slice(1).split("&").map(ee=>{const ie=ee.split("=")[0];return ie===z?(V=!0,`${ie}=${D}`):ee}).filter(ee=>ee);return V||te.push(`${z}=${D}`),`#${te.join("&")}`}return`#${D}`}}const ya={linearity:.3,easing:l.ba(0,0,.3,1)},gf=l.e({deceleration:2500,maxSpeed:1400},ya),_f=l.e({deceleration:20,maxSpeed:1400},ya),yf=l.e({deceleration:1e3,maxSpeed:360},ya),vf=l.e({deceleration:1e3,maxSpeed:90},ya);class xf{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=l.h.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)h.zoom+=y.zoomDelta||0,h.bearing+=y.bearingDelta||0,h.pitch+=y.pitchDelta||0,y.panDelta&&h.pan._add(y.panDelta),y.around&&(h.around=y.around),y.pinchAround&&(h.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(h.pan.mag()){const y=gl(h.pan.mag(),p,l.e({},gf,s||{}));g.offset=h.pan.mult(y.amount/h.pan.mag()),g.center=this._map.transform.center,Ts(g,y)}if(h.zoom){const y=gl(h.zoom,p,_f);g.zoom=this._map.transform.zoom+y.amount,Ts(g,y)}if(h.bearing){const y=gl(h.bearing,p,yf);g.bearing=this._map.transform.bearing+l.ad(y.amount,-179,179),Ts(g,y)}if(h.pitch){const y=gl(h.pitch,p,vf);g.pitch=this._map.transform.pitch+y.amount,Ts(g,y)}if(g.zoom||g.bearing){const y=h.pinchAround===void 0?h.around:h.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function Ts(_,s){(!_.duration||_.duration<s.duration)&&(_.duration=s.duration,_.easing=s.easing)}function gl(_,s,h){const{maxSpeed:p,linearity:g,deceleration:y}=h,E=l.ad(_*g/(s/1e3),-p,p),S=Math.abs(E)/(y*g);return{easing:h.easing,duration:1e3*S,amount:E*(S/2)}}class Tr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,p,g={}){const y=w.mousePos(h.getCanvasContainer(),p),E=h.unproject(y);super(s,l.e({point:y,lngLat:E,originalEvent:p},g)),this._defaultPrevented=!1,this.target=h}}class _l extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,p){const g=s==="touchend"?p.changedTouches:p.touches,y=w.touchPos(h.getCanvasContainer(),g),E=y.map(P=>h.unproject(P)),S=y.reduce((P,M,D,z)=>P.add(M.div(z.length)),new l.P(0,0));super(s,{points:y,point:S,lngLats:E,lngLat:h.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class bf extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}}class wf{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new bf(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Tr(s.type,this._map,s))}mouseup(s){this._map.fire(new Tr(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Tr(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Tr(s.type,this._map,s))}mouseover(s){this._map.fire(new Tr(s.type,this._map,s))}mouseout(s){this._map.fire(new Tr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new _l(s.type,this._map,s))}touchmove(s){this._map.fire(new _l(s.type,this._map,s))}touchend(s){this._map.fire(new _l(s.type,this._map,s))}touchcancel(s){this._map.fire(new _l(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tf{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Tr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Tr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ho{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(l.P.convert(s),this._map.terrain)}}class Ef{constructor(s,h){this._map=s,this._tr=new ho(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(w.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=p,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const y=Math.min(g.x,p.x),E=Math.max(g.x,p.x),S=Math.min(g.y,p.y),P=Math.max(g.y,p.y);w.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=E-y+"px",this._box.style.height=P-S+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const p=this._startPos,g=h;if(this.reset(),w.suppressClick(),p.x!==g.x||p.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:s})),{cameraAnimation:y=>y.fitScreenCoordinates(p,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.k(s,{originalEvent:h}))}}function jr(_,s){if(_.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${s.length}`);const h={};for(let p=0;p<_.length;p++)h[_[p].identifier]=s[p];return h}class $s{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const y=new l.P(0,0);for(const E of g)y._add(E);return y.div(g.length)}(h),this.touches=jr(p,h)))}touchmove(s,h,p){if(this.aborted||!this.centroid)return;const g=jr(p,h);for(const y in this.touches){const E=g[y];(!E||E.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(s,h,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class bc{constructor(s){this.singleTap=new $s(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,p){this.singleTap.touchstart(s,h,p)}touchmove(s,h,p){this.singleTap.touchmove(s,h,p)}touchend(s,h,p){const g=this.singleTap.touchend(s,h,p);if(g){const y=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(g)<30;if(y&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Hs{constructor(s){this._tr=new ho(s),this._zoomIn=new bc({numTouches:1,numTaps:2}),this._zoomOut=new bc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,p){this._zoomIn.touchstart(s,h,p),this._zoomOut.touchstart(s,h,p)}touchmove(s,h,p){this._zoomIn.touchmove(s,h,p),this._zoomOut.touchmove(s,h,p)}touchend(s,h,p){const g=this._zoomIn.touchend(s,h,p),y=this._zoomOut.touchend(s,h,p),E=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(g)},{originalEvent:s})}):y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(y)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ws{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const h=this._moveFunction(...s);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(s,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=h.length?h[0]:h;return!this._moved&&g.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(p,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&w.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vg={0:1,2:2};class Ku{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const h=w.mouseButton(s);this._eventButton=h}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(h,p){const g=vg[p];return h.buttons===void 0||(h.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return w.mouseButton(s)===this._eventButton}}class Sf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const wc=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=function(s){s.preventDefault()}},va=({enable:_,clickTolerance:s,bearingDegreesPerPixelMoved:h=.8})=>{const p=new Ku({checkCorrectEvent:g=>w.mouseButton(g)===0&&g.ctrlKey||w.mouseButton(g)===2});return new Ws({clickTolerance:s,move:(g,y)=>({bearingDelta:(y.x-g.x)*h}),moveStateManager:p,enable:_,assignEvents:wc})},qs=({enable:_,clickTolerance:s,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new Ku({checkCorrectEvent:g=>w.mouseButton(g)===0&&g.ctrlKey||w.mouseButton(g)===2});return new Ws({clickTolerance:s,move:(g,y)=>({pitchDelta:(y.y-g.y)*h}),moveStateManager:p,enable:_,assignEvents:wc})};class it{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,p){return this._calculateTransform(s,h,p)}touchmove(s,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,p)}touchend(s,h,p){this._calculateTransform(s,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,p){p.length>0&&(this._active=!0);const g=jr(p,h),y=new l.P(0,0),E=new l.P(0,0);let S=0;for(const M in g){const D=g[M],z=this._touches[M];z&&(y._add(D),E._add(D.sub(z)),S++,g[M]=D)}if(this._touches=g,S<this._minTouches||!E.mag())return;const P=E.div(S);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,p){if(!this._firstTwoTouches)return;s.preventDefault();const[g,y]=this._firstTwoTouches,E=fo(p,h,g),S=fo(p,h,y);if(!E||!S)return;const P=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],P,s)}touchend(s,h,p){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,E=fo(p,h,g),S=fo(p,h,y);E&&S||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fo(_,s,h){for(let p=0;p<_.length;p++)if(_[p].identifier===h)return s[p]}function xa(_,s){return Math.log(_/s)/Math.LN2}class Af extends Tc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(xa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xa(this._distance,p),pinchAround:h}}}function et(_,s){return 180*_.angleWith(s)/Math.PI}class Ju extends Tc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const p=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:et(this._vector,p),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,p=et(s,this._startVector);return Math.abs(p)<h}}function Qu(_){return Math.abs(_.y)>Math.abs(_.x)}class xg extends Tc{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,p){super.touchstart(s,h,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,Qu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),y=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,y,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,p){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,y=h.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=s.y>0==h.y>0;return Qu(s)&&Qu(h)&&E}}const eh={panStep:100,bearingStep:15,pitchStep:10};class Pf{constructor(s){this._tr=new ho(s);const h=eh;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,p=0,g=0,y=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),y=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),y=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:S=>{const P=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:If,zoom:h?Math.round(P.zoom)+h*(s.shiftKey?2:1):P.zoom,bearing:P.bearing+p*this._bearingStep,pitch:P.pitch+g*this._pitchStep,offset:[-y*this._panStep,-E*this._panStep],center:P.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function If(_){return _*(2-_)}const Cf=4.000244140625;class bg{constructor(s,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=s,this._tr=new ho(s),this._el=s.getCanvasContainer(),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!s[this._map._metaKey])return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=l.h.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Cf==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=w.mousePos(this._el,s),p=this._tr;this._around=l.L.convert(this._aroundCenter?p.center:p.unproject(h)),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Cf?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&P!==0&&(P=1/P);const M=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(M*P))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,p=this._startZoom,g=this._easing;let y,E=!1;if(this._type==="wheel"&&p&&g){const S=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),P=g(S);y=l.B.number(p,h,P),S<1?this._frameId||(this._frameId=!0):E=!0}else y=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:y-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.bb;if(this._prevEase){const p=this._prevEase,g=(l.h.now()-p.start)/p.duration,y=p.easing(g+.01)-p.easing(g),E=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-E*E);h=l.ba(E,S,.25,1)}return this._prevEase={start:l.h.now(),duration:s,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class th{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nh{constructor(s){this._tr=new ho(s),this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ih{constructor(){this._tap=new bc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,h,p){if(!this._swipePoint)if(this._tapTime){const g=h[0],y=s.timeStamp-this._tapTime<500,E=this._tapPoint.dist(g)<30;y&&E?p.length>0&&(this._swipePoint=g,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(s,h,p)}touchmove(s,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=h[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(s,h,p)}touchend(s,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const g=this._tap.touchend(s,h,p);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rh{constructor(s,h,p){this._el=s,this._mousePan=h,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class tr{constructor(s,h,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class po{constructor(s,h,p,g){this._el=s,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const yl=_=>_.zoom||_.drag||_.pitch||_.rotate;class sh extends l.k{}function vl(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class oh{constructor(s,h){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,y)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=g.type==="renderFrame"?void 0:g,S={needsRenderFrame:!1},P={},M={},D=g.touches,z=D?this._getMapTouches(D):void 0,V=z?w.touchPos(this._el,z):w.mousePos(this._el,g);for(const{handlerName:ie,handler:J,allowed:ge}of this._handlers){if(!J.isEnabled())continue;let we;this._blockedByActive(M,ge,ie)?J.reset():J[y||g.type]&&(we=J[y||g.type](g,V,z),this.mergeHandlerResult(S,P,we,ie,E),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||J.isActive())&&(M[ie]=J)}const te={};for(const ie in this._previousActiveHandlers)M[ie]||(te[ie]=E);this._previousActiveHandlers=M,(Object.keys(te).length||vl(S))&&(this._changes.push([S,P,te]),this._triggerRenderFrame()),(Object.keys(M).length||vl(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=S;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xf(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,E]of this._listeners)w.addEventListener(g,y,g===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,h,p]of this._listeners)w.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new wf(h,s));const g=h.boxZoom=new Ef(h,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const y=new Hs(h),E=new nh(h);h.doubleClickZoom=new th(E,y),this._add("tapZoom",y),this._add("clickZoom",E),s.interactive&&s.doubleClickZoom&&h.doubleClickZoom.enable();const S=new ih;this._add("tapDragZoom",S);const P=h.touchPitch=new xg(h);this._add("touchPitch",P),s.interactive&&s.touchPitch&&h.touchPitch.enable(s.touchPitch);const M=va(s),D=qs(s);h.dragRotate=new tr(s,M,D),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),s.interactive&&s.dragRotate&&h.dragRotate.enable();const z=(({enable:ge,clickTolerance:we})=>{const le=new Ku({checkCorrectEvent:ye=>w.mouseButton(ye)===0&&!ye.ctrlKey});return new Ws({clickTolerance:we,move:(ye,Ae)=>({around:Ae,panDelta:Ae.sub(ye)}),activateOnStart:!0,moveStateManager:le,enable:ge,assignEvents:wc})})(s),V=new it(s,h);h.dragPan=new rh(p,z,V),this._add("mousePan",z),this._add("touchPan",V,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&h.dragPan.enable(s.dragPan);const te=new Ju,ee=new Af;h.touchZoomRotate=new po(p,ee,te,S),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&h.touchZoomRotate.enable(s.touchZoomRotate);const ie=h.scrollZoom=new bg(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ie,["mousePan"]),s.interactive&&s.scrollZoom&&h.scrollZoom.enable(s.scrollZoom);const J=h.keyboard=new Pf(h);this._add("keyboard",J),s.interactive&&s.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Tf(h))}_add(s,h,p){this._handlers.push({handlerName:s,handler:h,allowed:p}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yl(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,p){for(const g in s)if(g!==p&&(!h||h.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const h=[];for(const p of s)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(s,h,p,g,y){if(!p)return;l.e(s,p);const E={handlerName:g,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const s={},h={},p={};for(const[g,y,E]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),l.e(h,y),l.e(p,E);this._updateMapTransform(s,h,p),this._changes=[]}_updateMapTransform(s,h,p){const g=this._map,y=g._getTransformForUpdate(),E=g.terrain;if(!(vl(s)||E&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:S,zoomDelta:P,bearingDelta:M,pitchDelta:D,around:z,pinchAround:V}=s;V!==void 0&&(z=V),g._stop(!0),z=z||g.transform.centerPoint;const te=y.pointLocation(S?z.sub(S):z);M&&(y.bearing+=M),D&&(y.pitch+=D),P&&(y.zoom+=P),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(S)):y.setLocationAtPoint(te,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(te,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(g.terrain)})):y.setLocationAtPoint(te,z),g._applyUpdatedTransform(y),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,p,!0)}_fireEvents(s,h,p){const g=yl(this._eventsInProgress),y=yl(s),E={};for(const D in s){const{originalEvent:z}=s[D];this._eventsInProgress[D]||(E[`${D}start`]=z),this._eventsInProgress[D]=s[D]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in E)this._fireEvent(D,E[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in s){const{originalEvent:z}=s[D];this._fireEvent(D,z)}const S={};let P;for(const D in this._eventsInProgress){const{handlerName:z,originalEvent:V}=this._eventsInProgress[D];this._handlersById[z].isActive()||(delete this._eventsInProgress[D],P=h[z]||V,S[`${D}end`]=P)}for(const D in S)this._fireEvent(D,S[D]);const M=yl(this._eventsInProgress);if(p&&(g||y)&&!M){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!D||!D.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:P})),z(this._map.getBearing())&&this._map.resetNorth()):(z(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.k(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new sh("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Mf extends l.E{constructor(s,h){super(),this._renderFrameCallback=()=>{const p=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,p){return s=l.P.convert(s).mult(-1),this.panTo(this.transform.center,l.e({offset:s},h),p)}panTo(s,h,p){return this.easeTo(l.e({center:s},h),p)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,p){return this.easeTo(l.e({zoom:s},h),p)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,p){return this.easeTo(l.e({bearing:s},h),p)}resetNorth(s,h){return this.rotateTo(0,l.e({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=Kt.convert(s);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,h)}_cameraForBoxAndBearing(s,h,p,g){const y={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Ae=g.padding;g.padding={top:Ae,bottom:Ae,right:Ae,left:Ae}}g.padding=l.e(y,g.padding);const E=this.transform,S=E.padding,P=E.project(l.L.convert(s)),M=E.project(l.L.convert(h)),D=P.rotate(-p*Math.PI/180),z=M.rotate(-p*Math.PI/180),V=new l.P(Math.max(D.x,z.x),Math.max(D.y,z.y)),te=new l.P(Math.min(D.x,z.x),Math.min(D.y,z.y)),ee=V.sub(te),ie=(E.width-(S.left+S.right+g.padding.left+g.padding.right))/ee.x,J=(E.height-(S.top+S.bottom+g.padding.top+g.padding.bottom))/ee.y;if(J<0||ie<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ge=Math.min(E.scaleZoom(E.scale*Math.min(ie,J)),g.maxZoom),we=l.P.convert(g.offset),le=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(p*Math.PI/180),ye=we.add(le).mult(E.scale/E.zoomScale(ge));return{center:E.unproject(P.add(M).div(2).sub(ye)),zoom:ge,bearing:p}}fitBounds(s,h,p){return this._fitInternal(this.cameraForBounds(s,h),h,p)}fitScreenCoordinates(s,h,p,g,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(s)),this.transform.pointLocation(l.P.convert(h)),p,g),g,y)}_fitInternal(s,h,p){return s?(delete(h=l.e(s,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(s,h){this.stop();const p=this._getTransformForUpdate();let g=!1,y=!1,E=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(g=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=l.L.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(y=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(E=!0,p.pitch=+s.pitch),s.padding==null||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this._applyUpdatedTransform(p),this.fire(new l.k("movestart",h)).fire(new l.k("move",h)),g&&this.fire(new l.k("zoomstart",h)).fire(new l.k("zoom",h)).fire(new l.k("zoomend",h)),y&&this.fire(new l.k("rotatestart",h)).fire(new l.k("rotate",h)).fire(new l.k("rotateend",h)),E&&this.fire(new l.k("pitchstart",h)).fire(new l.k("pitch",h)).fire(new l.k("pitchend",h)),this.fire(new l.k("moveend",h))}calculateCameraOptionsFromTo(s,h,p,g=0){const y=l.U.fromLngLat(s,h),E=l.U.fromLngLat(p,g),S=E.x-y.x,P=E.y-y.y,M=E.z-y.z,D=Math.hypot(S,P,M);if(D===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(S,P),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),te=180*Math.atan2(S,-P)/Math.PI;let ee=180*Math.acos(z/D)/Math.PI;return ee=M<0?90-ee:90+ee,{center:E.toLngLat(),zoom:V,pitch:ee,bearing:te}}easeTo(s,h){this._stop(!1,s.easeId),((s=l.e({offset:[0,0],duration:500,easing:l.bb},s)).animate===!1||!s.essential&&l.h.prefersReducedMotion)&&(s.duration=0);const p=this._getTransformForUpdate(),g=this.getZoom(),y=this.getBearing(),E=this.getPitch(),S=this.getPadding(),P="zoom"in s?+s.zoom:g,M="bearing"in s?this._normalizeBearing(s.bearing,y):y,D="pitch"in s?+s.pitch:E,z="padding"in s?s.padding:p.padding,V=l.P.convert(s.offset);let te=p.centerPoint.add(V);const ee=p.pointLocation(te),ie=l.L.convert(s.center||ee);this._normalizeCenter(ie);const J=p.project(ee),ge=p.project(ie).sub(J),we=p.zoomScale(P-g);let le,ye;s.around&&(le=l.L.convert(s.around),ye=p.locationPoint(le));const Ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||P!==g,this._rotating=this._rotating||y!==M,this._pitching=this._pitching||D!==E,this._padding=!p.isPaddingEqual(z),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Ae),this.terrain&&this._prepareElevation(ie),this._ease(Ie=>{if(this._zooming&&(p.zoom=l.B.number(g,P,Ie)),this._rotating&&(p.bearing=l.B.number(y,M,Ie)),this._pitching&&(p.pitch=l.B.number(E,D,Ie)),this._padding&&(p.interpolatePadding(S,z,Ie),te=p.centerPoint.add(V)),this.terrain&&!s.freezeElevation&&this._updateElevation(Ie),le)p.setLocationAtPoint(le,ye);else{const Fe=p.zoomScale(p.zoom-g),Ve=P>g?Math.min(2,we):Math.max(.5,we),Ue=Math.pow(Ve,1-Ie),$e=p.unproject(J.add(ge.mult(Ie*Ue)).mult(Fe));p.setLocationAtPoint(p.renderWorldCopies?$e.wrap():$e,te)}this._applyUpdatedTransform(p),this._fireMoveEvents(h)},Ie=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Ie)},s),this}_prepareEase(s,h,p={}){this._moving=!0,h||p.moving||this.fire(new l.k("movestart",s)),this._zooming&&!p.zooming&&this.fire(new l.k("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new l.k("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new l.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(p-(h-(p*s+this._elevationStart))/(1-s)),this._elevationTarget=h}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const h=s.clone(),{center:p,zoom:g,pitch:y,bearing:E,elevation:S}=this.transformCameraUpdate(h);p&&(h.center=p),g!==void 0&&(h.zoom=g),y!==void 0&&(h.pitch=y),E!==void 0&&(h.bearing=E),S!==void 0&&(h.elevation=S),this.transform.apply(h)}_fireMoveEvents(s){this.fire(new l.k("move",s)),this._zooming&&this.fire(new l.k("zoom",s)),this._rotating&&this.fire(new l.k("rotate",s)),this._pitching&&this.fire(new l.k("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.k("zoomend",s)),g&&this.fire(new l.k("rotateend",s)),y&&this.fire(new l.k("pitchend",s)),this.fire(new l.k("moveend",s))}flyTo(s,h){if(!s.essential&&l.h.prefersReducedMotion){const dt=l.F(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(dt,h)}this.stop(),s=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},s);const p=this._getTransformForUpdate(),g=this.getZoom(),y=this.getBearing(),E=this.getPitch(),S=this.getPadding(),P="zoom"in s?l.ad(+s.zoom,p.minZoom,p.maxZoom):g,M="bearing"in s?this._normalizeBearing(s.bearing,y):y,D="pitch"in s?+s.pitch:E,z="padding"in s?s.padding:p.padding,V=p.zoomScale(P-g),te=l.P.convert(s.offset);let ee=p.centerPoint.add(te);const ie=p.pointLocation(ee),J=l.L.convert(s.center||ie);this._normalizeCenter(J);const ge=p.project(ie),we=p.project(J).sub(ge);let le=s.curve;const ye=Math.max(p.width,p.height),Ae=ye/V,Ie=we.mag();if("minZoom"in s){const dt=l.ad(Math.min(s.minZoom,g,P),p.minZoom,p.maxZoom),on=ye/p.zoomScale(dt-g);le=Math.sqrt(on/Ie*2)}const Fe=le*le;function Ve(dt){const on=(Ae*Ae-ye*ye+(dt?-1:1)*Fe*Fe*Ie*Ie)/(2*(dt?Ae:ye)*Fe*Ie);return Math.log(Math.sqrt(on*on+1)-on)}function Ue(dt){return(Math.exp(dt)-Math.exp(-dt))/2}function $e(dt){return(Math.exp(dt)+Math.exp(-dt))/2}const ut=Ve(!1);let Ut=function(dt){return $e(ut)/$e(ut+le*dt)},Ke=function(dt){return ye*(($e(ut)*(Ue(on=ut+le*dt)/$e(on))-Ue(ut))/Fe)/Ie;var on},wt=(Ve(!0)-ut)/le;if(Math.abs(Ie)<1e-6||!isFinite(wt)){if(Math.abs(ye-Ae)<1e-6)return this.easeTo(s,h);const dt=Ae<ye?-1:1;wt=Math.abs(Math.log(Ae/ye))/le,Ke=function(){return 0},Ut=function(on){return Math.exp(dt*le*on)}}return s.duration="duration"in s?+s.duration:1e3*wt/("screenSpeed"in s?+s.screenSpeed/le:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=y!==M,this._pitching=D!==E,this._padding=!p.isPaddingEqual(z),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(J),this._ease(dt=>{const on=dt*wt,Bt=1/Ut(on);p.zoom=dt===1?P:g+p.scaleZoom(Bt),this._rotating&&(p.bearing=l.B.number(y,M,dt)),this._pitching&&(p.pitch=l.B.number(E,D,dt)),this._padding&&(p.interpolatePadding(S,z,dt),ee=p.centerPoint.add(te)),this.terrain&&!s.freezeElevation&&this._updateElevation(dt);const Lt=dt===1?J:p.unproject(ge.add(we.mult(Ke(on))).mult(Bt));p.setLocationAtPoint(p.renderWorldCopies?Lt.wrap():Lt,ee),this._applyUpdatedTransform(p),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,h,p){p.animate===!1||p.duration===0?(s(1),h()):(this._easeStart=l.h.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,h){s=l.b5(s,-180,180);const p=Math.abs(s-h);return Math.abs(s-360-h)<p&&(s-=360),Math.abs(s+360-h)<p&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=s.lng-h.center.lng;s.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}class Er{constructor(s={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const p=this._map._getUIString(`AttributionControl.${h}`);s.title=p,s.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const h=this._map.style.sourceCaches;for(const g in h){const y=h[g];if(y.used||y.usedForTerrain){const E=y.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,y)=>g.length-y.length),s=s.filter((g,y)=>{for(let E=y+1;E<s.length;E++)if(s[E].indexOf(g)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class bn{constructor(s={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const h=w.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ec{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const g of p)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ah={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Lf=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class kf extends l.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];const p={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aS(g.posMatrix,0,l.N,0,l.N,0,1),this._tiles[g.key]=new Jr(g,this.tileSize));for(const g in this._tiles)p[g]||delete this._tiles[g]}freeRtt(s){for(const h in this._tiles){const p=this._tiles[h];(!s||p.tileID.equals(s)||p.tileID.isChildOf(s)||s.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const p of this._renderableTilesKeys){const g=this._tiles[p].tileID;if(g.canonical.equals(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16),l.aS(y.posMatrix,0,l.N,0,l.N,0,1),h[p]=y}else if(g.canonical.isChildOf(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const E=g.canonical.z-s.canonical.z,S=g.canonical.x-(g.canonical.x>>E<<E),P=g.canonical.y-(g.canonical.y>>E<<E),M=l.N>>E;l.aS(y.posMatrix,0,M,0,M,0,1),l.$(y.posMatrix,y.posMatrix,[-S*M,-P*M,0]),h[p]=y}else if(s.canonical.isChildOf(g.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const E=s.canonical.z-g.canonical.z,S=s.canonical.x-(s.canonical.x>>E<<E),P=s.canonical.y-(s.canonical.y>>E<<E),M=l.N>>E;l.aS(y.posMatrix,0,l.N,0,l.N,0,1),l.$(y.posMatrix,y.posMatrix,[S*M,P*M,0]),l.a0(y.posMatrix,y.posMatrix,[1/2**E,1/2**E,0]),h[p]=y}}return h}getSourceTile(s,h){const p=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>p.maxzoom&&(g=p.maxzoom),g<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!y||!y.dem)&&h)for(;g>=p.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(s.scaledTo(g--).key);return y}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=s)}}class Rf{constructor(s,h,p){this.painter=s,this.sourceCache=new kf(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,h,p,g=l.N){var y;if(!(h>=0&&h<g&&p>=0&&p<g))return 0;const E=this.getTerrainData(s),S=(y=E.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;const P=function(ee,ie,J){var ge=ie[0],we=ie[1];return ee[0]=J[0]*ge+J[4]*we+J[12],ee[1]=J[1]*ge+J[5]*we+J[13],ee}([],[h/g*l.N,p/g*l.N],E.u_terrain_matrix),M=[P[0]*S.dim,P[1]*S.dim],D=Math.floor(M[0]),z=Math.floor(M[1]),V=M[0]-D,te=M[1]-z;return S.get(D,z)*(1-V)*(1-te)+S.get(D+1,z)*V*(1-te)+S.get(D,z+1)*(1-V)*te+S.get(D+1,z+1)*V*te}getElevationForLngLatZoom(s,h){const{tileID:p,mercatorX:g,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(s,h);return this.getElevation(p,g%l.N,y%l.N,l.N)}getElevation(s,h,p,g=l.N){return this.getDEMElevation(s,h,p,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,y=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ee(g,y,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ee(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const g=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new Ee(g,h.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),h.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const g=this.sourceCache.sourceCache._source.maxzoom;let y=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?y=s.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=s.canonical.x-(s.canonical.x>>y<<y),S=s.canonical.y-(s.canonical.y>>y<<y),P=l.bc(new Float64Array(16),[1/(l.N<<y),1/(l.N<<y),0]);l.$(P,P,[E*l.N,S*l.N,0]),this._demMatrixCache[s.key]={matrix:P,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(s){const h=this.painter,p=h.width/devicePixelRatio,g=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ee(h.context,{width:p,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ee(h.context,{width:p,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,g,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,E=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,E+=4)h[E+0]=255&S,h[E+1]=255&y,h[E+2]=S>>8<<4|y>>8,h[E+3]=0;const p=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),g=new Ee(s,p,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){const h=new Uint8Array(4),p=this.painter.context,g=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const y=h[0]+(h[2]>>4<<8),E=h[1]+((15&h[2])<<8),S=this.coordsIndex[255-h[3]],P=S&&this.sourceCache.getTileByID(S);if(!P)return null;const M=this._coordsTextureSize,D=(1<<P.tileID.canonical.z)*M;return new l.U(this._allowMercatorOverflow(s,(P.tileID.canonical.x*M+y)/D),(P.tileID.canonical.y*M+E)/D,this.getElevation(P.tileID,y,E,M))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,h=new l.bd,p=new l.b0,g=this.meshSize,y=l.N/g,E=g*g;for(let z=0;z<=g;z++)for(let V=0;V<=g;V++)h.emplaceBack(V*y,z*y,0);for(let z=0;z<E;z+=g+1)for(let V=0;V<g;V++)p.emplaceBack(V+z,g+V+z+1,g+V+z+2),p.emplaceBack(V+z,g+V+z+2,V+z+1);const S=h.length,P=S+2*(g+1);for(const z of[0,1])for(let V=0;V<=g;V++)for(const te of[0,1])h.emplaceBack(V*y,z*l.N,te);for(let z=0;z<2*g;z+=2)p.emplaceBack(P+z,P+z+1,P+z+3),p.emplaceBack(P+z,P+z+3,P+z+2),p.emplaceBack(S+z,S+z+3,S+z+1),p.emplaceBack(S+z,S+z+2,S+z+3);const M=h.length,D=M+2*(g+1);for(const z of[0,1])for(let V=0;V<=g;V++)for(const te of[0,1])h.emplaceBack(z*l.N,V*y,te);for(let z=0;z<2*g;z+=2)p.emplaceBack(M+z,M+z+1,M+z+3),p.emplaceBack(M+z,M+z+3,M+z+2),p.emplaceBack(D+z,D+z+3,D+z+1),p.emplaceBack(D+z,D+z+2,D+z+3);return this._mesh={indexBuffer:s.createIndexBuffer(p),vertexBuffer:s.createVertexBuffer(h,Lf.members),segments:l.S.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*l.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,h){var p;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,h);return(p=this.getMinMaxElevation(g).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(s,h){const p=l.U.fromLngLat(s.wrap()),g=(1<<h)*l.N,y=p.x*g,E=p.y*g,S=Math.floor(y/l.N),P=Math.floor(E/l.N);return{tileID:new l.O(h,0,h,S,P),mercatorX:y,mercatorY:E}}_allowMercatorOverflow(s,h){const p=s.x<this.painter.width/2;let g=l.bf(h);const y=this.painter.transform.center.lng;return p&&Math.sign(g)>0&&Math.sign(y)<0||!p&&Math.sign(g)<0&&Math.sign(y)>0?(g=360*Math.sign(y)+g,l.G(g)):h}}class wg{constructor(s,h,p){this._context=s,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new Ee(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:s,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>s.id!==h),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const Ui={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Sc{constructor(s,h){this.painter=s,this.terrain=h,this.pool=new wg(s.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(p=>!s._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const g=s.sourceCaches[p].getVisibleCoordinates();for(const y of g){const E=this.terrain.sourceCache.getTerrainCoords(y);for(const S in E)this._coordsDescendingInv[p][S]||(this._coordsDescendingInv[p][S]=[]),this._coordsDescendingInv[p][S].push(E[S])}}this._coordsDescendingInvStr={};for(const p of s._order){const g=s._layers[p],y=g.source;if(Ui[g.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const E in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][E]=this._coordsDescendingInv[y][E].map(S=>S.key).sort().join()}}for(const p of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[g][p.tileID.key];y&&y!==p.rttCoords[g]&&(p.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const h=s.type,p=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(Ui[h]&&(this._prevType&&Ui[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(Ui[this._prevType]||Ui[h]&&g){this._prevType=h;const y=this._stacks.length-1,E=this._stacks[y]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(zn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[y]){const M=this.pool.getObjectForId(S.rtt[y].id);if(M.stamp===S.rtt[y].stamp){this.pool.useObject(M);continue}}const P=this.pool.getOrCreateFreeObject();this.pool.useObject(P),this.pool.stampObject(P),S.rtt[y]={id:P.id,stamp:P.stamp},p.context.bindFramebuffer.set(P.fbo.framebuffer),p.context.clear({color:l.aT.transparent,stencil:0}),p.currentStencilSource=void 0;for(let M=0;M<E.length;M++){const D=p.style._layers[E[M]],z=D.source?this._coordsDescendingInv[D.source][S.tileID.key]:[S.tileID];p.context.viewport.set([0,0,P.fbo.width,P.fbo.height]),p._renderTileClippingMasks(D,z),p.renderLayer(p,p.style.sourceCaches[D.source],D,z),D.source&&(S.rttCoords[D.source]=this._coordsDescendingInvStr[D.source][S.tileID.key])}}return zn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ui[h]}return!1}}const mt=b,bt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},xl=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},lh={showCompass:!0,showZoom:!0,visualizePitch:!1};class ch{constructor(s,h,p=!1){this.mousedown=E=>{this.startMouse(l.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),w.mousePos(this.element,E)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,w.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),y=s.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=va({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:S,bearingDegreesPerPixelMoved:P=.8})=>{const M=new Sf;return new Ws({clickTolerance:S,move:(D,z)=>({bearingDelta:(z.x-D.x)*P}),moveStateManager:M,enable:E,assignEvents:xl})})({clickTolerance:g,enable:!0}),this.map=s,p&&(this.mousePitch=qs({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:S,pitchDegreesPerPixelMoved:P=-.5})=>{const M=new Sf;return new Ws({clickTolerance:S,move:(D,z)=>({pitchDelta:(z.y-D.y)*P}),moveStateManager:M,enable:E,assignEvents:xl})})({clickTolerance:y,enable:!0})),w.addEventListener(h,"mousedown",this.mousedown),w.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(h,"touchcancel",this.reset)}startMouse(s,h){this.mouseRotate.dragStart(s,h),this.mousePitch&&this.mousePitch.dragStart(s,h),w.disableDrag()}startTouch(s,h){this.touchRotate.dragStart(s,h),this.touchPitch&&this.touchPitch.dragStart(s,h),w.disableDrag()}moveMouse(s,h){const p=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,h)||{};if(g&&p.setBearing(p.getBearing()+g),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(s,h)||{};y&&p.setPitch(p.getPitch()+y)}}moveTouch(s,h){const p=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,h)||{};if(g&&p.setBearing(p.getBearing()+g),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(s,h)||{};y&&p.setPitch(p.getPitch()+y)}}off(){const s=this.element;w.removeEventListener(s,"mousedown",this.mousedown),w.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let qn;function uh(_,s,h){if(_=new l.L(_.lng,_.lat),s){const p=new l.L(_.lng-360,_.lat),g=new l.L(_.lng+360,_.lat),y=h.locationPoint(_).distSqr(s);h.locationPoint(p).distSqr(s)<y?_=p:h.locationPoint(g).distSqr(s)<y&&(_=g)}for(;Math.abs(_.lng-h.center.lng)>180;){const p=h.locationPoint(_);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;_.lng>h.center.lng?_.lng-=360:_.lng+=360}return _}const Gr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Df(_,s,h){const p=_.classList;for(const g in Gr)p.remove(`maplibregl-${h}-anchor-${g}`);p.add(`maplibregl-${h}-anchor-${s}`)}class Bo extends l.E{constructor(s){if(super(),this._onKeyPress=h=>{const p=h.code,g=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,g=this._element;this._popup&&(p===g||g.contains(p))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!p)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=uh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${Gr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${g}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const E=this._map.unproject(this._pos),S=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=E.distanceTo(this._lngLat)>20*S?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=l.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const h=w.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${g}px`),h.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const y=w.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const E=w.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const S=w.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of P){const we=w.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",ge.rx),we.setAttributeNS(null,"ry",ge.ry),S.appendChild(we)}const M=w.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const D=w.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(D);const z=w.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const V=w.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(V);const te=w.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ee=w.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=w.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const J=w.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#FFFFFF"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962"),ee.appendChild(ie),ee.appendChild(J),E.appendChild(S),E.appendChild(M),E.appendChild(z),E.appendChild(te),E.appendChild(ee),h.appendChild(E),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(h),this._offset=l.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Df(this._element,this._anchor,"marker"),s&&s.className)for(const h of s.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.L.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(s){return this._offset=l.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const On={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let kn=0,ba=!1;const bl={maxWidth:100,unit:"metric"};function wl(_,s,h){const p=h&&h.maxWidth||100,g=_._container.clientHeight/2,y=_.unproject([0,g]),E=_.unproject([p,g]),S=y.distanceTo(E);if(h&&h.unit==="imperial"){const P=3.2808*S;P>5280?No(s,p,P/5280,_._getUIString("ScaleControl.Miles")):No(s,p,P,_._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?No(s,p,S/1852,_._getUIString("ScaleControl.NauticalMiles")):S>=1e3?No(s,p,S/1e3,_._getUIString("ScaleControl.Kilometers")):No(s,p,S,_._getUIString("ScaleControl.Meters"))}function No(_,s,h,p){const g=function(y){const E=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/E;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(P){const M=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*M)/M}(S),E*S}(h);_.style.width=s*(g/h)+"px",_.innerHTML=`${g}&nbsp;${p}`}const hh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},dh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wa(_){if(_){if(typeof _=="number"){const s=Math.round(Math.abs(_)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,_),"top-left":new l.P(s,s),"top-right":new l.P(-s,s),bottom:new l.P(0,-_),"bottom-left":new l.P(s,-s),"bottom-right":new l.P(-s,-s),left:new l.P(_,0),right:new l.P(-_,0)}}if(_ instanceof l.P||Array.isArray(_)){const s=l.P.convert(_);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.P.convert(_.center||[0,0]),top:l.P.convert(_.top||[0,0]),"top-left":l.P.convert(_["top-left"]||[0,0]),"top-right":l.P.convert(_["top-right"]||[0,0]),bottom:l.P.convert(_.bottom||[0,0]),"bottom-left":l.P.convert(_["bottom-left"]||[0,0]),"bottom-right":l.P.convert(_["bottom-right"]||[0,0]),left:l.P.convert(_.left||[0,0]),right:l.P.convert(_.right||[0,0])}}return wa(new l.P(0,0))}const fh={extend:(_,...s)=>l.e(_,...s),run(_){_()},logToElement(_,s=!1,h="log"){const p=window.document.getElementById(h);p&&(s&&(p.innerHTML=""),p.innerHTML+=`<br>${_}`)}},ph=b;class en{static get version(){return ph}static get workerCount(){return Or.workerCount}static set workerCount(s){Or.workerCount=s}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(s){l.c.MAX_PARALLEL_IMAGE_REQUESTS=s}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(s){l.c.WORKER_URL=s}static addProtocol(s,h){l.c.REGISTERED_PROTOCOLS[s]=h}static removeProtocol(s){delete l.c.REGISTERED_PROTOCOLS[s]}}return en.Map=class extends Mf{constructor(_){if(l.bg.mark(l.bh.create),(_=l.e({},bt,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new xc(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),{bearingSnap:_.bearingSnap}),this._cooperativeGesturesOnWheel=s=>{this._onCooperativeGesture(s,s[this._metaKey],1)},this._contextLost=s=>{s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._cooperativeGestures=_.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new Ec,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},ah,_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this._imageQueueHandle=ce.addThrottleControl(()=>this.isMoving()),this._requestManager=new G(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const h=Fo(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{s?h(p):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new oh(this,_),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=_.hash&&new ml(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,l.e({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Er({customAttribution:_.customAttribution})),_.maplibreLogo&&this.addControl(new bn,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new l.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new l.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new l.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(_,s){if(s===void 0&&(s=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=_.onAdd(this);this._controls.push(_);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(_);return s>-1&&this._controls.splice(s,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,s,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,s,h,p)}resize(_){var s;const h=this._containerDimensions(),p=h[0],g=h[1],y=this._getClampedPixelRatio(p,g);if(this._resizeCanvas(p,g,y),this.painter.resize(p,g,y),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const P=this._getClampedPixelRatio(p,g);this._resizeCanvas(p,g,P),this.painter.resize(p,g,P)}this.transform.resize(p,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(p,g);const E=!this._moving;return E&&(this.stop(),this.fire(new l.k("movestart",_)).fire(new l.k("move",_))),this.fire(new l.k("resize",_)),E&&this.fire(new l.k("moveend",_)),this}_getClampedPixelRatio(_,s){const{0:h,1:p}=this._maxCanvasSize,g=this.getPixelRatio(),y=_*g,E=s*g;return Math.min(y>h?h/y:1,E>p?p/E:1)*g}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Kt.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(_){return this._cooperativeGestures=_,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(_){return this.transform.locationPoint(l.L.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(l.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,s,h){if(_==="mouseenter"||_==="mouseover"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:y=>{const E=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];E.length?p||(p=!0,h.call(this,new Tr(_,this,y.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(_==="mouseleave"||_==="mouseout"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:E=>{(this.getLayer(s)?this.queryRenderedFeatures(E.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,h.call(this,new Tr(_,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new Tr(_,this,E.originalEvent)))}}}}{const p=g=>{const y=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];y.length&&(g.features=y,h.call(this,g),delete g.features)};return{layer:s,listener:h,delegates:{[_]:p}}}}on(_,s,h){if(h===void 0)return super.on(_,s);const p=this._createDelegatedListener(_,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(p);for(const g in p.delegates)this.on(g,p.delegates[g]);return this}once(_,s,h){if(h===void 0)return super.once(_,s);const p=this._createDelegatedListener(_,s,h);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(_,s,h){return h===void 0?super.off(_,s):(this._delegatedListeners&&this._delegatedListeners[_]&&(p=>{const g=this._delegatedListeners[_];for(let y=0;y<g.length;y++){const E=g[y];if(E.layer===s&&E.listener===h){for(const S in E.delegates)this.off(S,E.delegates[S]);return g.splice(y,1),this}}})(),this)}queryRenderedFeatures(_,s){if(!this.style)return[];let h;const p=_ instanceof l.P||Array.isArray(_),g=p?_:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(p?{}:_)||{},g instanceof l.P||typeof g[0]=="number")h=[l.P.convert(g)];else{const y=l.P.convert(g[0]),E=l.P.convert(g[1]);h=[y,new l.P(E.x,y.y),E,new l.P(y.x,E.y),y]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(_,s){return this.style.querySourceFeatures(_,s)}setStyle(_,s){return(s=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(_,s))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const s=this._locale[_];if(s==null)throw new Error(`Missing UI string '${_}'`);return s}_updateStyle(_,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,s));const h=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new ln(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,s,h):this.style.loadJSON(_,s,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ln(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,s){if(typeof _=="string"){const h=this._requestManager.transformRequest(_,W.Style);l.f(h,(p,g)=>{p?this.fire(new l.j(p)):g&&this._updateDiff(g,s)})}else typeof _=="object"&&this._updateDiff(_,s)}_updateDiff(_,s){try{this.style.setState(_,s)&&this._update(!0)}catch(h){l.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(_,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(_,s){return this._lazyInitEmptyStyle(),this.style.addSource(_,s),this._update(!0)}isSourceLoaded(_){const s=this.style&&this.style.sourceCaches[_];if(s!==void 0)return s.loaded();this.fire(new l.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const s=this.style.sourceCaches[_.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===_.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Rf(this.painter,s,_),this.painter.renderToTexture=new Sc(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==_.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:_})),this}getTerrain(){var _,s;return(s=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const s in _){const h=_[s]._tiles;for(const p in h){const g=h[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(_,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,s,h)}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,s,h={}){const{pixelRatio:p=1,sdf:g=!1,stretchX:y,stretchY:E,content:S}=h;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||l.a(s))){if(s.width===void 0||s.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:M,data:D}=s,z=s;return this.style.addImage(_,{data:new l.R({width:P,height:M},new Uint8Array(D)),pixelRatio:p,stretchX:y,stretchY:E,content:S,sdf:g,version:0,userImage:z}),z.onAdd&&z.onAdd(this,_),this}}{const{width:P,height:M,data:D}=l.h.getImageData(s);this.style.addImage(_,{data:new l.R({width:P,height:M},D),pixelRatio:p,stretchX:y,stretchY:E,content:S,sdf:g,version:0})}}updateImage(_,s){const h=this.style.getImage(_);if(!h)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||l.a(s)?l.h.getImageData(s):s,{width:g,height:y,data:E}=p;if(g===void 0||y===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==h.data.width||y!==h.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(s instanceof HTMLImageElement||l.a(s));return h.data.replace(E,S),this.style.updateImage(_,h),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,s){ce.getImage(this._requestManager.transformRequest(_,W.Image),s)}listImages(){return this.style.listImages()}addLayer(_,s){return this._lazyInitEmptyStyle(),this.style.addLayer(_,s),this._update(!0)}moveLayer(_,s){return this.style.moveLayer(_,s),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,s,h){return this.style.setLayerZoomRange(_,s,h),this._update(!0)}setFilter(_,s,h={}){return this.style.setFilter(_,s,h),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,s,h,p={}){return this.style.setPaintProperty(_,s,h,p),this._update(!0)}getPaintProperty(_,s){return this.style.getPaintProperty(_,s)}setLayoutProperty(_,s,h,p={}){return this.style.setLayoutProperty(_,s,h,p),this._update(!0)}getLayoutProperty(_,s){return this.style.getLayoutProperty(_,s)}setGlyphs(_,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,s,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,s,h,p=>{p||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,s,h=>{h||this._update(!0)}),this}setLight(_,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(_,s){return this.style.setFeatureState(_,s),this._update()}removeFeatureState(_,s){return this.style.removeFeatureState(_,s),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,s=0;return this._container&&(_=this._container.clientWidth||400,s=this._container.clientHeight||300),[_,s]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const s=this._canvasContainer=w.create("div","maplibregl-canvas-container",_);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const g=this._controlContainer=w.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{y[E]=w.create("div",`maplibregl-ctrl-${E} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=w.create("div","maplibregl-cooperative-gesture-screen",this._container);let _=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(_=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${_}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){w.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(_,s,h){this._canvas.width=Math.floor(h*_),this._canvas.height=Math.floor(h*s),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{s={requestedAttributes:_},p&&(s.statusMessage=p.statusMessage,s.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!h){const p="Failed to initialize WebGL";throw s?(s.message=p,new Error(JSON.stringify(s))):new Error(p)}this.painter=new Oo(h,this.transform),C.testSupport(h)}_onCooperativeGesture(_,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,y=l.h.now();this.style.zoomHistory.update(g,y);const E=new l.a8(g,{now:y,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=E.crossFadingFactor();S===1&&S===this._crossFadingFactor||(h=!0,this._crossFadingFactor=S),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ce.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(_=>{l.bg.frame(_),this._frame=null,this._render(_)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return mt}getCameraTargetElevation(){return this.transform.elevation}},en.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const s=this._map.getZoom(),h=s===this._map.getMaxZoom(),p=s===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);s.title=p,s.setAttribute("aria-label",p)},this.options=l.e({},lh,_),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ch(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,s){const h=w.create("button",_,this._container);return h.type="button",h.addEventListener("click",s),h}},en.GeolocateControl=class extends l.E{constructor(_){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const h=new l.L(s.coords.longitude,s.coords.latitude),p=s.coords.accuracy,g=this._map.getBearing(),y=l.e({bearing:g},this.options.fitBoundsOptions),E=Kt.fromLngLat(h,p);this._map.fitBounds(E,y,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const h=new l.L(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&ba)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Bo({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},On,_)}onAdd(_){return this._map=_,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(s,h=!1){qn===void 0||h?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(p=>{qn=p.state!=="denied",s(qn)}).catch(()=>{qn=!!window.navigator.geolocation,s(qn)}):(qn=!!window.navigator.geolocation,s(qn)):s(qn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,kn=0,ba=!1}_isOutOfMapMaxBounds(_){const s=this._map.getMaxBounds(),h=_.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),s=_.getSouthEast(),h=_.getNorthEast(),p=s.distanceTo(h),g=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":kn--,ba=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),kn++,kn>1?(_={maximumAge:6e5,timeout:0},ba=!0):(_=this.options.positionOptions,ba=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},en.AttributionControl=Er,en.LogoControl=bn,en.ScaleControl=class{constructor(_){this._onMove=()=>{wl(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,wl(this._map,this._container,this.options)},this.options=l.e({},bl,_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},en.FullscreenControl=class extends l.E{constructor(_={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},en.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=_}onAdd(_){return this._map=_,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},en.Popup=class extends l.E{constructor(_){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=uh(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!s)return;const h=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);let p=this.options.anchor;const g=wa(this.options.offset);if(!p){const E=this._container.offsetWidth,S=this._container.offsetHeight;let P;P=h.y+g.bottom.y<S?["top"]:h.y>this._map.transform.height-S?["bottom"]:[],h.x<E/2?P.push("left"):h.x>this._map.transform.width-E/2&&P.push("right"),p=P.length===0?"bottom":P.join("-")}const y=h.add(g[p]).round();w.setTransform(this._container,`${Gr[p]} translate(${y.x}px,${y.y}px)`),Df(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(hh),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=l.L.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const s=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=_;p=h.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){this._container&&this._container.classList.add(_)}removeClassName(_){this._container&&this._container.classList.remove(_)}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(dh);_&&_.focus()}},en.Marker=Bo,en.Style=ln,en.LngLat=l.L,en.LngLatBounds=Kt,en.Point=l.P,en.MercatorCoordinate=l.U,en.Evented=l.E,en.AJAXError=l.bi,en.config=l.c,en.CanvasSource=Yi,en.GeoJSONSource=Ci,en.ImageSource=fn,en.RasterDEMTileSource=dn,en.RasterTileSource=Ii,en.VectorTileSource=mr,en.VideoSource=vs,en.setRTLTextPlugin=l.bj,en.getRTLTextPluginStatus=l.bk,en.prewarm=function(){Lo().acquire(Wt)},en.clearPrewarmedResources=function(){const _=Fr;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Wt),Fr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},fh.extend(en,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),en});var f=o;return f})})(PS);var Sk=PS.exports;const sw=Bm(Sk);function Md(t){"@babel/helpers - typeof";return Md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Md(t)}function Ak(t,e){if(Md(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(Md(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Pk(t){var e=Ak(t,"string");return Md(e)=="symbol"?e:e+""}function N(t,e,n){return(e=Pk(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Em(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const k0=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ow=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ow&&parseFloat(ow[1]);const Ik="3.4.15";function sa(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Wp=typeof process!="object"||String(process)!=="[object process]"||process.browser,Ck=typeof window<"u"&&typeof window.orientation<"u",aw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);aw&&parseFloat(aw[1]);class Mk{constructor(e,n){N(this,"name",void 0),N(this,"workerThread",void 0),N(this,"isRunning",!0),N(this,"result",void 0),N(this,"_resolve",()=>{}),N(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,o)=>{this._resolve=i,this._reject=o})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){sa(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){sa(this.isRunning),this.isRunning=!1,this._reject(e)}}let N_=class{terminate(){}};const U_=new Map;function Lk(t){sa(t.source&&!t.url||!t.source&&t.url);let e=U_.get(t.source||t.url);return e||(t.url&&(e=kk(t.url),U_.set(t.url,e)),t.source&&(e=CS(t.source),U_.set(t.source,e))),sa(e),e}function kk(t){if(!t.startsWith("http"))return t;const e=Rk(t);return CS(e)}function CS(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Rk(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function MS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(lw(t))i.add(t);else if(lw(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)MS(t[o],e,i)}}return n===void 0?Array.from(i):[]}function lw(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const V_=()=>{};class dv{static isSupported(){return typeof Worker<"u"&&Wp||typeof N_<"u"&&!Wp}constructor(e){N(this,"name",void 0),N(this,"source",void 0),N(this,"url",void 0),N(this,"terminated",!1),N(this,"worker",void 0),N(this,"onMessage",void 0),N(this,"onError",void 0),N(this,"_loadableURL","");const{name:n,source:i,url:o}=e;sa(i||o),this.name=n,this.source=i,this.url=o,this.onMessage=V_,this.onError=u=>console.log(u),this.worker=Wp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=V_,this.onError=V_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||MS(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=Lk({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new N_(i,{eval:!1})}else if(this.source)e=new N_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class Dk{static isSupported(){return dv.isSupported()}constructor(e){N(this,"name","unnamed"),N(this,"source",void 0),N(this,"url",void 0),N(this,"maxConcurrency",1),N(this,"maxMobileConcurrency",1),N(this,"onDebug",()=>{}),N(this,"reuseWorkers",!0),N(this,"props",{}),N(this,"jobQueue",[]),N(this,"idleQueue",[]),N(this,"count",0),N(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(u,f,l)=>u.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(u,f)=>u.error(f);const o=new Promise(u=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:u}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new Mk(n.name,e);e.onMessage=o=>n.onMessage(i,o.type,o.payload),e.onError=o=>n.onError(i,o),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new dv({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Ck?this.maxMobileConcurrency:this.maxConcurrency}}const zk={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ko{static isSupported(){return dv.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ko._workerFarm=Ko._workerFarm||new Ko({}),Ko._workerFarm.setProps(e),Ko._workerFarm}constructor(e){N(this,"props",void 0),N(this,"workerPools",new Map),this.props={...zk},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:o}=e;let u=this.workerPools.get(n);return u||(u=new Dk({name:n,source:i,url:o}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}N(Ko,"_workerFarm",void 0);const Ok="latest";function Fk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let o=n.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(o="modules/".concat(t.module,"/dist/").concat(i)),!o){let u=t.version;u==="latest"&&(u=Ok);const f=u?"@".concat(u):"";o="https://unpkg.com/@loaders.gl/".concat(t.module).concat(f,"/dist/").concat(i)}return sa(o),o}function Bk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ik;sa(t,"no worker provided");const n=t.version;return!(!e||!n)}function Nk(t,e){return!Ko.isSupported()||!Wp&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Uk(t,e,n,i,o){const u=t.id,f=Fk(t,n),b=Ko.getWorkerFarm(n).getWorkerPool({name:u,url:f});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const w=await b.startJob("process-on-worker",Vk.bind(null,o));return w.postMessage("process",{input:e,options:n,context:i}),await(await w.result).result}async function Vk(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:o,input:u,options:f}=i;try{const l=await t(u,f);e.postMessage("done",{id:o,result:l})}catch(l){const b=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:o,error:b})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function jk(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),o=new Uint8Array(e);for(let u=0;u<i.length;++u)if(i[u]!==o[u])return!1;return!0}function Gk(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),o=i.reduce((l,b)=>l+b.byteLength,0),u=new Uint8Array(o);let f=0;for(const l of i)u.set(l,f),f+=l.byteLength;return u.buffer}async function $k(t){const e=[];for await(const n of t)e.push(n);return Gk(...e)}function cw(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class uw{constructor(e,n){N(this,"name",void 0),N(this,"type",void 0),N(this,"sampleSize",1),N(this,"time",void 0),N(this,"count",void 0),N(this,"samples",void 0),N(this,"lastTiming",void 0),N(this,"lastSampleTime",void 0),N(this,"lastSampleCount",void 0),N(this,"_count",0),N(this,"_time",0),N(this,"_samples",0),N(this,"_startTime",0),N(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=cw(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(cw()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class R0{constructor(e){N(this,"id",void 0),N(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof uw?this.stats[n]=e:this.stats[n]=new uw(n,i)),this.stats[n]}}let Hk="";const hw={};function Wk(t){for(const e in hw)if(t.startsWith(e)){const n=hw[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(Hk).concat(t)),t}function qk(t){return t&&typeof t=="object"&&t.isBuffer}function LS(t){if(qk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function kS(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Zk(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Xk=t=>typeof t=="boolean",cd=t=>typeof t=="function",$d=t=>t!==null&&typeof t=="object",dw=t=>$d(t)&&t.constructor==={}.constructor,Yk=t=>t&&typeof t[Symbol.iterator]=="function",Kk=t=>t&&typeof t[Symbol.asyncIterator]=="function",Jl=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ql=t=>typeof Blob<"u"&&t instanceof Blob,Jk=t=>t&&typeof t=="object"&&t.isBuffer,Qk=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||$d(t)&&cd(t.tee)&&cd(t.cancel)&&cd(t.getReader),e3=t=>$d(t)&&cd(t.read)&&cd(t.pipe)&&Xk(t.readable),RS=t=>Qk(t)||e3(t),t3=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,n3=/^([-\w.]+\/[-\w.+]+)/;function i3(t){const e=n3.exec(t);return e?e[1]:t}function fw(t){const e=t3.exec(t);return e?e[1]:""}const DS=/\?.*/;function r3(t){const e=t.match(DS);return e&&e[0]}function D0(t){return t.replace(DS,"")}function tg(t){return Jl(t)?t.url:Ql(t)?t.name||"":typeof t=="string"?t:""}function z0(t){if(Jl(t)){const e=t,n=e.headers.get("content-type")||"",i=D0(e.url);return i3(n)||fw(i)}return Ql(t)?t.type||"":typeof t=="string"?fw(t):""}function s3(t){return Jl(t)?t.headers["content-length"]||-1:Ql(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function zS(t){if(Jl(t))return t;const e={},n=s3(t);n>=0&&(e["content-length"]=String(n));const i=tg(t),o=z0(t);o&&(e["content-type"]=o);const u=await l3(t);u&&(e["x-first-bytes"]=u),typeof t=="string"&&(t=new TextEncoder().encode(t));const f=new Response(t,{headers:e});return Object.defineProperty(f,"url",{value:i}),f}async function o3(t){if(!t.ok){const e=await a3(t);throw new Error(e)}}async function a3(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function l3(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const o=new FileReader;o.onload=u=>{var f;return i(u==null||(f=u.target)===null||f===void 0?void 0:f.result)},o.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=c3(n);return"data:base64,".concat(i)}return null}function c3(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function pw(t,e){if(typeof t=="string"){t=Wk(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await zS(t)}function OS(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const n=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function ca(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||OS()}const qp={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,process:typeof process=="object"&&process},bp=qp.window||qp.self||qp.global,jh=qp.process||{},FS=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";ca();const j_=globalThis;function BS(t){if(!ca())return"Node";if(OS())return"Electron";const n=(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o?"IE":j_.chrome?"Chrome":j_.safari?"Safari":j_.mozInnerScreenX?"Firefox":"Unknown"}function u3(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class h3{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";N(this,"storage",void 0),N(this,"id",void 0),N(this,"config",void 0),this.storage=u3(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function d3(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function f3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function G_(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const u=t.width*n,f=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(f/2),"px ").concat(Math.floor(u/2),"px;"),"line-height:".concat(f,"px;"),"background:url(".concat(o,");"),"background-size:".concat(u,"px ").concat(f,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Sm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Sm||(Sm={}));function mw(t){return typeof t=="string"?Sm[t.toUpperCase()]||Sm.WHITE:t}function p3(t,e,n){return!ca&&typeof t=="string"&&(e&&(e=mw(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=mw(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function m3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const o of i)typeof t[o]=="function"&&(e.find(u=>o===u)||(t[o]=t[o].bind(t)))}function Am(t,e){if(!t)throw new Error(e||"Assertion failed")}function Bc(){let t;if(ca&&"performance"in bp){var e,n;t=bp==null||(e=bp.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in jh){var i;const o=jh==null||(i=jh.hrtime)===null||i===void 0?void 0:i.call(jh);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const Nc={debug:ca&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},g3={enabled:!0,level:0};function Ls(){}const gw={},_w={once:!0};class Hd{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};N(this,"id",void 0),N(this,"VERSION",FS),N(this,"_startTs",Bc()),N(this,"_deltaTs",Bc()),N(this,"_storage",void 0),N(this,"userData",{}),N(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new h3("__probe-".concat(this.id,"__"),g3),this.timeStamp("".concat(this.id," started")),m3(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Bc()-this._startTs).toPrecision(10))}getDelta(){return Number((Bc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Am(e,n)}warn(e){return this._getLogFunction(0,e,Nc.warn,arguments,_w)}error(e){return this._getLogFunction(0,e,Nc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Nc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Nc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),u=2;u<i;u++)o[u-2]=arguments[u];return this._getLogFunction(e,n,Nc.debug||Nc.info,arguments,_w)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||Ls,i&&[i],{tag:x3(n)}):Ls}image(e){let{logLevel:n,priority:i,image:o,message:u="",scale:f=1}=e;return this._shouldLog(n||i)?ca?v3({image:o,message:u,scale:f}):y3():Ls}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ls)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=yw({logLevel:e,message:n,opts:i}),{collapsed:u}=i;return o.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ls)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=NS(e)}_getLogFunction(e,n,i,o,u){if(this._shouldLog(e)){u=yw({logLevel:e,message:n,args:o,opts:u}),i=i||u.method,Am(i),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=Bc();const f=u.tag||u.message;if(u.once)if(!gw[f])gw[f]=Bc();else return Ls;return n=_3(this.id,u.message,u),i.bind(console,n,...u.args)}return Ls}}N(Hd,"VERSION",FS);function NS(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Am(Number.isFinite(e)&&e>=0),e}function yw(t){const{logLevel:e,message:n}=t;t.logLevel=NS(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return Am(o==="string"||o==="object"),Object.assign(t,{args:i},t.opts)}function _3(t,e,n){if(typeof e=="string"){const i=n.time?f3(d3(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=p3(e,n.color,n.background)}return e}function y3(t){return console.warn("removed"),Ls}function v3(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const u=new Image;return u.onload=()=>{const f=G_(u,n,i);console.log(...f)},u.src=e,Ls}const o=e.nodeName||"";if(o.toLowerCase()==="img")return console.log(...G_(e,n,i)),Ls;if(o.toLowerCase()==="canvas"){const u=new Image;return u.onload=()=>console.log(...G_(u,n,i)),u.src=e.toDataURL(),Ls}return Ls}function x3(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const vw=new Hd({id:"loaders.gl"});class b3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class w3{constructor(){N(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const US={fetch:null,mimeType:void 0,nothrow:!1,log:new w3,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:k0,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},T3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function VS(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const jS=()=>{const t=VS();return t.globalOptions=t.globalOptions||{...US},t.globalOptions};function E3(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],S3(t,n),P3(e,t,i)}function S3(t,e){xw(t,null,US,T3,e);for(const n of e){const i=t&&t[n.id]||{},o=n.options&&n.options[n.id]||{},u=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};xw(i,n.id,o,u,e)}}function xw(t,e,n,i,o){const u=e||"Top level",f=e?"".concat(e,"."):"";for(const l in t){const b=!e&&$d(t[l]),w=l==="baseUri"&&!e,C=l==="workerUrl"&&e;if(!(l in n)&&!w&&!C){if(l in i)vw.warn("".concat(u," loader option '").concat(f).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!b){const L=A3(l,o);vw.warn("".concat(u," loader option '").concat(f).concat(l,"' not recognized. ").concat(L))()}}}}function A3(t,e){const n=t.toLowerCase();let i="";for(const o of e)for(const u in o.options){if(t===u)return"Did you mean '".concat(o.id,".").concat(u,"'?");const f=u.toLowerCase();(n.startsWith(f)||f.startsWith(n))&&(i=i||"Did you mean '".concat(o.id,".").concat(u,"'?"))}return i}function P3(t,e,n){const o={...t.options||{}};return I3(o,n),o.log===null&&(o.log=new b3),bw(o,jS()),bw(o,e),o}function bw(t,e){for(const n in e)if(n in e){const i=e[n];dw(i)&&dw(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function I3(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function O0(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function F0(t){var e,n;Em(t,"null loader"),Em(O0(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const GS=()=>{const t=VS();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function C3(t){const e=GS();t=Array.isArray(t)?t:[t];for(const n of t){const i=F0(n);e.find(o=>i===o)||e.unshift(i)}}function M3(){return GS()}const L3=new Hd({id:"loaders.gl"}),k3=/\.([^.]+)$/;async function R3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!$S(t))return null;let o=ww(t,e,{...n,nothrow:!0},i);if(o)return o;if(Ql(t)&&(t=await t.slice(0,10).arrayBuffer(),o=ww(t,e,n,i)),!o&&!(n!=null&&n.nothrow))throw new Error(HS(t));return o}function ww(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!$S(t))return null;if(e&&!Array.isArray(e))return F0(e);let o=[];e&&(o=o.concat(e)),n!=null&&n.ignoreRegisteredLoaders||o.push(...M3()),z3(o);const u=D3(t,o,n,i);if(!u&&!(n!=null&&n.nothrow))throw new Error(HS(t));return u}function D3(t,e,n,i){const o=tg(t),u=z0(t),f=D0(o)||(i==null?void 0:i.url);let l=null,b="";if(n!=null&&n.mimeType&&(l=$_(e,n==null?void 0:n.mimeType),b="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||O3(e,f),b=b||(l?"matched url ".concat(f):""),l=l||$_(e,u),b=b||(l?"matched MIME type ".concat(u):""),l=l||B3(e,t),b=b||(l?"matched initial data ".concat(WS(t)):""),l=l||$_(e,n==null?void 0:n.fallbackMimeType),b=b||(l?"matched fallback MIME type ".concat(u):""),b){var w;L3.log(1,"selectLoader selected ".concat((w=l)===null||w===void 0?void 0:w.name,": ").concat(b,"."))}return l}function $S(t){return!(t instanceof Response&&t.status===204)}function HS(t){const e=tg(t),n=z0(t);let i="No valid loader found (";i+=e?"".concat(kS(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const o=t?WS(t):"";return i+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",i+=")",i}function z3(t){for(const e of t)F0(e)}function O3(t,e){const n=e&&k3.exec(e),i=n&&n[1];return i?F3(t,i):null}function F3(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function $_(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function B3(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(N3(e,n))return n}else if(ArrayBuffer.isView(e)){if(Tw(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Tw(e,0,n))return n;return null}function N3(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Tw(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(o=>U3(t,e,n,o))}function U3(t,e,n,i){if(i instanceof ArrayBuffer)return jk(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const o=fv(t,e,i.length);return i===o;default:return!1}}function WS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?fv(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?fv(t,0,e):""}function fv(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let o="";for(let u=0;u<n;u++)o+=String.fromCharCode(i.getUint8(e+u));return o}const V3=256*1024;function*j3(t,e){const n=(e==null?void 0:e.chunkSize)||V3;let i=0;const o=new TextEncoder;for(;i<t.length;){const u=Math.min(t.length-i,n),f=t.slice(i,i+u);i+=u,yield o.encode(f)}}const G3=256*1024;function $3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=G3}=e;let i=0;for(;i<t.byteLength;){const o=Math.min(t.byteLength-i,n),u=new ArrayBuffer(o),f=new Uint8Array(t,i,o);new Uint8Array(u).set(f),i+=o,yield u}}()}const H3=1024*1024;async function*W3(t,e){const n=(e==null?void 0:e.chunkSize)||H3;let i=0;for(;i<t.size;){const o=i+n,u=await t.slice(i,o).arrayBuffer();i=o,yield u}}function Ew(t,e){return k0?q3(t,e):Z3(t)}async function*q3(t,e){const n=t.getReader();let i;try{for(;;){const o=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:u,value:f}=await o;if(u)return;yield LS(f)}}catch{n.releaseLock()}}async function*Z3(t,e){for await(const n of t)yield LS(n)}function X3(t,e){if(typeof t=="string")return j3(t,e);if(t instanceof ArrayBuffer)return $3(t,e);if(Ql(t))return W3(t,e);if(RS(t))return Ew(t,e);if(Jl(t))return Ew(t.body,e);throw new Error("makeIterator")}const qS="Cannot convert supplied data type";function Y3(t,e,n){if(e.text&&typeof t=="string")return t;if(Jk(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+o)),i}throw new Error(qS)}async function K3(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return Y3(t,e);if(Ql(t)&&(t=await zS(t)),Jl(t)){const o=t;return await o3(o),e.binary?await o.arrayBuffer():await o.text()}if(RS(t)&&(t=X3(t,n)),Yk(t)||Kk(t))return $k(t);throw new Error(qS)}function ZS(t,e){const n=jS(),i=t||n;return typeof i.fetch=="function"?i.fetch:$d(i.fetch)?o=>pw(o,i):e!=null&&e.fetch?e==null?void 0:e.fetch:pw}function J3(t,e,n){if(n)return n;const i={fetch:ZS(e,t),...t};if(i.url){const o=D0(i.url);i.baseUrl=o,i.queryString=r3(i.url),i.filename=kS(o),i.baseUrl=Zk(o)}return Array.isArray(i.loaders)||(i.loaders=null),i}function Q3(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function B0(t,e,n,i){sa(!i||typeof i=="object"),e&&!Array.isArray(e)&&!O0(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const o=tg(t),f=Q3(e,i),l=await R3(t,f,n);return l?(n=E3(n,l,f,o),i=J3({url:o,parse:B0,loaders:f},n,i||null),await eR(l,t,n,i)):null}async function eR(t,e,n,i){if(Bk(t),Jl(e)){const o=e,{ok:u,redirected:f,status:l,statusText:b,type:w,url:C}=o,L=Object.fromEntries(o.headers.entries());i.response={headers:L,ok:u,redirected:f,status:l,statusText:b,type:w,url:C}}if(e=await K3(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(Nk(t,n))return await Uk(t,e,n,i,B0);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw sa(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Pm(t,e,n,i){!Array.isArray(e)&&!O0(e)&&(n=e,e=void 0);const o=ZS(n);let u=t;return typeof t=="string"&&(u=await o(t)),Ql(t)&&(u=await o(t)),await B0(u,e,n)}const tR="3.4.15",{_parseImageNode:nR}=globalThis,pv=typeof Image<"u",mv=typeof ImageBitmap<"u",iR=!!nR,gv=k0?!0:iR;function rR(t){switch(t){case"auto":return mv||pv||gv;case"imagebitmap":return mv;case"image":return pv;case"data":return gv;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function sR(){if(mv)return"imagebitmap";if(pv)return"image";if(gv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function oR(t){const e=lR(t);if(!e)throw new Error("Not an image");return e}function aR(t){switch(oR(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function lR(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const cR=/^data:image\/svg\+xml/,uR=/\.svg((\?|#).*)?$/;function N0(t){return t&&(cR.test(t)||uR.test(t))}function hR(t,e){if(N0(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(u){throw new Error(u.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return XS(t,e)}function XS(t,e){if(N0(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function YS(t,e,n){const i=hR(t,n),o=self.URL||self.webkitURL,u=typeof i!="string"&&o.createObjectURL(i);try{return await dR(u||i,e)}finally{u&&o.revokeObjectURL(u)}}async function dR(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,o)=>{try{n.onload=()=>i(n),n.onerror=u=>o(new Error("Could not load image ".concat(t,": ").concat(u)))}catch(u){o(u)}})}const fR={};let Sw=!0;async function pR(t,e,n){let i;N0(n)?i=await YS(t,e,n):i=XS(t,n);const o=e&&e.imagebitmap;return await mR(i,o)}async function mR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((gR(e)||!Sw)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Sw=!1}return await createImageBitmap(t)}function gR(t){for(const e in t||fR)return!1;return!0}function _R(t){return!bR(t,"ftyp",4)||!(t[8]&96)?null:yR(t)}function yR(t){switch(vR(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function vR(t,e,n){return String.fromCharCode(...t.slice(e,n))}function xR(t){return[...t].map(e=>e.charCodeAt(0))}function bR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=xR(e);for(let o=0;o<i.length;++o)if(i[o]!==t[o+n])return!1;return!0}const Eo=!1,ud=!0;function KS(t){const e=Wd(t);return TR(e)||AR(e)||ER(e)||SR(e)||wR(e)}function wR(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=_R(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function TR(t){const e=Wd(t);return e.byteLength>=24&&e.getUint32(0,Eo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Eo),height:e.getUint32(20,Eo)}:null}function ER(t){const e=Wd(t);return e.byteLength>=10&&e.getUint32(0,Eo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ud),height:e.getUint16(8,ud)}:null}function SR(t){const e=Wd(t);return e.byteLength>=14&&e.getUint16(0,Eo)===16973&&e.getUint32(2,ud)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ud),height:e.getUint32(22,ud)}:null}function AR(t){const e=Wd(t);if(!(e.byteLength>=3&&e.getUint16(0,Eo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:o}=PR();let u=2;for(;u+9<e.byteLength;){const f=e.getUint16(u,Eo);if(o.has(f))return{mimeType:"image/jpeg",height:e.getUint16(u+5,Eo),width:e.getUint16(u+7,Eo)};if(!i.has(f))return null;u+=2,u+=e.getUint16(u,Eo)}return null}function PR(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Wd(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function IR(t,e){const{mimeType:n}=KS(t)||{},i=globalThis._parseImageNode;return Em(i),await i(t,n)}async function CR(t,e,n){e=e||{};const o=(e.image||{}).type||"auto",{url:u}=n||{},f=MR(o);let l;switch(f){case"imagebitmap":l=await pR(t,e,u);break;case"image":l=await YS(t,e,u);break;case"data":l=await IR(t);break;default:Em(!1)}return o==="data"&&(l=aR(l)),l}function MR(t){switch(t){case"auto":case"data":return sR();default:return rR(t),t}}const LR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],kR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],RR={image:{type:"auto",decode:!0}},DR={id:"image",module:"images",name:"Images",version:tR,mimeTypes:kR,extensions:LR,parse:CR,tests:[t=>!!KS(new DataView(t))],options:RR},an=new Hd({id:"deck"});let _v={};function zR(t){_v=t}function hr(t,e,n,i){an.level>0&&_v[t]&&_v[t].call(null,e,n,i)}function OR(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const FR={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:OR,parseTextSync:JSON.parse};function BR(){const t="8.9.36",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(an.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:an,_registerLoggers:zR},C3([FR,[DR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const NR=BR(),_n={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(_n,"IDENTITY",{get:()=>(an.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const So={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Wl={common:0,meters:1,pixels:2},Aw={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Et=new Hd({id:"luma.gl"});function Lr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const UR="Invalid WebGLRenderingContext",VR="Requires WebGL2";function ng(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Yt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function jR(t){return Yt(t)?t:null}function ig(t){return Lr(ng(t),UR),t}function fr(t){return Lr(Yt(t),VR),t}const Jh={};function GR(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function $R(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function HR(t,e){Jh[t]=!0,GR(e)}function WR(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Jh[i]=!0);while(i!==0);for(i in Jh)if(Jh[i])return delete Jh[i],parseInt(i,10);return 0}}const qd=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const o=new t.VertexAttrib(n);this.attribs[i]=o}this.maxAttrib=0};qd.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};qd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const ec=function(e){const n=this;this.gl=e,WR(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(u){return u===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(u,f){switch(u){case 34962:n.currentArrayBuffer=f;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=f;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(u,f){const b=n.currentVertexArrayObject.attribs[u];switch(f){case 34975:return b.buffer;case 34338:return b.enabled;case 34339:return b.size;case 34340:return b.stride;case 34341:return b.type;case 34922:return b.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(u,f,l,b,w,C){const L=n.currentVertexArrayObject;L.maxAttrib=Math.max(L.maxAttrib,u);const k=L.attribs[u];return k.buffer=n.currentArrayBuffer,k.size=f,k.type=l,k.normalized=b,k.stride=w,k.offset=C,k.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{$R("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};ec.prototype.VERTEX_ARRAY_BINDING_OES=34229;ec.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new qd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};ec.prototype.createVertexArrayOES=function(){const e=new qd(this);return this.vertexArrayObjects.push(e),e};ec.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};ec.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof qd&&e.hasBeenBound&&e.ext===this)};ec.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){HR(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,o=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const u=this.currentVertexArrayObject;if(o===u)return;(!o||u.elementArrayBuffer!==o.elementArrayBuffer)&&i.bindBuffer.call(n,34963,u.elementArrayBuffer);let f=this.currentArrayBuffer;const l=Math.max(o?o.maxAttrib:0,u.maxAttrib);for(let b=0;b<=l;b++){const w=u.attribs[b],C=o?o.attribs[b]:null;if((!o||w.enabled!==C.enabled)&&(w.enabled?i.enableVertexAttribArray.call(n,b):i.disableVertexAttribArray.call(n,b)),w.enabled){let L=!1;(!o||w.buffer!==C.buffer)&&(f!==w.buffer&&(i.bindBuffer.call(n,34962,w.buffer),f=w.buffer),L=!0),(L||w.cached!==C.cached)&&i.vertexAttribPointer.call(n,b,w.size,w.type,w.normalized,w.stride,w.offset)}}this.currentArrayBuffer!==f&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function qR(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const o=e.call(this)||[];return o.indexOf("OES_vertex_array_object")<0&&o.push("OES_vertex_array_object"),o};const n=t.getExtension;t.getExtension=function(o){const u=n.call(this,o);return u||(o!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new ec(this)),this.__OESVertexArrayObject))}}const Pw="OES_element_index",Iw="WEBGL_draw_buffers",ZR="EXT_disjoint_timer_query",XR="EXT_disjoint_timer_query_webgl2",YR="EXT_texture_filter_anisotropic",Cw="WEBGL_debug_renderer_info",KR=35723,JR=4352,QR=36795,eD=34047,tD=37445,nD=37446,Rn=t=>Yt(t)?void 0:0,iD={3074:t=>Yt(t)?void 0:36064,[KR]:t=>Yt(t)?void 0:JR,35977:Rn,32937:Rn,[QR]:(t,e)=>{const n=Yt(t)?t.getExtension(XR):t.getExtension(ZR);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[tD]:(t,e)=>{const n=t.getExtension(Cw);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[nD]:(t,e)=>{const n=t.getExtension(Cw);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[eD]:(t,e)=>{const n=t.luma.extensions[YR];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Rn,35071:Rn,37447:Rn,36063:(t,e)=>{if(!Yt(t)){const n=t.getExtension(Iw);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Rn,35374:Rn,35377:Rn,34852:t=>{if(!Yt(t)){const e=t.getExtension(Iw);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(Pw)?2147483647:65535,33001:t=>t.getExtension(Pw)?16777216:65535,33e3:t=>16777216,37157:Rn,35373:Rn,35657:Rn,36183:Rn,37137:Rn,34045:Rn,35978:Rn,35979:Rn,35968:Rn,35376:Rn,35375:Rn,35659:Rn,37154:Rn,35371:Rn,35658:Rn,35076:Rn,35077:Rn,35380:Rn};function rD(t,e,n){const i=iD[n],o=typeof i=="function"?i(t,e,n):i;return o!==void 0?o:e(n)}const sD="OES_vertex_array_object",JS="ANGLE_instanced_arrays",oD="WEBGL_draw_buffers",aD="EXT_disjoint_timer_query",lD="EXT_texture_filter_anisotropic",cD="VertexArray requires WebGL2 or OES_vertex_array_object extension";function uD(t,e){return{webgl2:Yt(t),ext:t.getExtension(e)}}const QS={[sD]:{meta:{suffix:"OES"},createVertexArray:()=>{Lr(!1,cD)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[JS]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Lr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[oD]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Lr(!1)}},[aD]:{meta:{suffix:"EXT"},createQuery:()=>{Lr(!1)},deleteQuery:()=>{Lr(!1)},beginQuery:()=>{Lr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},H_={readBuffer:(t,e,n)=>{Yt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:o,ext:u}=uD(t,JS);let f;switch(i){case 35069:f=o?void 0:!1;break;case 35070:f=!o&&!u?0:void 0;break}return f!==void 0?f:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Yt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,o)=>{if(!Yt(t))switch(o){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,o)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:o}=t.luma,u=o[lD];i=u&&u.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:rD,hint(t,e,n,i){return e(n,i)}};function hD(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(qR(t),dD(t),pD(t,QS),fD(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=hD;function dD(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function fD(t,e){let{target:n,target2:i}=e;Object.keys(H_).forEach(o=>{if(typeof H_[o]=="function"){const u=t[o]?t[o].bind(t):()=>{},f=H_[o].bind(null,t,u);n[o]=f,i[o]=f}})}function pD(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&mD(t,{extension:n,target:t.luma,target2:t})}function mD(t,e){let{extension:n,target:i,target2:o}=e;const u=QS[n];Lr(u);const{meta:f={}}=u,{suffix:l=""}=f,b=t.getExtension(n);for(const w of Object.keys(u)){const C="".concat(w).concat(l);let L=null;w==="meta"||typeof t[w]=="function"||(b&&typeof b[C]=="function"?L=function(){return b[C](...arguments)}:typeof u[w]=="function"&&(L=u[w].bind(i))),L&&(i[w]=L,o[w]=L)}}const U0={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},La=(t,e,n)=>e?t.enable(n):t.disable(n),Mw=(t,e,n)=>t.hint(n,e),os=(t,e,n)=>t.pixelStorei(n,e),gD=(t,e)=>{const n=Yt(t)?36009:36160;return t.bindFramebuffer(n,e)},_D=(t,e)=>t.bindFramebuffer(36008,e);function Gh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const yD={3042:La,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:La,2885:(t,e)=>t.cullFace(e),2929:La,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:La,35723:Mw,36006:gD,2886:(t,e)=>t.frontFace(e),33170:Mw,2849:(t,e)=>t.lineWidth(e),32823:La,32824:"polygonOffset",10752:"polygonOffset",35977:La,32938:"sampleCoverage",32939:"sampleCoverage",3089:La,3088:(t,e)=>t.scissor(...e),2960:La,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:os,3317:os,37440:os,37441:os,37443:os,3330:os,3332:os,3331:os,36010:_D,3314:os,32878:os,3316:os,3315:os,32877:os,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Gh(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Gh(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Gh(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Gh(e)&&e.length===3?[...e,...e]:e;const[n,i,o,u,f,l]=e;t.stencilFuncSeparate(1028,n,i,o),t.stencilFuncSeparate(1029,u,f,l)},stencilOp:(t,e)=>{e=Gh(e)&&e.length===3?[...e,...e]:e;const[n,i,o,u,f,l]=e;t.stencilOpSeparate(1028,n,i,o),t.stencilOpSeparate(1029,u,f,l)},viewport:(t,e)=>t.viewport(...e)};function ni(t,e,n){return e[t]!==void 0?e[t]:n[t]}const vD={blendEquation:(t,e,n)=>t.blendEquationSeparate(ni(32777,e,n),ni(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ni(32969,e,n),ni(32968,e,n),ni(32971,e,n),ni(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ni(32824,e,n),ni(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ni(32938,e,n),ni(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ni(2962,e,n),ni(2967,e,n),ni(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ni(34816,e,n),ni(36003,e,n),ni(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ni(2964,e,n),ni(2965,e,n),ni(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ni(34817,e,n),ni(34818,e,n),ni(34819,e,n))},Lw={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,o)=>t({32773:new Float32Array([e,n,i,o])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,o)=>t({32969:e,32968:n,32971:i,32970:o}),clearColor:(t,e,n,i,o)=>t({3106:new Float32Array([e,n,i,o])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,o)=>t({3107:[e,n,i,o]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,o)=>t({3088:new Int32Array([e,n,i,o])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,o)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:o}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,o)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:o}),viewport:(t,e,n,i,o)=>t({2978:[e,n,i,o]})},vo=(t,e)=>t.isEnabled(e),kw={3042:vo,2884:vo,2929:vo,3024:vo,32823:vo,32926:vo,32928:vo,3089:vo,2960:vo,35977:vo};function eA(t){for(const e in t)return!1;return!0}function xD(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}function Rw(t,e){const n=t[e].bind(t);t[e]=function(){const o=arguments.length<=0?void 0:arguments[0];return o in t.state.cache?t.state.enable?t.state.cache[o]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function bD(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var u=arguments.length,f=new Array(u),l=0;l<u;l++)f[l]=arguments[l];const{valueChanged:b,oldValue:w}=n(t.state._updateCache,...f);return b&&i(...f),w},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function wD(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class TD{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?SD(e):Object.assign({},U0),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Lr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];oa(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const o=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const u in e){Lr(u!==void 0);const f=e[u],l=this.cache[u];xD(f,l)||(n=!0,i=l,o&&!(u in o)&&(o[u]=l),this.cache[u]=f)}return{valueChanged:n,oldValue:i}}}function tA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(Lr(i!==void 0),!t.state){const{polyfillContext:o}=globalThis;o&&o(t),t.state=new TD(t,{copyState:i}),wD(t);for(const u in Lw){const f=Lw[u];bD(t,u,f)}Rw(t,"getParameter"),Rw(t,"isEnabled")}return t.state.enable=n,t}function ED(t){t.state||tA(t,{copyState:!1}),t.state.push()}function Dw(t){Lr(t.state),t.state.pop()}function oa(t,e){if(Lr(ng(t),"setParameters requires a WebGL context"),eA(e))return;const n={};for(const o in e){const u=Number(o),f=yD[o];f&&(typeof f=="string"?n[f]=!0:f(t,e[o],u))}const i=t.state&&t.state.cache;if(i)for(const o in n){const u=vD[o];u(t,e,i)}}function SD(t,e){if(e=e||U0,typeof e=="number"){const o=e,u=kw[o];return u?u(t,o):t.getParameter(o)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const o of n){const u=kw[o];i[o]=u?u(t,Number(o)):t.getParameter(Number(o))}return i}function AD(t){oa(t,U0)}function oo(t,e,n){if(eA(e))return n(t);const{nocatch:i=!0}=e;ED(t),oa(t,e);let o;if(i)o=n(t),Dw(t);else try{o=n(t)}finally{Dw(t)}return o}function bu(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function W_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=bu(t),o=t.drawingBufferWidth,u=t.drawingBufferHeight;return ID(e,i,o,u,n)}function PD(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function ID(t,e,n,i,o){const u=zw(t[0],e,n);let f=Ow(t[1],e,i,o),l=zw(t[0]+1,e,n);const b=l===n-1?l:l-1;l=Ow(t[1]+1,e,i,o);let w;return o?(l=l===0?l:l+1,w=f,f=l):w=l===i-1?l:l-1,{x:u,y:f,width:Math.max(b-u+1,1),height:Math.max(w-f+1,1)}}function zw(t,e,n){return Math.min(Math.round(t*e),n-1)}function Ow(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const V0=ca(),CD=V0&&typeof document<"u",nA={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function iA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lr(V0,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},nA,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let o;const{canvas:u}=t,f=RD({canvas:u,width:e,height:n,onError:i});return o=kD(f,t),o?(o=j0(o,t),DD(o),o):null}function j0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||zD(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},nA,e);const{manageState:n,debug:i}=e;return n&&tA(t,{copyState:!1,log:function(){for(var o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];return Et.log(1,...u)()}}),V0&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Et.level=Math.max(Et.level,1)):Et.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function MD(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),o=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),u=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:o||e,renderer:u||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function LD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=PD(e.useDevicePixels);OD(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function kD(t,e){const{onError:n}=e;let i=null;const o=b=>i=b.statusMessage||i;t.addEventListener("webglcontextcreationerror",o,!1);const{webgl1:u=!0,webgl2:f=!0}=e;let l=null;return f&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),u&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",o,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(f&&!u?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function RD(t){let{canvas:e,width:n=800,height:i=600,onError:o}=t,u;return typeof e=="string"?(CD&&document.readyState==="complete"||o("createGLContext called on canvas '".concat(e,"' before page was loaded")),u=document.getElementById(e)):e?u=e:(u=document.createElement("canvas"),u.id="lumagl-canvas",u.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",u.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(u,document.body.firstChild)),u}function DD(t){const e=Yt(t)?"WebGL2":"WebGL1",n=MD(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",o=t.debug?" debug":"";Et.info(1,"".concat(e).concat(o," context ").concat(i))()}function zD(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function OD(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,o="height"in n?n.height:t.canvas.clientHeight;(!i||!o)&&(Et.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,o=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const u=t.luma.canvasSizeInfo;if(u.clientWidth!==i||u.clientHeight!==o||u.devicePixelRatio!==e){let f=e;const l=Math.floor(i*f),b=Math.floor(o*f);t.canvas.width=l,t.canvas.height=b,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==b)&&(Et.warn("Device pixel ratio clamped")(),f=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/o),t.canvas.width=Math.floor(i*f),t.canvas.height=Math.floor(o*f)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:o,devicePixelRatio:e})}}const hd="8.5.21",FD="set luma.log.level=1 (or higher) to trace rendering";class BD{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new R0({id:e})),this.stats.get(e)}}const Fl=new BD;if(globalThis.luma&&globalThis.luma.VERSION!==hd)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(hd));globalThis.luma||(ca()&&Et.log(1,"luma.gl ".concat(hd," - ").concat(FD))(),globalThis.luma=globalThis.luma||{VERSION:hd,version:hd,log:Et,stats:Fl,globals:{modules:{},nodeIO:{}}});function ND(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function UD(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function lt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function q_(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return lt(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Ja(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Z_={};function nl(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Z_[t]=Z_[t]||1;const e=Z_[t]++;return"".concat(t,"-").concat(e)}function Fw(t){return lt(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function wu(t){let e=!0;for(const n in t){e=!1;break}return e}function rA(t,e,n,i){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),u=Object.getPrototypeOf(t);i.forEach(f=>{u.methodName||(u[f]=()=>{throw Et.removed("Calling removed method ".concat(e,".").concat(f,": "),o)(),new Error(f)})})}const Uc="Resource subclass must define virtual methods";let ua=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ig(e);const{id:i,userData:o={}}=n;this.gl=e,this.gl2=e,this.id=i||nl(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=q_(this.gl,e),lt(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const u=Yt(this.gl);if(!((!("webgl2"in o)||u)&&(!("extension"in o)||this.gl.getExtension(o.extension)))){const l=o.webgl1,b="webgl2"in o?o.webgl2:o.webgl1;return u?b:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,o=this.constructor.PARAMETERS||{},u=Yt(this.gl),f={},l=n||Object.keys(o);for(const b of l){const w=o[b];if(w&&(!("webgl2"in w)||u)&&(!("extension"in w)||this.gl.getExtension(w.extension))){const L=i?Ja(this.gl,b):b;f[L]=this.getParameter(b,e),i&&w.type==="GLenum"&&(f[L]=Ja(this.gl,f[L]))}}return f}setParameter(e,n){e=q_(this.gl,e),lt(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const u=Yt(this.gl);if(!((!("webgl2"in o)||u)&&(!("extension"in o)||this.gl.getExtension(o.extension))))throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(n=q_(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return rA(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Uc)}_deleteHandle(){throw new Error(Uc)}_bindHandle(e){throw new Error(Uc)}_getOptsFromHandle(){throw new Error(Uc)}_getParameter(e,n){throw new Error(Uc)}_setParameter(e,n){throw new Error(Uc)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Fl.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Fl.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const o=Fl.get("Memory Usage".concat(i));o.get("GPU Memory").addCount(e),o.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Fl.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const VD="Failed to deduce GL constant from typed array";function yv(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(VD)}}function Ld(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function jD(t){let{data:e,width:n,height:i,bytesPerPixel:o=4,temp:u}=t;const f=n*o;u=u||new Uint8Array(f);for(let l=0;l<i/2;++l){const b=l*f,w=(i-l-1)*f;u.set(e.subarray(b,b+f)),e.copyWithin(b,w,w+f),e.set(u,w)}}function GD(t){let{data:e,width:n,height:i}=t;const o=Math.round(n/2),u=Math.round(i/2),f=new Uint8Array(o*u*4);for(let l=0;l<u;l++)for(let b=0;b<o;b++)for(let w=0;w<4;w++)f[(l*o+b)*4+w]=e[(l*2*n+b*2)*4+w];return{data:f,width:o,height:u}}function vv(t,e,n){const{removedProps:i={},deprecatedProps:o={},replacedProps:u={}}=n;for(const l in i)if(l in e){const w=i[l]?"".concat(t,".").concat(i[l]):"N/A";Et.removed("".concat(t,".").concat(l),w)()}for(const l in o)if(l in e){const b=o[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(b))()}let f=null;for(const l in u)if(l in e){const b=u[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(b))(),f=f||Object.assign({},e),f[b]=e[l],delete f[l]}return f||e}const $D={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},HD={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class hs{static getBytesPerElement(e){return Ld(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return lt(e.size),Ld(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new hs($D,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(o=>this._assign(o)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return hs.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return hs.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=vv("Accessor",e,HD),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Bw=10,sA={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},WD={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:sA},qD={removedProps:sA};class En extends ua{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/hs.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/hs.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=vv("Buffer",e,WD),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=vv("Buffer",e,qD),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new hs(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:o=0}=e,u=e.byteLength||e.length;lt(n);const f=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(f,this.handle),o!==0||u!==void 0?(fr(this.gl),this.gl.bufferSubData(this.target,i,n,o,u)):this.gl.bufferSubData(f,i,n),this.gl.bindBuffer(f,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:o=0,size:u}=e;const{gl:f}=this;return fr(f),f.bindBuffer(36662,n.handle),f.bindBuffer(36663,this.handle),f.copyBufferSubData(36662,36663,i,o,u),f.bindBuffer(36662,null),f.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:o=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};fr(this.gl);const u=Ld(this.accessor.type||5126,{clamped:!1}),f=this._getAvailableElementCount(n),l=i;let b,w;e?(w=e.length,b=w-l):(b=Math.min(f,o||f),w=l+b);const C=Math.min(f,b);return o=o||C,lt(o<=C),e=e||new u(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,o),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?o!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,o):(lt(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Bw,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;lt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const o=this._getTarget();this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.usage),this.gl.bufferSubData(o,n,e),this.gl.bindBuffer(o,null),this.debugData=e.slice(0,Bw),this.bytesUsed=i,this._trackAllocatedMemory(i);const u=yv(e);return lt(u),this.setAccessor(new hs(this.accessor,{type:u})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;lt(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const o=this._getTarget();return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,n),this.gl.bindBuffer(o,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Ld(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new hs(this.accessor,{type:yv(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Et.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Et.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Et.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Et.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new hs(this.accessor,e),this}}const G0={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},oA={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},aA={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function ZD(t,e){const n=G0[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Yt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function XD(t,e){const n=G0[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const YD=[9729,9728],Nw=globalThis.WebGLBuffer||function(){};class ql extends ua{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:o}=n;let u=!0;return i&&(u=u&&ZD(e,i),u=u&&(!o||XD(e,i))),u}constructor(e,n){const{id:i=nl("texture"),handle:o,target:u}=n;super(e,{id:i,handle:o}),this.target=u,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(G=>this.initialize(Object.assign({},e,{pixels:G,data:G}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:o=null,format:u=6408,border:f=0,recreate:l=!1,parameters:b={},pixelStore:w={},textureUnit:C=void 0}=e;n||(n=o);let{width:L,height:k,dataFormat:H,type:K,compressed:re=!1,mipmaps:ce=!0}=e;const{depth:W=0}=e;return{width:L,height:k,compressed:re,dataFormat:H,type:K}=this._deduceParameters({format:u,type:K,dataFormat:H,compressed:re,data:n,width:L,height:k}),this.width=L,this.height=k,this.depth=W,this.format=u,this.type=K,this.dataFormat=H,this.border=f,this.textureUnit=C,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ce&&this._isNPOT()&&(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ce=!1,this._updateForNPOT(b)),this.mipmaps=ce,this.setImageData({data:n,width:L,height:k,depth:W,format:u,type:K,dataFormat:H,border:f,mipmaps:ce,parameters:w,compressed:re}),ce&&this.generateMipmap(),this.setParameters(b),l&&(this.data=n),i&&(this._video={video:n,parameters:b,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:o=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:o}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),oo(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:o=0,format:u=this.format,border:f=this.border,offset:l=0,parameters:b={}}=e;let{data:w=null,type:C=this.type,width:L=this.width,height:k=this.height,dataFormat:H=this.dataFormat,compressed:K=!1}=e;w||(w=i),{type:C,dataFormat:H,compressed:K,width:L,height:k}=this._deduceParameters({format:u,type:C,dataFormat:H,compressed:K,data:w,width:L,height:k});const{gl:re}=this;re.bindTexture(this.target,this.handle);let ce=null;({data:w,dataType:ce}=this._getDataType({data:w,compressed:K}));let W,G=0;if(oo(this.gl,b,()=>{switch(ce){case"null":re.texImage2D(n,o,u,L,k,f,H,C,w);break;case"typed-array":re.texImage2D(n,o,u,L,k,f,H,C,w,l);break;case"buffer":W=fr(re),W.bindBuffer(35052,w.handle||w),W.texImage2D(n,o,u,L,k,f,H,C,l),W.bindBuffer(35052,null);break;case"browser-object":Yt(re)?re.texImage2D(n,o,u,L,k,f,H,C,w):re.texImage2D(n,o,u,H,C,w);break;case"compressed":for(const[Z,fe]of w.entries())re.compressedTexImage2D(n,Z,fe.format,fe.width,fe.height,f,fe.data),G+=fe.levelSize;break;default:lt(!1,"Unknown image data type")}}),ce==="compressed")this._trackAllocatedMemory(G,"Texture");else if(w&&w.byteLength)this._trackAllocatedMemory(w.byteLength,"Texture");else{const Z=oA[this.dataFormat]||4,fe=aA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*Z*fe,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:o=null,x:u=0,y:f=0,width:l=this.width,height:b=this.height,level:w=0,format:C=this.format,type:L=this.type,dataFormat:k=this.dataFormat,compressed:H=!1,offset:K=0,border:re=this.border,parameters:ce={}}=e;if({type:L,dataFormat:k,compressed:H,width:l,height:b}=this._deduceParameters({format:C,type:L,dataFormat:k,compressed:H,data:o,width:l,height:b}),lt(this.depth===0,"texSubImage not supported for 3D textures"),o||(o=i),o&&o.data){const W=o;o=W.data,l=W.shape[0],b=W.shape[1]}o instanceof En&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),oo(this.gl,ce,()=>{if(H)this.gl.compressedTexSubImage2D(n,w,u,f,l,b,C,o);else if(o===null)this.gl.texSubImage2D(n,w,u,f,l,b,k,L,null);else if(ArrayBuffer.isView(o))this.gl.texSubImage2D(n,w,u,f,l,b,k,L,o,K);else if(o instanceof Nw){const W=fr(this.gl);W.bindBuffer(35052,o),W.texSubImage2D(n,w,u,f,l,b,k,L,K),W.bindBuffer(35052,null)}else Yt(this.gl)?fr(this.gl).texSubImage2D(n,w,u,f,l,b,k,L,o):this.gl.texSubImage2D(n,w,u,f,k,L,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Et.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof En?{data:n.handle,dataType:"buffer"}:n instanceof Nw?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:o,height:u,dataFormat:f,type:l,compressed:b}=e;const w=G0[n];return f=f||w&&w.dataFormat,l=l||w&&w.types[0],b=b||w&&w.compressed,{width:o,height:u}=this._deduceImageSize(i,o,u),{dataFormat:f,type:l,compressed:b,width:o,height:u,format:n,data:i}}_deduceImageSize(e,n,i){let o;return typeof ImageData<"u"&&e instanceof ImageData?o={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?o={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?o={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?o={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?o={width:e.videoWidth,height:e.videoHeight}:e?o={width:n,height:i}:o={width:n>=0?n:1,height:i>=0?i:1},lt(o,"Could not deduced texture size"),lt(n===void 0||o.width===n,"Deduced texture width does not match supplied width"),lt(i===void 0||o.height===i,"Deduced texture height does not match supplied height"),o}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:lt(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Yt(this.gl)||!this.width||!this.height?!1:!Fw(this.width)||!Fw(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:YD.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let KD="";function JD(t,e){return lt(typeof t=="string"),t=KD+t,new Promise((n,i)=>{try{const o=new Image;o.onload=()=>n(o),o.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),o.crossOrigin=e&&e.crossOrigin||"anonymous",o.src=t}catch(o){i(o)}})}class gs extends ql{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return ql.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ig(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:JD(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const xv=[34069,34070,34071,34072,34073,34074];class lA extends ql{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ig(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:o=0,y:u=0,mipmapLevel:f=0}=e;return this._subImage({target:n,data:i,x:o,y:u,mipmapLevel:f})}async setCubeMapImageData(e){let{width:n,height:i,pixels:o,data:u,border:f=0,format:l=6408,type:b=5121}=e;const{gl:w}=this,C=o||u,L=await Promise.all(xv.map(k=>{const H=C[k];return Promise.all(Array.isArray(H)?H:[H])}));this.bind(),xv.forEach((k,H)=>{L[H].length>1&&this.opts.mipmaps!==!1&&Et.warn("".concat(this.id," has mipmap and multiple LODs."))(),L[H].forEach((K,re)=>{n&&i?w.texImage2D(k,re,l,n,i,f,l,b,K):w.texImage2D(k,re,l,l,b,K)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:o,pixels:u,data:f,border:l=0,format:b=6408,type:w=5121}=e,{gl:C}=this,L=u||f;return this.bind(),L instanceof Promise?L.then(k=>this.setImageDataForFace(Object.assign({},e,{face:n,data:k,pixels:k}))):this.width||this.height?C.texImage2D(n,0,b,i,o,l,b,w,L):C.texImage2D(n,0,b,b,w,L),this}}lA.FACES=xv;class QD extends ql{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};fr(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:o,height:u,depth:f=1,border:l=0,format:b,type:w=5121,offset:C=0,data:L,parameters:k={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),oo(this.gl,k,()=>{ArrayBuffer.isView(L)&&this.gl.texImage3D(this.target,n,i,o,u,f,l,b,w,L),L instanceof En&&(this.gl.bindBuffer(35052,L.handle),this.gl.texImage3D(this.target,n,i,o,u,f,l,b,w,C))}),L&&L.byteLength)this._trackAllocatedMemory(L.byteLength,"Texture");else{const H=oA[this.dataFormat]||4,K=aA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*H*K,"Texture")}return this.loaded=!0,this}}const Il="EXT_color_buffer_float",Uw={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Il,bpp:2},33327:{gl2:Il,bpp:4},34842:{gl2:Il,bpp:8},33326:{gl2:Il,bpp:4},33328:{gl2:Il,bpp:8},34836:{gl2:Il,bpp:16},35898:{gl2:Il,bpp:4}};function ez(t,e,n){const i=n[e];if(!i)return!1;const o=Yt(t)&&i.gl2||i.gl1;return typeof o=="string"?t.getExtension(o):o}class iu extends ua{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||ez(e,n,Uw)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:o=1,samples:u=0}=e;return lt(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),u!==0&&Yt(this.gl)?this.gl.renderbufferStorageMultisample(36161,u,n,i,o):this.gl.renderbufferStorage(36161,n,i,o),this.format=n,this.width=i,this.height=o,this.samples=u,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Uw[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const tz=256,nz=1024,iz=16384,Vw=6144,jw=6145,Gw=6146,$w=34041,cA="clear: bad arguments";function $0(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:o=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u={};e&&(u.framebuffer=e);let f=0;n&&(f|=iz,n!==!0&&(u.clearColor=n)),i&&(f|=tz,i!==!0&&(u.clearDepth=i)),o&&(f|=nz,i!==!0&&(u.clearStencil=i)),lt(f!==0,cA),oo(t,u,()=>{t.clear(f)})}function rz(t){let{framebuffer:e=null,buffer:n=Vw,drawBuffer:i=0,value:o=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};fr(t),oo(t,{framebuffer:e},()=>{switch(n){case Vw:switch(o.constructor){case Int32Array:t.clearBufferiv(n,i,o);break;case Uint32Array:t.clearBufferuiv(n,i,o);break;case Float32Array:default:t.clearBufferfv(n,i,o)}break;case jw:t.clearBufferfv(jw,0,[o]);break;case Gw:t.clearBufferiv(Gw,0,[o]);break;case $w:const[u,f]=o;t.clearBufferfi($w,0,u,f);break;default:lt(!1,cA)}})}function sz(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return lt(!1),0}}function rg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:o=6408}=e;let{sourceAttachment:u=36064,target:f=null,sourceWidth:l,sourceHeight:b,sourceType:w}=e;const{framebuffer:C,deleteFramebuffer:L}=uA(t);lt(C);const{gl:k,handle:H,attachments:K}=C;l=l||C.width,b=b||C.height,u===36064&&H===null&&(u=1028),lt(K[u]),w=w||K[u].type,f=az(f,w,o,l,b),w=w||yv(f);const re=k.bindFramebuffer(36160,H);return k.readPixels(n,i,l,b,o,w,f),k.bindFramebuffer(36160,re||null),L&&C.delete(),f}function Hw(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=rg(t,{sourceAttachment:e}),{width:o,height:u}=t;for(;u>n;)({data:i,width:o,height:u}=GD({data:i,width:o,height:u}));jD({data:i,width:o,height:u});const f=document.createElement("canvas");f.width=o,f.height=u;const l=f.getContext("2d"),b=l.createImageData(o,u);return b.data.set(i),l.putImageData(b,0,0),f.toDataURL()}function oz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:o=0,targetMipmaplevel:u=0,targetInternalFormat:f=6408}=n;let{targetX:l,targetY:b,targetZ:w,width:C,height:L}=n;const{framebuffer:k,deleteFramebuffer:H}=uA(t);lt(k);const{gl:K,handle:re}=k,ce=typeof l<"u"||typeof b<"u"||typeof w<"u";l=l||0,b=b||0,w=w||0;const W=K.bindFramebuffer(36160,re);lt(e);let G=null;if(e instanceof ql&&(G=e,C=Number.isFinite(C)?C:G.width,L=Number.isFinite(L)?L:G.height,G.bind(0),e=G.target),!ce)K.copyTexImage2D(e,u,f,i,o,C,L,0);else switch(e){case 3553:case 34067:K.copyTexSubImage2D(e,u,l,b,i,o,C,L);break;case 35866:case 32879:fr(K).copyTexSubImage3D(e,u,l,b,w,i,o,C,L);break}return G&&G.unbind(),K.bindFramebuffer(36160,W||null),H&&k.delete(),G}function uA(t){return t instanceof Pi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:_z(t),deleteFramebuffer:!0}}function az(t,e,n,i,o){if(t)return t;e=e||5121;const u=Ld(e,{clamped:!1}),f=sz(n);return new u(i*o*f)}const Hn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function lz(t){const e=new gs(t,{format:6408,type:5126,dataFormat:6408}),n=new Pi(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const hA={[Hn.WEBGL2]:[!1,!0],[Hn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Hn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Hn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Hn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Hn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Hn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Hn.FLOAT_BLEND]:["EXT_float_blend"],[Hn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Hn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Hn.TEXTURE_FLOAT]:["OES_texture_float",!0],[Hn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Hn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Hn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Hn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Hn.COLOR_ATTACHMENT_RGBA32F]:[lz,"EXT_color_buffer_float"],[Hn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Hn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Hn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Hn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Hn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Hn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},cz=2;function uz(t,e){return dA(t,e)}function dA(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>fA(t,n))}function hz(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in hA)t.luma.caps[e]===void 0&&(t.luma.caps[e]=fA(t,e));return t.luma.caps}function fA(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=dz(t,e)),t.luma.caps[e]||Et.log(cz,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function dz(t,e){const n=hA[e];lt(n,e);let i;const o=Yt(t)&&n[1]||n[0];if(typeof o=="function")i=o(t);else if(Array.isArray(o)){i=!0;for(const u of o)i=i&&!!t.getExtension(u)}else typeof o=="string"?i=!!t.getExtension(o):typeof o=="boolean"?i=o:lt(!1);return i}const Ww="Multiple render targets not supported";class Pi extends ua{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:o}=n;let u=!0;return i&&(u=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),o&&(u=u&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),u}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Pi(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=fr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=fr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:o=null,color:u=!0,depth:f=!0,stencil:l=!1,check:b=!0,readBuffer:w=void 0,drawBuffers:C=void 0}=e;if(lt(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,o)for(const L in o){const k=o[L];(Array.isArray(k)?k[0]:k).resize({width:n,height:i})}else o=this._createDefaultAttachments(u,f,l,n,i);this.update({clearAttachments:!0,attachments:o,readBuffer:w,drawBuffers:C}),o&&b&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:o,clearAttachments:u=!1,resizeAttachments:f=!0}=e;this.attach(n,{clearAttachments:u,resizeAttachments:f});const{gl:l}=this,b=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),o&&this._setDrawBuffers(o),l.bindFramebuffer(36160,b||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return lt(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Et.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const o in this.attachments)this.attachments[o].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};n&&Object.keys(this.attachments).forEach(f=>{o[f]=null}),Object.assign(o,e);const u=this.gl.bindFramebuffer(36160,this.handle);for(const f in o){lt(f!==void 0,"Misspelled framebuffer binding point?");const l=Number(f),b=o[l];let w=b;if(!w)this._unattach(l);else if(w instanceof iu)this._attachRenderbuffer({attachment:l,renderbuffer:w});else if(Array.isArray(b)){const[C,L=0,k=0]=b;w=C,this._attachTexture({attachment:l,texture:C,layer:L,level:k})}else this._attachTexture({attachment:l,texture:w,layer:0,level:0});i&&w&&w.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(f=>!this.attachments[f]).forEach(f=>{delete this.attachments[f]})}checkStatus(){const{gl:e}=this,n=this.getStatus();if(n!==36053)throw new Error(pz(n));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:o,drawBuffers:u=[]}=e,f=this.gl.bindFramebuffer(36160,this.handle);return(n||i||o)&&$0(this.gl,{color:n,depth:i,stencil:o}),u.forEach((l,b)=>{rz(this.gl,{drawBuffer:b,value:l})}),this.gl.bindFramebuffer(36160,f||null),this}readPixels(){return Et.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Et.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Et.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Et.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Et.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Et.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:o=0,width:u,height:f}=e;const l=fr(this.gl),b=l.bindFramebuffer(36008,this.handle);return i===0&&o===0&&u===void 0&&f===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,o,u,f),l.bindFramebuffer(36008,b),this}getAttachmentParameter(e,n,i){let o=this._getAttachmentParameterFallback(n);return o===null&&(this.gl.bindFramebuffer(36160,this.handle),o=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&o>1e3&&(o=Ja(this.gl,o)),o}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const o={};for(const u of i){const f=n?Ja(this.gl,u):u;o[f]=this.getAttachmentParameter(e,u,n)}return o}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const o of n){const u=Number(o),f=e?Ja(this.gl,u):u;i[f]=this.getAttachmentParameters(u,e)}return i}show(){return typeof window<"u"&&window.open(Hw(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Et.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=Hw(this,{targetMaxHeight:100});return Et.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,o,u){let f=null;return e&&(f=f||{},f[36064]=new gs(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:o,height:u,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(f[36064])),n&&i?(f=f||{},f[33306]=new iu(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:o,height:111}),this.ownResources.push(f[33306])):n?(f=f||{},f[36096]=new iu(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:o,height:u}),this.ownResources.push(f[36096])):i&&lt(!1),f}_unattach(e){const n=this.attachments[e];n&&(n instanceof iu?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:o}=this;o.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:o,level:u}=e;const{gl:f}=this;switch(f.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:fr(f).framebufferTextureLayer(36160,n,i.target,u,o);break;case 34067:const b=fz(o);f.framebufferTexture2D(36160,n,b,i.handle,u);break;case 3553:f.framebufferTexture2D(36160,n,3553,i.handle,u);break;default:lt(!1,"Illegal texture type")}f.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=jR(this.gl);n?n.readBuffer(e):lt(e===36064||e===1029,Ww),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=fr(n);if(i)i.drawBuffers(e);else{const o=n.getExtension("WEBGL_draw_buffers");o?o.drawBuffersWEBGL(e):lt(e.length===1&&(e[0]===36064||e[0]===1029),Ww)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=hz(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function fz(t){return t<34069?t+34069:t}function pz(t){return(Pi.STATUS||{})[t]||"Framebuffer error ".concat(t)}const mz=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Pi.ATTACHMENT_PARAMETERS=mz;function gz(t,e){lt(t instanceof gs||t instanceof lA||t instanceof QD);const n=t.constructor,{gl:i,width:o,height:u,format:f,type:l,dataFormat:b,border:w,mipmaps:C}=t,L=Object.assign({width:o,height:u,format:f,type:l,dataFormat:b,border:w,mipmaps:C},e);return new n(i,L)}function _z(t,e){const{gl:n,width:i,height:o,id:u}=t;return new Pi(n,Object.assign({},e,{id:"framebuffer-for-".concat(u),width:i,height:o,attachments:{36064:t}}))}function Zp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const yz=35632,vz=35633;function xz(t){switch(t){case yz:return"fragment";case vz:return"vertex";default:return"unknown type"}}function bz(t,e,n,i){const o=t.split(/\r?\n/),u={},f={},l=i||Zp(e)||"(unnamed)",b="".concat(xz(n)," shader ").concat(l);for(let C=0;C<o.length;C++){const L=o[C];if(L.length<=1)continue;const k=L.split(":"),H=k[0],K=parseInt(k[2],10);if(isNaN(K))throw new Error("GLSL compilation error in ".concat(b,": ").concat(t));H!=="WARNING"?u[K]=L:f[K]=L}const w=wz(e);return{shaderName:b,errors:qw(u,w),warnings:qw(f,w)}}function qw(t,e){let n="";for(let i=0;i<e.length;i++){const o=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(o,`
`),t[i+1])){const u=t[i+1],f=u.split(":",3),l=f[0],b=parseInt(f[1],10)||0,w=u.substring(f.join(":").length+1).trim();n+=pA("^^^ ".concat(l,": ").concat(w,`

`),b)}}return n}function wz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),o=String(i.length+e-1).length;return i.map((u,f)=>{const l=String(f+e),b=l.length;return pA(l,o-b)+n+u})}function pA(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function mA(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const Tz="Shader: GLSL source code must be a JavaScript string";class kd extends ua{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return lt(!1),"unknown"}}constructor(e,n){ig(e),lt(typeof n.source=="string",Tz);const i=Zp(n.source,null)||n.id||nl("unnamed ".concat(kd.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=Zp(n,null);i&&(this.id=nl(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(kd.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Zp(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:o,errors:u,warnings:f}=bz(i,this.source,this.shaderType,this.id);throw Et.error("GLSL compilation errors in ".concat(o,`
`).concat(u))(),Et.warn("GLSL compilation warnings in ".concat(o,`
`).concat(f))(),new Error("GLSL compilation errors in ".concat(o))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class X_ extends kd{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Y_ extends kd{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Ez={5126:Fn.bind(null,"uniform1fv",as,1,ur),35664:Fn.bind(null,"uniform2fv",as,2,ur),35665:Fn.bind(null,"uniform3fv",as,3,ur),35666:Fn.bind(null,"uniform4fv",as,4,ur),5124:Fn.bind(null,"uniform1iv",ka,1,ur),35667:Fn.bind(null,"uniform2iv",ka,2,ur),35668:Fn.bind(null,"uniform3iv",ka,3,ur),35669:Fn.bind(null,"uniform4iv",ka,4,ur),35670:Fn.bind(null,"uniform1iv",ka,1,ur),35671:Fn.bind(null,"uniform2iv",ka,2,ur),35672:Fn.bind(null,"uniform3iv",ka,3,ur),35673:Fn.bind(null,"uniform4iv",ka,4,ur),35674:Fn.bind(null,"uniformMatrix2fv",as,4,Zo),35675:Fn.bind(null,"uniformMatrix3fv",as,9,Zo),35676:Fn.bind(null,"uniformMatrix4fv",as,16,Zo),35678:Wi,35680:Wi,5125:Fn.bind(null,"uniform1uiv",wp,1,ur),36294:Fn.bind(null,"uniform2uiv",wp,2,ur),36295:Fn.bind(null,"uniform3uiv",wp,3,ur),36296:Fn.bind(null,"uniform4uiv",wp,4,ur),35685:Fn.bind(null,"uniformMatrix2x3fv",as,6,Zo),35686:Fn.bind(null,"uniformMatrix2x4fv",as,8,Zo),35687:Fn.bind(null,"uniformMatrix3x2fv",as,6,Zo),35688:Fn.bind(null,"uniformMatrix3x4fv",as,12,Zo),35689:Fn.bind(null,"uniformMatrix4x2fv",as,8,Zo),35690:Fn.bind(null,"uniformMatrix4x3fv",as,12,Zo),35678:Wi,35680:Wi,35679:Wi,35682:Wi,36289:Wi,36292:Wi,36293:Wi,36298:Wi,36299:Wi,36300:Wi,36303:Wi,36306:Wi,36307:Wi,36308:Wi,36311:Wi},Sz={},Az={},Pz={},Zw=[0];function H0(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Zw[0]=t,t=Zw);const o=t.length;if(o%e&&Et.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let u=i[o];u||(u=new n(o),i[o]=u);for(let f=0;f<o;f++)u[f]=t[f];return u}function as(t,e){return H0(t,e,Float32Array,Sz)}function ka(t,e){return H0(t,e,Int32Array,Az)}function wp(t,e){return H0(t,e,Uint32Array,Pz)}function Xw(t,e,n){const i=Ez[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function Iz(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function Cz(t,e,n){for(const i in t){const o=t[i];if((!n||!!n[i])&&!Mz(o))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),o),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function Mz(t){return Array.isArray(t)||ArrayBuffer.isView(t)?kz(t):isFinite(t)||t===!0||t===!1||t instanceof ql||t instanceof iu?!0:t instanceof Pi?!!t.texture:!1}function Lz(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let o=0,u=n.length;o<u;++o)i[o]=n[o]}else t[e]=n.slice();else t[e]=n}function kz(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Wi(){let t=null;return(e,n,i)=>{const o=t!==i;return o&&(e.uniform1i(n,i),t=i),o}}function Fn(t,e,n,i){let o=null,u=null;return(f,l,b)=>{const w=e(b,n),C=w.length;let L=!1;if(o===null)o=new Float32Array(C),u=C,L=!0;else{lt(u===C,"Uniform length cannot change.");for(let k=0;k<C;++k)if(w[k]!==o[k]){L=!0;break}}return L&&(i(f,t,l,w),o.set(w)),L}}function ur(t,e,n,i){t[e](n,i)}function Zo(t,e,n,i){t[e](n,!1,i)}const Rz=5120,Dz=5121,zz=5122,Oz=5123,Yw=0,Tp=1,Fz=2,Bz=3,Ep=4,Nz=5,Uz=6,Ei=5126,Vz=35664,jz=35665,Gz=35666,$h=5124,$z=35667,Hz=35668,Wz=35669,Hh=5125,qz=36294,Zz=36295,Xz=36296,Yz=35670,Kz=35671,Jz=35672,Qz=35673,eO=35674,tO=35675,nO=35676,iO=35685,rO=35686,sO=35687,oO=35688,aO=35689,lO=35690,bv={[Ei]:[Ei,1,"float"],[Vz]:[Ei,2,"vec2"],[jz]:[Ei,3,"vec3"],[Gz]:[Ei,4,"vec4"],[$h]:[$h,1,"int"],[$z]:[$h,2,"ivec2"],[Hz]:[$h,3,"ivec3"],[Wz]:[$h,4,"ivec4"],[Hh]:[Hh,1,"uint"],[qz]:[Hh,2,"uvec2"],[Zz]:[Hh,3,"uvec3"],[Xz]:[Hh,4,"uvec4"],[Yz]:[Ei,1,"bool"],[Kz]:[Ei,2,"bvec2"],[Jz]:[Ei,3,"bvec3"],[Qz]:[Ei,4,"bvec4"],[eO]:[Ei,8,"mat2"],[iO]:[Ei,8,"mat2x3"],[rO]:[Ei,8,"mat2x4"],[tO]:[Ei,12,"mat3"],[sO]:[Ei,12,"mat3x2"],[oO]:[Ei,12,"mat3x4"],[nO]:[Ei,16,"mat4"],[aO]:[Ei,16,"mat4x2"],[lO]:[Ei,16,"mat4x3"]};function cO(t){switch(t){case Yw:return Yw;case Tp:return Tp;case Bz:return Tp;case Fz:return Tp;case Ep:return Ep;case Nz:return Ep;case Uz:return Ep;default:return lt(!1),0}}function Kw(t){const e=bv[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function gA(t,e){switch(t){case Rz:case Dz:case zz:case Oz:t=Ei;break}for(const n in bv){const[i,o,u]=bv[n];if(i===t&&o===e)return{glType:n,name:u}}return null}class uO{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let o=0;o<i;o++){const{name:u,type:f,size:l}=n.getActiveAttrib(e.handle,o),b=n.getAttribLocation(e.handle,u);b>=0&&this._addAttribute(b,u,f,l)}this.attributeInfos.sort((o,u)=>o.location-u.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Yt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let o=0;o<i;o++){const{name:u,type:f,size:l}=n.getTransformFeedbackVarying(e.handle,o);this._addVarying(o,u,f,l)}this.varyingInfos.sort((o,u)=>o.location-u.location)}_addAttribute(e,n,i,o){const{type:u,components:f}=Kw(i),l={type:u,size:o*f};this._inferProperties(e,n,l);const b={location:e,name:n,accessor:new hs(l)};this.attributeInfos.push(b),this.attributeInfosByLocation[e]=b,this.attributeInfosByName[b.name]=b}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,o){const{type:u,components:f}=Kw(i),l=new hs({type:u,size:o*f}),b={location:e,name:n,accessor:l};this.varyingInfos.push(b),this.varyingInfosByName[b.name]=b}}const Jw=4,hO=35981,dO=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class _A extends ua{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",dO),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:o,varyings:u,bufferMode:f=hO}=e;return this.hash=n||"",this.vs=typeof i=="string"?new X_(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof o=="string"?new Y_(this.gl,{id:"".concat(e.id,"-fs"),source:o}):o,lt(this.vs instanceof X_),lt(this.fs instanceof Y_),this.uniforms={},this._textureUniforms={},u&&u.length>0&&(fr(this.gl),this.varyings=u,this.gl2.transformFeedbackVaryings(this.handle,u,f)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new uO(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:o,offset:u=0,start:f,end:l,isIndexed:b=!1,indexType:w=5123,instanceCount:C=0,isInstanced:L=C>0,vertexArray:k=null,transformFeedback:H,framebuffer:K,parameters:re={},uniforms:ce,samplers:W}=e;if((ce||W)&&(Et.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ce||{})),Et.priority>=n){const G=K?K.id:"default",Z="mode=".concat(Ja(this.gl,i)," verts=").concat(o," ")+"instances=".concat(C," indexType=").concat(Ja(this.gl,w)," ")+"isInstanced=".concat(L," isIndexed=").concat(b," ")+"Framebuffer=".concat(G);Et.log(n,Z)()}return lt(k),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||o===0||L&&C===0?!1:(k.bindForDraw(o,C,()=>{if(K!==void 0&&(re=Object.assign({},re,{framebuffer:K})),H){const G=cO(i);H.begin(G)}this._bindTextures(),oo(this.gl,re,()=>{b&&L?this.gl2.drawElementsInstanced(i,o,w,u,C):b&&Yt(this.gl)&&!isNaN(f)&&!isNaN(l)?this.gl2.drawRangeElements(i,f,l,o,w,u):b?this.gl.drawElements(i,o,w,u):L?this.gl2.drawArraysInstanced(i,u,o,C):this.gl.drawArrays(i,u,o)}),H&&H.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Et.priority>=2&&Cz(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],o=this._uniformSetters[n];if(o){let u=i,f=!1;if(u instanceof Pi&&(u=u.texture),u instanceof ql)if(f=this.uniforms[n]!==i,f){o.textureIndex===void 0&&(o.textureIndex=this._textureIndexCounter++);const l=u,{textureIndex:b}=o;l.bind(b),u=b,this._textureUniforms[n]=l}else u=o.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(o(u)||f)&&Lz(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const o of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new X_({handle:o});break;case 35632:i.fs=new Y_({handle:o});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=nl(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Et.time(Jw,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Et.timeEnd(Jw,"linkProgram for ".concat(this._getName()))(),e.debug||Et.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:o}=Iz(i.name);let u=e.getUniformLocation(this.handle,o);if(this._uniformSetters[o]=Xw(e,u,i),i.size>1)for(let f=0;f<i.size;f++)u=e.getUniformLocation(this.handle,"".concat(o,"[").concat(f,"]")),this._uniformSetters["".concat(o,"[").concat(f,"]")]=Xw(e,u,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const fO=34918,pO=34919,mO=35007,gO=36795,_O=35976,yO=35887,vO=36202;class Im extends ua{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Yt(e),o=dA(e,Hn.TIMER_QUERY);let u=i||o;for(const f of n)switch(f){case"queries":u=u&&i;break;case"timers":u=u&&o;break;default:lt(!1)}return u}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(mO)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?vO:yO)}beginTransformFeedbackQuery(){return this.begin(_O)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,pO);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(gO)}getResult(){return this.gl2.getQueryParameter(this.handle,fO)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,o)=>{const u=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(u)};requestAnimationFrame(u)}),this._pollingPromise}_createHandle(){return Im.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class yA extends ua{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};fr(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,wu(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:o,byteSize:u,byteOffset:f}=this._getBufferParams(n);return i<0?(this.unused[e]=o,Et.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,o,f,u),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,o;return e instanceof En?o=e:(o=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||o.byteLength-n),{buffer:o,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:o}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,o,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const u=n&&n.handle;return!u||o===void 0?this.gl.bindBufferBase(35982,e,u):this.gl.bindBufferRange(35982,e,u,i,o),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Sp=null;function xO(t){return(!Sp||Sp.byteLength<t)&&(Sp=new ArrayBuffer(t)),Sp}function bO(t,e){const n=xO(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function wO(t){let{target:e,source:n,start:i=0,count:o=1}=t;const u=n.length,f=o*u;let l=0;for(let b=i;l<u;l++)e[b++]=n[l];for(;l<f;)l<f-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+f-l),l=f);return e}const TO="elements must be GL.ELEMENT_ARRAY_BUFFER";class ls extends ua{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Yt(e)||BS()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new ls(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return ls.MAX_ATTRIBUTES=ls.MAX_ATTRIBUTES||e.getParameter(34921),ls.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:ls._setConstantFloatArray(e,n,i);break;case Int32Array:ls._setConstantIntArray(e,n,i);break;case Uint32Array:ls._setConstantUintArray(e,n,i);break;default:lt(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return ls.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return lt(!e||e.target===34963,TO),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:o,type:u,stride:f,offset:l,normalized:b,integer:w,divisor:C}=i,{gl:L,gl2:k}=this;return e=Number(e),this.bind(()=>{L.bindBuffer(34962,n.handle),w?(lt(Yt(L)),k.vertexAttribIPointer(e,o,u,f,l)):L.vertexAttribPointer(e,o,u,b,f,l),L.enableVertexAttribArray(e),k.vertexAttribDivisor(e,C||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!ls.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),o=i.byteLength*e,u=i.length*e;let f=!this.buffer;if(this.buffer=this.buffer||new En(this.gl,o),f=f||this.buffer.reallocate(o),f=f||!this._compareConstantArrayValues(i,this.bufferValue),f){const l=bO(n.constructor,u);wO({target:l,source:i,start:0,count:u}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:lt(!1)}}static _setConstantIntArray(e,n,i){switch(lt(Yt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:lt(!1)}}static _setConstantUintArray(e,n,i){switch(lt(Yt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:lt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return lt(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const EO="VertexArray: attributes must be Buffers or constants (i.e. typed array)",SO=/^(.+)__LOCATION_([0-9]+)$/,AO=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class PO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new ls(e),rA(this,"VertexArray","v6.0",AO),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:o,accessor:u}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return o>=0&&(this.values[o]=n,this.accessors[o]=u,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,u)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:o,accessor:u}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=u,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new En(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof En&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof En&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let o;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),o=i()}),o}_resolveLocationAndAccessor(e,n,i,o){const u={location:-1,accessor:null},{location:f,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(f)||f<0)return this.unused[e]=n,Et.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),u;const b=this._getAttributeInfo(l||f);if(!b)return u;const w=this.accessors[f]||{},C=hs.resolve(b.accessor,w,i,o),{size:L,type:k}=C;return lt(Number.isFinite(L)&&Number.isFinite(k)),{location:f,accessor:C}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=SO.exec(e),o=i?i[1]:e,u=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(o)+u,name:o}:{location:-1}}_setAttribute(e,n){if(n instanceof En)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof En){const i=n[0],o=n[1];this.setBuffer(e,i,o)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof En){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(EO)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let o=this.values[0];ArrayBuffer.isView(o)&&this._setConstantAttributeZero(o,i);for(let u=1;u<this.vertexArrayObject.MAX_ATTRIBUTES;u++)o=this.values[u],ArrayBuffer.isView(o)&&this._setConstantAttribute(u,o)}_setConstantAttributeZero(e,n){if(ls.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){ls.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],o=this.accessors[n];if(!i)return;const{divisor:u}=o,f=u>0;if(e.isInstanced=e.isInstanced||f,i instanceof En){const l=i;if(f){const b=l.getVertexCount(o);e.instanceCount=Math.min(e.instanceCount,b)}else{const b=l.getVertexCount(o);e.vertexCount=Math.min(e.vertexCount,b)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Et.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function IO(t,e){const{maxElts:n=16,size:i=1}=e;let o="[";for(let f=0;f<t.length&&f<n;++f)f>0&&(o+=",".concat(f%i===0?" ":"")),o+=Rd(t[f],e);const u=t.length>n?"...":"]";return"".concat(o).concat(u)}function Rd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return IO(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const o=t.toPrecision(2);return o.indexOf(".0")===o.length-2?o.slice(0,-1):o}function Qw(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:o=!1}=t;lt(n);const u=".*_.*",f=".*Matrix",l=n._uniformSetters,b={},w=Object.keys(l).sort();let C=0;for(const H of w)!H.match(u)&&!H.match(f)&&K_({table:b,header:e,uniforms:i,uniformName:H,undefinedOnly:o})&&C++;for(const H of w)H.match(f)&&K_({table:b,header:e,uniforms:i,uniformName:H,undefinedOnly:o})&&C++;for(const H of w)b[H]||K_({table:b,header:e,uniforms:i,uniformName:H,undefinedOnly:o})&&C++;let L=0;const k={};if(!o)for(const H in i){const K=i[H];b[H]||(L++,k[H]={Type:"NOT USED: ".concat(K),[e]:Rd(K)})}return{table:b,count:C,unusedTable:k,unusedCount:L}}function K_(t){let{table:e,header:n,uniforms:i,uniformName:o,undefinedOnly:u}=t;const f=i[o],l=CO(f);return!u||!l?(e[o]={[n]:l?Rd(f):"N/A","Uniform Type":l?f:"NOT PROVIDED"},!0):!1}function CO(t){return t!=null}function MO(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=eT(e,e.elements,null,n));const o=e.values;for(const u in o){const f=e._getAttributeInfo(u);if(f){let l="".concat(u,": ").concat(f.name);const b=e.accessors[f.location];b&&(l="".concat(u,": ").concat(LO(f.name,b))),i[l]=eT(e,o[u],b,n)}}return i}function eT(t,e,n,i){const{gl:o}=t;if(!e)return{[i]:"null","Format ":"N/A"};let u="NOT PROVIDED",f=1,l=0,b=0,w,C,L;if(n&&(u=n.type,f=n.size,u=String(u).replace("Array",""),w=u.indexOf("nt")!==-1),e instanceof En){const k=e,{data:H,changed:K}=k.getDebugData();C=K?"*":"",L=H,b=k.byteLength,l=b/H.BYTES_PER_ELEMENT/f;let re;if(n){const ce=n.divisor>0;re="".concat(ce?"I ":"P "," ").concat(l," (x").concat(f,"=").concat(b," bytes ").concat(Ja(o,u),")")}else w=!0,re="".concat(b," bytes");return{[i]:"".concat(C).concat(Rd(L,{size:f,isInteger:w})),"Format ":re}}return L=e,f=e.length,u=String(e.constructor.name).replace("Array",""),w=u.indexOf("nt")!==-1,{[i]:"".concat(Rd(L,{size:f,isInteger:w})," (constant)"),"Format ":"".concat(f,"x").concat(u," (constant)")}}function LO(t,e){const{type:n,size:i}=e,o=gA(n,i);return o?"".concat(t," (").concat(o.name,")"):t}function kO(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const o=tT(i);e["in ".concat(o)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const o=tT(i);e["out ".concat(o)]={[n]:JSON.stringify(i.accessor)}}return e}function tT(t){const{type:e,size:n}=t.accessor,i=gA(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const nT=ca()&&typeof document<"u";let RO=0;class DO{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=ce=>iA(ce),onAddHTML:i=null,onInitialize:o=()=>{},onRender:u=()=>{},onFinalize:f=()=>{},onError:l,gl:b=null,glOptions:w={},debug:C=!1,createFramebuffer:L=!1,autoResizeViewport:k=!0,autoResizeDrawingBuffer:H=!0,stats:K=Fl.get("animation-loop-".concat(RO++))}=e;let{useDevicePixels:re=!0}=e;"useDevicePixelRatio"in e&&(Et.deprecated("useDevicePixelRatio","useDevicePixels")(),re=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:o,onRender:u,onFinalize:f,onError:l,gl:b,glOptions:w,debug:C,createFramebuffer:L},this.gl=b,this.needsRedraw=null,this.timeline=null,this.stats=K,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:k,autoResizeDrawingBuffer:H,useDevicePixels:re}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return lt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Im.isSupported(this.gl,["timers"])?new Im(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Et.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=nT?new Promise((e,n)=>{if(nT&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):UD(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):ND(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?j0(this.props.gl,e):this.onCreateContext(e),!ng(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");AD(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:o}=this.gl;return o&&o.clientHeight?i=o.clientWidth/o.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&LD(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Pi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Zd="vs",W0="fs";function ps(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const J_={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function zO(t){const e={};for(const n in t){const i=t[n],o=OO(i);e[n]=o}return e}function OO(t){let e=iT(t);return e==="object"?t?"type"in t?Object.assign({},t,J_[t.type]):"value"in t?(e=iT(t.value),Object.assign({type:e},t,J_[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},J_[e])}function iT(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const FO="vs",BO="fs";class rT{constructor(e){let{name:n,vs:i,fs:o,dependencies:u=[],uniforms:f,getUniforms:l,deprecations:b=[],defines:w={},inject:C={},vertexShader:L,fragmentShader:k}=e;ps(typeof n=="string"),this.name=n,this.vs=i||L,this.fs=o||k,this.getModuleUniforms=l,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(b),this.defines=w,this.injections=NO(C),f&&(this.uniforms=zO(f))}getModuleSource(e){let n;switch(e){case FO:n=this.vs||"";break;case BO:n=this.fs||"";break;default:ps(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const o in i){const u=i[o];o in e&&!u.private?(u.validate&&ps(u.validate(e[o],u),"".concat(this.name,": invalid ").concat(o)),n[o]=e[o]):n[o]=u.value}return n}}function NO(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const o=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[o][n]=i}return e}function UO(t){return VO(xA(t))}function VO(t){const e={},n={};return vA({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,o)=>n[o]-n[i]).map(i=>e[i])}function vA(t){let{modules:e,level:n,moduleMap:i,moduleDepth:o}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)i[u.name]=u,(o[u.name]===void 0||o[u.name]<n)&&(o[u.name]=n);for(const u of e)u.dependencies&&vA({modules:u.dependencies,level:n+1,moduleMap:i,moduleDepth:o})}function xA(t,e){return t.map(n=>(n instanceof rT||(ps(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),ps(n.name,"shader module has no name"),n=new rT(n),n.dependencies=xA(n.dependencies)),n))}function jO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o}const GO=7936,$O=7937,HO=7938,WO=35724,q0={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Rl={};Object.keys(q0).forEach(t=>{Rl[t]=t});function qO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function ZO(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||GO),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||$O);return{gpuVendor:XO(n,i),vendor:n,renderer:i,version:t.getParameter(HO),shadingLanguageVersion:t.getParameter(WO)}}function XO(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Q_={};function sT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=q0[e];if(ps(i,e),!jO(n))return!0;if(e in Q_)return Q_[e];const o=i[0],u=n.behavior||"enable",f="#extension GL_".concat(o," : ").concat(u,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,f),t.compileShader(l);const b=t.getShaderParameter(l,35713);return t.deleteShader(l),Q_[e]=b,b}function YO(t,e){const n=q0[e];ps(n,e);const i=qO(t)&&n[1]||n[0],o=typeof i=="string"?!!t.getExtension(i):i;return ps(o===!1||o===!0),o}function Ap(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>YO(t,n))}function KO(t){switch(ZO(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function JO(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Ap(t,Rl.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Ap(t,Rl.GLSL_DERIVATIVES)&&sT(t,Rl.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Ap(t,Rl.GLSL_FRAG_DATA)&&sT(t,Rl.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Ap(t,Rl.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const QO=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,eF=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,tF={[Zd]:QO,[W0]:eF},Xp="__LUMA_INJECT_DECLARATIONS__",oT=/void\s+main\s*\([^)]*\)\s*\{\n?/,aT=/}\n?[^{}]*$/,ey=[];function lT(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=e===Zd;for(const u in n){const f=n[u];f.sort((b,w)=>b.order-w.order),ey.length=f.length;for(let b=0,w=f.length;b<w;++b)ey[b]=f[b].injection;const l="".concat(ey.join(`
`),`
`);switch(u){case"vs:#decl":o&&(t=t.replace(Xp,l));break;case"vs:#main-start":o&&(t=t.replace(oT,b=>b+l));break;case"vs:#main-end":o&&(t=t.replace(aT,b=>l+b));break;case"fs:#decl":o||(t=t.replace(Xp,l));break;case"fs:#main-start":o||(t=t.replace(oT,b=>b+l));break;case"fs:#main-end":o||(t=t.replace(aT,b=>l+b));break;default:t=t.replace(u,b=>b+l)}}return t=t.replace(Xp,""),i&&(t=t.replace(/\}\s*$/,u=>u+tF[e])),t}function wv(t){const e={};return ps(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function Tu(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const bA=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],nF=[...bA,[Tu("attribute"),"in $1"],[Tu("varying"),"out $1"]],iF=[...bA,[Tu("varying"),"in $1"]],wA=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],rF=[...wA,[Tu("in"),"attribute $1"],[Tu("out"),"varying $1"]],sF=[...wA,[Tu("in"),"varying $1"]],Tv="gl_FragColor",Ev=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,oF=/void\s+main\s*\([^)]*\)\s*\{\n?/;function aF(t,e,n){switch(e){case 300:return n?Cm(t,nF):lF(t);case 100:return n?Cm(t,rF):cF(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Cm(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function lF(t){t=Cm(t,iF);const e=t.match(Ev);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Tv,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(oF,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(Tv,"\\b"),"g"),n)}return t}function cF(t){t=Cm(t,sF);const e=t.match(Ev);if(e){const n=e[1];t=t.replace(Ev,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Tv)}return t}const uF=`

`.concat(Xp,`

`),TA={[Zd]:"vertex",[W0]:"fragment"},hF=`precision highp float;

`;function dF(t,e){const{vs:n,fs:i}=e,o=UO(e.modules||[]);return{gl:t,vs:cT(t,Object.assign({},e,{source:n,type:Zd,modules:o})),fs:cT(t,Object.assign({},e,{source:i,type:W0,modules:o})),getUniforms:fF(o)}}function cT(t,e){let{id:n,source:i,type:o,modules:u,defines:f={},hookFunctions:l=[],inject:b={},transpileToGLSL100:w=!1,prologue:C=!0,log:L}=e;ps(typeof i=="string","shader source must be a string");const k=o===Zd,H=i.split(`
`);let K=100,re="",ce=i;H[0].indexOf("#version ")===0?(K=300,re=H[0],ce=H.slice(1).join(`
`)):re="#version ".concat(K);const W={};u.forEach(ze=>{Object.assign(W,ze.getDefines())}),Object.assign(W,f);let G=C?"".concat(re,`
`).concat(mF({id:n,source:i,type:o}),`
`).concat(pF({type:o}),`
`).concat(KO(t),`
`).concat(JO(t),`
`).concat(gF(W),`
`).concat(k?"":hF,`
`):"".concat(re,`
`);const Z=yF(l),fe={},Te={},Pe={};for(const ze in b){const Oe=typeof b[ze]=="string"?{injection:b[ze],order:0}:b[ze],Me=ze.match(/^(v|f)s:(#)?([\w-]+)$/);if(Me){const Ee=Me[2],Re=Me[3];Ee?Re==="decl"?Te[ze]=[Oe]:Pe[ze]=[Oe]:fe[ze]=[Oe]}else Pe[ze]=[Oe]}for(const ze of u){L&&ze.checkDeprecations(ce,L);const Oe=ze.getModuleSource(o,K);G+=Oe;const Me=ze.injections[o];for(const Ee in Me){const Re=Ee.match(/^(v|f)s:#([\w-]+)$/);if(Re){const rt=Re[2]==="decl"?Te:Pe;rt[Ee]=rt[Ee]||[],rt[Ee].push(Me[Ee])}else fe[Ee]=fe[Ee]||[],fe[Ee].push(Me[Ee])}}return G+=uF,G=lT(G,o,Te),G+=_F(Z[o],fe),G+=ce,G=lT(G,o,Pe),G=aF(G,w?100:K,k),G}function fF(t){return function(n){const i={};for(const o of t){const u=o.getUniforms(n,i);Object.assign(i,u)}return i}}function pF(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(TA[e].toUpperCase(),`
`)}function mF(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(TA[i],`

`):""}function gF(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const o=t[i];(o||Number.isFinite(o))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function _F(t,e){let n="";for(const i in t){const o=t[i];if(n+="void ".concat(o.signature,` {
`),o.header&&(n+="  ".concat(o.header)),e[i]){const u=e[i];u.sort((f,l)=>f.order-l.order);for(const f of u)n+="  ".concat(f.injection,`
`)}o.footer&&(n+="  ".concat(o.footer)),n+=`}
`}return n}function yF(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[o,u]=n.split(":"),f=n.replace(/\(.+/,"");e[o][f]=Object.assign(i,{signature:u})}),e}const vF="void main() {gl_FragColor = vec4(0);}",EA=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,xF=`#version 300 es
`.concat(EA);function SA(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,o,u]=n;if(!e.includes(i)||!o||!u)return null;const f=u.split(";")[0];return{qualifier:i,type:o,name:f}}function AA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:o}=t;if(!n)return e===300?xF:e>300?"#version ".concat(e,`
`).concat(EA):vF;const u=TF(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(o,`;
void main() {
  `).concat(o," = ").concat(u,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(u,`;
}`)}function bF(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ps(!1),null}}function wF(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ps(!1),null}}function TF(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return ps(!1),null}}const EF=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,SF={name:"fp32",vs:EF,fs:null};function uT(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Os={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function AF(t,{precision:e=Os.precision}={}){return t=PF(t),"".concat(parseFloat(t.toPrecision(e)))}function Eu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ja(t,e,n){return CF(t,i=>Math.max(e,Math.min(n,i)))}function Mm(t,e,n){return Eu(t)?t.map((i,o)=>Mm(i,e[o],n)):n*e+(1-n)*t}function Dd(t,e,n){const i=Os.EPSILON;try{if(t===e)return!0;if(Eu(t)&&Eu(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!Dd(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Os.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Os.EPSILON=i}}function PF(t){return Math.round(t/Os.EPSILON)*Os.EPSILON}function IF(t){return t.clone?t.clone():new Array(t.length)}function CF(t,e,n){if(Eu(t)){const i=t;n=n||IF(i);for(let o=0;o<n.length&&o<i.length;++o)n[o]=e(t[o],o,n);return n}return e(t)}function MF(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class PA extends MF(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Eu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Os)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+AF(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Dd(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let o=0;o<this.ELEMENTS;++o){const u=e[o];this[o]=u+i*(n[o]-u)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Os.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function LF(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function us(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function ty(t,e,n=""){if(Os.debug&&!LF(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class kF extends PA{get x(){return this[0]}set x(e){this[0]=us(e)}get y(){return this[1]}set y(e){this[1]=us(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const o=this[i]-e[i];n+=o*o}return us(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return us(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return uT(e>=0&&e<this.ELEMENTS,"index is out of range"),us(this[e])}setComponent(e,n){return uT(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Yp=1e-6,Su=typeof Float32Array<"u"?Float32Array:Array;function RF(){var t=new Su(2);return Su!=Float32Array&&(t[0]=0,t[1]=0),t}function hT(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function DF(t,e){return t[0]=-e[0],t[1]=-e[1],t}function IA(t,e,n,i){var o=e[0],u=e[1];return t[0]=o+i*(n[0]-o),t[1]=u+i*(n[1]-u),t}function zF(t,e,n){var i=e[0],o=e[1];return t[0]=n[0]*i+n[4]*o+n[12],t[1]=n[1]*i+n[5]*o+n[13],t}(function(){var t=RF();return function(e,n,i,o,u,f){var l,b;for(n||(n=2),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],u(t,t,f),e[l]=t[0],e[l+1]=t[1];return e}})();function OF(t,e,n){const i=e[0],o=e[1],u=n[3]*i+n[7]*o||1;return t[0]=(n[0]*i+n[4]*o)/u,t[1]=(n[1]*i+n[5]*o)/u,t}function CA(t,e,n){const i=e[0],o=e[1],u=e[2],f=n[3]*i+n[7]*o+n[11]*u||1;return t[0]=(n[0]*i+n[4]*o+n[8]*u)/f,t[1]=(n[1]*i+n[5]*o+n[9]*u)/f,t[2]=(n[2]*i+n[6]*o+n[10]*u)/f,t}function FF(t,e,n){const i=e[0],o=e[1];return t[0]=n[0]*i+n[2]*o,t[1]=n[1]*i+n[3]*o,t[2]=e[2],t}function BF(){var t=new Su(3);return Su!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function NF(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function UF(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function VF(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function jF(t,e,n){var i=e[0],o=e[1],u=e[2],f=n[0],l=n[1],b=n[2];return t[0]=o*b-u*l,t[1]=u*f-i*b,t[2]=i*l-o*f,t}function MA(t,e,n){var i=e[0],o=e[1],u=e[2],f=n[3]*i+n[7]*o+n[11]*u+n[15];return f=f||1,t[0]=(n[0]*i+n[4]*o+n[8]*u+n[12])/f,t[1]=(n[1]*i+n[5]*o+n[9]*u+n[13])/f,t[2]=(n[2]*i+n[6]*o+n[10]*u+n[14])/f,t}function GF(t,e,n){var i=e[0],o=e[1],u=e[2];return t[0]=i*n[0]+o*n[3]+u*n[6],t[1]=i*n[1]+o*n[4]+u*n[7],t[2]=i*n[2]+o*n[5]+u*n[8],t}function $F(t,e,n){var i=n[0],o=n[1],u=n[2],f=n[3],l=e[0],b=e[1],w=e[2],C=o*w-u*b,L=u*l-i*w,k=i*b-o*l;return C=C+C,L=L+L,k=k+k,t[0]=l+f*C+o*k-u*L,t[1]=b+f*L+u*C-i*k,t[2]=w+f*k+i*L-o*C,t}function HF(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[0],u[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),u[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function WF(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),u[1]=o[1],u[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function qF(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),u[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),u[2]=o[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function ZF(t,e){var n=t[0],i=t[1],o=t[2],u=e[0],f=e[1],l=e[2],b=Math.sqrt((n*n+i*i+o*o)*(u*u+f*f+l*l)),w=b&&VF(t,e)/b;return Math.acos(Math.min(Math.max(w,-1),1))}var XF=NF;(function(){var t=BF();return function(e,n,i,o,u,f){var l,b;for(n||(n=3),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],u(t,t,f),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const ny=[0,0,0];let Pp;class Co extends kF{static get ZERO(){return Pp||(Pp=new Co(0,0,0),Object.freeze(Pp)),Pp}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Eu(e)?this.copy(e):(Os.debug&&(us(e),us(n),us(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Os.debug&&(us(e.x),us(e.y),us(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=us(e)}angle(e){return ZF(this,e)}cross(e){return jF(this,this,e),this.check()}rotateX({radians:e,origin:n=ny}){return HF(this,this,n,e),this.check()}rotateY({radians:e,origin:n=ny}){return WF(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=ny}){return qF(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return MA(this,this,e),this.check()}transformAsVector(e){return CA(this,this,e),this.check()}transformByMatrix3(e){return GF(this,this,e),this.check()}transformByMatrix2(e){return FF(this,this,e),this.check()}transformByQuaternion(e){return $F(this,this,e),this.check()}}class YF extends PA{toString(){let e="[";if(Os.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=us(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)n[o]=this[i+o];return n}setColumn(e,n){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)this[i+o]=n[o];return this}}function KF(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function JF(t,e){if(t===e){var n=e[1],i=e[2],o=e[3],u=e[6],f=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=u,t[11]=e[14],t[12]=o,t[13]=f,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Sv(t,e){var n=e[0],i=e[1],o=e[2],u=e[3],f=e[4],l=e[5],b=e[6],w=e[7],C=e[8],L=e[9],k=e[10],H=e[11],K=e[12],re=e[13],ce=e[14],W=e[15],G=n*l-i*f,Z=n*b-o*f,fe=n*w-u*f,Te=i*b-o*l,Pe=i*w-u*l,ze=o*w-u*b,Oe=C*re-L*K,Me=C*ce-k*K,Ee=C*W-H*K,Re=L*ce-k*re,nt=L*W-H*re,rt=k*W-H*ce,yt=G*rt-Z*nt+fe*Re+Te*Ee-Pe*Me+ze*Oe;return yt?(yt=1/yt,t[0]=(l*rt-b*nt+w*Re)*yt,t[1]=(o*nt-i*rt-u*Re)*yt,t[2]=(re*ze-ce*Pe+W*Te)*yt,t[3]=(k*Pe-L*ze-H*Te)*yt,t[4]=(b*Ee-f*rt-w*Me)*yt,t[5]=(n*rt-o*Ee+u*Me)*yt,t[6]=(ce*fe-K*ze-W*Z)*yt,t[7]=(C*ze-k*fe+H*Z)*yt,t[8]=(f*nt-l*Ee+w*Oe)*yt,t[9]=(i*Ee-n*nt-u*Oe)*yt,t[10]=(K*Pe-re*fe+W*G)*yt,t[11]=(L*fe-C*Pe-H*G)*yt,t[12]=(l*Me-f*Re-b*Oe)*yt,t[13]=(n*Re-i*Me+o*Oe)*yt,t[14]=(re*Z-K*Te-ce*G)*yt,t[15]=(C*Te-L*Z+k*G)*yt,t):null}function QF(t){var e=t[0],n=t[1],i=t[2],o=t[3],u=t[4],f=t[5],l=t[6],b=t[7],w=t[8],C=t[9],L=t[10],k=t[11],H=t[12],K=t[13],re=t[14],ce=t[15],W=e*f-n*u,G=e*l-i*u,Z=n*l-i*f,fe=w*K-C*H,Te=w*re-L*H,Pe=C*re-L*K,ze=e*Pe-n*Te+i*fe,Oe=u*Pe-f*Te+l*fe,Me=w*Z-C*G+L*W,Ee=H*Z-K*G+re*W;return b*ze-o*Oe+ce*Me-k*Ee}function Ul(t,e,n){var i=e[0],o=e[1],u=e[2],f=e[3],l=e[4],b=e[5],w=e[6],C=e[7],L=e[8],k=e[9],H=e[10],K=e[11],re=e[12],ce=e[13],W=e[14],G=e[15],Z=n[0],fe=n[1],Te=n[2],Pe=n[3];return t[0]=Z*i+fe*l+Te*L+Pe*re,t[1]=Z*o+fe*b+Te*k+Pe*ce,t[2]=Z*u+fe*w+Te*H+Pe*W,t[3]=Z*f+fe*C+Te*K+Pe*G,Z=n[4],fe=n[5],Te=n[6],Pe=n[7],t[4]=Z*i+fe*l+Te*L+Pe*re,t[5]=Z*o+fe*b+Te*k+Pe*ce,t[6]=Z*u+fe*w+Te*H+Pe*W,t[7]=Z*f+fe*C+Te*K+Pe*G,Z=n[8],fe=n[9],Te=n[10],Pe=n[11],t[8]=Z*i+fe*l+Te*L+Pe*re,t[9]=Z*o+fe*b+Te*k+Pe*ce,t[10]=Z*u+fe*w+Te*H+Pe*W,t[11]=Z*f+fe*C+Te*K+Pe*G,Z=n[12],fe=n[13],Te=n[14],Pe=n[15],t[12]=Z*i+fe*l+Te*L+Pe*re,t[13]=Z*o+fe*b+Te*k+Pe*ce,t[14]=Z*u+fe*w+Te*H+Pe*W,t[15]=Z*f+fe*C+Te*K+Pe*G,t}function Lm(t,e,n){var i=n[0],o=n[1],u=n[2],f,l,b,w,C,L,k,H,K,re,ce,W;return e===t?(t[12]=e[0]*i+e[4]*o+e[8]*u+e[12],t[13]=e[1]*i+e[5]*o+e[9]*u+e[13],t[14]=e[2]*i+e[6]*o+e[10]*u+e[14],t[15]=e[3]*i+e[7]*o+e[11]*u+e[15]):(f=e[0],l=e[1],b=e[2],w=e[3],C=e[4],L=e[5],k=e[6],H=e[7],K=e[8],re=e[9],ce=e[10],W=e[11],t[0]=f,t[1]=l,t[2]=b,t[3]=w,t[4]=C,t[5]=L,t[6]=k,t[7]=H,t[8]=K,t[9]=re,t[10]=ce,t[11]=W,t[12]=f*i+C*o+K*u+e[12],t[13]=l*i+L*o+re*u+e[13],t[14]=b*i+k*o+ce*u+e[14],t[15]=w*i+H*o+W*u+e[15]),t}function Z0(t,e,n){var i=n[0],o=n[1],u=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function e4(t,e,n,i){var o=i[0],u=i[1],f=i[2],l=Math.sqrt(o*o+u*u+f*f),b,w,C,L,k,H,K,re,ce,W,G,Z,fe,Te,Pe,ze,Oe,Me,Ee,Re,nt,rt,yt,Dt;return l<Yp?null:(l=1/l,o*=l,u*=l,f*=l,b=Math.sin(n),w=Math.cos(n),C=1-w,L=e[0],k=e[1],H=e[2],K=e[3],re=e[4],ce=e[5],W=e[6],G=e[7],Z=e[8],fe=e[9],Te=e[10],Pe=e[11],ze=o*o*C+w,Oe=u*o*C+f*b,Me=f*o*C-u*b,Ee=o*u*C-f*b,Re=u*u*C+w,nt=f*u*C+o*b,rt=o*f*C+u*b,yt=u*f*C-o*b,Dt=f*f*C+w,t[0]=L*ze+re*Oe+Z*Me,t[1]=k*ze+ce*Oe+fe*Me,t[2]=H*ze+W*Oe+Te*Me,t[3]=K*ze+G*Oe+Pe*Me,t[4]=L*Ee+re*Re+Z*nt,t[5]=k*Ee+ce*Re+fe*nt,t[6]=H*Ee+W*Re+Te*nt,t[7]=K*Ee+G*Re+Pe*nt,t[8]=L*rt+re*yt+Z*Dt,t[9]=k*rt+ce*yt+fe*Dt,t[10]=H*rt+W*yt+Te*Dt,t[11]=K*rt+G*yt+Pe*Dt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function LA(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[4],f=e[5],l=e[6],b=e[7],w=e[8],C=e[9],L=e[10],k=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*o+w*i,t[5]=f*o+C*i,t[6]=l*o+L*i,t[7]=b*o+k*i,t[8]=w*o-u*i,t[9]=C*o-f*i,t[10]=L*o-l*i,t[11]=k*o-b*i,t}function t4(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[0],f=e[1],l=e[2],b=e[3],w=e[8],C=e[9],L=e[10],k=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o-w*i,t[1]=f*o-C*i,t[2]=l*o-L*i,t[3]=b*o-k*i,t[8]=u*i+w*o,t[9]=f*i+C*o,t[10]=l*i+L*o,t[11]=b*i+k*o,t}function kA(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[0],f=e[1],l=e[2],b=e[3],w=e[4],C=e[5],L=e[6],k=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o+w*i,t[1]=f*o+C*i,t[2]=l*o+L*i,t[3]=b*o+k*i,t[4]=w*o-u*i,t[5]=C*o-f*i,t[6]=L*o-l*i,t[7]=k*o-b*i,t}function n4(t,e){var n=e[0],i=e[1],o=e[2],u=e[3],f=n+n,l=i+i,b=o+o,w=n*f,C=i*f,L=i*l,k=o*f,H=o*l,K=o*b,re=u*f,ce=u*l,W=u*b;return t[0]=1-L-K,t[1]=C+W,t[2]=k-ce,t[3]=0,t[4]=C-W,t[5]=1-w-K,t[6]=H+re,t[7]=0,t[8]=k+ce,t[9]=H-re,t[10]=1-w-L,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i4(t,e,n,i,o,u,f){var l=1/(n-e),b=1/(o-i),w=1/(u-f);return t[0]=u*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*b,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(o+i)*b,t[10]=(f+u)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*u*2*w,t[15]=0,t}function r4(t,e,n,i,o){var u=1/Math.tan(e/2);if(t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){var f=1/(i-o);t[10]=(o+i)*f,t[14]=2*o*i*f}else t[10]=-1,t[14]=-2*i;return t}var s4=r4;function o4(t,e,n,i,o,u,f){var l=1/(e-n),b=1/(i-o),w=1/(u-f);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*l,t[13]=(o+i)*b,t[14]=(f+u)*w,t[15]=1,t}var a4=o4;function l4(t,e,n,i){var o,u,f,l,b,w,C,L,k,H,K=e[0],re=e[1],ce=e[2],W=i[0],G=i[1],Z=i[2],fe=n[0],Te=n[1],Pe=n[2];return Math.abs(K-fe)<Yp&&Math.abs(re-Te)<Yp&&Math.abs(ce-Pe)<Yp?KF(t):(C=K-fe,L=re-Te,k=ce-Pe,H=1/Math.sqrt(C*C+L*L+k*k),C*=H,L*=H,k*=H,o=G*k-Z*L,u=Z*C-W*k,f=W*L-G*C,H=Math.sqrt(o*o+u*u+f*f),H?(H=1/H,o*=H,u*=H,f*=H):(o=0,u=0,f=0),l=L*f-k*u,b=k*o-C*f,w=C*u-L*o,H=Math.sqrt(l*l+b*b+w*w),H?(H=1/H,l*=H,b*=H,w*=H):(l=0,b=0,w=0),t[0]=o,t[1]=l,t[2]=C,t[3]=0,t[4]=u,t[5]=b,t[6]=L,t[7]=0,t[8]=f,t[9]=w,t[10]=k,t[11]=0,t[12]=-(o*K+u*re+f*ce),t[13]=-(l*K+b*re+w*ce),t[14]=-(C*K+L*re+k*ce),t[15]=1,t)}function c4(){var t=new Su(4);return Su!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function u4(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Xd(t,e,n){var i=e[0],o=e[1],u=e[2],f=e[3];return t[0]=n[0]*i+n[4]*o+n[8]*u+n[12]*f,t[1]=n[1]*i+n[5]*o+n[9]*u+n[13]*f,t[2]=n[2]*i+n[6]*o+n[10]*u+n[14]*f,t[3]=n[3]*i+n[7]*o+n[11]*u+n[15]*f,t}(function(){var t=c4();return function(e,n,i,o,u,f){var l,b;for(n||(n=4),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],u(t,t,f),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var Av;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Av||(Av={}));const h4=45*Math.PI/180,d4=1,iy=.1,ry=500,f4=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Mo extends YF{static get IDENTITY(){return m4()}static get ZERO(){return p4()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Av}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,o,u,f,l,b,w,C,L,k,H,K,re,ce){return this[0]=e,this[1]=n,this[2]=i,this[3]=o,this[4]=u,this[5]=f,this[6]=l,this[7]=b,this[8]=w,this[9]=C,this[10]=L,this[11]=k,this[12]=H,this[13]=K,this[14]=re,this[15]=ce,this.check()}setRowMajor(e,n,i,o,u,f,l,b,w,C,L,k,H,K,re,ce){return this[0]=e,this[1]=u,this[2]=w,this[3]=H,this[4]=n,this[5]=f,this[6]=C,this[7]=K,this[8]=i,this[9]=l,this[10]=L,this[11]=re,this[12]=o,this[13]=b,this[14]=k,this[15]=ce,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(f4)}fromObject(e){return this.check()}fromQuaternion(e){return n4(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:o,top:u,near:f=iy,far:l=ry}=e;return l===1/0?g4(this,n,i,o,u,f):i4(this,n,i,o,u,f,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:o=[0,1,0]}=e;return l4(this,n,i,o),this.check()}ortho(e){const{left:n,right:i,bottom:o,top:u,near:f=iy,far:l=ry}=e;return a4(this,n,i,o,u,f,l),this.check()}orthographic(e){const{fovy:n=h4,aspect:i=d4,focalDistance:o=1,near:u=iy,far:f=ry}=e;dT(n);const l=n/2,b=o*Math.tan(l),w=b*i;return this.ortho({left:-w,right:w,bottom:-b,top:b,near:u,far:f})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:o=.1,far:u=500}=e;return dT(n),s4(this,n,i,o,u),this.check()}determinant(){return QF(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],u=1/i[1],f=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*u,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*u,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],u=1/i[1],f=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=this[4]*o,e[4]=this[5]*u,e[5]=this[6]*f,e[6]=this[8]*o,e[7]=this[9]*u,e[8]=this[10]*f,e}transpose(){return JF(this,this),this.check()}invert(){return Sv(this,this),this.check()}multiplyLeft(e){return Ul(this,e,this),this.check()}multiplyRight(e){return Ul(this,this,e),this.check()}rotateX(e){return LA(this,this,e),this.check()}rotateY(e){return t4(this,this,e),this.check()}rotateZ(e){return kA(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return e4(this,this,e,n),this.check()}scale(e){return Z0(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Lm(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Xd(n||[-0,-0,-0,-0],e,this),ty(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let o;switch(i){case 2:o=zF(n||[-0,-0],e,this);break;case 3:o=MA(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ty(o,e.length),o}transformAsVector(e,n){let i;switch(e.length){case 2:i=OF(n||[-0,-0],e,this);break;case 3:i=CA(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ty(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Ip,Cp;function p4(){return Ip||(Ip=new Mo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ip)),Ip}function m4(){return Cp||(Cp=new Mo,Object.freeze(Cp)),Cp}function dT(t){if(t>Math.PI*2)throw Error("expected radians")}function g4(t,e,n,i,o,u){const f=2*u/(n-e),l=2*u/(o-i),b=(n+e)/(n-e),w=(o+i)/(o-i),C=-1,L=-1,k=-2*u;return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=b,t[9]=w,t[10]=C,t[11]=L,t[12]=0,t[13]=0,t[14]=k,t[15]=0,t}const _4=new Uint8Array([0,255,255,255]),y4={pickingSelectedColor:null,pickingHighlightColor:_4,pickingActive:!1,pickingAttribute:!1};function v4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:y4;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const x4=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,b4=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,w4={name:"picking",vs:x4,fs:b4,getUniforms:v4},T4=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,E4={name:"transform",vs:T4,fs:null};class Yd{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Yd(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:o={},inject:u={},varyings:f=[],bufferMode:l=35981,transpileToGLSL100:b=!1}=e,w=this._getModuleList(e.modules),C=this._getHash(n),L=this._getHash(i),k=w.map(Z=>this._getHash(Z.name)).sort(),H=f.map(Z=>this._getHash(Z)),K=Object.keys(o).sort(),re=Object.keys(u).sort(),ce=[],W=[];for(const Z of K)ce.push(this._getHash(Z)),ce.push(this._getHash(o[Z]));for(const Z of re)W.push(this._getHash(Z)),W.push(this._getHash(u[Z]));const G="".concat(C,"/").concat(L,"D").concat(ce.join("/"),"M").concat(k.join("/"),"I").concat(W.join("/"),"V").concat(H.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(b?"T":"");if(!this._programCache[G]){const Z=dF(this.gl,{vs:n,fs:i,modules:w,inject:u,defines:o,hookFunctions:this._hookFunctions,transpileToGLSL100:b});this._programCache[G]=new _A(this.gl,{hash:G,vs:Z.vs,fs:Z.fs,varyings:f,bufferMode:l}),this._getUniforms[G]=Z.getUniforms||(fe=>{}),this._useCounts[G]=0}return this._useCounts[G]++,this._programCache[G]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let o=0;for(let u=0,f=this._defaultModules.length;u<f;++u){const l=this._defaultModules[u],b=l.name;n[o++]=l,i[b]=!0}for(let u=0,f=e.length;u<f;++u){const l=e[u],b=l.name;i[b]||(n[o++]=l,i[b]=!0)}return n.length=o,n}}const S4={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function A4(t,e,n){const i={};let o=e.indices;for(const u in e.attributes){const f=e.attributes[u],l=P4(u);if(u==="indices")o=f;else if(f.constant)i[l]=f.value;else{const b=f.value,w={...f};delete w.value,i[l]=[new En(t,b),w],I4(u,w)}}if(o){const u=o.value||o;lt(u instanceof Uint16Array||u instanceof Uint32Array,'attribute array for "indices" must be of integer type');const f={size:1,isIndexed:o.isIndexed===void 0?!0:o.isIndexed};i.indices=[new En(t,{data:u,target:34963}),f]}return i}function P4(t,e){const{attributeMap:n=S4}={};return n&&n[t]||t}function I4(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}lt(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Vc=2,C4=1e4,M4="Model needs drawMode and vertexCount",fT=()=>{},L4={};class Kd{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=nl("model")}=n;lt(ng(e)),this.id=i,this.gl=e,this.id=n.id||nl("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Yd.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:C}=e;this.programProps={program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:C},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},lt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),M4)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:C}=e;this.programProps={program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:C},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return lt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return lt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=A4(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(wu(e))return this;const n={};for(const i in e){const o=e[i];n[i]=o.getValue?o.getValue():o}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return $0(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:o={},attributes:u={},transformFeedback:f=this.transformFeedback,parameters:l={},vertexArray:b=this.vertexArray}=e;this.setAttributes(u),this.updateModuleSettings(n),this.setUniforms(o);let w;Et.priority>=Vc&&(w=this._logDrawCallStart(Vc));const C=this.vertexArray.getDrawParams(),{isIndexed:L=C.isIndexed,indexType:k=C.indexType,indexOffset:H=C.indexOffset,vertexArrayInstanced:K=C.isInstanced}=this.props;K&&!this.isInstanced&&Et.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:re,instanceCount:ce}=this,{onBeforeRender:W=fT,onAfterRender:G=fT}=this.props;W(),this.program.setUniforms(this.uniforms);const Z=this.program.draw(Object.assign(L4,e,{logPriority:w,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:b,transformFeedback:f,isIndexed:L,indexType:k,isInstanced:re,instanceCount:ce,offset:L?H:0}));return G(),Et.priority>=Vc&&this._logDrawCallEnd(w,b,i),Z}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:o=[]}=e;let{parameters:u}=e;i&&this._setFeedbackBuffers(i),n&&(u=Object.assign({},u,{35977:n})),o.forEach(f=>f.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:u}))}finally{o.forEach(f=>f.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Et.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:o,modules:u,inject:f,defines:l,varyings:b,bufferMode:w,transpileToGLSL100:C}=this.programProps;n=this.programManager.get({vs:i,fs:o,modules:u,inject:f,defines:l,varyings:b,bufferMode:w,transpileToGLSL100:C}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}lt(n instanceof _A,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new PO(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof En&&n.delete()}}_setAnimationProps(e){this.animated&&lt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(wu(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new yA(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:C4;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Et.group(Vc,">>> DRAWING MODEL ".concat(this.id),{collapsed:Et.level<=2})(),e}_logDrawCallEnd(e,n,i,o){if(e===void 0)return;const u=MO({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:f,unusedTable:l,unusedCount:b}=Qw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:w,count:C}=Qw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});C>0&&Et.log("MISSING UNIFORMS",Object.keys(w))(),b>0&&Et.log("UNUSED UNIFORMS",Object.keys(l))();const L=kO(this.vertexArray.configuration);Et.table(e,u)(),Et.table(e,f)(),Et.table(e+1,L)(),o&&o.log({logLevel:Vc,message:"Rendered to ".concat(o.id)}),Et.groupEnd(Vc)()}}class k4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:o}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:o}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof En?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&lt(Yt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const o in this.feedbackMap){const u=this.feedbackMap[o];o in n&&(i[u]=o)}Object.assign(i,e.feedbackBuffers);for(const o in i){const u=i[o];if(typeof u=="string"){const f=n[u],{byteLength:l,usage:b,accessor:w}=f;i[o]=this._createNewBuffer(o,{byteLength:l,usage:b,accessor:w})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:o}=i;e.transformFeedback=new yA(this.gl,{program:o,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const o in this.feedbackMap){const u=this.feedbackMap[o];n[o]=e.feedbackBuffers[u],i[u]=e.sourceBuffers[o],lt(i[u]instanceof En)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new En(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const R4="transform_uSampler_",km="transform_uSize_",pT="transform_position";function D4(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:o}=t,f=Object.keys(n).length,l=null;const b={};let w=e,C={};if(f>0||i){const L=w.split(`
`),k=L.slice();if(L.forEach((H,K,re)=>{if(f>0){const ce=N4(H,n);if(ce){const{updatedLine:W,inject:G}=ce;k[K]=W,C=wv([C,G]),Object.assign(b,ce.samplerTextureMap),f--}}i&&!l&&(l=B4(H,i))}),i){lt(o);const H="".concat(km).concat(i),K="uniform vec2 ".concat(H,`;
`),re="     vec2 ".concat(pT," = transform_getPos(").concat(H,`);
     gl_Position = vec4(`).concat(pT,`, 0, 1.);
`);C=wv([C,{"vs:#decl":K,"vs:#main-start":re}])}w=k.join(`
`)}return{vs:w,targetTextureType:l,inject:C,samplerTextureMap:b}}function z4(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const o={};let u,f;n&&({width:u,height:f}=i,o["".concat(km).concat(n)]=[u,f]);for(const l in e)({width:u,height:f}=e[l]),o["".concat(km).concat(l)]=[u,f];return o}function O4(t){return SA(t,["attribute","in"])}function F4(t){const e="".concat(R4).concat(t),n="".concat(km).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function B4(t,e){const n=SA(t,["varying","out"]);return n&&n.name===e?n.type:null}function N4(t,e){const n={},i=O4(t);if(!i)return null;const{type:o,name:u}=i;if(u&&e[u]){const f="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:b,uniformDeclerations:w}=F4(u),C=bF(o),L="  ".concat(o," ").concat(u," = transform_getInput(").concat(l,", ").concat(b,").").concat(C,`;
`);return n[l]=u,{updatedLine:f,inject:{"vs:#decl":w,"vs:#main-start":L},samplerTextureMap:n}}return null}const U4={10241:9728,10240:9728,10242:33071,10243:33071},V4="transform_output";class j4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:o,targetTexture:u}=this.bindings[this.currentIndex],f=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),b=Object.assign({},e.parameters);let w=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){f.transform_elementID=this.elementIDBuffer;for(const L in this.samplerTextureMap){const k=this.samplerTextureMap[L];l[L]=i[k]}this._setSourceTextureParameters();const C=z4({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:u});Object.assign(l,C)}return this.hasTargetTexture&&(w=!1,b.viewport=[0,0,o.width,o.height]),{attributes:f,framebuffer:o,uniforms:l,discard:w,parameters:b}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=rg(n);if(!e)return i;const o=i.constructor,u=wF(this.targetTextureType),f=new o(i.length*u/4);let l=0;for(let b=0;b<i.length;b+=4)for(let w=0;w<u;w++)f[l++]=i[b+w];return f}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof gs)return i;const o=n[i];return o?(this._targetRefTexName=i,this._createNewTexture(o)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:o}=e,u=this._createTargetTexture({sourceTextures:i,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:u}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,o,u)=>{u[o]=o}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new En(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:o,targetTexture:u}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,o),Object.assign(e.sourceBuffers,i),u){e.targetTexture=u;const{width:f,height:l}=u,{framebuffer:b}=e;b?(b.update({attachments:{36064:u},resizeAttachments:!1}),b.resize({width:f,height:l})):e.framebuffer=new Pi(this.gl,{id:"transform-framebuffer",width:f,height:l,attachments:{36064:u}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(U4)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=gz(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:o,uniforms:u,targetTextureType:f,inject:l,samplerTextureMap:b}=D4({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),w=wv([e.inject||{},l]);this.targetTextureType=f,this.samplerTextureMap=b;const C=e._fs||AA({version:mA(o),input:this.targetTextureVarying,inputType:f,output:V4}),L=this.hasSourceTextures||this.targetTextureVarying?[E4].concat(e.modules||[]):e.modules;return{vs:o,fs:C,modules:L,uniforms:u,inject:w}}}class X0{static isSupported(e){return Yt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();lt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const o=i.getData(e);if(o)return o}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Kd(n,Object.assign({},e,{fs:e.fs||AA({version:mA(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=o.updateModelProps(n);return n}_buildResourceTransforms(e,n){G4(n)&&(this.bufferTransform=new k4(e,n)),$4(n)&&(this.textureTransform=new j4(e,n)),lt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=Object.assign(n,o.getDrawOptions(n));return n}}function G4(t){return!!(!wu(t.feedbackBuffers)||!wu(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function $4(t){return!!(!wu(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const mT={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class sg{static get DRAW_MODE(){return mT}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=nl("geometry"),drawMode:i=mT.TRIANGLES,attributes:o={},indices:u=null,vertexCount:f=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(o,u),this.vertexCount=f||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let o=e[i];o=ArrayBuffer.isView(o)?{value:o}:o,lt(ArrayBuffer.isView(o.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!o.size&&(o.size=3),i==="indices"?(lt(!this.indices),this.indices=o):this.attributes[i]=o}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const o in e){const u=e[o],{value:f,size:l,constant:b}=u;!b&&f&&l>=1&&(i=Math.min(i,f.length/l))}return lt(Number.isFinite(i)),i}}let H4=1,W4=1;class RA{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:o=1,repeat:u=1}=e,f=H4++,l={time:0,delay:n,duration:i,rate:o,repeat:u};return this._setChannelTime(l,this.time),this.channels.set(f,l),f}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const o of n)this._setChannelTime(o,this.time);const i=this.animations.values();for(const o of i){const{animation:u,channel:f}=o;u.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=W4++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,o=e.duration*e.repeat;i>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const q4=[255,255,255],Z4=1;let X4=0;class Y4{constructor(e={}){N(this,"id",void 0),N(this,"color",void 0),N(this,"intensity",void 0),N(this,"type","ambient");const{color:n=q4}=e,{intensity:i=Z4}=e;this.id=e.id||"ambient-".concat(X4++),this.color=n,this.intensity=i}}const K4=[255,255,255],J4=1,Q4=[0,0,-1];let eB=0;class gT{constructor(e={}){N(this,"id",void 0),N(this,"color",void 0),N(this,"intensity",void 0),N(this,"type","directional"),N(this,"direction",void 0),N(this,"shadow",void 0);const{color:n=K4}=e,{intensity:i=J4}=e,{direction:o=Q4}=e,{_shadow:u=!1}=e;this.id=e.id||"directional-".concat(eB++),this.color=n,this.intensity=i,this.type="directional",this.direction=new Co(o).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class tB{constructor(e,n={id:"pass"}){N(this,"id",void 0),N(this,"gl",void 0),N(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Y0 extends tB{constructor(...e){super(...e),N(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return oa(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:o,views:u,onViewportActive:f,clearStack:l=!0,clearCanvas:b=!0}=e;e.pass=e.pass||"unknown";const w=this.gl;b&&iB(w,n),l&&(this._lastRenderIndex=-1);const C=[];for(const L of o){const k=u&&u[L.id];f==null||f(L);const H=this._getDrawLayerParams(L,e),K=L.subViewports||[L];for(const re of K){const ce=this._drawLayersInViewport(w,{target:n,moduleParameters:i,viewport:re,view:k,pass:e.pass,layers:e.layers},H);C.push(ce)}}return C}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:o=!1,layerFilter:u,cullRect:f,effects:l,moduleParameters:b},w=!1){const C=[],L=DA(this._lastRenderIndex+1),k={layer:n[0],viewport:e,isPicking:o,renderPass:i,cullRect:f},H={};for(let K=0;K<n.length;K++){const re=n[K],ce=this._shouldDrawLayer(re,k,u,H),W={shouldDrawLayer:ce};ce&&!w&&(W.layerRenderIndex=L(re,ce),W.moduleParameters=this._getModuleParameters(re,l,i,b),W.layerParameters=this.getLayerParameters(re,K,e)),C[K]=W}return C}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:o,target:u,viewport:f,view:l},b){const w=nB(e,{moduleParameters:i,target:u,viewport:f});if(l&&l.props.clear){const L=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;oo(e,{scissorTest:!0,scissor:w},()=>$0(e,L))}const C={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};oa(e,{viewport:w});for(let L=0;L<n.length;L++){const k=n[L],{shouldDrawLayer:H,layerRenderIndex:K,moduleParameters:re,layerParameters:ce}=b[L];if(H&&k.props.pickable&&C.pickableCount++,k.isComposite)C.compositeCount++;else if(H){C.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,K),re.viewport=f;try{k._drawLayer({moduleParameters:re,uniforms:{layerIndex:K},parameters:ce})}catch(W){k.raiseError(W,"drawing ".concat(k," to ").concat(o))}}}return C}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(n))return!1;n.layer=f,f=f.parent}if(i){const l=n.layer.id;if(l in o||(o[l]=i(n)),!o[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,o){var u;const f=Object.assign(Object.create(((u=e.internalState)===null||u===void 0?void 0:u.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:bu(this.gl)});if(n)for(const b of n){var l;Object.assign(f,(l=b.getModuleParameters)===null||l===void 0?void 0:l.call(b,e))}return Object.assign(f,this.getModuleParameters(e,n),o)}}function DA(t=0,e={}){const n={},i=(o,u)=>{const f=o.props._offset,l=o.id,b=o.parent&&o.parent.id;let w;if(b&&!(b in e)&&i(o.parent,!1),b in n){const C=n[b]=n[b]||DA(e[b],e);w=C(o,u),n[l]=C}else Number.isFinite(f)?(w=f+(e[b]||0),n[l]=null):w=t;return u&&w>=t&&(t=w+1),e[l]=w,w};return i}function nB(t,{moduleParameters:e,target:n,viewport:i}){const o=n&&n.id!=="default-framebuffer",u=e&&e.devicePixelRatio||bu(t),f=o?n.height:t.drawingBufferHeight,l=i;return[l.x*u,f-(l.y+l.height)*u,l.width*u,l.height*u]}function iB(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;oa(t,{viewport:[0,0,n,i]}),t.clear(16640)}class rB extends Y0{constructor(e,n){super(e,n),N(this,"shadowMap",void 0),N(this,"depthBuffer",void 0),N(this,"fbo",void 0),this.shadowMap=new gs(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new iu(e,{format:33189,width:1,height:1}),this.fbo=new Pi(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;oo(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],o=bu(this.gl),u=i.width*o,f=i.height*o;(u!==n.width||f!==n.height)&&n.resize({width:u,height:f}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const zA="#define SMOOTH_EDGE_RADIUS 0.5",sB=`
`.concat(zA,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),oB=`
`.concat(zA,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),aB={name:"geometry",vs:sB,fs:oB},lB=Object.keys(_n).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(_n[t],";")).join(""),cB=Object.keys(So).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(So[t],";")).join(""),uB=Object.keys(Wl).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Wl[t],";")).join(""),hB="".concat(lB,`
`).concat(cB,`
`).concat(uB,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function dB(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Jd(t){let e={},n;return i=>{for(const o in i)if(!dB(i[o],e[o])){n=t(i),e=i;break}return n}}const _T=[0,0,0,0],fB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],OA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],pB=[0,0,0],FA=[0,0,0],mB=Jd(yB);function BA(t,e,n=FA){n.length<3&&(n=[n[0],n[1],0]);let i=n,o,u=!0;switch(e===_n.LNGLAT_OFFSETS||e===_n.METER_OFFSETS?o=n:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case So.WEB_MERCATOR:(e===_n.LNGLAT||e===_n.CARTESIAN)&&(o=[0,0,0],u=!1);break;case So.WEB_MERCATOR_AUTO_OFFSET:e===_n.LNGLAT?i=o:e===_n.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case So.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case So.GLOBE:u=!1,o=null;break;default:u=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:i,offsetMode:u}}function gB(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:o}=t;let{viewMatrix:u,viewProjectionMatrix:f}=t,l=_T,b=_T,w=t.cameraPosition;const{geospatialOrigin:C,shaderCoordinateOrigin:L,offsetMode:k}=BA(t,e,n);return k&&(b=t.projectPosition(C||L),w=[w[0]-b[0],w[1]-b[1],w[2]-b[2]],b[3]=1,l=Xd([],b,f),u=i||u,f=Ul([],o,u),f=Ul([],f,fB)),{viewMatrix:u,viewProjectionMatrix:f,projectionCenter:l,originCommon:b,cameraPosCommon:w,shaderCoordinateOrigin:L,geospatialOrigin:C}}function _B({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=_n.DEFAULT,coordinateOrigin:o=FA,autoWrapLongitude:u=!1}){i===_n.DEFAULT&&(i=t.isGeospatial?_n.LNGLAT:_n.CARTESIAN);const f=mB({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:o});return f.project_uWrapLongitude=u,f.project_uModelMatrix=n||OA,f}function yB({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:o,viewProjectionMatrix:u,originCommon:f,cameraPosCommon:l,shaderCoordinateOrigin:b,geospatialOrigin:w}=gB(t,n,i),C=t.getDistanceScales(),L=[t.width*e,t.height*e],k=Xd([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,H={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:b,project_uCommonOrigin:f.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:L,project_uDevicePixelRatio:e,project_uFocalDistance:k,project_uCommonUnitsPerMeter:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:pB,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:u,project_uModelMatrix:OA,project_uCameraPosition:l};if(w){const K=t.getDistanceScales(w);switch(n){case _n.METER_OFFSETS:H.project_uCommonUnitsPerWorldUnit=K.unitsPerMeter,H.project_uCommonUnitsPerWorldUnit2=K.unitsPerMeter2;break;case _n.LNGLAT:case _n.LNGLAT_OFFSETS:t._pseudoMeters||(H.project_uCommonUnitsPerMeter=K.unitsPerMeter),H.project_uCommonUnitsPerWorldUnit=K.unitsPerDegree,H.project_uCommonUnitsPerWorldUnit2=K.unitsPerDegree2;break;case _n.CARTESIAN:H.project_uCommonUnitsPerWorldUnit=[1,1,K.unitsPerMeter[2]],H.project_uCommonUnitsPerWorldUnit2=[0,0,K.unitsPerMeter2[2]];break}}return H}const vB={};function xB(t=vB){return"viewport"in t?_B(t):{}}const K0={name:"project",dependencies:[SF,aB],vs:hB,getUniforms:xB};function bB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hu(t,e){const n=Xd([],e,t);return u4(n,n,1/n[3]),n}function yT(t,e){const n=t%e;return n<0?e+n:n}function Pv(t,e,n){return t<e?e:t>n?n:t}function wB(t){return Math.log(t)*Math.LOG2E}const J0=Math.log2||wB;function aa(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const io=Math.PI,NA=io/4,Fs=io/180,Iv=180/io,Au=512,Rm=4003e4,Mp=85.051129,TB=1.5;function EB(t){return J0(t)}function zd(t){const[e,n]=t;aa(Number.isFinite(e)),aa(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Fs,o=n*Fs,u=Au*(i+io)/(2*io),f=Au*(io+Math.log(Math.tan(NA+o*.5)))/(2*io);return[u,f]}function Pu(t){const[e,n]=t,i=e/Au*(2*io)-io,o=2*(Math.atan(Math.exp(n/Au*(2*io)-io))-NA);return[i*Iv,o*Iv]}function SB(t){const{latitude:e}=t;aa(Number.isFinite(e));const n=Math.cos(e*Fs);return EB(Rm*n)-9}function Kp(t){const e=Math.cos(t*Fs);return Au/Rm/e}function Cv(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;aa(Number.isFinite(e)&&Number.isFinite(n));const o=Au,u=Math.cos(e*Fs),f=o/360,l=f/u,b=o/Rm/u,w={unitsPerMeter:[b,b,b],metersPerUnit:[1/b,1/b,1/b],unitsPerDegree:[f,l,b],degreesPerUnit:[1/f,1/l,1/b]};if(i){const C=Fs*Math.tan(e*Fs)/u,L=f*C/2,k=o/Rm*C,H=k/l*b;w.unitsPerDegree2=[0,L,k],w.unitsPerMeter2=[H,0,H]}return w}function UA(t,e){const[n,i,o]=t,[u,f,l]=e,{unitsPerMeter:b,unitsPerMeter2:w}=Cv({longitude:n,latitude:i,highPrecision:!0}),C=zd(t);C[0]+=u*(b[0]+w[0]*f),C[1]+=f*(b[1]+w[1]*f);const L=Pu(C),k=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[L[0],L[1],k]:L}function AB(t){const{height:e,pitch:n,bearing:i,altitude:o,scale:u,center:f}=t,l=bB();Lm(l,l,[0,0,-o]),LA(l,l,-n*Fs),kA(l,l,i*Fs);const b=u/e;return Z0(l,l,[b,b,b]),f&&Lm(l,l,UF([],f)),l}function PB(t){const{width:e,height:n,altitude:i,pitch:o=0,offset:u,center:f,scale:l,nearZMultiplier:b=1,farZMultiplier:w=1}=t;let{fovy:C=Dm(TB)}=t;i!==void 0&&(C=Dm(i));const L=C*Fs,k=o*Fs,H=VA(C);let K=H;f&&(K+=f[2]*l/Math.cos(k)/n);const re=L*(.5+(u?u[1]:0)/n),ce=Math.sin(re)*K/Math.sin(Pv(Math.PI/2-k-re,.01,Math.PI-.01)),W=Math.sin(k)*ce+K,G=K*10,Z=Math.min(W*w,G);return{fov:L,aspect:e/n,focalDistance:H,near:b,far:Z}}function Dm(t){return 2*Math.atan(.5/t)*Iv}function VA(t){return .5/Math.tan(.5*t*Fs)}function jA(t,e){const[n,i,o=0]=t;return aa(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),hu(e,[n,i,o,1])}function Q0(t,e,n=0){const[i,o,u]=t;if(aa(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u))return hu(e,[i,o,u,1]);const f=hu(e,[i,o,0,1]),l=hu(e,[i,o,1,1]),b=f[2],w=l[2],C=b===w?0:((n||0)-b)/(w-b);return IA([],f,l,C)}function IB(t){const{width:e,height:n,bounds:i,minExtent:o=0,maxZoom:u=24,offset:f=[0,0]}=t,[[l,b],[w,C]]=i,L=CB(t.padding),k=zd([l,Pv(C,-Mp,Mp)]),H=zd([w,Pv(b,-Mp,Mp)]),K=[Math.max(Math.abs(H[0]-k[0]),o),Math.max(Math.abs(H[1]-k[1]),o)],re=[e-L.left-L.right-Math.abs(f[0])*2,n-L.top-L.bottom-Math.abs(f[1])*2];aa(re[0]>0&&re[1]>0);const ce=re[0]/K[0],W=re[1]/K[1],G=(L.right-L.left)/2/ce,Z=(L.top-L.bottom)/2/W,fe=[(H[0]+k[0])/2+G,(H[1]+k[1])/2+Z],Te=Pu(fe),Pe=Math.min(u,J0(Math.abs(Math.min(ce,W))));return aa(Number.isFinite(Pe)),{longitude:Te[0],latitude:Te[1],zoom:Pe}}function CB(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(aa(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const vT=Math.PI/180;function MB(t,e=0){const{width:n,height:i,unproject:o}=t,u={targetZ:e},f=o([0,i],u),l=o([n,i],u);let b,w;const C=t.fovy?.5*t.fovy*vT:Math.atan(.5/t.altitude),L=(90-t.pitch)*vT;return C>L-.01?(b=xT(t,0,e),w=xT(t,n,e)):(b=o([0,0],u),w=o([n,0],u)),[f,l,w,b]}function xT(t,e,n){const{pixelUnprojectionMatrix:i}=t,o=hu(i,[e,0,1,1]),u=hu(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-o[2])/(u[2]-o[2]),b=IA([],o,u,l),w=Pu(b);return w.push(n),w}const bT=512;function LB(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:o,latitude:u,zoom:f,bearing:l=0}=t;(o<-180||o>180)&&(o=yT(o+180,360)-180),(l<-180||l>180)&&(l=yT(l+180,360)-180);const b=J0(n/bT);if(f<=b)f=b,u=0;else{const w=n/2/Math.pow(2,f),C=Pu([0,w])[1];if(u<C)u=C;else{const L=Pu([0,bT-w])[1];u>L&&(u=L)}}return{width:e,height:n,longitude:o,latitude:u,zoom:f,pitch:i,bearing:l}}const kB=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,RB=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,DB=Jd(NB),zB=Jd(UB),OB=[0,0,0,1],FB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function BB(t,e){const[n,i,o]=t,u=Q0([n,i,o],e);return Number.isFinite(o)?u:[u[0],u[1],0]}function NB({viewport:t,center:e}){return new Mo(t.viewProjectionMatrix).invert().transform(e)}function UB({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,u=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(f=>BB(f,i));for(const f of e){const l=f.clone().translate(new Co(t.center).negate()),b=u.map(C=>l.transform(C)),w=new Mo().ortho({left:Math.min(...b.map(C=>C[0])),right:Math.max(...b.map(C=>C[0])),bottom:Math.min(...b.map(C=>C[1])),top:Math.max(...b.map(C=>C[1])),near:Math.min(...b.map(C=>-C[2])),far:Math.max(...b.map(C=>-C[2]))});n.push(w.multiplyRight(f))}return n}function VB(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||OB,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},o=DB({viewport:t.viewport,center:e.project_uCenter}),u=[],f=zB({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const b=f[l],w=b.clone().translate(new Co(t.viewport.center).negate());e.project_uCoordinateSystem===_n.LNGLAT&&e.project_uProjectionMode===So.WEB_MERCATOR?(f[l]=w,u[l]=o):(f[l]=b.clone().multiplyRight(FB),u[l]=w.transform(o))}for(let l=0;l<f.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=f[l],i["shadow_uProjectCenters[".concat(l,"]")]=u[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const sy={name:"shadow",dependencies:[K0],vs:kB,fs:RB,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?VB(t,e):{}},jB={color:[255,255,255],intensity:1},wT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],GB=[0,0,0,200/255];class GA{constructor(e={}){N(this,"id","lighting-effect"),N(this,"props",void 0),N(this,"shadowColor",GB),N(this,"shadow",void 0),N(this,"ambientLight",void 0),N(this,"directionalLights",void 0),N(this,"pointLights",void 0),N(this,"shadowPasses",[]),N(this,"shadowMaps",[]),N(this,"dummyShadowMap",null),N(this,"programManager",void 0),N(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:o,onViewportActive:u,views:f}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Yd.getDefaultProgramManager(e),sy&&this.programManager.addDefaultModule(sy)),this.dummyShadowMap||(this.dummyShadowMap=new gs(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:o,onViewportActive:u,views:f,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(sy),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Mo().lookAt({eye:new Co(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new rB(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new Y4(jB),this.directionalLights.push(new gT(wT[0]),new gT(wT[1])))}}class $B{constructor(e={}){N(this,"_pool",[]),N(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:o,padding:u=0,copy:f=!1,initialize:l=!1,maxCount:b}){const w=o||e&&e.constructor||Float32Array,C=n*i+u;if(ArrayBuffer.isView(e)){if(C<=e.length)return e;if(C*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,C)}let L=1/0;b&&(L=b*i+u);const k=this._allocate(w,C,l,L);return e&&f?k.set(e):l||k.fill(0,0,4),this._release(e),k}release(e){this._release(e)}_allocate(e,n,i,o){let u=Math.max(Math.ceil(n*this.opts.overAlloc),1);u>o&&(u=o);const f=this._pool,l=e.BYTES_PER_ELEMENT*u,b=f.findIndex(w=>w.byteLength>=l);if(b>=0){const w=new e(f.splice(b,1)[0],0,u);return i&&w.fill(0),w}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:o}=i,u=n.findIndex(f=>f.byteLength>=o);u<0?n.push(i):(u>0||n.length<this.opts.poolSize)&&n.splice(u,0,i),n.length>this.opts.poolSize&&n.shift()}}const Iu=new $B;function Qh(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function HB(t){return[t[12],t[13],t[14]]}function WB(t){return{left:jc(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:jc(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:jc(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:jc(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:jc(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:jc(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const TT=new Co;function jc(t,e,n,i){TT.set(t,e,n);const o=TT.len();return{distance:i/o,normal:new Co(-t/o,-e/o,-n/o)}}function qB(t){return t-Math.fround(t)}let Wh;function oy(t,e){const{size:n=1,startIndex:i=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,u=(o-i)/n;Wh=Iu.allocate(Wh,u,{type:Float32Array,size:n*2});let f=i,l=0;for(;f<o;){for(let b=0;b<n;b++){const w=t[f++];Wh[l+b]=w,Wh[l+b+n]=qB(w)}l+=n*2}return Wh.subarray(0,u*n*2)}function ZB(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const XB=Math.PI/180,YB=Qh(),ET=[0,0,0],KB={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function JB({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:o,padding:u,near:f,far:l}){const b=t/e,w=n?new Mo().orthographic({fovy:i,aspect:b,focalDistance:o,near:f,far:l}):new Mo().perspective({fovy:i,aspect:b,near:f,far:l});if(u){const{left:C=0,right:L=0,top:k=0,bottom:H=0}=u,K=ja((C+t-L)/2,0,t)-t/2,re=ja((k+e-H)/2,0,e)-e/2;w[8]-=K*2/t,w[9]+=re*2/e}return w}class Ru{constructor(e={}){N(this,"id",void 0),N(this,"x",void 0),N(this,"y",void 0),N(this,"width",void 0),N(this,"height",void 0),N(this,"padding",void 0),N(this,"isGeospatial",void 0),N(this,"zoom",void 0),N(this,"focalDistance",void 0),N(this,"position",void 0),N(this,"modelMatrix",void 0),N(this,"distanceScales",void 0),N(this,"scale",void 0),N(this,"center",void 0),N(this,"cameraPosition",void 0),N(this,"projectionMatrix",void 0),N(this,"viewMatrix",void 0),N(this,"viewMatrixUncentered",void 0),N(this,"viewMatrixInverse",void 0),N(this,"viewProjectionMatrix",void 0),N(this,"pixelProjectionMatrix",void 0),N(this,"pixelUnprojectionMatrix",void 0),N(this,"resolution",void 0),N(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||KB,this.focalDistance=e.focalDistance||1,this.position=e.position||ET,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?So.WEB_MERCATOR:So.WEB_MERCATOR_AUTO_OFFSET:So.IDENTITY}equals(e){return e instanceof Ru?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Dd(e.projectionMatrix,this.projectionMatrix)&&Dd(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),o=jA(i,this.pixelProjectionMatrix),[u,f]=o,l=n?f:this.height-f;return e.length===2?[u,l]:[u,l,o[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[o,u,f]=e,l=n?u:this.height-u,b=i&&i*this.distanceScales.unitsPerMeter[2],w=Q0([o,l,f],this.pixelUnprojectionMatrix,b),[C,L,k]=this.unprojectPosition(w);return Number.isFinite(f)?[C,L,k]:Number.isFinite(i)?[C,L,i]:[C,L]}projectPosition(e){const[n,i]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,o]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,o]}projectFlat(e){if(this.isGeospatial){const n=zd(e);return n[1]=ja(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Pu(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),o=this.unproject([this.width,0],n),u=this.unproject([0,this.height],n),f=this.unproject([this.width,this.height],n);return[Math.min(i[0],o[0],u[0],f[0]),Math.min(i[1],o[1],u[1],f[1]),Math.max(i[0],o[0],u[0],f[0]),Math.max(i[1],o[1],u[1],f[1])]}getDistanceScales(e){return e?Cv({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:o=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,WB(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=SB({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Cv({latitude:i,longitude:n}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:u,modelMatrix:f}=e;let l=ET;if(u&&(l=f?new Mo(f).transformAsVector(u,[]):u),this.isGeospatial){const b=this.projectPosition([n,i,0]);this.center=new Co(l).scale(this.distanceScales.unitsPerMeter).add(b)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=YB,projectionMatrix:i=null,orthographic:o=!1,fovyRadians:u,fovy:f=75,near:l=.1,far:b=1e3,padding:w=null,focalDistance:C=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Mo().multiplyRight(n).translate(new Co(this.center).negate()),this.projectionMatrix=i||JB({width:this.width,height:this.height,orthographic:o,fovyRadians:u||f*XB,focalDistance:C,padding:w,near:l,far:b});const L=Qh();Ul(L,L,this.projectionMatrix),Ul(L,L,this.viewMatrix),this.viewProjectionMatrix=L,this.viewMatrixInverse=Sv([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=HB(this.viewMatrixInverse);const k=Qh(),H=Qh();Z0(k,k,[this.width/2,-this.height/2,1]),Lm(k,k,[1,-1,0]),Ul(H,k,this.viewProjectionMatrix),this.pixelProjectionMatrix=H,this.pixelUnprojectionMatrix=Sv(Qh(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||an.warn("Pixel project matrix not invertible")()}}N(Ru,"displayName","Viewport");class Zl extends Ru{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:o=0,pitch:u=0,bearing:f=0,nearZMultiplier:l=.1,farZMultiplier:b=1.01,nearZ:w,farZ:C,orthographic:L=!1,projectionMatrix:k,repeat:H=!1,worldOffset:K=0,position:re,padding:ce,legacyMeterSizes:W=!1}=e;let{width:G,height:Z,altitude:fe=1.5}=e;const Te=Math.pow(2,o);G=G||1,Z=Z||1;let Pe,ze=null;if(k)fe=k[5]/2,Pe=Dm(fe);else{e.fovy?(Pe=e.fovy,fe=VA(Pe)):Pe=Dm(fe);let Me;if(ce){const{top:Ee=0,bottom:Re=0}=ce;Me=[0,ja((Ee+Z-Re)/2,0,Z)-Z/2]}ze=PB({width:G,height:Z,scale:Te,center:re&&[0,0,re[2]*Kp(n)],offset:Me,pitch:u,fovy:Pe,nearZMultiplier:l,farZMultiplier:b}),Number.isFinite(w)&&(ze.near=w),Number.isFinite(C)&&(ze.far=C)}let Oe=AB({height:Z,pitch:u,bearing:f,scale:Te,altitude:fe});K&&(Oe=new Mo().translate([512*K,0,0]).multiplyLeft(Oe)),super({...e,width:G,height:Z,viewMatrix:Oe,longitude:i,latitude:n,zoom:o,...ze,fovy:Pe,focalDistance:fe}),N(this,"longitude",void 0),N(this,"latitude",void 0),N(this,"pitch",void 0),N(this,"bearing",void 0),N(this,"altitude",void 0),N(this,"fovy",void 0),N(this,"orthographic",void 0),N(this,"_subViewports",void 0),N(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=o,this.pitch=u,this.bearing=f,this.altitude=fe,this.fovy=Pe,this.orthographic=L,this._subViewports=H?[]:null,this._pseudoMeters=W,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let o=n;o<=i;o++){const u=o?new Zl({...this,worldOffset:o}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),o=(e[2]||0)*Kp(e[1]);return[n,i,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),o=(e[2]||0)/Kp(i);return[n,i,o]}addMetersToLngLat(e,n){return UA(e,n)}panByPosition(e,n){const i=Q0(n,this.pixelUnprojectionMatrix),o=this.projectFlat(e),u=hT([],o,DF([],i)),f=hT([],this.center,u),[l,b]=this.unprojectFlat(f);return{longitude:l,latitude:b}}getBounds(e={}){const n=MB(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:o}=this,{longitude:u,latitude:f,zoom:l}=IB({width:i,height:o,bounds:e,...n});return new Zl({width:i,height:o,longitude:u,latitude:f,zoom:l})}}N(Zl,"displayName","WebMercatorViewport");const ST=[0,0,0];function ay(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Zl){const[o,u,f=0]=t,l=e.getDistanceScales([o,u]);i[2]=f*l.unitsPerMeter[2]}return i}function QB(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:o,fromCoordinateSystem:u,fromCoordinateOrigin:f}=t;return o===_n.DEFAULT&&(o=e.isGeospatial?_n.LNGLAT:_n.CARTESIAN),u===void 0&&(u=o),f===void 0&&(f=i),{viewport:e,coordinateSystem:o,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:u,fromCoordinateOrigin:f}}function $A(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:o,offsetMode:u}){let[f,l,b=0]=t;switch(n&&([f,l,b]=Xd([],[f,l,b,1],n)),i){case _n.LNGLAT:return ay([f,l,b],e,u);case _n.LNGLAT_OFFSETS:return ay([f+o[0],l+o[1],b+(o[2]||0)],e,u);case _n.METER_OFFSETS:return ay(UA(o,[f,l,b]),e,u);case _n.CARTESIAN:default:return e.isGeospatial?[f+o[0],l+o[1],b+o[2]]:e.projectPosition([f,l,b])}}function eN(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:o,modelMatrix:u,fromCoordinateSystem:f,fromCoordinateOrigin:l}=QB(e),{autoOffset:b=!0}=e,{geospatialOrigin:w=ST,shaderCoordinateOrigin:C=ST,offsetMode:L=!1}=b?BA(n,i,o):{},k=$A(t,{viewport:n,modelMatrix:u,coordinateSystem:f,coordinateOrigin:l,offsetMode:L});if(L){const H=n.projectPosition(w||C);XF(k,k,H)}return k}const AT={blendFunc:[1,0,32771,0],blendEquation:32774};class HA extends Y0{constructor(...e){super(...e),N(this,"pickZ",void 0),N(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:u,pickingFBO:f,deviceRect:{x:l,y:b,width:w,height:C},cullRect:L,effects:k,pass:H="picking",pickZ:K,moduleParameters:re}){const ce=this.gl;this.pickZ=K;const W=this._resetColorEncoder(K),G=oo(ce,{scissorTest:!0,scissor:[l,b,w,C],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...AT,blend:!K},()=>super.render({target:f,layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:u,cullRect:L,effects:k==null?void 0:k.filter(fe=>fe.useInPicking),pass:H,isPicking:!0,moduleParameters:re}));return this._colorEncoderState=null,{decodePickingColor:W&&nN.bind(null,W),stats:G}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const o={...e.props.parameters},{pickable:u,operation:f}=e.props;return this._colorEncoderState?u&&f.includes("draw")&&(Object.assign(o,AT),o.blend=!0,o.blendColor=tN(this._colorEncoderState,e,i)):o.blend=!1,f.includes("terrain")&&(o.blend=!1),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function tN(t,e,n){const{byLayer:i,byAlpha:o}=t;let u,f=i.get(e);return f?(f.viewports.push(n),u=f.a):(u=i.size+1,u<=255?(f={a:u,layer:e,viewports:[n]},i.set(e,f),o[u]=f):(an.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function nN(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const $c={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},zm=Symbol.for("component"),Qa=Symbol.for("propTypes"),ly=Symbol.for("deprecatedProps"),du=Symbol.for("asyncPropDefaults"),Xl=Symbol.for("asyncPropOriginal"),Ga=Symbol.for("asyncPropResolved");function Cu(t,e=()=>!0){return Array.isArray(t)?WA(t,e,[]):e(t)?[t]:[]}function WA(t,e,n){let i=-1;for(;++i<t.length;){const o=t[i];Array.isArray(o)?WA(o,e,n):e(o)&&n.push(o)}return n}function iN({target:t,source:e,start:n=0,count:i=1}){const o=e.length,u=i*o;let f=0;for(let l=n;f<o;f++)t[l++]=e[f];for(;f<u;)f<u-f?(t.copyWithin(n+f,n,n+f),f*=2):(t.copyWithin(n+f,n,n+u-f),f=u);return t}class rN{constructor(e,n,i){N(this,"id",void 0),N(this,"context",void 0),N(this,"isLoaded",void 0),N(this,"persistent",void 0),N(this,"_loadCount",0),N(this,"_subscribers",new Set),N(this,"_data",void 0),N(this,"_loader",void 0),N(this,"_error",void 0),N(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let o=e;typeof e=="string"&&(o=Pm(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(u=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===i&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class sN{constructor({gl:e,protocol:n}){N(this,"protocol",void 0),N(this,"_context",void 0),N(this,"_resources",void 0),N(this,"_consumers",void 0),N(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:o=!0}){let u=this._resources[e];u?u.setData(n,i):(u=new rN(e,n,this._context),this._resources[e]=u),u.persistent=o}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const o=n[i],u=this._resources[o.resourceId];u&&u.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:o="default"}){const{_resources:u,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=u[e];if(this._track(i,o,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,o){const u=this._consumers,f=u[e]=u[e]||{},l=f[n]||{},b=l.resourceId&&this._resources[l.resourceId];b&&(b.unsubscribe(l),this.prune()),i&&(f[n]=l,l.onChange=o,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const oN=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,og={name:"project32",dependencies:[K0],vs:oN},ag={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...w4},aN=[K0],lN=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function cN(t){const e=Yd.getDefaultProgramManager(t);for(const n of aN)e.addDefaultModule(n);for(const n of lN)e.addShaderHook(n);return e}const uN="layerManager.setLayers",hN="layerManager.activateViewport";class dN{constructor(e,{deck:n,stats:i,viewport:o,timeline:u}={}){N(this,"layers",void 0),N(this,"context",void 0),N(this,"resourceManager",void 0),N(this,"_lastRenderedLayers",[]),N(this,"_needsRedraw",!1),N(this,"_needsUpdate",!1),N(this,"_nextLayers",null),N(this,"_debug",!1),N(this,"activateViewport",f=>{hr(hN,this,f),f&&(this.context.viewport=f)}),this.layers=[],this.resourceManager=new sN({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&cN(e),stats:i||new R0({id:"deck.gl"}),viewport:o||new Ru({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new RA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const o=i.getNeedsRedraw(e);n=n||o}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){hr(uN,this,n,e),this._lastRenderedLayers=e;const i=Cu(e,Boolean);for(const o of i)o.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const f of e)i[f.id]?an.warn("Multiple old layers with same id ".concat(f.id))():i[f.id]=f;const o=[];this._updateSublayersRecursively(n,i,o),this._finalizeOldLayers(i);let u=!1;for(const f of o)if(f.hasUniformTransition()){u="Uniform transition in ".concat(f);break}this._needsUpdate=u,this.layers=o}_updateSublayersRecursively(e,n,i){for(const o of e){o.context=this.context;const u=n[o.id];u===null&&an.warn("Multiple new layers with same id ".concat(o.id))(),n[o.id]=null;let f=null;try{this._debug&&u!==o&&o.validateProps(),u?(this._transferLayerState(u,o),this._updateLayer(o)):this._initializeLayer(o),i.push(o),f=o.isComposite?o.getSubLayers():null}catch(l){this._handleError("matching",l,o)}f&&this._updateSublayersRecursively(f,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=$c.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=$c.MATCHED,n!==e&&(e.lifecycle=$c.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=$c.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=$c.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Ao(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ao(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(const u of i)if(!e.hasOwnProperty(u)||!Ao(t[u],e[u],n-1))return!1;return!0}return!1}class fN{constructor(e){N(this,"width",void 0),N(this,"height",void 0),N(this,"views",void 0),N(this,"viewState",void 0),N(this,"controllers",void 0),N(this,"timeline",void 0),N(this,"_viewports",void 0),N(this,"_viewportMap",void 0),N(this,"_isUpdating",void 0),N(this,"_needsRedraw",void 0),N(this,"_needsUpdate",void 0),N(this,"_eventManager",void 0),N(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),o={x:e[0],y:e[1]};for(let u=i.length-1;u>=0;--u){const f=i[u];if(f.containsPixel(o)){const l=e.slice();return l[0]-=f.x,l[1]-=f.y,f.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Cu(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ao(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):an.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var f;return(f=this.getView(e.id))===null||f===void 0?void 0:f.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,n,i,o){const u=e.controller;if(u&&i){const f={...n,...u,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!o||o.constructor!==u.type)&&(o=this._createController(e,f)),o&&o.setProps(f),o}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let o=e.length;o--;){const u=e[o],f=this.getViewState(u),l=u.makeViewport({viewState:f,width:this.width,height:this.height});let b=n[u.id];const w=!!u.controller;w&&!b&&(i=!0),(i||!w)&&b&&(b.finalize(),b=null),this.controllers[u.id]=this._updateController(u,f,l,b),l&&this._viewports.unshift(l)}for(const o in n){const u=n[o];u&&!this.controllers[o]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,o)=>!e[o].equals(n[o]))}}const pN=/([0-9]+\.?[0-9]*)(%|px)/;function Ra(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=pN.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Da(t,e){return t.relative?Math.round(t.position*e):t.position}function mi(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class mN{constructor(e){N(this,"id",void 0),N(this,"viewportInstance",void 0),N(this,"_x",void 0),N(this,"_y",void 0),N(this,"_width",void 0),N(this,"_height",void 0),N(this,"_padding",void 0),N(this,"props",void 0);const{id:n,x:i=0,y:o=0,width:u="100%",height:f="100%",padding:l=null,viewportInstance:b}=e||{};mi(!b||b instanceof Ru),this.viewportInstance=b,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Ra(i),this._y=Ra(o),this._width=Ra(u),this._height=Ra(f),this._padding=l&&{left:Ra(l.left||0),right:Ra(l.right||0),top:Ra(l.top||0),bottom:Ra(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Ao(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const o=this.getDimensions({width:e,height:n});return!o.height||!o.width?null:new this.ViewportType({...i,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Da(this._x,e),y:Da(this._y,n),width:Da(this._width,e),height:Da(this._height,n)};return this._padding&&(i.padding={left:Da(this._padding.left,e),top:Da(this._padding.top,n),right:Da(this._padding.right,e),bottom:Da(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Qd{constructor(e){N(this,"_inProgress",void 0),N(this,"_handle",void 0),N(this,"_timeline",void 0),N(this,"time",void 0),N(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:o}=this;this._handle=i.addChannel({delay:i.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const PT=()=>{},Mv={BREAK:1,SNAP_TO_END:2,IGNORE:3},gN=t=>t,_N=Mv.BREAK;class yN{constructor(e){N(this,"getControllerState",void 0),N(this,"props",void 0),N(this,"propsInTransition",void 0),N(this,"transition",void 0),N(this,"onViewStateChange",void 0),N(this,"onStateChange",void 0),N(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:o,startProps:u,endProps:f,duration:l,easing:b}}=n,w=b(i/l),C=o.interpolateProps(u,f,w);this.propsInTransition=this.getControllerState({...this.props,...C}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Qd(e.timeline),this.onViewStateChange=e.onViewStateChange||PT,this.onStateChange=e.onStateChange||PT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let o=i;if(this.transition.inProgress){const{interruption:u,endProps:f}=this.transition.settings;o={...i,...u===Mv.SNAP_TO_END?f:this.propsInTransition||i}}this._triggerTransition(o,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Mv.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),o=this.getControllerState(n).shortestPathFrom(i),u=n.transitionInterpolator,f=u.getDuration?u.getDuration(e,n):n.transitionDuration;if(f===0)return;const l=u.initializeProps(e,o);this.propsInTransition={};const b={duration:f,easing:n.transitionEasing||gN,interpolator:u,interruption:n.transitionInterruption||_N,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(b),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class vN{constructor(e){N(this,"_propsToCompare",void 0),N(this,"_propsToExtract",void 0),N(this,"_requiredProps",void 0);const{compare:n,extract:i,required:o}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=o}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!Dd(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},o={};for(const u of this._propsToExtract)(u in e||u in n)&&(i[u]=e[u],o[u]=n[u]);return this._checkRequiredProps(i),this._checkRequiredProps(o),{start:i,end:o}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];mi(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const xN=["longitude","latitude","zoom","bearing","pitch"],bN=["longitude","latitude","zoom"];class qA extends vN{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:xN,required:bN},super(i.transitionProps),N(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:o,around:u}=this.opts;if(o&&u){const f=o(e),l=o(n),b=f.unproject(u);i.start.around=u,Object.assign(i.end,{around:l.project(b),aroundPosition:b,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const o={};for(const u of this._propsToExtract)o[u]=Mm(e[u]||0,n[u]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...n,...o});Object.assign(o,u.panByPosition(n.aroundPosition,Mm(e.around,n.around,i)))}return o}}const za={transitionDuration:0},wN=300,Lp=t=>1-(1-t)*(1-t),Gc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Cl={};class TN{constructor(e){N(this,"props",void 0),N(this,"state",{}),N(this,"transitionManager",void 0),N(this,"eventManager",void 0),N(this,"onViewStateChange",void 0),N(this,"onStateChange",void 0),N(this,"makeViewport",void 0),N(this,"_controllerState",void 0),N(this,"_events",{}),N(this,"_interactionState",{isDragging:!1}),N(this,"_customEvents",[]),N(this,"_eventStartBlocked",null),N(this,"_panMove",!1),N(this,"invertPan",!1),N(this,"dragMode","rotate"),N(this,"inertia",0),N(this,"scrollZoom",!0),N(this,"dragPan",!0),N(this,"dragRotate",!0),N(this,"doubleClickZoom",!0),N(this,"touchZoom",!0),N(this,"touchRotate",!1),N(this,"keyboard",!0),this.transitionManager=new yN({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:o}=e;return[o.x-n,o.y-i]}isPointInBounds(e,n){const{width:i,height:o}=this.props;if(n&&n.handled)return!1;const u=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=o;return u&&n&&n.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?wN:0;const{scrollZoom:i=!0,dragPan:o=!0,dragRotate:u=!0,doubleClickZoom:f=!0,touchZoom:l=!0,touchRotate:b=!1,keyboard:w=!0}=e,C=!!this.onViewStateChange;this.toggleEvents(Gc.WHEEL,C&&i),this.toggleEvents(Gc.PAN,C),this.toggleEvents(Gc.PINCH,C&&(l||b)),this.toggleEvents(Gc.TRIPLE_PAN,C&&b),this.toggleEvents(Gc.DOUBLE_TAP,C&&f),this.toggleEvents(Gc.KEYBOARD,C&&w),this.scrollZoom=i,this.dragPan=o,this.dragRotate=u,this.doubleClickZoom=f,this.touchZoom=l,this.touchRotate=b,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const o={...e.getViewportProps(),...n},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),u){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:f})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const o=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(o,za,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,za,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],u=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Lp},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,za,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],u=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Lp},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let f=2/(1+Math.exp(-Math.abs(u*i)));u<0&&f!==0&&(f=1/f);const l=this.controllerState.zoom({pos:n,scale:f});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,za,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,za,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),o=[i[0],i[1]+=e.velocityY*n/2],u=this.controllerState.rotate({pos:o});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Lp},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Cl._startPinchRotation=e.rotation,Cl._lastPinchEvent=e,this.updateViewport(i,za,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,o=this.getCenter(e);n=n.zoom({pos:o,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Cl._startPinchRotation-i})}return this.updateViewport(n,za,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Cl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Cl;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const o=this.getCenter(e);let u=this.controllerState.rotateEnd();const f=Math.log2(e.scale),l=(f-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),b=Math.pow(2,f+l*n/2);u=u.zoom({pos:o,scale:b}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:o}),transitionDuration:n,transitionEasing:Lp},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Cl._startPinchRotation=null,Cl._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(o,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:o,rotateSpeedX:u,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let b;const w={};switch(e.srcEvent.code){case"Minus":b=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),w.isZooming=!0;break;case"Equal":b=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),w.isZooming=!0;break;case"ArrowLeft":n?(b=l.rotateLeft(u),w.isRotating=!0):(b=l.moveLeft(o),w.isPanning=!0);break;case"ArrowRight":n?(b=l.rotateRight(u),w.isRotating=!0):(b=l.moveRight(o),w.isPanning=!0);break;case"ArrowUp":n?(b=l.rotateUp(f),w.isRotating=!0):(b=l.moveUp(o),w.isPanning=!0);break;case"ArrowDown":n?(b=l.rotateDown(f),w.isRotating=!0):(b=l.moveDown(o),w.isPanning=!0);break;default:return!1}return this.updateViewport(b,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?za:e?{...n,transitionInterpolator:new qA({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class EN{constructor(e,n){N(this,"_viewportProps",void 0),N(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const IT=5,SN=1.2;class AN extends EN{constructor(e){const{width:n,height:i,latitude:o,longitude:u,zoom:f,bearing:l=0,pitch:b=0,altitude:w=1.5,position:C=[0,0,0],maxZoom:L=20,minZoom:k=0,maxPitch:H=60,minPitch:K=0,startPanLngLat:re,startZoomLngLat:ce,startRotatePos:W,startBearing:G,startPitch:Z,startZoom:fe,normalize:Te=!0}=e;mi(Number.isFinite(u)),mi(Number.isFinite(o)),mi(Number.isFinite(f)),super({width:n,height:i,latitude:o,longitude:u,zoom:f,bearing:l,pitch:b,altitude:w,maxZoom:L,minZoom:k,maxPitch:H,minPitch:K,normalize:Te,position:C},{startPanLngLat:re,startZoomLngLat:ce,startRotatePos:W,startBearing:G,startPitch:Z,startZoom:fe}),N(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:o,startBearing:u,startPitch:f}=this.getState();if(!o||u===void 0||f===void 0)return this;let l;return e?l=this._getNewRotation(e,o,f,u):l={bearing:u+n,pitch:f+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:o,startZoomLngLat:u}=this.getState();if(u||(o=this.getViewportProps().zoom,u=this._unproject(n)||this._unproject(e)),!u)return this;const{maxZoom:f,minZoom:l}=this.getViewportProps();let b=o+Math.log2(i);b=ja(b,l,f);const w=this.makeViewport({...this.getViewportProps(),zoom:b});return this._getUpdatedState({zoom:b,...w.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:o,longitude:u}=i;return Math.abs(o-n.bearing)>180&&(i.bearing=o<0?o+360:o-360),Math.abs(u-n.longitude)>180&&(i.longitude=u<0?u+360:u-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:o}=e;e.zoom=ja(o,i,n);const{maxPitch:u,minPitch:f,pitch:l}=e;e.pitch=ja(l,f,u);const{normalize:b=!0}=e;return b&&Object.assign(e,LB(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,o){const u=e[0]-n[0],f=e[1]-n[1],l=e[1],b=n[1],{width:w,height:C}=this.getViewportProps(),L=u/w;let k=0;f>0?Math.abs(C-b)>IT&&(k=f/(b-C)*SN):f<0&&b>IT&&(k=1-l/b),k=ja(k,-1,1);const{minPitch:H,maxPitch:K}=this.getViewportProps(),re=o+180*L;let ce=i;return k>0?ce=i+k*(K-i):k<0&&(ce=i-k*(H-i)),{pitch:ce,bearing:re}}}class PN extends TN{constructor(...e){super(...e),N(this,"ControllerState",AN),N(this,"transition",{transitionDuration:300,transitionInterpolator:new qA({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),N(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class ex extends mN{get ViewportType(){return Zl}get ControllerType(){return PN}}N(ex,"displayName","MapView");const IN=new GA;function CN(t,e){var n,i;const o=(n=t.order)!==null&&n!==void 0?n:1/0,u=(i=e.order)!==null&&i!==void 0?i:1/0;return o-u}class MN{constructor(){N(this,"effects",void 0),N(this,"_resolvedEffects",[]),N(this,"_defaultEffects",[]),N(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(o=>CN(o,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ao(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const o of this.effects)n[o.id]=o;const i=[];for(const o of e){const u=n[o.id];u&&u!==o?u.setProps?(u.setProps(o.props),i.push(u)):(u.cleanup(),i.push(o)):i.push(o),delete n[o.id]}for(const o in n)n[o].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(o=>o instanceof GA)||this._resolvedEffects.push(IN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class LN extends Y0{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const kN="deckRenderer.renderLayers";class RN{constructor(e){N(this,"gl",void 0),N(this,"layerFilter",void 0),N(this,"drawPickingColors",void 0),N(this,"drawLayersPass",void 0),N(this,"pickLayersPass",void 0),N(this,"renderCount",void 0),N(this,"_needsRedraw",void 0),N(this,"renderBuffers",void 0),N(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new LN(e),this.pickLayersPass=new HA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Pi.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const o=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,u=n.render({...i,target:o});i.effects&&this._postRender(i.effects,i),this.renderCount++,hr(kN,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Pi(this.gl),new Pi(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,o={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const u of e)if(u.postRender){if(u.id===this.lastPostProcessEffect){o.target=n.target,u.postRender(this.gl,o);break}const f=u.postRender(this.gl,o);o.inputBuffer=f,o.swapBuffer=f===i[0]?i[1]:i[0]}}}const DN={pickedColor:null,pickedObjectIndex:-1};function zN({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:o,deviceRect:u}){const{x:f,y:l,width:b,height:w}=u;let C=o*o,L=-1,k=0;for(let H=0;H<w;H++){const K=H+l-i,re=K*K;if(re>C)k+=4*b;else for(let ce=0;ce<b;ce++){if(t[k+3]-1>=0){const G=ce+f-n,Z=G*G+re;Z<=C&&(C=Z,L=k)}k+=4}}if(L>=0){const H=t.slice(L,L+4),K=e(H);if(K){const re=Math.floor(L/4/b),ce=L/4-re*b;return{...K,pickedColor:H,pickedX:f+ce,pickedY:l+re}}an.error("Picked non-existent layer. Is picking buffer corrupt?")()}return DN}function ON({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const u=t.slice(i,i+4),f=u.join(",");if(!n.has(f)){const l=e(u);l?n.set(f,{...l,color:u}):an.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function ZA({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:o,z:u}){let f=e[0];e.length>1&&(f=BN((t==null?void 0:t.pickedViewports)||e,{x:i,y:o}));let l;if(f){const b=[i-f.x,o-f.y];u!==void 0&&(b[2]=u),l=f.unproject(b)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:i,y:o,pixel:[i,o],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function FN(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:o}=t,{pickedColor:u,pickedLayer:f,pickedObjectIndex:l}=e,b=f?[f]:[];if(i==="hover"){const L=n.index,k=n.layerId,H=f?f.props.id:null;if(H!==k||l!==L){if(H!==k){const K=o.find(re=>re.props.id===k);K&&b.unshift(K)}n.layerId=H,n.index=l,n.info=null}}const w=ZA(t),C=new Map;return C.set(null,w),b.forEach(L=>{let k={...w};L===f&&(k.color=u,k.index=l,k.picked=!0),k=XA({layer:L,info:k,mode:i});const H=k.layer;L===f&&i==="hover"&&(n.info=k),C.set(H.id,k),i==="hover"&&H.updateAutoHighlight(k)}),C}function XA({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function BN(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class NN{constructor(e){N(this,"gl",void 0),N(this,"pickingFBO",void 0),N(this,"depthFBO",void 0),N(this,"pickLayersPass",void 0),N(this,"layerFilter",void 0),N(this,"lastPickedInfo",void 0),N(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new HA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:o},u=this.lastPickedInfo.info){const f=u&&u.layer&&u.layer.id,l=u&&u.viewport&&u.viewport.id,b=f?i.find(k=>k.id===f):null,w=l&&o.find(k=>k.id===l)||o[0],C=w&&w.unproject([e-w.x,n-w.y]);return{...u,...{x:e,y:n,viewport:w,coordinate:C,layer:b}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Pi(i),Pi.isSupported(i,{colorBufferFloat:!0}))){const o=new Pi(i);o.attach({36064:new gs(i,{format:Yt(i)?34836:6408,type:5126})}),this.depthFBO=o}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:o,y:u,radius:f=0,depth:l=1,mode:b="query",unproject3D:w,onViewportActive:C,effects:L}){const k=this._getPickable(e),H=bu(this.gl);if(!k)return{result:[],emptyInfo:ZA({viewports:i,x:o,y:u,pixelRatio:H})};this._resizeBuffer();const K=W_(this.gl,[o,u],!0),re=[K.x+Math.floor(K.width/2),K.y+Math.floor(K.height/2)],ce=Math.round(f*H),{width:W,height:G}=this.pickingFBO,Z=this._getPickingRect({deviceX:re[0],deviceY:re[1],deviceRadius:ce,deviceWidth:W,deviceHeight:G}),fe={x:o-f,y:u-f,width:f*2+1,height:f*2+1};let Te;const Pe=[],ze=new Set;for(let Oe=0;Oe<l;Oe++){let Me;if(Z){const Re=this._drawAndSample({layers:k,views:n,viewports:i,onViewportActive:C,deviceRect:Z,cullRect:fe,effects:L,pass:"picking:".concat(b)});Me=zN({...Re,deviceX:re[0],deviceY:re[1],deviceRadius:ce,deviceRect:Z})}else Me={pickedColor:null,pickedObjectIndex:-1};let Ee;if(Me.pickedLayer&&w&&this.depthFBO){const{pickedColors:Re}=this._drawAndSample({layers:[Me.pickedLayer],views:n,viewports:i,onViewportActive:C,deviceRect:{x:Me.pickedX,y:Me.pickedY,width:1,height:1},cullRect:fe,effects:L,pass:"picking:".concat(b,":z")},!0);Re[3]&&(Ee=Re[0])}Me.pickedLayer&&Oe+1<l&&(ze.add(Me.pickedLayer),Me.pickedLayer.disablePickingIndex(Me.pickedObjectIndex)),Te=FN({pickInfo:Me,lastPickedInfo:this.lastPickedInfo,mode:b,layers:k,viewports:i,x:o,y:u,z:Ee,pixelRatio:H});for(const Re of Te.values())Re.layer&&Pe.push(Re);if(!Me.pickedColor)break}for(const Oe of ze)Oe.restorePickingColors();return{result:Pe,emptyInfo:Te.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:o,y:u,width:f=1,height:l=1,mode:b="query",maxObjects:w=null,onViewportActive:C,effects:L}){const k=this._getPickable(e);if(!k)return[];this._resizeBuffer();const H=bu(this.gl),K=W_(this.gl,[o,u],!0),re=K.x,ce=K.y+K.height,W=W_(this.gl,[o+f,u+l],!0),G=W.x+W.width,Z=W.y,fe={x:re,y:Z,width:G-re,height:ce-Z},Te=this._drawAndSample({layers:k,views:n,viewports:i,onViewportActive:C,deviceRect:fe,cullRect:{x:o,y:u,width:f,height:l},effects:L,pass:"picking:".concat(b)}),Pe=ON(Te),ze=new Map,Oe=Number.isFinite(w);for(let Ee=0;Ee<Pe.length;Ee++){var Me;if(Oe&&w&&ze.size>=w)break;const Re=Pe[Ee];let nt={color:Re.pickedColor,layer:null,index:Re.pickedObjectIndex,picked:!0,x:o,y:u,pixelRatio:H};nt=XA({layer:Re.pickedLayer,info:nt,mode:b});const rt=(Me=nt.object)!==null&&Me!==void 0?Me:"".concat(nt.layer.id,"[").concat(nt.index,"]");ze.has(rt)||ze.set(rt,nt)}return Array.from(ze.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:o,deviceRect:u,cullRect:f,effects:l,pass:b},w=!1){const C=w?this.depthFBO:this.pickingFBO,L={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:o,pickingFBO:C,deviceRect:u,cullRect:f,effects:l,pass:b,pickZ:w,preRenderStats:{}};for(const G of l)G.useInPicking&&(L.preRenderStats[G.id]=G.preRender(this.gl,L));const{decodePickingColor:k}=this.pickLayersPass.render(L),{x:H,y:K,width:re,height:ce}=u,W=new(w?Float32Array:Uint8Array)(re*ce*4);return rg(C,{sourceX:H,sourceY:K,sourceWidth:re,sourceHeight:ce,target:W}),{pickedColors:W,decodePickingColor:k}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:o,deviceHeight:u}){const f=Math.max(0,e-i),l=Math.max(0,n-i),b=Math.min(o,e+i+1)-f,w=Math.min(u,n+i+1)-l;return b<=0||w<=0?null:{x:f,y:l,width:b,height:w}}}const UN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class VN{constructor(e){N(this,"el",null),N(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,UN),n.appendChild(this.el))}setTooltip(e,n,i){const o=this.el;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var YA={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,o){var u=["","webkit","Moz","MS","ms","o"],f=n.createElement("div"),l="function",b=Math.round,w=Math.abs,C=Date.now;function L(q,Y,de){return setTimeout(Z(q,de),Y)}function k(q,Y,de){return Array.isArray(q)?(H(q,de[Y],de),!0):!1}function H(q,Y,de){var Ce;if(q)if(q.forEach)q.forEach(Y,de);else if(q.length!==o)for(Ce=0;Ce<q.length;)Y.call(de,q[Ce],Ce,q),Ce++;else for(Ce in q)q.hasOwnProperty(Ce)&&Y.call(de,q[Ce],Ce,q)}function K(q,Y,de){var Ce="DEPRECATED METHOD: "+Y+`
`+de+` AT 
`;return function(){var Ge=new Error("get-stack-trace"),ct=Ge&&Ge.stack?Ge.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ft=e.console&&(e.console.warn||e.console.log);return Ft&&Ft.call(e.console,Ce,ct),q.apply(this,arguments)}}var re;typeof Object.assign!="function"?re=function(Y){if(Y===o||Y===null)throw new TypeError("Cannot convert undefined or null to object");for(var de=Object(Y),Ce=1;Ce<arguments.length;Ce++){var Ge=arguments[Ce];if(Ge!==o&&Ge!==null)for(var ct in Ge)Ge.hasOwnProperty(ct)&&(de[ct]=Ge[ct])}return de}:re=Object.assign;var ce=K(function(Y,de,Ce){for(var Ge=Object.keys(de),ct=0;ct<Ge.length;)(!Ce||Ce&&Y[Ge[ct]]===o)&&(Y[Ge[ct]]=de[Ge[ct]]),ct++;return Y},"extend","Use `assign`."),W=K(function(Y,de){return ce(Y,de,!0)},"merge","Use `assign`.");function G(q,Y,de){var Ce=Y.prototype,Ge;Ge=q.prototype=Object.create(Ce),Ge.constructor=q,Ge._super=Ce,de&&re(Ge,de)}function Z(q,Y){return function(){return q.apply(Y,arguments)}}function fe(q,Y){return typeof q==l?q.apply(Y&&Y[0]||o,Y):q}function Te(q,Y){return q===o?Y:q}function Pe(q,Y,de){H(Ee(Y),function(Ce){q.addEventListener(Ce,de,!1)})}function ze(q,Y,de){H(Ee(Y),function(Ce){q.removeEventListener(Ce,de,!1)})}function Oe(q,Y){for(;q;){if(q==Y)return!0;q=q.parentNode}return!1}function Me(q,Y){return q.indexOf(Y)>-1}function Ee(q){return q.trim().split(/\s+/g)}function Re(q,Y,de){if(q.indexOf&&!de)return q.indexOf(Y);for(var Ce=0;Ce<q.length;){if(de&&q[Ce][de]==Y||!de&&q[Ce]===Y)return Ce;Ce++}return-1}function nt(q){return Array.prototype.slice.call(q,0)}function rt(q,Y,de){for(var Ce=[],Ge=[],ct=0;ct<q.length;){var Ft=q[ct][Y];Re(Ge,Ft)<0&&Ce.push(q[ct]),Ge[ct]=Ft,ct++}return Ce=Ce.sort(function(Qn,xi){return Qn[Y]>xi[Y]}),Ce}function yt(q,Y){for(var de,Ce,Ge=Y[0].toUpperCase()+Y.slice(1),ct=0;ct<u.length;){if(de=u[ct],Ce=de?de+Ge:Y,Ce in q)return Ce;ct++}return o}var Dt=1;function Sn(){return Dt++}function Xt(q){var Y=q.ownerDocument||q;return Y.defaultView||Y.parentWindow||e}var Ye=/mobile|tablet|ip(ad|hone|od)|android/i,Tt="ontouchstart"in e,pt=yt(e,"PointerEvent")!==o,Ot=Tt&&Ye.test(navigator.userAgent),Mt="touch",Kt="pen",vn="mouse",mr="kinect",Ii=25,dn=1,Ci=2,tn=4,fn=8,vs=1,Yi=2,Kr=4,Bi=8,zr=16,gi=Yi|Kr,Mi=Bi|zr,Jr=gi|Mi,xs=["x","y"],Le=["clientX","clientY"];function pn(q,Y){var de=this;this.manager=q,this.callback=Y,this.element=q.element,this.target=q.options.inputTarget,this.domHandler=function(Ce){fe(q.options.enable,[q])&&de.handler(Ce)},this.init()}pn.prototype={handler:function(){},init:function(){this.evEl&&Pe(this.element,this.evEl,this.domHandler),this.evTarget&&Pe(this.target,this.evTarget,this.domHandler),this.evWin&&Pe(Xt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ze(this.element,this.evEl,this.domHandler),this.evTarget&&ze(this.target,this.evTarget,this.domHandler),this.evWin&&ze(Xt(this.element),this.evWin,this.domHandler)}};function Ki(q){var Y,de=q.options.inputClass;return de?Y=de:pt?Y=_r:Ot?Y=me:Tt?Y=De:Y=It,new Y(q,sn)}function sn(q,Y,de){var Ce=de.pointers.length,Ge=de.changedPointers.length,ct=Y&dn&&Ce-Ge===0,Ft=Y&(tn|fn)&&Ce-Ge===0;de.isFirst=!!ct,de.isFinal=!!Ft,ct&&(q.session={}),de.eventType=Y,Wt(q,de),q.emit("hammer.input",de),q.recognize(de),q.session.prevInput=de}function Wt(q,Y){var de=q.session,Ce=Y.pointers,Ge=Ce.length;de.firstInput||(de.firstInput=Fr(Y)),Ge>1&&!de.firstMultiple?de.firstMultiple=Fr(Y):Ge===1&&(de.firstMultiple=!1);var ct=de.firstInput,Ft=de.firstMultiple,Vn=Ft?Ft.center:ct.center,Qn=Y.center=Lo(Ce);Y.timeStamp=C(),Y.deltaTime=Y.timeStamp-ct.timeStamp,Y.angle=He(Vn,Qn),Y.distance=Br(Vn,Qn),Or(de,Y),Y.offsetDirection=Qr(Y.deltaX,Y.deltaY);var xi=Us(Y.deltaTime,Y.deltaX,Y.deltaY);Y.overallVelocityX=xi.x,Y.overallVelocityY=xi.y,Y.overallVelocity=w(xi.x)>w(xi.y)?xi.x:xi.y,Y.scale=Ft?An(Ft.pointers,Ce):1,Y.rotation=Ft?Nr(Ft.pointers,Ce):0,Y.maxPointers=de.prevInput?Y.pointers.length>de.prevInput.maxPointers?Y.pointers.length:de.prevInput.maxPointers:Y.pointers.length,lo(de,Y);var xr=q.element;Oe(Y.srcEvent.target,xr)&&(xr=Y.srcEvent.target),Y.target=xr}function Or(q,Y){var de=Y.center,Ce=q.offsetDelta||{},Ge=q.prevDelta||{},ct=q.prevInput||{};(Y.eventType===dn||ct.eventType===tn)&&(Ge=q.prevDelta={x:ct.deltaX||0,y:ct.deltaY||0},Ce=q.offsetDelta={x:de.x,y:de.y}),Y.deltaX=Ge.x+(de.x-Ce.x),Y.deltaY=Ge.y+(de.y-Ce.y)}function lo(q,Y){var de=q.lastInterval||Y,Ce=Y.timeStamp-de.timeStamp,Ge,ct,Ft,Vn;if(Y.eventType!=fn&&(Ce>Ii||de.velocity===o)){var Qn=Y.deltaX-de.deltaX,xi=Y.deltaY-de.deltaY,xr=Us(Ce,Qn,xi);ct=xr.x,Ft=xr.y,Ge=w(xr.x)>w(xr.y)?xr.x:xr.y,Vn=Qr(Qn,xi),q.lastInterval=Y}else Ge=de.velocity,ct=de.velocityX,Ft=de.velocityY,Vn=de.direction;Y.velocity=Ge,Y.velocityX=ct,Y.velocityY=Ft,Y.direction=Vn}function Fr(q){for(var Y=[],de=0;de<q.pointers.length;)Y[de]={clientX:b(q.pointers[de].clientX),clientY:b(q.pointers[de].clientY)},de++;return{timeStamp:C(),pointers:Y,center:Lo(Y),deltaX:q.deltaX,deltaY:q.deltaY}}function Lo(q){var Y=q.length;if(Y===1)return{x:b(q[0].clientX),y:b(q[0].clientY)};for(var de=0,Ce=0,Ge=0;Ge<Y;)de+=q[Ge].clientX,Ce+=q[Ge].clientY,Ge++;return{x:b(de/Y),y:b(Ce/Y)}}function Us(q,Y,de){return{x:Y/q||0,y:de/q||0}}function Qr(q,Y){return q===Y?vs:w(q)>=w(Y)?q<0?Yi:Kr:Y<0?Bi:zr}function Br(q,Y,de){de||(de=xs);var Ce=Y[de[0]]-q[de[0]],Ge=Y[de[1]]-q[de[1]];return Math.sqrt(Ce*Ce+Ge*Ge)}function He(q,Y,de){de||(de=xs);var Ce=Y[de[0]]-q[de[0]],Ge=Y[de[1]]-q[de[1]];return Math.atan2(Ge,Ce)*180/Math.PI}function Nr(q,Y){return He(Y[1],Y[0],Le)+He(q[1],q[0],Le)}function An(q,Y){return Br(Y[0],Y[1],Le)/Br(q[0],q[1],Le)}var Vs={mousedown:dn,mousemove:Ci,mouseup:tn},es="mousedown",qe="mousemove mouseup";function It(){this.evEl=es,this.evWin=qe,this.pressed=!1,pn.apply(this,arguments)}G(It,pn,{handler:function(Y){var de=Vs[Y.type];de&dn&&Y.button===0&&(this.pressed=!0),de&Ci&&Y.which!==1&&(de=tn),this.pressed&&(de&tn&&(this.pressed=!1),this.callback(this.manager,de,{pointers:[Y],changedPointers:[Y],pointerType:vn,srcEvent:Y}))}});var Pt={pointerdown:dn,pointermove:Ci,pointerup:tn,pointercancel:fn,pointerout:fn},yi={2:Mt,3:Kt,4:vn,5:mr},gr="pointerdown",Ct="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(gr="MSPointerDown",Ct="MSPointerMove MSPointerUp MSPointerCancel");function _r(){this.evEl=gr,this.evWin=Ct,pn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}G(_r,pn,{handler:function(Y){var de=this.store,Ce=!1,Ge=Y.type.toLowerCase().replace("ms",""),ct=Pt[Ge],Ft=yi[Y.pointerType]||Y.pointerType,Vn=Ft==Mt,Qn=Re(de,Y.pointerId,"pointerId");ct&dn&&(Y.button===0||Vn)?Qn<0&&(de.push(Y),Qn=de.length-1):ct&(tn|fn)&&(Ce=!0),!(Qn<0)&&(de[Qn]=Y,this.callback(this.manager,ct,{pointers:de,changedPointers:[Y],pointerType:Ft,srcEvent:Y}),Ce&&de.splice(Qn,1))}});var ne={touchstart:dn,touchmove:Ci,touchend:tn,touchcancel:fn},F="touchstart",U="touchstart touchmove touchend touchcancel";function X(){this.evTarget=F,this.evWin=U,this.started=!1,pn.apply(this,arguments)}G(X,pn,{handler:function(Y){var de=ne[Y.type];if(de===dn&&(this.started=!0),!!this.started){var Ce=se.call(this,Y,de);de&(tn|fn)&&Ce[0].length-Ce[1].length===0&&(this.started=!1),this.callback(this.manager,de,{pointers:Ce[0],changedPointers:Ce[1],pointerType:Mt,srcEvent:Y})}}});function se(q,Y){var de=nt(q.touches),Ce=nt(q.changedTouches);return Y&(tn|fn)&&(de=rt(de.concat(Ce),"identifier")),[de,Ce]}var ae={touchstart:dn,touchmove:Ci,touchend:tn,touchcancel:fn},xe="touchstart touchmove touchend touchcancel";function me(){this.evTarget=xe,this.targetIds={},pn.apply(this,arguments)}G(me,pn,{handler:function(Y){var de=ae[Y.type],Ce=ue.call(this,Y,de);Ce&&this.callback(this.manager,de,{pointers:Ce[0],changedPointers:Ce[1],pointerType:Mt,srcEvent:Y})}});function ue(q,Y){var de=nt(q.touches),Ce=this.targetIds;if(Y&(dn|Ci)&&de.length===1)return Ce[de[0].identifier]=!0,[de,de];var Ge,ct,Ft=nt(q.changedTouches),Vn=[],Qn=this.target;if(ct=de.filter(function(xi){return Oe(xi.target,Qn)}),Y===dn)for(Ge=0;Ge<ct.length;)Ce[ct[Ge].identifier]=!0,Ge++;for(Ge=0;Ge<Ft.length;)Ce[Ft[Ge].identifier]&&Vn.push(Ft[Ge]),Y&(tn|fn)&&delete Ce[Ft[Ge].identifier],Ge++;if(Vn.length)return[rt(ct.concat(Vn),"identifier"),Vn]}var _e=2500,ke=25;function De(){pn.apply(this,arguments);var q=Z(this.handler,this);this.touch=new me(this.manager,q),this.mouse=new It(this.manager,q),this.primaryTouch=null,this.lastTouches=[]}G(De,pn,{handler:function(Y,de,Ce){var Ge=Ce.pointerType==Mt,ct=Ce.pointerType==vn;if(!(ct&&Ce.sourceCapabilities&&Ce.sourceCapabilities.firesTouchEvents)){if(Ge)Ne.call(this,de,Ce);else if(ct&&St.call(this,Ce))return;this.callback(Y,de,Ce)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ne(q,Y){q&dn?(this.primaryTouch=Y.changedPointers[0].identifier,gt.call(this,Y)):q&(tn|fn)&&gt.call(this,Y)}function gt(q){var Y=q.changedPointers[0];if(Y.identifier===this.primaryTouch){var de={x:Y.clientX,y:Y.clientY};this.lastTouches.push(de);var Ce=this.lastTouches,Ge=function(){var ct=Ce.indexOf(de);ct>-1&&Ce.splice(ct,1)};setTimeout(Ge,_e)}}function St(q){for(var Y=q.srcEvent.clientX,de=q.srcEvent.clientY,Ce=0;Ce<this.lastTouches.length;Ce++){var Ge=this.lastTouches[Ce],ct=Math.abs(Y-Ge.x),Ft=Math.abs(de-Ge.y);if(ct<=ke&&Ft<=ke)return!0}return!1}var ot=yt(f.style,"touchAction"),vt=ot!==o,At="compute",qt="auto",Jt="manipulation",kt="none",Rt="pan-x",Un="pan-y",nn=Ji();function Cn(q,Y){this.manager=q,this.set(Y)}Cn.prototype={set:function(q){q==At&&(q=this.compute()),vt&&this.manager.element.style&&nn[q]&&(this.manager.element.style[ot]=q),this.actions=q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var q=[];return H(this.manager.recognizers,function(Y){fe(Y.options.enable,[Y])&&(q=q.concat(Y.getTouchAction()))}),ri(q.join(" "))},preventDefaults:function(q){var Y=q.srcEvent,de=q.offsetDirection;if(this.manager.session.prevented){Y.preventDefault();return}var Ce=this.actions,Ge=Me(Ce,kt)&&!nn[kt],ct=Me(Ce,Un)&&!nn[Un],Ft=Me(Ce,Rt)&&!nn[Rt];if(Ge){var Vn=q.pointers.length===1,Qn=q.distance<2,xi=q.deltaTime<250;if(Vn&&Qn&&xi)return}if(!(Ft&&ct)&&(Ge||ct&&de&gi||Ft&&de&Mi))return this.preventSrc(Y)},preventSrc:function(q){this.manager.session.prevented=!0,q.preventDefault()}};function ri(q){if(Me(q,kt))return kt;var Y=Me(q,Rt),de=Me(q,Un);return Y&&de?kt:Y||de?Y?Rt:Un:Me(q,Jt)?Jt:qt}function Ji(){if(!vt)return!1;var q={},Y=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(de){q[de]=Y?e.CSS.supports("touch-action",de):!0}),q}var ko=1,si=2,yr=4,bs=8,Nt=bs,js=16,Ni=32;function xn(q){this.options=re({},this.defaults,q||{}),this.id=Sn(),this.manager=null,this.options.enable=Te(this.options.enable,!0),this.state=ko,this.simultaneous={},this.requireFail=[]}xn.prototype={defaults:{},set:function(q){return re(this.options,q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(q){if(k(q,"recognizeWith",this))return this;var Y=this.simultaneous;return q=vi(q,this),Y[q.id]||(Y[q.id]=q,q.recognizeWith(this)),this},dropRecognizeWith:function(q){return k(q,"dropRecognizeWith",this)?this:(q=vi(q,this),delete this.simultaneous[q.id],this)},requireFailure:function(q){if(k(q,"requireFailure",this))return this;var Y=this.requireFail;return q=vi(q,this),Re(Y,q)===-1&&(Y.push(q),q.requireFailure(this)),this},dropRequireFailure:function(q){if(k(q,"dropRequireFailure",this))return this;q=vi(q,this);var Y=Re(this.requireFail,q);return Y>-1&&this.requireFail.splice(Y,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(q){return!!this.simultaneous[q.id]},emit:function(q){var Y=this,de=this.state;function Ce(Ge){Y.manager.emit(Ge,q)}de<bs&&Ce(Y.options.event+Li(de)),Ce(Y.options.event),q.additionalEvent&&Ce(q.additionalEvent),de>=bs&&Ce(Y.options.event+Li(de))},tryEmit:function(q){if(this.canEmit())return this.emit(q);this.state=Ni},canEmit:function(){for(var q=0;q<this.requireFail.length;){if(!(this.requireFail[q].state&(Ni|ko)))return!1;q++}return!0},recognize:function(q){var Y=re({},q);if(!fe(this.options.enable,[this,Y])){this.reset(),this.state=Ni;return}this.state&(Nt|js|Ni)&&(this.state=ko),this.state=this.process(Y),this.state&(si|yr|bs|js)&&this.tryEmit(Y)},process:function(q){},getTouchAction:function(){},reset:function(){}};function Li(q){return q&js?"cancel":q&bs?"end":q&yr?"move":q&si?"start":""}function nc(q){return q==zr?"down":q==Bi?"up":q==Yi?"left":q==Kr?"right":""}function vi(q,Y){var de=Y.manager;return de?de.get(q):q}function ln(){xn.apply(this,arguments)}G(ln,xn,{defaults:{pointers:1},attrTest:function(q){var Y=this.options.pointers;return Y===0||q.pointers.length===Y},process:function(q){var Y=this.state,de=q.eventType,Ce=Y&(si|yr),Ge=this.attrTest(q);return Ce&&(de&fn||!Ge)?Y|js:Ce||Ge?de&tn?Y|bs:Y&si?Y|yr:si:Ni}});function Gs(){ln.apply(this,arguments),this.pX=null,this.pY=null}G(Gs,ln,{defaults:{event:"pan",threshold:10,pointers:1,direction:Jr},getTouchAction:function(){var q=this.options.direction,Y=[];return q&gi&&Y.push(Un),q&Mi&&Y.push(Rt),Y},directionTest:function(q){var Y=this.options,de=!0,Ce=q.distance,Ge=q.direction,ct=q.deltaX,Ft=q.deltaY;return Ge&Y.direction||(Y.direction&gi?(Ge=ct===0?vs:ct<0?Yi:Kr,de=ct!=this.pX,Ce=Math.abs(q.deltaX)):(Ge=Ft===0?vs:Ft<0?Bi:zr,de=Ft!=this.pY,Ce=Math.abs(q.deltaY))),q.direction=Ge,de&&Ce>Y.threshold&&Ge&Y.direction},attrTest:function(q){return ln.prototype.attrTest.call(this,q)&&(this.state&si||!(this.state&si)&&this.directionTest(q))},emit:function(q){this.pX=q.deltaX,this.pY=q.deltaY;var Y=nc(q.direction);Y&&(q.additionalEvent=this.options.event+Y),this._super.emit.call(this,q)}});function ws(){ln.apply(this,arguments)}G(ws,ln,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[kt]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.scale-1)>this.options.threshold||this.state&si)},emit:function(q){if(q.scale!==1){var Y=q.scale<1?"in":"out";q.additionalEvent=this.options.event+Y}this._super.emit.call(this,q)}});function un(){xn.apply(this,arguments),this._timer=null,this._input=null}G(un,xn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[qt]},process:function(q){var Y=this.options,de=q.pointers.length===Y.pointers,Ce=q.distance<Y.threshold,Ge=q.deltaTime>Y.time;if(this._input=q,!Ce||!de||q.eventType&(tn|fn)&&!Ge)this.reset();else if(q.eventType&dn)this.reset(),this._timer=L(function(){this.state=Nt,this.tryEmit()},Y.time,this);else if(q.eventType&tn)return Nt;return Ni},reset:function(){clearTimeout(this._timer)},emit:function(q){this.state===Nt&&(q&&q.eventType&tn?this.manager.emit(this.options.event+"up",q):(this._input.timeStamp=C(),this.manager.emit(this.options.event,this._input)))}});function Ht(){ln.apply(this,arguments)}G(Ht,ln,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[kt]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.rotation)>this.options.threshold||this.state&si)}});function ts(){ln.apply(this,arguments)}G(ts,ln,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:gi|Mi,pointers:1},getTouchAction:function(){return Gs.prototype.getTouchAction.call(this)},attrTest:function(q){var Y=this.options.direction,de;return Y&(gi|Mi)?de=q.overallVelocity:Y&gi?de=q.overallVelocityX:Y&Mi&&(de=q.overallVelocityY),this._super.attrTest.call(this,q)&&Y&q.offsetDirection&&q.distance>this.options.threshold&&q.maxPointers==this.options.pointers&&w(de)>this.options.velocity&&q.eventType&tn},emit:function(q){var Y=nc(q.offsetDirection);Y&&this.manager.emit(this.options.event+Y,q),this.manager.emit(this.options.event,q)}});function hn(){xn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}G(hn,xn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Jt]},process:function(q){var Y=this.options,de=q.pointers.length===Y.pointers,Ce=q.distance<Y.threshold,Ge=q.deltaTime<Y.time;if(this.reset(),q.eventType&dn&&this.count===0)return this.failTimeout();if(Ce&&Ge&&de){if(q.eventType!=tn)return this.failTimeout();var ct=this.pTime?q.timeStamp-this.pTime<Y.interval:!0,Ft=!this.pCenter||Br(this.pCenter,q.center)<Y.posThreshold;this.pTime=q.timeStamp,this.pCenter=q.center,!Ft||!ct?this.count=1:this.count+=1,this._input=q;var Vn=this.count%Y.taps;if(Vn===0)return this.hasRequireFailures()?(this._timer=L(function(){this.state=Nt,this.tryEmit()},Y.interval,this),si):Nt}return Ni},failTimeout:function(){return this._timer=L(function(){this.state=Ni},this.options.interval,this),Ni},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Nt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function vr(q,Y){return Y=Y||{},Y.recognizers=Te(Y.recognizers,vr.defaults.preset),new Ur(q,Y)}vr.VERSION="2.0.7",vr.defaults={domEvents:!1,touchAction:At,enable:!0,inputTarget:null,inputClass:null,preset:[[Ht,{enable:!1}],[ws,{enable:!1},["rotate"]],[ts,{direction:gi}],[Gs,{direction:gi},["swipe"]],[hn],[hn,{event:"doubletap",taps:2},["tap"]],[un]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Qi=1,ha=2;function Ur(q,Y){this.options=re({},vr.defaults,Y||{}),this.options.inputTarget=this.options.inputTarget||q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=q,this.input=Ki(this),this.touchAction=new Cn(this,this.options.touchAction),ol(this,!0),H(this.options.recognizers,function(de){var Ce=this.add(new de[0](de[1]));de[2]&&Ce.recognizeWith(de[2]),de[3]&&Ce.requireFailure(de[3])},this)}Ur.prototype={set:function(q){return re(this.options,q),q.touchAction&&this.touchAction.update(),q.inputTarget&&(this.input.destroy(),this.input.target=q.inputTarget,this.input.init()),this},stop:function(q){this.session.stopped=q?ha:Qi},recognize:function(q){var Y=this.session;if(!Y.stopped){this.touchAction.preventDefaults(q);var de,Ce=this.recognizers,Ge=Y.curRecognizer;(!Ge||Ge&&Ge.state&Nt)&&(Ge=Y.curRecognizer=null);for(var ct=0;ct<Ce.length;)de=Ce[ct],Y.stopped!==ha&&(!Ge||de==Ge||de.canRecognizeWith(Ge))?de.recognize(q):de.reset(),!Ge&&de.state&(si|yr|bs)&&(Ge=Y.curRecognizer=de),ct++}},get:function(q){if(q instanceof xn)return q;for(var Y=this.recognizers,de=0;de<Y.length;de++)if(Y[de].options.event==q)return Y[de];return null},add:function(q){if(k(q,"add",this))return this;var Y=this.get(q.options.event);return Y&&this.remove(Y),this.recognizers.push(q),q.manager=this,this.touchAction.update(),q},remove:function(q){if(k(q,"remove",this))return this;if(q=this.get(q),q){var Y=this.recognizers,de=Re(Y,q);de!==-1&&(Y.splice(de,1),this.touchAction.update())}return this},on:function(q,Y){if(q!==o&&Y!==o){var de=this.handlers;return H(Ee(q),function(Ce){de[Ce]=de[Ce]||[],de[Ce].push(Y)}),this}},off:function(q,Y){if(q!==o){var de=this.handlers;return H(Ee(q),function(Ce){Y?de[Ce]&&de[Ce].splice(Re(de[Ce],Y),1):delete de[Ce]}),this}},emit:function(q,Y){this.options.domEvents&&al(q,Y);var de=this.handlers[q]&&this.handlers[q].slice();if(!(!de||!de.length)){Y.type=q,Y.preventDefault=function(){Y.srcEvent.preventDefault()};for(var Ce=0;Ce<de.length;)de[Ce](Y),Ce++}},destroy:function(){this.element&&ol(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ol(q,Y){var de=q.element;if(de.style){var Ce;H(q.options.cssProps,function(Ge,ct){Ce=yt(de.style,ct),Y?(q.oldCssProps[Ce]=de.style[Ce],de.style[Ce]=Ge):de.style[Ce]=q.oldCssProps[Ce]||""}),Y||(q.oldCssProps={})}}function al(q,Y){var de=n.createEvent("Event");de.initEvent(q,!0,!0),de.gesture=Y,Y.target.dispatchEvent(de)}re(vr,{INPUT_START:dn,INPUT_MOVE:Ci,INPUT_END:tn,INPUT_CANCEL:fn,STATE_POSSIBLE:ko,STATE_BEGAN:si,STATE_CHANGED:yr,STATE_ENDED:bs,STATE_RECOGNIZED:Nt,STATE_CANCELLED:js,STATE_FAILED:Ni,DIRECTION_NONE:vs,DIRECTION_LEFT:Yi,DIRECTION_RIGHT:Kr,DIRECTION_UP:Bi,DIRECTION_DOWN:zr,DIRECTION_HORIZONTAL:gi,DIRECTION_VERTICAL:Mi,DIRECTION_ALL:Jr,Manager:Ur,Input:pn,TouchAction:Cn,TouchInput:me,MouseInput:It,PointerEventInput:_r,TouchMouseInput:De,SingleTouchInput:X,Recognizer:xn,AttrRecognizer:ln,Tap:hn,Pan:Gs,Swipe:ts,Pinch:ws,Rotate:Ht,Press:un,on:Pe,off:ze,each:H,merge:W,extend:ce,assign:re,inherit:G,bindFn:Z,prefixed:yt});var da=typeof e<"u"?e:typeof self<"u"?self:{};da.Hammer=vr,t.exports?t.exports=vr:e[i]=vr})(window,document,"Hammer")})(YA);var ef=YA.exports;const jN=Bm(ef),xo=gC({__proto__:null,default:jN},[ef]),KA=1,JA=2,Lv=4,GN={mousedown:KA,mousemove:JA,mouseup:Lv};function $N(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function HN(t){const e=t.prototype.handler;t.prototype.handler=function(i){const o=this.store;i.button>0&&i.type==="pointerdown"&&($N(o,u=>u.pointerId===i.pointerId)||o.push(i)),e.call(this,i)}}function WN(t){t.prototype.handler=function(n){let i=GN[n.type];i&KA&&n.button>=0&&(this.pressed=!0),i&JA&&n.buttons===0&&(i=Lv),this.pressed&&(i&Lv&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}HN(ef.PointerEventInput);WN(ef.MouseInput);const qN=ef.Manager;class lg{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const ZN=xo?[[xo.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[xo.Rotate,{enable:!1}],[xo.Pinch,{enable:!1}],[xo.Swipe,{enable:!1}],[xo.Pan,{threshold:0,enable:!1}],[xo.Press,{enable:!1}],[xo.Tap,{event:"doubletap",taps:2,enable:!1}],[xo.Tap,{event:"anytap",enable:!1}],[xo.Tap,{enable:!1}]]:null,CT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},XN={doubletap:["tap"]},YN={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},tx={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},KN={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},MT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},JN=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ru=typeof window<"u"?window:global;let kv=!1;try{const t={get passive(){return kv=!0,!0}};ru.addEventListener("test",null,t),ru.removeEventListener("test",null)}catch{kv=!1}const QN=JN.indexOf("firefox")!==-1,{WHEEL_EVENTS:e5}=tx,LT="wheel",kT=4.000244140625,t5=40,n5=.25;class i5 extends lg{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{if(!this.options.enable)return;let u=o.deltaY;ru.WheelEvent&&(QN&&o.deltaMode===ru.WheelEvent.DOM_DELTA_PIXEL&&(u/=ru.devicePixelRatio),o.deltaMode===ru.WheelEvent.DOM_DELTA_LINE&&(u*=t5)),u!==0&&u%kT===0&&(u=Math.floor(u/kT)),o.shiftKey&&u&&(u=u*n5),this.callback({type:LT,center:{x:o.clientX,y:o.clientY},delta:-u,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(e5),this.events.forEach(o=>e.addEventListener(o,this.handleEvent,kv?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===LT&&(this.options.enable=n)}}const{MOUSE_EVENTS:r5}=tx,RT="pointermove",DT="pointerover",zT="pointerout",OT="pointerenter",FT="pointerleave";class s5 extends lg{constructor(e,n,i){super(e,n,i),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(r5),this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===RT&&(this.enableMoveEvent=n),e===DT&&(this.enableOverEvent=n),e===zT&&(this.enableOutEvent=n),e===OT&&(this.enableEnterEvent=n),e===FT&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(DT,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(zT,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(OT,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(FT,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(RT,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:o5}=tx,BT="keydown",NT="keyup";class a5 extends lg{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{const u=o.target||o.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:BT,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:NT,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(o5),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===BT&&(this.enableDownEvent=n),e===NT&&(this.enableUpEvent=n)}}const UT="contextmenu";class l5 extends lg{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{this.options.enable&&this.callback({type:UT,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===UT&&(this.options.enable=n)}}const VT=1,Rv=2,jT=4,c5={pointerdown:VT,pointermove:Rv,pointerup:jT,mousedown:VT,mousemove:Rv,mouseup:jT},u5=0,h5=1,d5=2,f5=1,p5=2,m5=4;function g5(t){const e=c5[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i}=t.srcEvent;let o=!1,u=!1,f=!1;return e===Rv?(o=!!(n&f5),u=!!(n&m5),f=!!(n&p5)):(o=i===u5,u=i===h5,f=i===d5),{leftButton:o,middleButton:u,rightButton:f}}function _5(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),o=i.width/e.offsetWidth||1,u=i.height/e.offsetHeight||1,f={x:(n.x-i.left-e.clientLeft)/o,y:(n.y-i.top-e.clientTop)/u};return{center:n,offsetCenter:f}}const cy={srcElement:"root",priority:0};class y5{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,o=!1,u=!1){const{handlers:f,handlersByElement:l}=this;let b=cy;typeof i=="string"||i&&i.addEventListener?b={...cy,srcElement:i}:i&&(b={...cy,...i});let w=l.get(b.srcElement);w||(w=[],l.set(b.srcElement,w));const C={type:e,handler:n,srcElement:b.srcElement,priority:b.priority};o&&(C.once=!0),u&&(C.passive=!0),f.push(C),this._active=this._active||!C.passive;let L=w.length-1;for(;L>=0&&!(w[L].priority>=C.priority);)L--;w.splice(L+1,0,C)}remove(e,n){const{handlers:i,handlersByElement:o}=this;for(let u=i.length-1;u>=0;u--){const f=i[u];if(f.type===e&&f.handler===n){i.splice(u,1);const l=o.get(f.srcElement);l.splice(l.indexOf(f),1),l.length===0&&o.delete(f.srcElement)}}this._active=i.some(u=>!u.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let o=!1;const u=()=>{e.handled=!0},f=()=>{e.handled=!0,o=!0},l=[];for(let b=0;b<i.length;b++){const{type:w,handler:C,once:L}=i[b];if(C({...e,type:w,stopPropagation:u,stopImmediatePropagation:f}),L&&l.push(i[b]),o)break}for(let b=0;b<l.length;b++){const{type:w,handler:C}=l[b];this.remove(w,C)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...g5(e),..._5(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const v5={events:null,recognizers:null,recognizerOptions:{},Manager:qN,touchAction:"none",tabIndex:0};class x5{constructor(e=null,n){this._onBasicInput=o=>{const{srcEvent:u}=o,f=YN[u.type];f&&this.manager.emit(f,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...v5,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||ZN}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(CT).forEach(o=>{const u=this.manager.get(o);u&&CT[o].forEach(f=>{u.recognizeWith(f)})});for(const o in n.recognizerOptions){const u=this.manager.get(o);if(u){const f=n.recognizerOptions[o];delete f.enable,u.set(f)}}this.wheelInput=new i5(e,this._onOtherEvent,{enable:!1}),this.moveInput=new s5(e,this._onOtherEvent,{enable:!1}),this.keyInput=new a5(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new l5(e,this._onOtherEvent,{enable:!1});for(const[o,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(o,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const o=i.get(e);if(o&&o.options.enable!==n){o.set({enable:n});const u=XN[e];u&&!this.options.recognizers&&u.forEach(f=>{const l=i.get(f);n?(l.requireFailure(e),o.dropRequireFailure(f)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,o,u){if(typeof e!="string"){i=n;for(const C in e)this._addEventHandler(C,e[C],i,o,u);return}const{manager:f,events:l}=this,b=MT[e]||e;let w=l.get(b);w||(w=new y5(this),l.set(b,w),w.recognizerName=KN[b]||b,f&&f.on(b,w.handleEvent)),w.add(e,n,i,o,u),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const f in e)this._removeEventHandler(f,e[f]);return}const{events:i}=this,o=MT[e]||e,u=i.get(o);if(u&&(u.remove(e,n),u.isEmpty())){const{recognizerName:f}=u;let l=!1;for(const b of i.values())if(b.recognizerName===f&&!b.isEmpty()){l=!0;break}l||this._toggleRecognizer(f,!1)}}}function Ml(){}const b5=({isDragging:t})=>t?"grabbing":"grab",QA={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ml,onResize:Ml,onViewStateChange:Ml,onInteractionStateChange:Ml,onBeforeRender:Ml,onAfterRender:Ml,onLoad:Ml,onError:t=>an.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:b5,getTooltip:null,debug:!1,drawPickingColors:!1};class Od{constructor(e){N(this,"props",void 0),N(this,"width",0),N(this,"height",0),N(this,"userData",{}),N(this,"canvas",null),N(this,"viewManager",null),N(this,"layerManager",null),N(this,"effectManager",null),N(this,"deckRenderer",null),N(this,"deckPicker",null),N(this,"eventManager",null),N(this,"tooltip",null),N(this,"metrics",void 0),N(this,"animationLoop",void 0),N(this,"stats",void 0),N(this,"viewState",void 0),N(this,"cursorState",void 0),N(this,"_needsRedraw",void 0),N(this,"_pickRequest",void 0),N(this,"_lastPointerDownInfo",null),N(this,"_metricsCounter",void 0),N(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),N(this,"_onEvent",n=>{const i=Aw[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const u=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:u,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:l}=f,b=l&&(l[i.handler]||l.props[i.handler]),w=this.props[i.handler];let C=!1;b&&(C=b.call(l,f,n)),!C&&w&&w(f,n)}),N(this,"_onPointerDown",n=>{const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo}),this.props={...QA,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&an.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),BS()==="IE"&&an.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new R0({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Iu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,o,u,f,l,b;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(o=this.effectManager)===null||o===void 0||o.finalize(),this.effectManager=null,(u=this.deckRenderer)===null||u===void 0||u.finalize(),this.deckRenderer=null,(f=this.deckPicker)===null||f===void 0||f.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(b=this.tooltip)===null||b===void 0||b.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var w;(w=this.canvas.parentElement)===null||w===void 0||w.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&an.removed("onLayerHover","onHover")(),"onLayerClick"in e&&an.removed("onLayerClick","onClick")(),e.initialViewState&&!Ao(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return n=n||i||o||u||f,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return mi(this.viewManager),this.viewManager.views}getViewports(e){return mi(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){mi(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(n).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return o.get(n).timeEnd(),u}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),mi(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const u=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=u}if(i||i===0){var o;const u=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const o=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,u=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(o!==this.width||u!==this.height){var f,l;this.width=o,this.height=u,(f=this.viewManager)===null||f===void 0||f.setProps({width:o,height:u}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:o,height:u})}}_createAnimationLoop(e){const{width:n,height:i,gl:o,glOptions:u,debug:f,onError:l,onBeforeRender:b,onAfterRender:w,useDevicePixels:C}=e;return new DO({width:n,height:i,useDevicePixels:C,autoResizeDrawingBuffer:!o,autoResizeViewport:!1,gl:o,onCreateContext:L=>iA({...u,...L,canvas:this.canvas,debug:f,onContextLost:()=>this._onContextLost()}),onInitialize:L=>this._setGLContext(L.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:b,onAfterRender:w,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new ex({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let u=o,f=!1;for(const l of i){var n;u=l,f=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||f}if(!f&&this.props.onHover&&this.props.onHover(u,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(u);this.tooltip.setTooltip(l,u.x,u.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,j0(e,{enable:!0,copyState:!0})),this.tooltip=new VN(this.canvas),oa(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new RA;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new x5(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Aw)this.eventManager.on(o,this._onEvent);this.viewManager=new fN({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new dN(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new MN,this.deckRenderer=new RN(e),this.deckPicker=new NN(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;oa(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),an.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Fl.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}N(Od,"defaultProps",QA);N(Od,"VERSION",NR);class uy{constructor(e,n){N(this,"opts",void 0),N(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:o}=n;let u=i;if(i&&i.length!==o){u=new Float32Array(o);const f=n.elementOffset||0;for(let l=0;l<o;++l)u[l]=i[f+l]}return u}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function w5(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Jp(t){return t.stride||t.size*t.bytesPerElement}function eP(t,e){e.offset&&an.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Jp(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,u=i*n+o*t.bytesPerElement+(t.offset||0);return{...e,offset:u,stride:n}}function T5(t,e){const n=eP(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class E5{constructor(e,n,i){N(this,"gl",void 0),N(this,"id",void 0),N(this,"size",void 0),N(this,"settings",void 0),N(this,"value",void 0),N(this,"doublePrecision",void 0),N(this,"_buffer",void 0),N(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const o=n.logicalType||n.type,u=o===5130;let{defaultValue:f}=n;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let l;u?l=5126:!o&&n.isIndexed?l=e&&uz(e,Hn.ELEMENT_INDEX_UINT32)?5125:5123:l=o||5126;let b=w5(o||l||5126);this.doublePrecision=u,u&&n.fp64===!1&&(b=Float32Array),this.value=null,this.settings={...n,defaultType:b,defaultValue:f,logicalType:o,type:l,size:this.size,bytesPerElement:b.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new En(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Jp(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Iu.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},o=this.value instanceof Float64Array,u=T5(this.getAccessor(),n||{});return i[e]=new uy(this,u.high),i["".concat(e,"64Low")]=o?new uy(this,u.low):new Float32Array(this.size),i}if(n){const i=eP(this.getAccessor(),n);return{[e]:new uy(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:o}=this,u=i*o;if(n&&u&&n.length>=u){const f=new Array(o).fill(1/0),l=new Array(o).fill(-1/0);for(let b=0;b<u;)for(let w=0;w<o;w++){const C=n[b++];C<f[w]&&(f[w]=C),C>l[w]&&(l[w]=C)}e=[f,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof En?i={buffer:e}:i=e;const o={...this.settings,...i};if(n.bufferAccessor=o,n.bounds=null,i.constant){let u=i.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!n.constant||!this._areValuesEqual(u,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=u}else if(i.buffer){const u=i.buffer;n.externalBuffer=u,n.constant=!1,this.value=i.value||null;const f=i.value instanceof Float64Array;o.type=i.type||u.accessor.type,o.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(f?2:1),o.stride=Jp(o)}else if(i.value){this._checkExternalBuffer(i);let u=i.value;n.externalBuffer=null,n.constant=!1,this.value=u,o.bytesPerElement=u.BYTES_PER_ELEMENT,o.stride=Jp(o);const{buffer:f,byteOffset:l}=this;this.doublePrecision&&u instanceof Float64Array&&(u=oy(u,o));const b=u.byteLength+l+o.stride*2;f.byteLength<b&&f.reallocate(b),f.setAccessor(null),f.subData({data:u,offset:l}),o.type=i.type||f.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:o}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?oy(n,{size:this.size,startIndex:i,endIndex:o}):n.subarray(i,o),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,o=i.allocatedValue,u=Iu.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=u;const{buffer:f,byteOffset:l}=this;return f.byteLength<u.byteLength+l&&(f.reallocate(u.byteLength+l),n&&o&&f.subData({data:o instanceof Float64Array?oy(o,this):o,offset:l})),i.allocatedValue=u,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=n.BYTES_PER_ELEMENT<4),o)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&an.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:o,size:u}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let f=u;for(;--f>=0;)n[i+f]=o[f];return n}switch(u){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let f=u;for(;--f>=0;)n[i+f]=Number.isFinite(e[f])?e[f]:o[f]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}}const GT=[],$T=[];function cg(t,e=0,n=1/0){let i=GT;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&($T.length=t.length,i=$T):i=GT,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),o.index=e-1),{iterable:i,objectInfo:o}}function tP(t){return t&&t[Symbol.asyncIterator]}function nP(t,e){const{size:n,stride:i,offset:o,startIndices:u,nested:f}=e,l=t.BYTES_PER_ELEMENT,b=i?i/l:n,w=o?o/l:0,C=Math.floor((t.length-w)/b);return(L,{index:k,target:H})=>{if(!u){const W=k*b+w;for(let G=0;G<n;G++)H[G]=t[W+G];return H}const K=u[k],re=u[k+1]||C;let ce;if(f){ce=new Array(re-K);for(let W=K;W<re;W++){const G=W*b+w;H=new Array(n);for(let Z=0;Z<n;Z++)H[Z]=t[G+Z];ce[W-K]=H}}else if(b===n)ce=t.subarray(K*n+w,re*n+w);else{ce=new t.constructor((re-K)*n);let W=0;for(let G=K;G<re;G++){const Z=G*b+w;for(let fe=0;fe<n;fe++)ce[W++]=t[Z+fe]}}return ce}}const S5=[],Qp=[[0,1/0]];function A5(t,e){if(t===Qp||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let o=0;for(let u=0;u<i;u++){const f=t[u];f[1]<e[0]?(n.push(f),o=u+1):f[0]>e[1]?n.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return n.splice(o,0,e),n}function hy(t){const{source:e,target:n,start:i=0,size:o,getData:u}=t,f=t.end||n.length,l=e.length,b=f-i;if(l>b){n.set(e.subarray(0,b),i);return}if(n.set(e,i),!u)return;let w=l;for(;w<b;){const C=u(w,e);for(let L=0;L<o;L++)n[i+w]=C[L]||0,w++}}function P5({source:t,target:e,size:n,getData:i,sourceStartIndices:o,targetStartIndices:u}){if(!Array.isArray(u))return hy({source:t,target:e,size:n,getData:i}),e;let f=0,l=0;const b=i&&((C,L)=>i(C+l,L)),w=Math.min(o.length,u.length);for(let C=1;C<w;C++){const L=o[C]*n,k=u[C]*n;hy({source:t.subarray(f,L),target:e,start:l,end:k,size:n,getData:b}),f=L,l=k}return l<e.length&&hy({source:[],target:e,start:l,size:n,getData:b}),e}const I5={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function iP(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...I5[n],...e,...t,type:n}}function rP(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function sP(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function oP(t){t.push(t.shift())}function nx(t,e){const{doublePrecision:n,settings:i,value:o,size:u}=t,f=n&&o instanceof Float64Array?2:1;return(i.noAlloc?o.length:e*u)*f}function aP({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:o,getData:u=f=>f}){const f=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*f,b=n.byteOffset,w=n.startIndices,C=o&&w,L=nx(n,e),k=n.isConstant;if(!C&&i>=L)return;const H=k?n.value:n.getBuffer().getData({srcByteOffset:b});if(n.settings.normalized&&!k){const W=u;u=(G,Z)=>n.normalizeConstant(W(G,Z))}const K=k?(W,G)=>u(H,G):(W,G)=>u(H.subarray(W,W+l),G),re=t.getData({length:i}),ce=new Float32Array(L);P5({source:re,target:ce,sourceStartIndices:o,targetStartIndices:w,size:l,getData:K}),t.byteLength<ce.byteLength+b&&t.reallocate(ce.byteLength+b),t.subData({data:ce,offset:b})}class ix extends E5{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Qp}),N(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,o=Array.isArray(n)?e[n.find(u=>e[u])]:e[n];return iP(o,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:o=1/0}=n;this.state.updateRanges=A5(this.state.updateRanges,[i,o])}else this.state.updateRanges=Qp}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=S5}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Qp),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:f,noAlloc:l}}=this;let b=!0;if(f){for(const[w,C]of u)f.call(o,this,{data:n,startRow:w,endRow:C,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,C]of u){const L=Number.isFinite(w)?this.getVertexOffset(w):0,k=Number.isFinite(C)?this.getVertexOffset(C):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:L,endOffset:k})}this._checkAttributeArray()}else b=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),b}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:o}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),o.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;mi(ArrayBuffer.isView(f.value),"invalid ".concat(o.accessor));const l=!!f.size&&f.size!==this.size;return i.binaryAccessor=nP(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:o,props:u,numInstances:f}){if(e.constant)return;const{settings:l,state:b,value:w,size:C,startIndices:L}=e,{accessor:k,transform:H}=l,K=b.binaryAccessor||(typeof k=="function"?k:u[k]);mi(typeof K=="function",'accessor "'.concat(k,'" is not a function'));let re=e.getVertexOffset(i);const{iterable:ce,objectInfo:W}=cg(n,i,o);for(const G of ce){W.index++;let Z=K(G,W);if(H&&(Z=H.call(this,Z)),L){const fe=(W.index<L.length-1?L[W.index+1]:f)-L[W.index];if(Z&&Array.isArray(Z[0])){let Te=re;for(const Pe of Z)e._normalizeValue(Pe,w,Te),Te+=C}else Z&&Z.length>C?w.set(Z,re):(e._normalizeValue(Z,W.target,0),iN({target:w,source:W.target,start:re,count:fe}));re+=fe*C}else e._normalizeValue(Z,w,re),re+=C}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class C5{constructor({gl:e,attribute:n,timeline:i}){N(this,"gl",void 0),N(this,"type","interpolation"),N(this,"attributeInTransition",void 0),N(this,"settings",void 0),N(this,"attribute",void 0),N(this,"transition",void 0),N(this,"currentStartIndices",void 0),N(this,"currentLength",void 0),N(this,"transform",void 0),N(this,"buffers",void 0),this.gl=e,this.transition=new Qd(i),this.attribute=n,this.attributeInTransition=new ix(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=L5(e,n);const o={byteLength:0,usage:35050};this.buffers=[new En(e,o),new En(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:o,attribute:u}=this;oP(o);const f={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)aP({buffer:l,...f});this.currentStartIndices=u.startIndices,this.currentLength=nx(u,n),this.attributeInTransition.setData({buffer:o[1],value:u.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aFrom:o[0],aTo:rP(i,u)},feedbackBuffers:{vCurrent:o[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:o}=this.transition;let u=o/n;i&&(u=i(u)),this.transform.run({uniforms:{time:u}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const M5=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function L5(t,e){const n=sP(e.size);return new X0(t,{vs:M5,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class k5{constructor({gl:e,attribute:n,timeline:i}){N(this,"gl",void 0),N(this,"type","spring"),N(this,"attributeInTransition",void 0),N(this,"settings",void 0),N(this,"attribute",void 0),N(this,"transition",void 0),N(this,"currentStartIndices",void 0),N(this,"currentLength",void 0),N(this,"texture",void 0),N(this,"framebuffer",void 0),N(this,"transform",void 0),N(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Qd(i),this.attribute=n,this.attributeInTransition=new ix(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=D5(e),this.framebuffer=z5(e,this.texture),this.transform=R5(e,n,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new En(e,o),new En(e,o),new En(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:o,attribute:u}=this,f={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)aP({buffer:l,...f});this.settings=e,this.currentStartIndices=u.startIndices,this.currentLength=nx(u,n),this.attributeInTransition.setData({buffer:o[1],value:u.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aTo:rP(i,u)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:o}=this;if(!o.update())return!1;const f=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:f.stiffness,damping:f.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),oP(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),rg(i)[0]>0||o.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function R5(t,e,n){const i=sP(e.size);return new X0(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function D5(t){return new gs(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function z5(t,e){return new Pi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const O5={interpolation:C5,spring:k5};class F5{constructor(e,{id:n,timeline:i}){N(this,"id",void 0),N(this,"isSupported",void 0),N(this,"gl",void 0),N(this,"timeline",void 0),N(this,"transitions",void 0),N(this,"needsRedraw",void 0),N(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=X0.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const o in e){const u=e[o],f=u.getTransitionSetting(n);f&&this._updateAttribute(o,u,f)}for(const o in this.transitions){const u=e[o];(!u||!u.getTransitionSetting(n))&&this._removeTransition(o)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const o=this.transitions[e];let u=!o||o.type!==i.type;if(u){if(!this.isSupported){an.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}o&&this._removeTransition(e);const f=O5[i.type];f?this.transitions[e]=new f({attribute:n,timeline:this.timeline,gl:this.gl}):(an.error("unsupported transition type '".concat(i.type,"'"))(),u=!1)}(u||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const HT="attributeManager.invalidate",B5="attributeManager.updateStart",N5="attributeManager.updateEnd",U5="attribute.updateStart",V5="attribute.allocate",j5="attribute.updateEnd";class G5{constructor(e,{id:n="attribute-manager",stats:i,timeline:o}={}){N(this,"id",void 0),N(this,"gl",void 0),N(this,"attributes",void 0),N(this,"updateTriggers",void 0),N(this,"needsRedraw",void 0),N(this,"userData",void 0),N(this,"stats",void 0),N(this,"attributeTransitionManager",void 0),N(this,"mergeBoundsMemoized",Jd(ZB)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new F5(e,{id:"".concat(n,"-transitions"),timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);hr(HT,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);hr(HT,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:o,props:u={},buffers:f={},context:l={}}){let b=!1;hr(B5,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const C=this.attributes[w],L=C.settings.accessor;C.startIndices=i,C.numInstances=n,u[w]&&an.removed("props.".concat(w),"data.attributes.".concat(w))(),C.setExternalBuffer(f[w])||C.setBinaryValue(typeof L=="string"?f[L]:void 0,e.startIndices)||typeof L=="string"&&!f[L]&&C.setConstantValue(u[L])||C.needsUpdate()&&(b=!0,this._updateAttribute({attribute:C,numInstances:n,data:e,props:u,context:l})),this.needsRedraw=this.needsRedraw||C.needsRedraw()}b&&hr(N5,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var o;return(o=this.attributes[i])===null||o===void 0?void 0:o.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,o={...i.getAttributes()};for(const u in n){const f=n[u];f.needsRedraw(e)&&!i.hasAttribute(u)&&(o[u]=f)}return o}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const o in e)n[o]||Object.assign(i,e[o].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const o=e[i];this.attributes[i]=this._createAttribute(i,o,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const o={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new ix(this.gl,o)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:o}=this,u=o[e];return u&&u.forEach(f=>{const l=i[f];l&&l.setNeedsUpdate(l.id,n)}),u}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(hr(U5,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&hr(V5,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,hr(j5,n,i))}}class $5 extends Qd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:o,easing:u}}=this,f=u(e/o);this._value=Mm(n,i,f)}}const WT=1e-5;function qT(t,e,n,i,o){const u=e-t,l=(n-e)*o,b=-u*i;return l+b+u+e}function H5(t,e,n,i,o){if(Array.isArray(n)){const u=[];for(let f=0;f<n.length;f++)u[f]=qT(t[f],e[f],n[f],i,o);return u}return qT(t,e,n,i,o)}function ZT(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const o=t[i]-e[i];n+=o*o}return Math.sqrt(n)}return Math.abs(t-e)}class W5 extends Qd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:o}=this.settings,{_prevValue:u=e,_currValue:f=e}=this;let l=H5(u,f,n,i,o);const b=ZT(l,n),w=ZT(l,f);b<WT&&w<WT&&(l=n,this.end()),this._prevValue=f,this._currValue=l}}const q5={interpolation:$5,spring:W5};class Z5{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,o){const{transitions:u}=this;if(u.has(e)){const b=u.get(e),{value:w=b.settings.fromValue}=b;n=w,this.remove(e)}if(o=iP(o),!o)return;const f=q5[o.type];if(!f){an.error("unsupported transition type '".concat(o.type,"'"))();return}const l=new f(this.timeline);l.start({...o,fromValue:n,toValue:i}),u.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function X5(t){const e=t[Qa];for(const n in e){const i=e[n],{validate:o}=i;if(o&&!o(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function Y5(t,e){const n=lP({newProps:t,oldProps:e,propTypes:t[Qa],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=J5(t,e);let o=!1;return i||(o=Q5(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:o,extensionsChanged:e6(t,e),transitionsChanged:K5(t,e)}}function K5(t,e){if(!t.transitions)return!1;const n={},i=t[Qa];let o=!1;for(const u in t.transitions){const f=i[u],l=f&&f.type;(l==="number"||l==="color"||l==="array")&&Dv(t[u],e[u],f)&&(n[u]=!0,o=!0)}return o?n:!1}function lP({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(o," changed shallowly");for(const u of Object.keys(t))if(!(u in n)){if(!(u in e))return"".concat(o,".").concat(u," added");const f=Dv(t[u],e[u],i[u]);if(f)return"".concat(o,".").concat(u," ").concat(f)}for(const u of Object.keys(e))if(!(u in n)){if(!(u in t))return"".concat(o,".").concat(u," dropped");if(!Object.hasOwnProperty.call(t,u)){const f=Dv(t[u],e[u],i[u]);if(f)return"".concat(o,".").concat(u," ").concat(f)}}return!1}function Dv(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function J5(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:o}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&o&&(n=o(t.data,e.data)||n),n}function Q5(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&XT(t,e,"all"))return{all:!0};const n={};let i=!1;for(const o in t.updateTriggers)o!=="all"&&XT(t,e,o)&&(n[o]=!0,i=!0);return i?n:!1}function e6(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let o=0;o<i.length;o++)if(!i[o].equals(n[o]))return!0;return!1}function XT(t,e,n){let i=t.updateTriggers[n];i=i??{};let o=e.updateTriggers[n];return o=o??{},lP({oldProps:o,newProps:i,triggerName:n})}const t6="count(): argument not an object",n6="count(): argument not a container";function i6(t){if(!s6(t))throw new Error(t6);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(r6(t))return Object.keys(t).length;throw new Error(n6)}function r6(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function s6(t){return t!==null&&typeof t=="object"}function o6(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(o=>o.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const o in e.inject)i[o]=(i[o]||"")+e.inject[o];n.inject=i}return n}const a6={10241:9987,10240:9729,10242:33071,10243:33071},zv={};function l6(t,e,n,i){if(n instanceof gs)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let o=null;n.compressed&&(o={10241:n.data.length>1?9985:9729});const u=new gs(e,{...n,parameters:{...a6,...o,...i}});return zv[u.id]=t,u}function c6(t,e){!e||!(e instanceof gs)||zv[e.id]===t&&(e.delete(),delete zv[e.id])}const u6={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Ov(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Ao(t,e,1)}},accessor:{validate(t,e){const n=Om(t);return n==="function"||n===Om(e.value)},equal(t,e,n){return typeof e=="function"?!0:Ao(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Ov(t)},equal(t,e,n){const{compare:i}=n,o=Number.isInteger(i)?i:i?1:0;return i?Ao(t,e,o):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,o=Number.isInteger(i)?i:i?1:0;return i?Ao(t,e,o):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:l6(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{c6(n.id,t)}}};function h6(t){const e={},n={},i={};for(const[o,u]of Object.entries(t)){const f=u==null?void 0:u.deprecatedFor;if(f)i[o]=Array.isArray(f)?f:[f];else{const l=d6(o,u);e[o]=l,n[o]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function d6(t,e){switch(Om(e)){case"object":return qh(t,e);case"array":return qh(t,{type:"array",value:e,compare:!1});case"boolean":return qh(t,{type:"boolean",value:e});case"number":return qh(t,{type:"number",value:e});case"function":return qh(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function qh(t,e){return"type"in e?{name:t,...u6[e.type],...e}:"value"in e?{name:t,type:Om(e.value),...e}:{name:t,type:"object",value:e}}function Ov(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Om(t){return Ov(t)?"array":t===null?"null":typeof t}function f6(t,e){let n;for(let u=e.length-1;u>=0;u--){const f=e[u];"extensions"in f&&(n=f.extensions)}const i=Fv(t.constructor,n),o=Object.create(i);o[zm]=t,o[Xl]={},o[Ga]={};for(let u=0;u<e.length;++u){const f=e[u];for(const l in f)o[l]=f[l]}return Object.freeze(o),o}const p6="_mergedDefaultProps";function Fv(t,e){let n=p6;if(e)for(const o of e){const u=o.constructor;u&&(n+=":".concat(u.extensionName||u.name))}const i=cP(t,n);return i||(t[n]=m6(t,e||[]))}function m6(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),o=Fv(i),u=cP(t,"defaultProps")||{},f=h6(u),l=Object.assign(Object.create(null),o,f.defaultProps),b=Object.assign(Object.create(null),o==null?void 0:o[Qa],f.propTypes),w=Object.assign(Object.create(null),o==null?void 0:o[ly],f.deprecatedProps);for(const C of e){const L=Fv(C.constructor);L&&(Object.assign(l,L),Object.assign(b,L[Qa]),Object.assign(w,L[ly]))}return g6(l,t),y6(l,b),_6(l,w),l[Qa]=b,l[ly]=w,e.length===0&&!rx(t,"_propTypes")&&(t._propTypes=b),l}function g6(t,e){const n=x6(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function _6(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const o="".concat(this.id,": ").concat(n);for(const u of e[n])rx(this,u)||(this[u]=i);an.deprecated(o,e[n].join("/"))()}})}function y6(t,e){const n={},i={};for(const o in e){const u=e[o],{name:f,value:l}=u;u.async&&(n[f]=l,i[f]=v6(f))}t[du]=n,t[Xl]={},Object.defineProperties(t,i)}function v6(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||tP(e)?this[Xl][t]=e:this[Ga][t]=e},get(){if(this[Ga]){if(t in this[Ga])return this[Ga][t]||this[du][t];if(t in this[Xl]){const e=this[zm]&&this[zm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[du][t]}}return this[du][t]}}}function rx(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function cP(t,e){return rx(t,e)&&t[e]}function x6(t){const e=t.componentName;return e||an.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let b6=0;class sx{constructor(...e){N(this,"id",void 0),N(this,"props",void 0),N(this,"count",void 0),this.props=f6(this,e),this.id=this.props.id,this.count=b6++}clone(e){const{props:n}=this,i={};for(const o in n[du])o in n[Ga]?i[o]=n[Ga][o]:o in n[Xl]&&(i[o]=n[Xl][o]);return new this.constructor({...n,...i,...e})}}N(sx,"componentName","Component");N(sx,"defaultProps",{});const w6=Object.freeze({});class T6{constructor(e){N(this,"component",void 0),N(this,"onAsyncPropUpdated",void 0),N(this,"asyncProps",void 0),N(this,"oldProps",void 0),N(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||w6}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[zm]||this.component;const n=e[Ga]||{},i=e[Xl]||e,o=e[du]||{};for(const u in n){const f=n[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,f),n[u]=this.getAsyncProp(u)}for(const u in i){const f=i[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,f)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(tP(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const o=this.asyncProps[e];o&&i>=o.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=n,o.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const o=i.pendingLoadCount;n.then(u=>{this.component&&(u=this._postProcessValue(i,u),this._setAsyncPropValue(e,u,o),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const o=i.pendingLoadCount;let u=[],f=0;for await(const l of n){if(!this.component)return;const{dataTransform:b}=this.component.props;b?u=b(l,u):u=u.concat(l),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(e,u,o)}this._onResolve(e,u)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Qa];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class E6 extends T6{constructor({attributeManager:e,layer:n}){super(n),N(this,"attributeManager",void 0),N(this,"needsRedraw",void 0),N(this,"needsUpdate",void 0),N(this,"subLayers",void 0),N(this,"usesPickingColorCache",void 0),N(this,"hasPickingBuffer",void 0),N(this,"changeFlags",void 0),N(this,"viewport",void 0),N(this,"uniformTransitions",void 0),N(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,o=i==null?void 0:i.props.fetch;return o?o(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const o=i.props.onDataLoad;e==="data"&&o&&o(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const S6="layer.changeFlag",A6="layer.initialize",P6="layer.update",I6="layer.finalize",C6="layer.matched",YT=2**24-1,M6=Object.freeze([]),L6=Jd(({oldViewport:t,viewport:e})=>t.equals(e));let bo=new Uint8ClampedArray(0);const k6={data:{type:"data",value:M6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:o,signal:u})=>{const{resourceManager:f}=n.context;if(o=o||n.getLoadOptions(),i=i||n.props.loaders,u){var l;o={...o,fetch:{...(l=o)===null||l===void 0?void 0:l.fetch,signal:u}}}let b=f.contains(t);return!b&&!o&&(f.add({resourceId:t,data:Pm(t,i),persistent:!1}),b=!0),b?f.subscribe({resourceId:t,onChange:w=>{var C;return(C=n.internalState)===null||C===void 0?void 0:C.reloadAsyncProp(e,w)},consumerId:n.id,requestId:e}):Pm(t,i,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:_n.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class tc extends sx{constructor(...e){super(...e),N(this,"internalState",null),N(this,"lifecycle",$c.NO_STATE),N(this,"context",void 0),N(this,"state",void 0),N(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){mi(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=$A(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,u,f]=jA(i,n.pixelProjectionMatrix);return e.length===2?[o,u]:[o,u,f]}unproject(e){return mi(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){mi(this.internalState);const i=this.internalState.viewport||this.context.viewport;return eN(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===_n.DEFAULT||e===_n.LNGLAT||e===_n.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){mi(e instanceof Uint8Array);const[n,i,o]=e;return n+i*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:i6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=o6(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const o of i)n.invalidateAll(o);else n.invalidateAll();if(n){const{props:o}=e,u=this.internalState.hasPickingBuffer,f=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(u!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:l,instancePickingColors:b}=n.attributes,w=l||b;w&&(f&&w.constant&&(w.constant=!1,n.invalidate(w.id)),!w.value&&!f&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,n){var i,o;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(o=this.props).onError)!==null&&i!==void 0&&i.call(o,e))){var u,f;(u=this.context)===null||u===void 0||(f=u.onError)===null||f===void 0||f.call(u,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!L6({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),o=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:o,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const o in n)Object.defineProperty(i,o,{value:n[o]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(bo.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>YT&&an.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),bo=Iu.allocate(bo,n,{size:3,copy:!0,maxCount:Math.max(n,YT)});const o=Math.floor(bo.length/3),u=[];for(let f=i;f<o;f++)this.encodePickingColor(f,u),bo[f*3+0]=u[0],bo[f*3+1]=u[1],bo[f*3+2]=u[2]}e.value=bo.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),o=e.userData.excludeAttributes||{},u=i.getShaderAttributes(n,o);e.setAttributes(u)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:o}=this.getAttributeManager().attributes,u=i||o,f=u&&n.attributes&&n.attributes[u.id];if(f&&f.value){const l=f.value,b=this.encodePickingColor(e);for(let w=0;w<n.length;w++){const C=u.getVertexOffset(w);l[C]===b[0]&&l[C+1]===b[1]&&l[C+2]===b[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i;if(!o)return;const u=o.getVertexOffset(e),f=o.getVertexOffset(e+1);o.buffer.subData({data:new Uint8Array(f-u),offset:u})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==bo.buffer&&(i.value=bo.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){mi(!this.internalState),mi(Number.isFinite(this.props.coordinateSystem)),hr(A6,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new E6({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(an.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Z5(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){hr(C6,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(hr(P6,this,e),!e)return;const n=this.props,i=this.context,o=this.internalState,u=i.viewport,f=this._updateUniformTransition();o.propsInTransition=f,i.viewport=o.viewport||u,this.props=f;try{const l=this._getUpdateParams(),b=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const C of this.props.extensions)C.updateState.call(this,l,C);const w=this.getModels()[0]!==b[0];this._postUpdate(l,w)}finally{i.viewport=u,this.props=n,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){hr(I6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,u=this.context;this.props=this.internalState.propsInTransition||o;const f=this.props.opacity;n.opacity=Math.pow(f,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,b=l&&l(n)||[0,0];oa(u.gl,{polygonOffset:b}),oo(u.gl,i,()=>{const w={moduleParameters:e,uniforms:n,parameters:i,context:u};for(const C of this.props.extensions)C.draw.call(this,w,C);this.draw(w)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const o in e)if(e[o]){let u=!1;switch(o){case"dataChanged":const f=e[o],l=n[o];f&&Array.isArray(l)&&(n.dataChanged=Array.isArray(f)?l.concat(f):f,u=!0);default:n[o]||(n[o]=e[o],u=!0)}u&&hr(S6,this,o,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=Y5(e,n);if(i.updateTriggersChanged)for(const u in i.updateTriggersChanged)i.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(i.transitionsChanged)for(const u in i.transitionsChanged){var o;this.internalState.uniformTransitions.add(u,n[u],e[u],(o=e.transitions)===null||o===void 0?void 0:o[u])}return this.setChangeFlags(i)}validateProps(){X5(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new G5(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:o}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:u}=this.state;u==null||u.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:l,highlightColor:b}=i;if(n||o.autoHighlight!==f||o.highlightedObjectIndex!==l||o.highlightColor!==b){const w={};f||(w.pickingSelectedColor=null),Array.isArray(b)&&(w.pickingHighlightColor=b),(n||l!==o.highlightedObjectIndex)&&(w.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(w)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),o=i?i.getNeedsRedraw(e):!1;if(n=n||o,n)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}N(tc,"defaultProps",k6);N(tc,"layerName","Layer");const R6="compositeLayer.renderLayers";class uP extends tc{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,o)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,o)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:o,visible:u,parameters:f,getPolygonOffset:l,highlightedObjectIndex:b,autoHighlight:w,highlightColor:C,coordinateSystem:L,coordinateOrigin:k,wrapLongitude:H,positionFormat:K,modelMatrix:re,extensions:ce,fetch:W,operation:G,_subLayerProps:Z}=this.props,fe={id:"",updateTriggers:{},opacity:i,pickable:o,visible:u,parameters:f,getPolygonOffset:l,highlightedObjectIndex:b,autoHighlight:w,highlightColor:C,coordinateSystem:L,coordinateOrigin:k,wrapLongitude:H,positionFormat:K,modelMatrix:re,extensions:ce,fetch:W,operation:G},Te=Z&&e.id&&Z[e.id],Pe=Te&&Te.updateTriggers,ze=e.id||"sublayer";if(Te){const Oe=this.props[Qa],Me=e.type?e.type._propTypes:{};for(const Ee in Te){const Re=Me[Ee]||Oe[Ee];Re&&Re.type==="accessor"&&(Te[Ee]=this.getSubLayerAccessor(Te[Ee]))}}Object.assign(fe,e,Te),fe.id="".concat(this.props.id,"-").concat(ze),fe.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...Pe};for(const Oe of ce){const Me=Oe.getSubLayerProps.call(this,Oe);Me&&Object.assign(fe,Me,{updateTriggers:Object.assign(fe.updateTriggers,Me.updateTriggers)})}return fe}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const o=!i||this.needsUpdate();if(o){const u=this.renderLayers();i=Cu(u,Boolean),this.internalState.subLayers=i}hr(R6,this,o,i);for(const u of i)u.parent=this}}N(uP,"layerName","CompositeLayer");class D6{constructor(e){N(this,"opts",void 0),N(this,"typedArrayManager",void 0),N(this,"indexStarts",[0]),N(this,"vertexStarts",[0]),N(this,"vertexCount",0),N(this,"instanceCount",0),N(this,"attributes",void 0),N(this,"_attributeDefs",void 0),N(this,"data",void 0),N(this,"getGeometry",void 0),N(this,"geometryBuffer",void 0),N(this,"buffers",void 0),N(this,"positionSize",void 0),N(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Iu,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:o,geometryBuffer:u,positionFormat:f,dataChanged:l,normalize:b=!0}=this.opts;if(this.data=n,this.getGeometry=o,this.positionSize=u&&u.size||(f==="XY"?2:3),this.buffers=i,this.normalize=b,u&&(mi(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),b||(i.positions=u)),this.geometryBuffer=i.positions,Array.isArray(l))for(const w of l)this._rebuildGeometry(w);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?nP(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:o,_attributeDefs:u,typedArrayManager:f}=this;for(const l in u)if(l in o)f.release(i[l]),i[l]=null;else{const b=u[l];b.copy=n,i[l]=f.allocate(i[l],e,b)}}_forEachGeometry(e,n,i){const{data:o,getGeometry:u}=this,{iterable:f,objectInfo:l}=cg(o,n,i);for(const b of f){l.index++;const w=u?u(b,l):null;e(w,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:o}=this;const{data:u,geometryBuffer:f}=this,{startRow:l=0,endRow:b=1/0}=e||{},w={};if(e||(n=[0],i=[0]),this.normalize||!f)this._forEachGeometry((L,k)=>{const H=L&&this.normalizeGeometry(L);w[k]=H,i[k+1]=i[k]+(H?this.getGeometrySize(H):0)},l,b),o=i[i.length-1];else if(i=u.startIndices,o=i[u.length]||0,ArrayBuffer.isView(f))o=o||f.length/this.positionSize;else if(f instanceof En){const L=f.accessor.stride||this.positionSize*4;o=o||f.byteLength/L}else if(f.buffer){const L=f.stride||this.positionSize*4;o=o||f.buffer.byteLength/L}else if(f.value){const L=f.value,k=f.stride/L.BYTES_PER_ELEMENT||this.positionSize;o=o||L.length/k}this._allocate(o,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=o;const C={};this._forEachGeometry((L,k)=>{const H=w[k]||L;C.vertexStart=i[k],C.indexStart=n[k];const K=k<i.length-1?i[k+1]:o;C.geometrySize=K-i[k],C.geometryIndex=k,this.updateGeometryAttributes(H,C)},l,b),this.vertexCount=n[n.length-1]}}const dy=512,z6=Math.PI/180;function hP({map:t,gl:e,deck:n}){if(t.__deck)return t.__deck;const i=n==null?void 0:n.props._customRender,o=n==null?void 0:n.props.onLoad,u=fP({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),i==null||i("")}});let f;return(!n||n.props.gl===e)&&(Object.assign(u,{gl:e,width:null,height:null,touchAction:"unset",viewState:Fd(t)}),n!=null&&n.isInitialized?KT(n,t):u.onLoad=()=>{o==null||o(),KT(f,t)}),n?(f=n,n.setProps(u),n.userData.isExternal=!0):(f=new Od(u),t.on("remove",()=>{dP(t)})),f.userData.mapboxLayers=new Set,t.__deck=f,t.on("render",()=>{f.isInitialized&&V6(f,t)}),f}function KT(t,e){const n=()=>{t.isInitialized?j6(t,e):e.off("move",n)};e.on("move",n)}function dP(t){var e;(e=t.__deck)===null||e===void 0||e.finalize(),t.__deck=null}function fP(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new ex({id:"mapbox"})]}}function O6(t,e){t.userData.mapboxLayers.add(e),ox(t)}function F6(t,e){t.userData.mapboxLayers.delete(e),ox(t)}function B6(t,e){ox(t)}function N6(t,e,n){let{currentViewport:i}=t.userData,o=!1;i||(i=pP(t,e,!0),t.userData.currentViewport=i,o=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:u})=>n.id===u.id||u.props.operation.includes("terrain"),clearStack:o,clearCanvas:!1})}function Fd(t){var e;const{lng:n,lat:i}=t.getCenter(),o={longitude:(n+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(e=t.getTerrain)!==null&&e!==void 0&&e.call(t)&&U6(t,o),o}function U6(t,e){if(t.getFreeCameraOptions){const{position:n}=t.getFreeCameraOptions();if(!n||n.z===void 0)return;const i=t.transform.height,{longitude:o,latitude:u,pitch:f}=e,l=n.x*dy,b=(1-n.y)*dy,w=n.z*dy,C=zd([o,u]),L=l-C[0],k=b-C[1],H=Math.sqrt(L*L+k*k),K=f*z6,re=1.5*i,ce=K<.001?re*Math.cos(K)/w:re*Math.sin(K)/H;e.zoom=Math.log2(ce);const W=re*Math.cos(K)/ce,G=w-W;e.position=[0,0,G/Kp(u)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function pP(t,e,n=!0){return new Zl({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...Fd(e),nearZMultiplier:n?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function V6(t,e){const{mapboxLayers:n,isExternal:i}=t.userData;if(i){const o=Array.from(n,C=>C.id),f=Cu(t.props.layers,Boolean).some(C=>C&&!o.includes(C.id));let l=t.getViewports();const b=l.findIndex(C=>C.id==="mapbox"),w=l.length>1||b<0;(f||w)&&(b>=0&&(l=l.slice(),l[b]=pP(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:l,layerFilter:C=>(!t.props.layerFilter||t.props.layerFilter(C))&&(C.viewport.id!=="mapbox"||!o.includes(C.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function j6(t,e){t.setProps({viewState:Fd(e)}),t.needsRedraw({clearRedrawFlags:!0})}function ox(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(n=>{const i=n.props.type,o=new i(n.props);e.push(o)}),t.setProps({layers:e})}class G6{constructor(e){if(N(this,"id",void 0),N(this,"type",void 0),N(this,"renderingMode",void 0),N(this,"map",void 0),N(this,"deck",void 0),N(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,n){this.map=e,this.deck=hP({map:e,gl:n,deck:this.props.deck}),O6(this.deck,this)}onRemove(){this.deck&&F6(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&B6(this.deck)}render(){N6(this.deck,this.map,this)}}const fy="__UNDEFINED__";function kp(t,e,n,i){if(!t||!e||!t.style||!t.style._loaded)return;const o=Cu(i,Boolean);if(n!==i){const l=Cu(n,Boolean),b=new Set(l.map(w=>w.id));for(const w of o)b.delete(w.id);for(const w of b)t.getLayer(w)&&t.removeLayer(w)}for(const l of o){const b=t.getLayer(l.id);b?b.implementation.setProps(l.props):t.addLayer(new G6({id:l.id,deck:e}),l.props.beforeId)}const u=t.style._order,f={};for(const l of o){let{beforeId:b}=l.props;(!b||!u.includes(b))&&(b=fy),f[b]=f[b]||[],f[b].push(l.id)}for(const l in f){const b=f[l];let w=l===fy?u.length:u.indexOf(l),C=l===fy?void 0:l;for(let L=b.length-1;L>=0;L--){const k=b[L],H=u.indexOf(k);H!==w-1&&(t.moveLayer(k,C),H>w&&w++),w--,C=k}}}class $6{constructor(e){N(this,"_props",void 0),N(this,"_deck",void 0),N(this,"_map",void 0),N(this,"_container",void 0),N(this,"_interleaved",void 0),N(this,"_lastMouseDownPoint",void 0),N(this,"_handleStyleChange",()=>{kp(this._map,this._deck,this._props.layers,this._props.layers)}),N(this,"_updateContainerSize",()=>{if(this._map&&this._container){const{clientWidth:o,clientHeight:u}=this._map.getContainer();Object.assign(this._container.style,{width:"".concat(o,"px"),height:"".concat(u,"px")})}}),N(this,"_updateViewState",()=>{const o=this._deck;o&&(o.setProps({viewState:Fd(this._map)}),o.isInitialized&&o.redraw())}),N(this,"_handleMouseEvent",o=>{const u=this._deck;if(!u||!u.isInitialized)return;const f={type:o.type,offsetCenter:o.point,srcEvent:o},l=this._lastMouseDownPoint;switch(!o.point&&l&&(f.deltaX=o.originalEvent.clientX-l.clientX,f.deltaY=o.originalEvent.clientY-l.clientY,f.offsetCenter={x:l.x+f.deltaX,y:l.y+f.deltaY}),f.type){case"mousedown":u._onPointerDown(f),this._lastMouseDownPoint={...o.point,clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY};break;case"dragstart":f.type="panstart",u._onEvent(f);break;case"drag":f.type="panmove",u._onEvent(f);break;case"dragend":f.type="panend",u._onEvent(f);break;case"click":f.tapCount=1,u._onEvent(f);break;case"dblclick":f.type="click",f.tapCount=2,u._onEvent(f);break;case"mousemove":f.type="pointermove",u._onPointerMove(f);break;case"mouseout":f.type="pointerleave",u._onPointerMove(f);break;default:return}});const{interleaved:n=!1,...i}=e;this._interleaved=n,this._props=i}setProps(e){this._interleaved&&e.layers&&kp(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?fP(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=n,this._deck=new Od({...this._props,parent:n,viewState:Fd(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}_onAddInterleaved(e){return this._deck=hP({map:e,gl:e.painter.context.gl,deck:new Od({...this._props,gl:e.painter.context.gl})}),e.on("styledata",this._handleStyleChange),kp(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var n;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(n=this._deck)===null||n===void 0||n.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),kp(e,this._deck,this._props.layers,[]),dP(e)}getDefaultPosition(){return"top-left"}pickObject(e){return mi(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return mi(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return mi(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const H6=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,W6=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,q6=1024,Z6=4,JT=()=>{},QT={10241:9987,10240:9729,10242:33071,10243:33071};function X6(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Y6(t,e,n,i){const o=Math.min(n/e.width,i/e.height),u=Math.floor(e.width*o),f=Math.floor(e.height*o);return o===1?{data:e,width:u,height:f}:(t.canvas.height=f,t.canvas.width=u,t.clearRect(0,0,u,f),t.drawImage(e,0,0,e.width,e.height,0,0,u,f),{data:t.canvas,width:u,height:f})}function Bd(t){return t&&(t.id||t.url)}function K6(t,e,n,i){const o=t.width,u=t.height,f=new gs(t.gl,{width:e,height:n,parameters:i});return oz(t,f,{targetY:0,width:o,height:u}),t.delete(),f}function e2(t,e,n){for(let i=0;i<e.length;i++){const{icon:o,xOffset:u}=e[i],f=Bd(o);t[f]={...o,x:u,y:n}}}function J6({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:o=0,rowHeight:u=0,canvasWidth:f}){let l=[];for(let b=0;b<t.length;b++){const w=t[b],C=Bd(w);if(!n[C]){const{height:L,width:k}=w;i+k+e>f&&(e2(n,l,o),i=0,o=u+o+e,u=0,l=[]),l.push({icon:w,xOffset:i}),i=i+k+e,u=Math.max(u,L)}}return l.length>0&&e2(n,l,o),{mapping:n,rowHeight:u,xOffset:i,yOffset:o,canvasWidth:f,canvasHeight:X6(u+o+e)}}function Q6(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:o,objectInfo:u}=cg(t);for(const f of o){u.index++;const l=e(f,u),b=Bd(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!i[b]&&(!n[b]||l.url!==n[b].url)&&(i[b]={...l,source:f,sourceIndex:u.index})}return i}class eU{constructor(e,{onUpdate:n=JT,onError:i=JT}){N(this,"gl",void 0),N(this,"onUpdate",void 0),N(this,"onError",void 0),N(this,"_loadOptions",null),N(this,"_texture",null),N(this,"_externalTexture",null),N(this,"_mapping",{}),N(this,"_textureParameters",null),N(this,"_pendingCount",0),N(this,"_autoPacking",!1),N(this,"_xOffset",0),N(this,"_yOffset",0),N(this,"_rowHeight",0),N(this,"_buffer",Z6),N(this,"_canvasWidth",q6),N(this,"_canvasHeight",0),N(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Bd(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:o,textureParameters:u}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),o&&(this._mapping=o),i){var f;(f=this._texture)===null||f===void 0||f.delete(),this._texture=null,this._externalTexture=i}u&&(this._textureParameters=u)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(Q6(e,n,this._mapping)||{});if(i.length>0){const{mapping:o,xOffset:u,yOffset:f,rowHeight:l,canvasHeight:b}=J6({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=o,this._xOffset=u,this._yOffset=f,this._canvasHeight=b,this._texture||(this._texture=new gs(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||QT})),this._texture.height!==this._canvasHeight&&(this._texture=K6(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||QT)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,Pm(i.url,this._loadOptions).then(o=>{const u=Bd(i),f=this._mapping[u],{x:l,y:b,width:w,height:C}=f,{data:L,width:k,height:H}=Y6(n,o,w,C);this._texture.setSubImageData({data:L,x:l+(w-k)/2,y:b+(C-H)/2,width:k,height:H}),f.width=k,f.height=H,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const mP=[0,0,0,255],tU={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:mP},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class ax extends tc{constructor(...e){super(...e),N(this,"state",void 0)}getShaders(){return super.getShaders({vs:H6,fs:W6,modules:[og,ag]})}initializeState(){this.state={iconManager:new eU(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:mP},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:o}=e,u=this.getAttributeManager(),{iconAtlas:f,iconMapping:l,data:b,getIcon:w,textureParameters:C}=n,{iconManager:L}=this.state,k=f||this.internalState.isAsyncPropLoading("iconAtlas");if(L.setProps({loadOptions:n.loadOptions,autoPacking:!k,iconAtlas:f,iconMapping:k?l:null,textureParameters:C}),k?i.iconMapping!==n.iconMapping&&u.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&L.packIcons(b,w),o.extensionsChanged){var H;const{gl:K}=this.context;(H=this.state.model)===null||H===void 0||H.delete(),this.state.model=this._getModel(K),u.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:o,sizeUnits:u,billboard:f,alphaCutoff:l}=this.props,{iconManager:b}=this.state,w=b.getTexture();w&&this.state.model.setUniforms(e).setUniforms({iconsTexture:w,iconsTextureDim:[w.width,w.height],sizeUnits:Wl[u],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:o,billboard:f,alphaCutoff:l}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Kd(e,{...this.getShaders(),id:this.props.id,geometry:new sg({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):an.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:o=n/2,anchorY:u=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-o,i/2-u]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:o,height:u}=this.state.iconManager.getIconMapping(e);return[n,i,o,u]}}N(ax,"defaultProps",tU);N(ax,"layerName","IconLayer");const nU=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,iU=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,t2=[0,0,0,255],rU={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:t2},getLineColor:{type:"accessor",value:t2},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class lx extends tc{getShaders(){return super.getShaders({vs:nU,fs:iU,modules:[og,ag]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:o,radiusMaxPixels:u,stroked:f,filled:l,billboard:b,antialiasing:w,lineWidthUnits:C,lineWidthScale:L,lineWidthMinPixels:k,lineWidthMaxPixels:H}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:f?1:0,filled:l,billboard:b,antialiasing:w,radiusUnits:Wl[n],radiusScale:i,radiusMinPixels:o,radiusMaxPixels:u,lineWidthUnits:Wl[C],lineWidthScale:L,lineWidthMinPixels:k,lineWidthMaxPixels:H}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Kd(e,{...this.getShaders(),id:this.props.id,geometry:new sg({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}N(lx,"defaultProps",rU);N(lx,"layerName","ScatterplotLayer");function Rp(t,e){const n=e.length,i=t.length;if(i>0){let o=!0;for(let u=0;u<n;u++)if(t[i-n+u]!==e[u]){o=!1;break}if(o)return!1}for(let o=0;o<n;o++)t[i+o]=e[o];return!0}function n2(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function i2(t,e,n,i,o=[]){const u=i+e*n;for(let f=0;f<n;f++)o[f]=t[u+f];return o}function r2(t,e,n,i,o=[]){let u,f;if(n&8)u=(i[3]-t[1])/(e[1]-t[1]),f=3;else if(n&4)u=(i[1]-t[1])/(e[1]-t[1]),f=1;else if(n&2)u=(i[2]-t[0])/(e[0]-t[0]),f=2;else if(n&1)u=(i[0]-t[0])/(e[0]-t[0]),f=0;else return null;for(let l=0;l<t.length;l++)o[l]=(f&1)===l?i[f]:u*(e[l]-t[l])+t[l];return o}function py(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function gP(t,e){const{size:n=2,broken:i=!1,gridResolution:o=10,gridOffset:u=[0,0],startIndex:f=0,endIndex:l=t.length}=e||{},b=(l-f)/n;let w=[];const C=[w],L=i2(t,0,n,f);let k,H;const K=sU(L,o,u,[]),re=[];Rp(w,L);for(let ce=1;ce<b;ce++){for(k=i2(t,ce,n,f,k),H=py(k,K);H;){r2(L,k,H,K,re);const W=py(re,K);W&&(r2(L,re,W,K,re),H=W),Rp(w,re),n2(L,re),oU(K,o,H),i&&w.length>n&&(w=[],C.push(w),Rp(w,L)),H=py(k,K)}Rp(w,k),n2(L,k)}return i?C:C[0]}function sU(t,e,n,i){const o=Math.floor((t[0]-n[0])/e)*e+n[0],u=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=o,i[1]=u,i[2]=o+e,i[3]=u+e,i}function oU(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function aU(t,e){const{size:n=2,startIndex:i=0,endIndex:o=t.length,normalize:u=!0}=e||{},f=t.slice(i,o);lU(f,n,0,o-i);const l=gP(f,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(u)for(const b of l)cU(b,n);return l}function lU(t,e,n,i){let o=t[0],u;for(let f=n;f<i;f+=e){u=t[f];const l=u-o;(l>180||l<-180)&&(u-=Math.round(l/360)*360),t[f]=o=u}}function cU(t,e){let n;const i=t.length/e;for(let u=0;u<i&&(n=t[u*e],(n+180)%360===0);u++);const o=-Math.round(n/360)*360;if(o!==0)for(let u=0;u<i;u++)t[u*e]+=o}function uU(t,e,n,i){let o;if(Array.isArray(t[0])){const u=t.length*e;o=new Array(u);for(let f=0;f<t.length;f++)for(let l=0;l<e;l++)o[f*e+l]=t[f][l]||0}else o=t;return n?gP(o,{size:e,gridResolution:n}):i?aU(o,{size:e}):o}const hU=1,dU=2,my=4;class fU extends D6{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?uU(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(s2(e)){let i=0;for(const o of e)i+=this.getGeometrySize(o);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&s2(e))for(const i of e){const o=this.getGeometrySize(i);n.geometrySize=o,this.updateGeometryAttributes(i,n),n.vertexStart+=o}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,o=e?this.isClosed(e):!1,{vertexStart:u,geometrySize:f}=n;i.fill(0,u,u+f),o?(i[u]=my,i[u+f-2]=my):(i[u]+=hU,i[u+f-2]+=dU),i[u+f-1]=my}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:o,geometrySize:u}=n,f=new Array(3);for(let l=o,b=0;b<u;l++,b++)this.getPointOnPath(e,b,f),i[l*3]=f[0],i[l*3+1]=f[1],i[l*3+2]=f[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:o}=this;n*o>=e.length&&(n+=1-e.length/o);const u=n*o;return i[0]=e[u],i[1]=e[u+1],i[2]=o===3&&e[u+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function s2(t){return Array.isArray(t[0])}const pU=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,mU=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,_P=[0,0,0,255],gU={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:_P},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},gy={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class cx extends tc{constructor(...e){super(...e),N(this,"state",void 0)}getShaders(){return super.getShaders({vs:pU,fs:mU,modules:[og,ag]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:gy,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:gy,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:gy,defaultValue:_P},instancePickingColors:{size:3,type:5121,accessor:(i,{index:o,target:u})=>this.encodePickingColor(i&&i.__source?i.__source.index:o,u)}}),this.setState({pathTesselator:new fU({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,o=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,b=n.data.attributes||{};l.updateGeometry({data:n.data,geometryBuffer:b.getPath,buffers:b,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||o.invalidateAll()}if(i.extensionsChanged){var f;const{gl:l}=this.context;(f=this.state.model)===null||f===void 0||f.delete(),this.state.model=this._getModel(l),o.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:o}=this.props;return o[0]&&o[0].__source&&(n.object=o.find(u=>u.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:o,miterLimit:u,widthUnits:f,widthScale:l,widthMinPixels:b,widthMaxPixels:w}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:o,widthUnits:Wl[f],widthScale:l,miterLimit:u,widthMinPixels:b,widthMaxPixels:w}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Kd(e,{...this.getShaders(),id:this.props.id,geometry:new sg({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}N(cx,"defaultProps",gU);N(cx,"layerName","PathLayer");const _U=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,_y=192/256,o2=[],yU={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class ux extends ax{constructor(...e){super(...e),N(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:_U}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:o})=>this.encodePickingColor(i,o)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:o}=n;o!==i.outlineColor&&(o=o.map(u=>u/255),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!n.sdf&&n.outlineWidth&&an.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:o}=this.props,{outlineColor:u}=this.state,f=o?Math.max(i,_y*(1-o)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:_y,outlineBuffer:f,gamma:i,sdf:!!n,outlineColor:u},super.draw(e),n&&o){const{iconManager:l}=this.state;l.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:_y}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):o2}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):o2}}N(ux,"defaultProps",yU);N(ux,"layerName","MultiIconLayer");const dd=1e20;class vU{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:o=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:l="normal",lang:b=null}={}){this.buffer=n,this.cutoff=o,this.radius=i,this.lang=b;const w=this.size=e+n*4,C=this._createCanvas(w),L=this.ctx=C.getContext("2d",{willReadFrequently:!0});L.font=`${l} ${f} ${e}px ${u}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(e),l=Math.ceil(i),b=0,w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),C=Math.min(this.size-this.buffer,l+Math.ceil(o)),L=w+2*this.buffer,k=C+2*this.buffer,H=Math.max(L*k,0),K=new Uint8ClampedArray(H),re={data:K,width:L,height:k,glyphWidth:w,glyphHeight:C,glyphTop:l,glyphLeft:b,glyphAdvance:n};if(w===0||C===0)return re;const{ctx:ce,buffer:W,gridInner:G,gridOuter:Z}=this;this.lang&&(ce.lang=this.lang),ce.clearRect(W,W,w,C),ce.fillText(e,W,W+l);const fe=ce.getImageData(W,W,w,C);Z.fill(dd,0,H),G.fill(0,0,H);for(let Te=0;Te<C;Te++)for(let Pe=0;Pe<w;Pe++){const ze=fe.data[4*(Te*w+Pe)+3]/255;if(ze===0)continue;const Oe=(Te+W)*L+Pe+W;if(ze===1)Z[Oe]=0,G[Oe]=dd;else{const Me=.5-ze;Z[Oe]=Me>0?Me*Me:0,G[Oe]=Me<0?Me*Me:0}}a2(Z,0,0,L,k,L,this.f,this.v,this.z),a2(G,W,W,w,C,L,this.f,this.v,this.z);for(let Te=0;Te<H;Te++){const Pe=Math.sqrt(Z[Te])-Math.sqrt(G[Te]);K[Te]=Math.round(255-255*(Pe/this.radius+this.cutoff))}return re}}function a2(t,e,n,i,o,u,f,l,b){for(let w=e;w<e+i;w++)l2(t,n*u+w,u,o,f,l,b);for(let w=n;w<n+o;w++)l2(t,w*u+e,1,i,f,l,b)}function l2(t,e,n,i,o,u,f){u[0]=0,f[0]=-dd,f[1]=dd,o[0]=t[e];for(let l=1,b=0,w=0;l<i;l++){o[l]=t[e+l*n];const C=l*l;do{const L=u[b];w=(o[l]-o[L]+C-L*L)/(l-L)/2}while(w<=f[b]&&--b>-1);b++,u[b]=l,f[b]=w,f[b+1]=dd}for(let l=0,b=0;l<i;l++){for(;f[b+1]<l;)b++;const w=u[b],C=l-w;t[e+l*n]=o[w]+C*C}}const xU=32,bU=[];function wU(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function TU({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:o,mapping:u={},xOffset:f=0,yOffset:l=0}){let b=0,w=f;const C=n+i*2;for(const L of t)if(!u[L]){const k=e(L);w+k+i*2>o&&(w=0,b++),u[L]={x:w+i,y:l+b*C+i,width:k,height:C,layoutWidth:k,layoutHeight:n},w+=k+i*2}return{mapping:u,xOffset:w,yOffset:l+b*C,canvasHeight:wU(l+(b+1)*C)}}function yP(t,e,n,i){let o=0;for(let f=e;f<n;f++){var u;const l=t[f];o+=((u=i[l])===null||u===void 0?void 0:u.layoutWidth)||0}return o}function vP(t,e,n,i,o,u){let f=e,l=0;for(let b=e;b<n;b++){const w=yP(t,b,b+1,o);l+w>i&&(f<b&&u.push(b),f=b,l=0),l+=w}return l}function EU(t,e,n,i,o,u){let f=e,l=e,b=e,w=0;for(let C=e;C<n;C++)if((t[C]===" "||t[C+1]===" "||C+1===n)&&(b=C+1),b>l){let L=yP(t,l,b,o);w+L>i&&(f<l&&(u.push(l),f=l,w=0),L>i&&(L=vP(t,l,b,i,o,u),f=u[u.length-1])),l=b,w+=L}return w}function SU(t,e,n,i,o=0,u){u===void 0&&(u=t.length);const f=[];return e==="break-all"?vP(t,o,u,n,i,f):EU(t,o,u,n,i,f),f}function AU(t,e,n,i,o,u){let f=0,l=0;for(let b=e;b<n;b++){const w=t[b],C=i[w];C?(l||(l=C.layoutHeight),o[b]=f+C.layoutWidth/2,f+=C.layoutWidth):(an.warn("Missing character: ".concat(w," (").concat(w.codePointAt(0),")"))(),o[b]=f,f+=xU)}u[0]=f,u[1]=l}function PU(t,e,n,i,o){const u=Array.from(t),f=u.length,l=new Array(f),b=new Array(f),w=new Array(f),C=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,L=[0,0],k=[0,0];let H=0,K=0,re=0;for(let W=0;W<=f;W++){const G=u[W];if((G===`
`||W===f)&&(re=W),re>K){const Z=C?SU(u,n,i,o,K,re):bU;for(let fe=0;fe<=Z.length;fe++){const Te=fe===0?K:Z[fe-1],Pe=fe<Z.length?Z[fe]:re;AU(u,Te,Pe,o,l,k);for(let ze=Te;ze<Pe;ze++){var ce;const Oe=u[ze],Me=((ce=o[Oe])===null||ce===void 0?void 0:ce.layoutOffsetY)||0;b[ze]=H+k[1]/2+Me,w[ze]=k[0]}H=H+k[1]*e,L[0]=Math.max(L[0],k[0])}K=re}G===`
`&&(l[K]=0,b[K]=0,w[K]=0,K++)}return L[1]=H,{x:l,y:b,rowWidth:w,size:L}}function IU({value:t,length:e,stride:n,offset:i,startIndices:o,characterSet:u}){const f=t.BYTES_PER_ELEMENT,l=n?n/f:1,b=i?i/f:0,w=o[e]||Math.ceil((t.length-b)/l),C=u&&new Set,L=new Array(e);let k=t;if(l>1||b>0){const H=t.constructor;k=new H(w);for(let K=0;K<w;K++)k[K]=t[K*l+b]}for(let H=0;H<e;H++){const K=o[H],re=o[H+1]||w,ce=k.subarray(K,re);L[H]=String.fromCodePoint.apply(null,ce),C&&ce.forEach(C.add,C)}if(C)for(const H of C)u.add(String.fromCodePoint(H));return{texts:L,characterCount:w}}class xP{constructor(e=5){N(this,"limit",void 0),N(this,"_cache",{}),N(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function CU(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const fu={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:CU(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},c2=1024,u2=.9,h2=1.2,bP=3;let Fm=new xP(bP);function MU(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Fm.get(t);if(!i)return n;for(const o in i.mapping)n.has(o)&&n.delete(o);return n}function LU(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function d2(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function kU(t){an.assert(Number.isFinite(t)&&t>=bP,"Invalid cache limit"),Fm=new xP(t)}class RU{constructor(){N(this,"props",{...fu}),N(this,"_key",void 0),N(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*h2+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=MU(this._key,this.props.characterSet),i=Fm.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const o=this._generateFontAtlas(n,i);this._atlas=o,Fm.set(this._key,o)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:o,fontSize:u,buffer:f,sdf:l,radius:b,cutoff:w}=this.props;let C=n&&n.data;C||(C=document.createElement("canvas"),C.width=c2);const L=C.getContext("2d",{willReadFrequently:!0});d2(L,i,u,o);const{mapping:k,canvasHeight:H,xOffset:K,yOffset:re}=TU({getFontWidth:ce=>L.measureText(ce).width,fontHeight:u*h2,buffer:f,characterSet:e,maxCanvasWidth:c2,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(C.height!==H){const ce=L.getImageData(0,0,C.width,C.height);C.height=H,L.putImageData(ce,0,0)}if(d2(L,i,u,o),l){const ce=new vU({fontSize:u,buffer:f,radius:b,cutoff:w,fontFamily:i,fontWeight:"".concat(o)});for(const W of e){const{data:G,width:Z,height:fe,glyphTop:Te}=ce.draw(W);k[W].width=Z,k[W].layoutOffsetY=u*u2-Te;const Pe=L.createImageData(Z,fe);LU(G,Pe),L.putImageData(Pe,k[W].x,k[W].y)}}else for(const ce of e)L.fillText(ce,k[ce].x,k[ce].y+f+u*u2);return{xOffset:K,yOffset:re,mapping:k,data:C,width:C.width,height:C.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:o,sdf:u,radius:f,cutoff:l}=this.props;return u?"".concat(e," ").concat(n," ").concat(i," ").concat(o," ").concat(f," ").concat(l):"".concat(e," ").concat(n," ").concat(i," ").concat(o)}}const DU=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,zU=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,OU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class hx extends tc{constructor(...e){super(...e),N(this,"state",void 0)}getShaders(){return super.getShaders({vs:DU,fs:zU,modules:[og,ag]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:o}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:o,sizeMinPixels:u,sizeMaxPixels:f,getLineWidth:l}=this.props;let{padding:b}=this.props;b.length<4&&(b=[b[0],b[1],b[0],b[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!l,padding:b,sizeUnits:Wl[o],sizeScale:i,sizeMinPixels:u,sizeMaxPixels:f}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Kd(e,{...this.getShaders(),id:this.props.id,geometry:new sg({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}N(hx,"defaultProps",OU);N(hx,"layerName","TextBackgroundLayer");const f2={start:1,middle:0,end:-1},p2={top:1,center:0,bottom:-1},yy=[0,0,0,255],FU=1,BU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:yy},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:fu.characterSet},fontFamily:fu.fontFamily,fontWeight:fu.fontWeight,lineHeight:FU,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:yy},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:yy},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class dx extends uP{constructor(...e){super(...e),N(this,"state",void 0),N(this,"getBoundingRect",(n,i)=>{let{size:[o,u]}=this.transformParagraph(n,i);const{fontSize:f}=this.state.fontAtlasManager.props;o/=f,u/=f;const{getTextAnchor:l,getAlignmentBaseline:b}=this.props,w=f2[typeof l=="function"?l(n,i):l],C=p2[typeof b=="function"?b(n,i):b];return[(w-1)*o/2,(C-1)*u/2,o,u]}),N(this,"getIconOffsets",(n,i)=>{const{getTextAnchor:o,getAlignmentBaseline:u}=this.props,{x:f,y:l,rowWidth:b,size:[w,C]}=this.transformParagraph(n,i),L=f2[typeof o=="function"?o(n,i):o],k=p2[typeof u=="function"?u(n,i):u],H=f.length,K=new Array(H*2);let re=0;for(let ce=0;ce<H;ce++){const W=(1-L)*(w-b[ce])/2;K[re++]=(L-1)*w/2+W+f[ce],K[re++]=(k-1)*C/2+l[ce]}return K})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new RU},this.props.maxWidth>0&&an.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:o}=e;(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:o,characterSet:u}=this.state,f={...e,characterSet:u,fontFamily:n,fontWeight:i};if(!o.mapping)return o.setProps(f),!0;for(const l in f)if(f[l]!==o.props[l])return o.setProps(f),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,o=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:u}=this.props,f=n.startIndices,l;const b=i==="auto"&&new Set;if(o&&f){const{texts:w,characterCount:C}=IU({...ArrayBuffer.isView(o)?{value:o}:o,length:n.length,startIndices:f,characterSet:b});l=C,u=(L,{index:k})=>w[k]}else{const{iterable:w,objectInfo:C}=cg(n);f=[0],l=0;for(const L of w){C.index++;const k=Array.from(u(L,C)||"");b&&k.forEach(b.add,b),l+=k.length,f.push(l)}}this.setState({getText:u,startIndices:f,numInstances:l,characterSet:b||i})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,o=i.mapping,u=this.state.getText,{wordBreak:f,lineHeight:l,maxWidth:b}=this.props,w=u(e,n)||"";return PU(w,l,f,b*i.props.fontSize,o)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:o,texture:u,mapping:f},styleVersion:l}=this.state,{data:b,_dataDiff:w,getPosition:C,getColor:L,getSize:k,getAngle:H,getPixelOffset:K,getBackgroundColor:re,getBorderColor:ce,getBorderWidth:W,backgroundPadding:G,background:Z,billboard:fe,fontSettings:Te,outlineWidth:Pe,outlineColor:ze,sizeScale:Oe,sizeUnits:Me,sizeMinPixels:Ee,sizeMaxPixels:Re,transitions:nt,updateTriggers:rt}=this.props,yt=this.getSubLayerClass("characters",ux),Dt=this.getSubLayerClass("background",hx);return[Z&&new Dt({getFillColor:re,getLineColor:ce,getLineWidth:W,padding:G,getPosition:C,getSize:k,getAngle:H,getPixelOffset:K,billboard:fe,sizeScale:Oe,sizeUnits:Me,sizeMinPixels:Ee,sizeMaxPixels:Re,transitions:nt&&{getPosition:nt.getPosition,getAngle:nt.getAngle,getSize:nt.getSize,getFillColor:nt.getBackgroundColor,getLineColor:nt.getBorderColor,getLineWidth:nt.getBorderWidth,getPixelOffset:nt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:rt.getPosition,getAngle:rt.getAngle,getSize:rt.getSize,getFillColor:rt.getBackgroundColor,getLineColor:rt.getBorderColor,getLineWidth:rt.getBorderWidth,getPixelOffset:rt.getPixelOffset,getBoundingRect:{getText:rt.getText,getTextAnchor:rt.getTextAnchor,getAlignmentBaseline:rt.getAlignmentBaseline,styleVersion:l}}}),{data:b.attributes&&b.attributes.background?{length:b.length,attributes:b.attributes.background}:b,_dataDiff:w,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new yt({sdf:Te.sdf,smoothing:Number.isFinite(Te.smoothing)?Te.smoothing:fu.smoothing,outlineWidth:Pe/(Te.radius||fu.radius),outlineColor:ze,iconAtlas:u,iconMapping:f,getPosition:C,getColor:L,getSize:k,getAngle:H,getPixelOffset:K,billboard:fe,sizeScale:Oe*o,sizeUnits:Me,sizeMinPixels:Ee*o,sizeMaxPixels:Re*o,transitions:nt&&{getPosition:nt.getPosition,getAngle:nt.getAngle,getColor:nt.getColor,getSize:nt.getSize,getPixelOffset:nt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:rt.getText,getPosition:rt.getPosition,getAngle:rt.getAngle,getColor:rt.getColor,getSize:rt.getSize,getPixelOffset:rt.getPixelOffset,getIconOffsets:{getTextAnchor:rt.getTextAnchor,getAlignmentBaseline:rt.getAlignmentBaseline,styleVersion:l}}}),{data:b,_dataDiff:w,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){kU(e)}}N(dx,"defaultProps",BU);N(dx,"layerName","TextLayer");const NU=({tracks:t,onBackToUpload:e})=>{const n=gn.useRef(null),i=gn.useRef(null),o=gn.useRef(null),u=gn.useRef(null),f=gn.useRef(0),l=gn.useRef(0),[b,w]=gn.useState(!1),[C,L]=gn.useState(0),[k,H]=gn.useState(0),[K,re]=gn.useState(1),[ce,W]=gn.useState({});gn.useEffect(()=>{if(!n.current||i.current)return;const Me=new sw.Map({container:n.current,style:{version:8,glyphs:"https://tiles.stadiamaps.com/fonts/{fontstack}/{range}.pbf",sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:22}]},center:[0,0],zoom:2,pitch:45,bearing:0,maxPitch:85});return Me.addControl(new sw.NavigationControl,"top-right"),Me.on("load",()=>{if(t.length>0){const Ee=G(t);Ee.west!==Ee.east&&Ee.south!==Ee.north&&Me.fitBounds([[Ee.west,Ee.south],[Ee.east,Ee.north]],{padding:50,duration:1e3})}if(!o.current){const Ee=new $6({interleaved:!0,layers:[]});Me.addControl(Ee),o.current=Ee}}),i.current=Me,()=>{if(i.current){if(o.current){try{i.current.removeControl(o.current)}catch{}o.current=null}i.current.remove(),i.current=null}}},[t]);const G=gn.useCallback(Me=>{if(!Me||Me.length===0)return{west:-180,south:-90,east:180,north:90};let Ee=90,Re=-90,nt=180,rt=-180;return Me.forEach(yt=>{yt.coordinates&&yt.coordinates.length>0&&yt.coordinates.forEach(Dt=>{Dt&&typeof Dt.latitude=="number"&&typeof Dt.longitude=="number"&&(Ee=Math.min(Ee,Dt.latitude),Re=Math.max(Re,Dt.latitude),nt=Math.min(nt,Dt.longitude),rt=Math.max(rt,Dt.longitude))})}),{west:nt,south:Ee,east:rt,north:Re}},[]);gn.useEffect(()=>{var Me;if(console.log("=== TRACK PROCESSING START ==="),console.log("Map ref exists:",!!i.current),console.log("Map style loaded:",(Me=i.current)==null?void 0:Me.isStyleLoaded()),console.log("Tracks count:",t.length),t.forEach((Ee,Re)=>{var nt,rt,yt,Dt;console.log(`Track ${Re} structure:`,{name:Ee.name,id:Ee.id,pilotName:Ee.pilotName,coordinatesCount:(nt=Ee.coordinates)==null?void 0:nt.length,timestampsCount:(rt=Ee.timestamps)==null?void 0:rt.length,duration:Ee.duration,color:Ee.color,coordinates:(yt=Ee.coordinates)==null?void 0:yt.slice(0,3),timestamps:(Dt=Ee.timestamps)==null?void 0:Dt.slice(0,3)}),Ee.coordinates&&Ee.coordinates.length>0&&console.log(`Track ${Re} first coordinate details:`,{hasTimestamp:!!Ee.coordinates[0].timestamp,timestampType:typeof Ee.coordinates[0].timestamp,timestampValue:Ee.coordinates[0].timestamp,latitude:Ee.coordinates[0].latitude,longitude:Ee.coordinates[0].longitude})}),!i.current){console.log("Map ref not ready, waiting...");return}if(!i.current.isStyleLoaded()){console.log("Map style not loaded, waiting...");const Ee=()=>{console.log("Map style now loaded, processing tracks..."),Z()};i.current.loaded()?(console.log("Map already loaded, processing tracks..."),Z()):i.current.once("load",Ee);return}Z()},[t]);const Z=gn.useCallback(()=>{if(console.log("=== PROCESSING TRACKS FUNCTION CALLED ==="),!i.current){console.log("No map ref in processTracks");return}if(t.length===0){console.log("No tracks in processTracks");return}console.log("=== PROCESSING TRACKS ===");const Me=i.current;if(t.length===0){console.log("No tracks to process");return}let Ee=0;t.forEach((Re,nt)=>{var Tt;console.log(`=== PROCESSING TRACK ${nt+1} ===`),console.log("Track name:",Re.name),console.log("Track ID:",Re.id),console.log("Original coordinates count:",(Tt=Re.coordinates)==null?void 0:Tt.length);const rt=`track-${Re.id}`,yt=`label-${Re.id}`,Dt=`head-${Re.id}`;console.log("Creating timestamps from original coordinates..."),console.log("Sample of first 3 original coordinates:",Re.coordinates.slice(0,3));const Sn=Re.coordinates||[],Xt=Sn.filter(pt=>pt&&typeof pt.longitude=="number"&&typeof pt.latitude=="number"&&pt.timestamp).map(pt=>{const Ot=pt.timestamp;return console.log("Processing timestamp:",Ot,"Type:",typeof Ot),Ot instanceof Date?Ot.getTime():typeof Ot=="string"?new Date(Ot).getTime():typeof Ot=="number"?Ot:null}).filter(pt=>pt!==null);console.log("Timestamps count:",Xt.length),Xt.length>0?(console.log("First timestamp:",Xt[0]),console.log("Last timestamp:",Xt[Xt.length-1])):(console.error("No valid timestamps created!"),console.error("Original coordinates sample:",Sn.slice(0,3))),console.log("Filtering coordinates...");const Ye=Re.coordinates.filter(pt=>pt&&typeof pt.longitude=="number"&&typeof pt.latitude=="number").map(pt=>[pt.longitude,pt.latitude,pt.altitude??0]);console.log("Filtered coordinates count:",Ye.length),Ye.length>0&&(console.log("First coordinate:",Ye[0]),console.log("Last coordinate:",Ye[Ye.length-1])),Ye.length!==0&&(console.log("Skipping MapLibre line source. Using deck.gl overlay."),Re.trackId=rt,Re.labelId=yt,Re.coordinates=Ye,Re.timestamps=Xt,Re.headId=Dt,console.log("Track processing complete:"),console.log("  - Track ID:",rt),console.log("  - Label ID:",yt),console.log("  - Coordinates count:",Ye.length),console.log("  - Timestamps count:",Xt.length),console.log("  - Color:",Re.color))}),Ee=0,console.log("=== DURATION CALCULATION (POST-BUILD) ==="),t.forEach(Re=>{if(Re.timestamps&&Re.timestamps.length>1){const nt=Re.timestamps[Re.timestamps.length-1]-Re.timestamps[0];console.log(`Track ${Re.name} duration:`,nt,"ms"),Ee=Math.max(Ee,nt)}}),console.log("Final max duration:",Ee,"ms"),H(Ee);try{fe(0)}catch(Re){console.error("Failed initial overlay render",Re)}return()=>{t.forEach(Re=>{Re.trackId&&Me.getLayer(Re.trackId)&&Me.removeLayer(Re.trackId),Re.labelId&&Me.getLayer(Re.labelId)&&Me.removeLayer(Re.labelId),Re.headId&&Me.getLayer(Re.headId)&&Me.removeLayer(Re.headId),Re.trackId&&Me.getSource(Re.trackId)&&Me.removeSource(Re.trackId),Re.labelId&&Me.getSource(Re.labelId)&&Me.removeSource(Re.labelId),Re.headId&&Me.getSource(Re.headId)&&Me.removeSource(Re.headId)})}},[t]);gn.useEffect(()=>{if(!i.current||k<=0||!b)return;f.current=Date.now(),l.current=C*1e3;const Me=()=>{if(!b)return;const Ee=Date.now()-f.current,Re=Math.min(l.current+Ee*K,k);L(Re/1e3),fe(Re),Re<k?u.current=requestAnimationFrame(Me):w(!1)};return u.current=requestAnimationFrame(Me),()=>{u.current&&cancelAnimationFrame(u.current)}},[b,K,k]);const fe=gn.useCallback(Me=>{if(!i.current)return;const Ee=[];t.forEach(Re=>{const{coordinates:nt,timestamps:rt,labelId:yt,trackId:Dt}=Re;if(!nt||!rt||!yt||rt.length===0)return;let Sn=0;for(let Xt=0;Xt<rt.length&&rt[Xt]-rt[0]<=Me;Xt++)Sn=Xt;if(nt[Sn]){const Xt=nt.slice(0,Sn+1),Ye=Re.color.replace("#",""),Tt=parseInt(Ye.substring(0,2),16)||255,pt=parseInt(Ye.substring(2,4),16)||0,Ot=parseInt(Ye.substring(4,6),16)||0;Ee.push(new cx({id:`${Dt}-path`,data:[{path:Xt}],getPath:Mt=>Mt.path,getColor:[Tt,pt,Ot,200],widthUnits:"pixels",getWidth:3})),Ee.push(new lx({id:`${Dt}-head`,data:[nt[Sn]],getPosition:Mt=>Mt,getFillColor:[Tt,pt,Ot,255],radiusUnits:"pixels",getRadius:6,stroked:!0,getLineColor:[255,255,255,255],lineWidthUnits:"pixels",getLineWidth:2})),Ee.push(new dx({id:`${Dt}-label`,data:[{position:nt[Sn],text:Re.pilotName}],getPosition:Mt=>Mt.position,getText:Mt=>Mt.text,getSize:14,getColor:[255,255,255,255],background:!0,getBackgroundColor:[0,0,0,180],billboard:!0})),W(Mt=>({...Mt,[Re.id]:{pilot:Re.pilotName,position:Sn+1,total:nt.length}}))}}),o.current&&o.current.setProps({layers:Ee})},[t]),Te=()=>{b?(w(!1),u.current&&cancelAnimationFrame(u.current)):w(!0)},Pe=()=>{w(!1),L(0),u.current&&cancelAnimationFrame(u.current),fe(0),W({})},ze=Me=>{if(k<=0)return;const Re=Math.max(0,Math.min(100,Me))/100*k;L(Re/1e3),u.current&&cancelAnimationFrame(u.current),fe(Re),b&&(f.current=Date.now(),l.current=Re,u.current=requestAnimationFrame(()=>{const nt=Date.now()-f.current,rt=Math.min(l.current+nt*K,k);L(rt/1e3),fe(rt)}))},Oe=Me=>{const Ee=Math.floor(Me/60),Re=Math.floor(Me%60);return`${Ee}:${Re.toString().padStart(2,"0")}`};return at.jsxs("div",{className:"w-full h-full relative",children:[at.jsx("div",{ref:n,className:"w-full h-full"}),at.jsxs("div",{className:"absolute top-4 left-4 bg-white bg-opacity-90 rounded-lg shadow-lg p-4 min-w-80",children:[at.jsxs("div",{className:"flex items-center justify-between mb-4",children:[at.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Replay Controls"}),at.jsx("button",{onClick:e,className:"text-gray-600 hover:text-gray-800 p-2",title:"Back to upload",children:at.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:at.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})]}),at.jsxs("div",{className:"space-y-4",children:[at.jsxs("div",{className:"flex items-center space-x-2",children:[at.jsx("button",{onClick:Te,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:b?"Pause":"Play"}),at.jsx("button",{onClick:Pe,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Reset"})]}),at.jsxs("div",{className:"space-y-2",children:[at.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[at.jsx("span",{children:Oe(C)}),at.jsx("span",{children:Oe(k/1e3)})]}),at.jsx("input",{type:"range",min:"0",max:"100",value:k>0?C/(k/1e3)*100:0,onChange:Me=>ze(parseFloat(Me.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"})]}),at.jsxs("div",{className:"space-y-2",children:[at.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Playback Speed"}),at.jsx("input",{type:"range",min:"0.5",max:"10",step:"0.5",value:K,onChange:Me=>re(parseFloat(Me.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),at.jsxs("div",{className:"text-sm text-gray-600",children:[K,"x"]})]})]}),Object.keys(ce).length>0&&at.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[at.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Positions"}),at.jsx("div",{className:"space-y-1",children:Object.entries(ce).map(([Me,Ee])=>at.jsxs("div",{className:"text-xs text-gray-600",children:[Ee.pilot,": ",Ee.position,"/",Ee.total]},Me))})]})]}),at.jsxs("div",{className:"absolute top-4 right-4 bg-white bg-opacity-90 rounded-lg shadow-lg p-4",children:[at.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Tracks"}),at.jsx("div",{className:"space-y-2",children:t.map(Me=>at.jsxs("div",{className:"flex items-center space-x-2",children:[at.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:Me.color}}),at.jsx("span",{className:"text-sm text-gray-700",children:Me.pilotName})]},Me.id))})]})]})};function UU(){const[t,e]=gn.useState([]),[n,i]=gn.useState(!1),o=l=>{e(l)},u=()=>{i(!0)},f=()=>{i(!1),e([])};return at.jsx("div",{className:"w-full h-full",children:n?at.jsx(NU,{tracks:t,onBackToUpload:f}):at.jsx(Ek,{onFilesUploaded:o,onCreateReplay:u,tracks:t})})}vy.createRoot(document.getElementById("root")).render(at.jsx(RC.StrictMode,{children:at.jsx(UU,{})}));
